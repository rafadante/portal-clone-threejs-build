(self.webpackChunkportal_react=self.webpackChunkportal_react||[]).push([[487],{487:(P,t,e)=>{e.r(t),e.d(t,{init:()=>ha});var b=e(408),w=e(489),A=e.n(w),t=e(583),i=e(910),n=e(613),B=e.n(n),n=(b.LoY.prototype.computeBoundsTree=i.LO,b.LoY.prototype.disposeBoundsTree=i.je,b.eaF.prototype.raycast=i.zQ,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(s=!0,a=!(r=.5),l=1,f=!(o=63),document.getElementById("next-map").style.transform="scale(0.5)",B()(".desktop").css("display","none")):(a=!(s=!(r=.5)),l=2,o=63,f="true"==localStorage.getItem("antialising")),window.canvasWidth=window.innerWidth,window.canvasHeight=window.innerHeight,window.canvasWidth=Math.min(window.canvasWidth,1920),window.canvasHeight=Math.min(window.canvasHeight,1080),new b.ubm(o,window.canvasWidth/window.canvasHeight,.1,1e3)),i=(n.rotation.order="YXZ",n.position.set(0,0,30),window.fov=o,new b.B69),o=(i.name="listener",n.add(i),Math.atan(Math.tan(n.fov*Math.PI/180/2)*n.aspect),Math.PI,n.clone()),i=(o.layers.mask=2,o.near=1e-5,o.updateProjectionMatrix(),new b.B69),i=(i.position.z=-1.25,i.name="cubeHolder",window.cubeHolder=i,n.add(i),new b.JeP({alpha:!0,powerPreference:"high-performance",antialias:f})),f=(i.setPixelRatio(window.devicePixelRatio),i.setSize(window.canvasWidth,window.canvasHeight),i.outputColorSpace=b.er$,i.toneMapping=b.FV,i.toneMappingExposure=1,i.shadowMap.enabled=a,i.shadowMap.type=b.Wk7,i.shadowMap.needsUpdate=!0,i.localClippingEnabled=!0,i.physicallyCorrectLights=!0,i.domElement.id="viewer-3d",i.shadowMap.autoUpdate=!0,i.domElement.id="viewer-3d",new t.N(n,i.domElement));function v(){return{cube:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},cube_2:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},scale_cube:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},door:{count:0,max:5},door:{count:0,max:5},sphere:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},gel_gun_blue:{count:0,max:10},gel_gun_orange:{count:0,max:10},gel_gun_white:{count:0,max:10},pedestal_button:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!0},radio:{count:0,max:1,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},button_weight:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},button_box:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!0},button_sphere:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!0},dispenser:{count:0,max:100,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},ramp:{count:0,max:10},ramp_half:{count:0,max:10},ramp_half2:{count:0,max:10},stairs:{count:0,max:10},light_bridge:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},tractor_beam:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_emitter:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_receiver:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_relay:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},pellet_launcher:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},pellet_catcher:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_cube:{count:0,max:10,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!1,ground:!1,ceiling:!0,trigger:!1},faith_plate:{count:0,max:10,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},light:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},lightEmissive:{count:0,max:10,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},stripe:{count:0,max:10},gel_blue:{count:0,max:10},gel_recharger:{count:0,max:10},gel_reflection:{count:0,max:10},gel_clear:{count:0,max:10},gel_white:{count:0,max:10},angled_panel:{count:0,max:10,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},gel_orange:{count:0,max:10},gel_purple:{count:0,max:10},camera:{count:0,max:5,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!1,ceiling:!1,trigger:!1},bed:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},incinerator:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!0},trash:{count:0,max:5,instanced:!0,interactive:!0,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},toilet:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},desk:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.8,wall:!1,ground:!0,ceiling:!1,trigger:!1},step:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.8,wall:!1,ground:!0,ceiling:!1,trigger:!1},cabinet:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},sign:{count:0,max:5,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},portal_0:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},portal_1:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},laser_field:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},fizzler:{count:0,max:20,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!0,trigger:!1},observation_room:{count:0,max:10},glass:{count:0,max:20},portal_gun:{count:0,max:1,instanced:!1,interactive:!1,roughness:.2,envIntensity:.5,wall:!1,ground:!0,ceiling:!1,trigger:!1},paint_gun:{count:0,max:1},trigger_area:{count:0,max:10},trigger_voice:{count:0,max:10},trigger_audio:{count:0,max:10},trigger_save:{count:0,max:10},portal:{count:0,max:10},spawn:{count:0,max:1},piston_platforms:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!1,trigger:!0},track_platforms:{count:0,max:10,instanced:!0,interactive:!1,roughness:.2,envIntensity:.5,wall:!0,ground:!0,ceiling:!1,trigger:!0}}}f.minDistance=0;var U={LASERS:new b.YJl,STATS_UI:{time:0,portals:0,steps:0},BOUNDING_BOX:[],PLATFORM_BODIES:[],FINISHED:!1,PIXEL_RATIO:r,DEBUGGER_GROUP:new b.YJl,SCENE:new b.Z58,SCENE_CHILDREN:new b.YJl,MAIN_CAMERA:n,MAIN_CAMERA_GROUP:new b.YJl,PIVOT:null,PORTAL_GUN_CAMERA:o,CONTROLS:f,POINTER_CONTROLS:null,RENDERER:i,COMPOSER:null,COMPOSER2:null,ITEM_HOLDED_NAME:null,FPS_MODE:!1,MOBILE:s,PAUSED:!1,CONNECTING:!1,STOP_TIME:!1,FPS_UNLOCKED:!0,HOLDING_ITEM:!1,ALLOW_PLACE_PORTALS:!0,GEL_ORANGE:!1,LOADED_LEVEL:!1,ITEMS_ADDED:new b.YJl,ROOM:new b.YJl,ITEMS:new b.YJl,CUBES:new b.YJl,PLANE_USER_DATA:[],PLANE_LEVEL_INSTANCED:null,BUDGET:5e3,PORTALS:[null,null],PORTAL_RECURSION_LEVELS:l,PORTAL_TARGETS:[new b.nWS(+window.canvasWidth,+window.canvasHeight),new b.nWS(+window.canvasWidth,+window.canvasHeight)],PORTAL_TMP_TARGETS:[new b.nWS(+window.canvasWidth,+window.canvasHeight),new b.nWS(+window.canvasWidth,+window.canvasHeight)],PORTAL_WIDTH:.9,PORTAL_DEPTH:1.8,PORTAL_EPS:.01,PORTAL_COLORS:[57855,16762368],PORTAL_CDBB_HEIGHT:3,PORTAL_HEIGHT:.2,PORTAL_RING_THICKNESS:.3,PORTAL_SHADER:[],PORTAL_BOX:[],PORTAL_INNER_BOX:[],CANNON_WORLD:null,CGROUP_ENVIRONMENT:1,CGROUP_PORTAL_HOST_CDISABLE:[2,4],CGROUP_DYNAMIC:2,CGROUP_PLAYER:4,CGROUP_ALL:255,PHYSICS_UPDATEPERSEC_LIMIT:75,PHYSICS_MATERIAL:new w.Material({friction:.01,restitution:.1}),PLAYER:null,PLAYER_MODEL:null,PLAYER_MODEL_CLONE:null,PLAYER_ANIMATIONS:null,MIXERS:null,MIXERS_CLONE:null,BOX_BODY:[],SPHERE_BODY:[],TRIGGER:{button_weight:[],button_box:[],button_sphere:[],pedestal_button:[]},DYMANIC_ITEMS:{cube:[],cube_2:[],scale_cube:[],sphere:[],gel_gun_blue:[],gel_gun_orange:[],gel_gun_white:[],pedestal_button:[],radio:[],button_weight:[],button_box:[],button_sphere:[],dispenser:[],ramp:[],ramp_half:[],ramp_half2:[],stairs:[],light_bridge:[],tractor_beam:[],laser_emitter:[],laser_receiver:[],laser_relay:[],laser_cube:[],faith_plate:[],door:[],light:[],lightEmissive:[],stripe:[],gel_blue:[],gel_recharger:[],gel_reflection:[],gel_clear:[],gel_orange:[],gel_purple:[],gel_white:[],camera:[],portal_0:[],portal_1:[],laser_field:[],fizzler:[],glass:[],portal_gun:[],trigger_area:[],trigger_save:[],trigger_voice:[],trigger_audio:[],pellet_launcher:[],pellet_catcher:[],angled_panel:[],paint_gun:[],spawn:[],bed:[],trash:[],toilet:[],desk:[],cabinet:[],sign:[],piston_platforms:[],track_platforms:[],incinerator:[],step:[]},TRIGGER_BOXES:[],INTERACTIVE:[],ITEM_CUBE:null,DYNAMIC_OBJECTS:[],SELECTED_ID:[],SELECTED_ID_ORANGE:[],SELECTED_SIDE:null,SELECTED_COLOR:[],SELECTED:null,SELECTING:!1,SELECTED_FOR_CONNECTION:null,GELS:[],CURRENT_ITEM:null,CURRENT_ITEM_ID:null,GUN:null,GUN_CLONE:null,GUN_CLONE2:null,GUN_MODE:"portal",ENV_MAP:null,STATS:null,INK_MATERIAL:null,CORRIDOR_ENTER:null,ENTER_DOOR:null,EXIT_DOOR:null,LASER_EMITTER:[],LASER_EMITTER_OBJ:[],LASER_EMITTER_LENGTH:0,LASER_EMITTER_BOUNDING_BOX:[],LASER_EMITTER_RAYCASTER:[],LASER_CUBE:null,TRACTOR_BEAM:[],TRACTOR_BEAM_BOUNDING_BOX:[],TRACTOR_BEAM_RAYCASTER:[],TRACTOR_BEAM_LENGTH:0,LIGHT_BRIDGE_RAYCASTER:[],LIGHT_BRIDGE_CLONE:[],LIGHT_BRIDGE_COLLIDER_CLONE:[],LIGHT_BRIDGE_TRIGGER:"Middle Horizontal",GLASS_TRIGGER:"Middle Vertical",LASER_FIELD_TRIGGER:"Middle Vertical",FIZZLER_TRIGGER:"Middle Vertical",LASER_FIELD_RAYCASTER:[],FIZZLER_RAYCASTER:[],GLASS_RAYCASTER:[],LIGHT_GROUP:null,INTERVAL:1/60,CURRENT_INSTANCED:null,CAMERA_OBJ_HORIZONTAL:[],CAMERA_OBJ_VERTICAL:[],MATERIAL_PORTAL_EDITOR:null,MATERIAL_NON_PORTAL_EDITOR:null,OBSERVATION_ROOM:null,OBSERVATION_ROOM_IMG:null,OBSERVATION_ROOM_HALF:null,IMG_CHECK:null,IMG_CLOSE:null,SMOOTHNESS:.1,GOO_PLANES:[],GOO_BOXES:[],FAITH_PLATE_TO_ROTATE:[],FAITH_PLATE_CONTACT_BOX:[],UNIFORMS_GEL:null,UNIFORMS_LIGHT_BRIDGE:null,UNIFORMS_TRACTOR_BEAM:null,UNIFORMS_TRACTOR_BEAM_ORANGE:null,UNIFORMS_PORTAL_GUN_ENERGY:null,UNIFORMS_FIZZLER:null,UNIFORMS_DISSOLVER:null,MATERIAL_DISSOLVER:null,LIGHTNIN_STRIKE_1:null,LIGHTNIN_STRIKE_2:null,LIGHTNIN_STRIKE_3:null,TARGET_ROTATION_X:0,TARGET_ROTATION_Y:0,SPOTLIGHT:null,DOORS:[],MATERIAL_FLOOR_PORTAL:null,MATERIAL_FLOOR_NON_PORTAL:null,MATERIAL_WALL_PORTAL:null,MATERIAL_WALL_PORTAL2:null,MATERIAL_WALL_PORTAL3:null,MATERIAL_WALL_PORTAL4:null,MATERIAL_WALL_NON_PORTAL:null,MATERIAL_WALL_NON_PORTAL2:null,MATERIAL_GUN:null,MATERIAL_MAIN_MENU:null,MATERIAL_SUB_MENU:null,TEXTURE_MENU_GRID:null,MATERIAL_TRACTOR_BEAM:null,MATERIAL_TRACTOR_BEAM_REVERSE:null,MATERIAL_LIGHT_BRIDGERS:null,MATERIAL_LASER_FIELD:null,MATERIAL_FIZZLER:null,UNIFORMS_LASER_FIELD:null,ELEVATOR:null,ELEVATOR_DOOR_LEFT:null,ELEVATOR_DOOR_RIGHT:null,ELEVATOR_TRIGGER:null,WALL_CORRIDOR_ENTER:null,BODY_ELEVATOR:null,WALL_CORRIDOR_BACK:null,CORRIDOR_COLLIDERS:[],PLANE_EXIT_DOOR:null,PORTAL_GUN_CLONE_STATE:!0,PLAYER_CLONE_STATE:!0,FLASH:null,FLASH_CLONE:null,PORTAL_GUN_FLASH:null,PORTAL_RENDER_LEVEL:0,LIGHT_PORTAL_0:null,LIGHT_PORTAL_1:null,RADIO_MUSIC:[],CAMERAS:[],ITEMS_COUNT:v(),SCENE_FPS:null,LISTENER:new b.Pf$,CANNON_BODIES:[],CANNON_BODIES_CONTINUOUS:[],LEVEL_ENTERED:!1,DOOR_OPEN_STATE:!1,AMBIENT_AUDIO:null,PORTAL_AUDIO:[],DRAGGING:!1,DRAGGED_ITEM_ELEMENT:null,CURRENT_LINE:null,CONNECTIONS:[],POSITIONAL_AUDIO_GROUP:null,PORTAL_AUDIO:[new b.B69,new b.B69],SELECTED_FOR_BLOOM:null,PLAYER_MOVING:!1,GLASS_PANELS:[],RESIZING_GLASS_PANEL:!1,BLOCK_PORTAL:[],MATERIAL_GLASS:null,MATERIAL_GRID:null,GRID_STATE:!1,LOADED_CONNECTIONS:[],PORTAL_GUN_INITIATE:"all",PORTAL_GUN_INITIATE_HOLDER:null,TELEPORTING_TARGET_QUATERNION:null,PORTAL_GUN_BOX:[],WALL_BODIES:[],ACTIVATED:[],SOUNDS_FPS:[],MATERIAL_TRIGGER_ONCE:null,MATERIAL_TRIGGER_MULT:null,BATCHED_ORANGE:null,BATCHED_BLUE:null,BATCHED_GLASS:null,BATCHED_GRID:null,LASER_EMITTER_PORTAL_CLONES:[],DYNAMIC_BODIES:[],LASER_EMITTER_TRIGGER:"Bottom",LASER_RECEIVER_TRIGGER:"Bottom",LASER_TRIGGERS:[],MATERIAL_CONE:null,BLOCK_PLAYER_MOVE:!1,FAITH_PLATE_TARGET:null,GROUP_LINE_TRAGECTORY:new b.YJl,GOO_REFLECTIONS:!1,CUSTOM_GRAVITY:[],SPEED:1,HEAD_BOB_SPEED:6,ANGLED_PANELS:[],INSTANCED_WHITE_GEL:[],GEL_TRIGGER:[],PAINTING_GUN_MODE:[],PAINT_GUN:null,GUN_GROUP:new b.YJl,LINES:new b.YJl};function Y(e,t,i,n,o,a,r,s,l,E,c,_,d){var u;e.roughness=s,e.metalness=l,t&&((u=(new b.Tap).load("./assets/textures/"+t)).colorSpace=b.er$,e.map=u,_)&&V(u,_,d),i&&(u=(new b.Tap).load("./assets/textures/"+i),e.normalMap=u,_)&&V(u,_,d),n&&(u=(new b.Tap).load("./assets/textures/"+n),e.aoMap=u,_)&&V(u,_,d),o&&(u=(new b.Tap).load("./assets/textures/"+o),e.roughnessMap=u,_)&&V(u,_,d),a&&(u=(new b.Tap).load("./assets/textures/"+a),e.metalnessMap=u,_)&&V(u,_,d),r&&(u=(new b.Tap).load("./assets/textures/"+r),e.alphaMap=u,_)&&V(u,_,d),e.envMap=U.ENV_MAP,e.alphaTest=c,U.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select")?e.envMapIntensity=.5:e.envMapIntensity=1.5*E}function V(e,t,i){e.wrapS=e.wrapT=b.GJx,e.repeat.set(t,i),e.needsUpdate=!0}U.SCENE.add(U.SCENE_CHILDREN);var a=new b.Tap,t=a.load("./assets/textures/decal/base2.png"),r=(t.colorSpace=b.er$,a.load("./assets/textures/decal/normal.webp")),n=(U.INK_MATERIAL=new b._4j({normalMap:r,normalScale:new b.I9Y(1,1),transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-4,wireframe:!1,roughness:0}),(new b.Tap).load("./assets/textures/tilePortal.jpg")),n=(t.colorSpace=b.er$,U.MATERIAL_PORTAL_EDITOR=new b._4j({map:n,transparent:!0}),(new b.Tap).load("./assets/textures/tileNonPortal.jpg"));function H(e,t,i){e.material=t.clone();i*=5;t=e.material.map.clone(),(e.material.map=t).repeat.set(5,i),t.needsUpdate=!0,t=e.material.normalMap.clone();(e.material.normalMap=t).repeat.set(5,i),t.needsUpdate=!0,e.material.metalnessMap&&(t=e.material.metalnessMap.clone(),(e.material.metalnessMap=t).repeat.set(5,i),t.needsUpdate=!0),e.material.alphaMap&&(t=e.material.alphaMap.clone(),(e.material.alphaMap=t).repeat.set(5,i),t.needsUpdate=!0),e.material.roughnessMap&&(t=e.material.roughnessMap.clone(),(e.material.roughnessMap=t).repeat.set(5,i),t.needsUpdate=!0)}t.colorSpace=b.er$,U.MATERIAL_NON_PORTAL_EDITOR=new b._4j({map:n,transparent:!0}),U.IMG_CHECK=(new b.Tap).load("./assets/check.png"),U.IMG_CLOSE=(new b.Tap).load("./assets/close.png");var k,n=(new b.Tap).load("./assets/textures/trigger_once.jpg"),n=(t.colorSpace=b.er$,U.MATERIAL_TRIGGER_ONCE=new b.V9B({map:n}),(new b.Tap).load("./assets/textures/trigger_mult.jpg")),n=(t.colorSpace=b.er$,U.MATERIAL_TRIGGER_MULT=new b.V9B({map:n}),(new b.Tap).load("./assets/textures/cone.png"));function F(e){e.link&&!e.played&&(window.previousAudio&&(window.previousAudio.currentTime=0,window.previousAudio.pause()),e.played=!0,e.voice.currentTime=0,e.voice.play(),window.previousAudio=e.voice)}t.colorSpace=b.er$,U.MATERIAL_CONE=new b._4j({map:n,transparent:!0,opacity:.05,emissive:new b.Q1f(2,2,0),side:2}),window.listernAdded=!1;function D(e){0<e.currentTime&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA||(e.volume=e.getAttribute("volume"),void 0!==(e=e.play())&&e.then(e=>{}).catch(e=>{}))}function G(e,t,i,n,o,a,r){window.listernAdded||(window.listernAdded=!0,(k=new b.Pf$).name="listener",U.MAIN_CAMERA.add(k)),k.context.resume();var s=new b.xZx(k),e=document.getElementById(e).cloneNode(!0);e.id="",s.setMediaElementSource(e),s.setRefDistance(1),s.setMaxDistance(a),s.setDistanceModel("linear"),s.setVolume(.5),s.volume=.5,s.audio=e,s.audio.loop=n,!i||0<(a=s.audio).currentTime&&!a.paused&&!a.ended&&a.readyState>a.HAVE_CURRENT_DATA||a.play(),t[r]=s,U.SCENE_FPS.add(s),o&&s.position.copy(t.position),U.SOUNDS_FPS.push(s)}function z(e,t){for(var i=0;i<e.length;i++)0!=e[i].length&&(G(t,e[i],!0,!0,!0,2),"audio-fizzler"!=t&&"audio-laser-beam"!=t||G(t,e[i].cloneLaserField,!0,!0,!0,2))}function j(e){let t=e;.1<e.volume?(e.volume-=.1,e.timeout=setTimeout(()=>{j(t)},100)):(e.pause(),e.volume=1)}var q,X,L={AMBIENT:document.getElementById("AUDIO-AMBIENT"),EDITOR:document.getElementById("AUDIO-EDITOR"),PORTAL_GUN_BLUE:document.getElementById("AUDIO-PORTAL_GUN_BLUE"),PORTAL_GUN_ORANGE:document.getElementById("AUDIO-PORTAL_GUN_ORANGE"),PORTAL_ENTER:document.getElementById("AUDIO-PORTAL_ENTER"),PORTAL_EXIT:document.getElementById("AUDIO-PORTAL_EXIT"),PORTAL_GUN_LOOP:document.getElementById("AUDIO-PORTAL_GUN_LOOP"),PORTAL_INVALID:document.getElementById("AUDIO-PORTAL_INVALID"),FALLING:document.getElementById("AUDIO-FALLING"),PICK_FAIL:document.getElementById("AUDIO-PICK_FAIL"),PICK_SUCESS:document.getElementById("AUDIO-PICK_SUCESS"),HOLD:document.getElementById("AUDIO-HOLD"),PLAYER_INSIDE_TRACTOR_BEAM:document.getElementById("AUDIO-PLAYER_INSIDE_TRACTOR_BEAM"),DEATH:document.getElementById("AUDIO-DEATH"),WALK:document.getElementById("AUDIO-WALK"),JUMP:document.getElementById("AUDIO-JUMP"),AERIAL:document.getElementById("AUDIO-AERIAL"),POSITIVE:document.getElementById("AUDIO-POSITIVE"),PROPULSION:document.getElementById("AUDIO-PROPULSION")},o=(L.AMBIENT.value=1,e(601)),f=e.n(o),h=h||(q=[],{getAll:function(){return q},removeAll:function(){q=[]},add:function(e){q.push(e)},remove:function(e){e=q.indexOf(e);-1!==e&&q.splice(e,1)},update:function(e,t){if(0===q.length)return!1;var i=0;for(e=void 0!==e?e:h.now();i<q.length;)q[i].update(e)||t?i++:q.splice(i,1);return!0}});function g(t){return U.PLANE_USER_DATA.filter(function(e){return e.name==t})}function W(e){B()("#warning span").text(e),B()("#warning").css("opacity",1),setTimeout(()=>{B()("#warning").css("opacity",0)},2e3)}function Z(t,e){let i=100/t.length;var n=e.map((e,t)=>[t,Math.floor(e/i),e%i]).sort((e,t)=>t[2]-e[2]),o=t.length-n.reduce((e,t)=>e+t[1],0);for(let e=0;e<o;e++)n[e][1]++;let a=0;return n.sort((e,t)=>e[0]-t[0]).map(e=>t.slice(a,a+=e[1]))}function Q(e){let t=(e=e.slice(0)).length;for(;0!=t;){var i=Math.floor(Math.random()*t);t--,[e[t],e[i]]=[e[i],e[t]]}return e}function S(e,t,i){new h.Tween(t).to(i,e).start()}function J(e,t,i){e.traverse(e=>{e.material&&(e.material.transparent=t,e.material.opacity=i,e.material.colorWrite=!t,e.material.depthWrite=!t)})}function C(e){return(new b.Pq0).copy(e)}function K(e){return new b.IUQ(e.x,e.y,e.z,1)}function $(e){return new b.Pq0(e.x,e.y,e.z).multiplyScalar(1/e.w)}"undefined"==typeof window&&"undefined"!=typeof process?h.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?h.now=window.performance.now.bind(window.performance):void 0!==Date.now?h.now=Date.now:h.now=function(){return(new Date).getTime()},h.Tween=function(e){var E,c=e,_={},d={},u={},A=1e3,p=0,m=!1,i=!1,N=0,T=null,R=h.Easing.Linear.None,O=h.Interpolation.Linear,I=[],D=null,L=!1,g=null,S=null,t=null;this.to=function(e,t){return d=e,void 0!==t&&(A=t),this},this.start=function(e){for(var t in h.add(this),L=!(i=!0),T=void 0!==e?e:h.now(),T+=N,d){if(d[t]instanceof Array){if(0===d[t].length)continue;d[t]=[c[t]].concat(d[t])}void 0!==c[t]&&(_[t]=c[t],_[t]instanceof Array==!1&&(_[t]*=1),u[t]=_[t]||0)}return this},this.stop=function(){return i&&(h.remove(this),i=!1,null!==t&&t.call(c,c),this.stopChainedTweens()),this},this.end=function(){return this.update(T+A),this},this.stopChainedTweens=function(){for(var e=0,t=I.length;e<t;e++)I[e].stop()},this.delay=function(e){return N=e,this},this.repeat=function(e){return p=e,this},this.repeatDelay=function(e){return E=e,this},this.yoyo=function(e){return m=e,this},this.easing=function(e){return R=e,this},this.interpolation=function(e){return O=e,this},this.chain=function(){return I=arguments,this},this.onStart=function(e){return D=e,this},this.onUpdate=function(e){return g=e,this},this.onComplete=function(e){return S=e,this},this.onStop=function(e){return t=e,this},this.update=function(e){var t,i,n,o,a,r;if(e<T)return!0;for(t in!1===L&&(null!==D&&D.call(c,c),L=!0),n=R(i=1<(i=(e-T)/A)?1:i),d)void 0!==_[t]&&(o=_[t]||0,(a=d[t])instanceof Array?c[t]=O(a,n):"number"==typeof(a="string"==typeof a?"+"===a.charAt(0)||"-"===a.charAt(0)?o+parseFloat(a):parseFloat(a):a)&&(c[t]=o+(a-o)*n));if(null!==g&&g.call(c,n),1!=i)return!0;if(0<p){for(t in isFinite(p)&&p--,u)"string"==typeof d[t]&&(u[t]=u[t]+parseFloat(d[t])),m&&(r=u[t],u[t]=d[t],d[t]=r),_[t]=u[t];return m&&0,T=void 0!==E?e+E:e+N,!0}null!==S&&S.call(c,c);for(var s=0,l=I.length;s<l;s++)I[s].start(T+A);return!1}},h.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((1+t)*e-t)*.5:.5*((e-=2)*e*((1+t)*e+t)+2)}},Bounce:{In:function(e){return 1-h.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*h.Easing.Bounce.In(2*e):.5*h.Easing.Bounce.Out(2*e-1)+.5}}},h.Interpolation={Linear:function(e,t){var i=e.length-1,n=i*t,o=Math.floor(n),a=h.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],n):1<t?a(e[i],e[i-1],i-n):a(e[o],e[i<o+1?i:o+1],n-o)},Bezier:function(e,t){for(var i=0,n=e.length-1,o=Math.pow,a=h.Interpolation.Utils.Bernstein,r=0;r<=n;r++)i+=o(1-t,n-r)*o(t,r)*e[r]*a(n,r);return i},CatmullRom:function(e,t){var i=e.length-1,n=i*t,o=Math.floor(n),a=h.Interpolation.Utils.CatmullRom;return e[0]===e[i]?a(e[((o=t<0?Math.floor(n=i*(1+t)):o)-1+i)%i],e[o],e[(o+1)%i],e[(o+2)%i],n-o):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-n)-e[0]):1<t?e[i]-(a(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):a(e[o?o-1:0],e[o],e[i<o+1?i:o+1],e[i<o+2?i:o+2],n-o)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=h.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:(X=[1],function(e){var t=1;if(X[e])return X[e];for(var i=e;1<i;i--)t*=i;return X[e]=t}),CatmullRom:function(e,t,i,n,o){var e=.5*(i-e),n=.5*(n-t),a=o*o;return(2*t-2*i+e+n)*(o*a)+(-3*t+3*i-2*e-n)*a+e*o+t}}};let ee=e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)});var N=e(119),i=e(269);function te(e,t){e.tractor==t&&(e.mass="player"==e.name?50:5,U.TRACTOR_BEAM[t].inTractor=e.inTractor=!1,e.tractor=null,e.tractorID=null,"player"==e.name?(document.getElementById("panel-top").style.opacity=0,L.PLAYER_INSIDE_TRACTOR_BEAM.pause()):e.allowSleep=!0)}var ie=e(695),ne=(window.pellets=[],new b.tBo);function oe(e){var t=new b.Q1f(0,5,0),i=(e.userData.pedestalInfinity||(t=new b.Q1f(5,0,0)),new b.B69),n=(i.position.copy(e.position),i.quaternion.copy(e.quaternion),i.translateY(1),new b.Gu$(.1,8,4)),o=new b._4j({emissive:t,envMap:U.envMap}),n=new b.eaF(n,o),o=(n.position.copy(i.position),n.rotation.copy(i.rotation),n.origin=i,n.time=e.userData.pedestalValue,n.infinity=e.userData.pedestalInfinity,n.active=!0,U.SCENE_FPS.add(n),new b.HiM(t,.5,3),n.clone()),i=(o.visible=!1,new w.Sphere(.1)),t=new w.Body({shape:i,mass:1,material:new w.Material}),i=(U.CANNON_BODIES.push(t),t.position.copy(n.position),t.quaternion.copy(n.quaternion),t.collisionFilterGroup=U.CGROUP_DYNAMIC,t.collisionFilterMask=U.CGROUP_ALL,U.CANNON_BODIES.push(t),U.CANNON_WORLD.addBody(t),n.body=t,n.item=e,new b.Pq0(0,1,0).applyQuaternion(t.quaternion));t.direction=i,t.originaldirection=i,t.clone=o,t.name="pellet",t.pellet=n,t.previousDirection=i,t.addEventListener("collide",function(e){var t,i,n;e.target.started&&0!=e.body.collisionResponse&&e.target.pellet.active&&"fizzler"!=e.body.name&&(D(e.target.sound.audio),"wall"==e.body.name&&(t=C(e.target.position),i=e.body.wallRotation,n=e.target.direction,_.parent||U.SCENE_FPS.add(_),ne.set(t,n),0<ne.intersectObject(_).length||((n=new b.B69).scale.set(1,1,1),n.position.copy(t),n.rotation.set(i.x,i.y,i.z),n.translateY(-.01),n.updateMatrix(),_.setMatrixAt(_.current,n.matrix),_.setVisibilityAt(_.current,!0),_.instanceMatrix.needsUpdate=!0,_.computeBoundingSphere(),_.current<=1e3?_.current+=1:_.current=0)),"player"==e.body.name?(clearTimeout(e.target.pellet.timeout),ae(e.target.pellet,!0),pt(U.PLAYER),e.target.direction=e.target.originaldirection):"pellet_catcher"!=e.body.name||e.body.active?(t=e.contact.ni,i=new b.Pq0(t.x,t.y,t.z).negate(),n=e.target.direction,i.equals(e.target.previousDirection.round())?e.target.direction=i.negate():e.target.direction=i,"panel"==e.body.name&&(Math.abs(n.x)>Math.abs(n.z)?e.target.direction.x=0:Math.abs(n.x)<Math.abs(n.z)&&(e.target.direction.z=0)),e.target.previousDirection=e.target.direction):(e.body.active=!0,e.body.item.cone.visible=!1,p(e.body.item,!0,!0),clearTimeout(e.target.pellet.timeout),e.target.pellet.infinity?ae(e.target.pellet,!0):(e.target.pellet.active=!1,e.target.pellet.position.set(1e5,1e4,1e4),setTimeout(()=>{e.target.removeEventListener("collide"),U.CANNON_WORLD.removeBody(e.target)},10)),e.target.direction=e.target.originaldirection,F(e.body.item.userData)))}),U.DYNAMIC_OBJECTS.push(t),window.pellets.push(n),G("pelletHit",t,!1,!1,!1,10,"sound")}function ae(e,t){U.FPS_MODE&&(t&&(D(e.body.sound.audio),e.visible=!1,e.active=!1,e.position.copy(e.origin.position),e.rotation.copy(e.origin.rotation),e.body.direction=e.body.originaldirection,setTimeout(()=>{e.visible=!0,e.active=!0},1e3)),e.infinity||(e.timeout=setTimeout(()=>{ae(e,!0)},1e3*e.time)))}B()("body").on("input","#state-pellet-infinity",function(){this.checked?B()("#pellet-timer").addClass("disabled"):B()("#pellet-timer").removeClass("disabled"),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.pedestalInfinity=this.checked}),B()("body").on("input","#pellet-timer-value",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.pedestalValue=parseInt(this.value)});var s=new b.iNn(.6,.01,.6),l=(new b.Tap).load("./assets/textures/burn01a.webp");let _=new ie.t9(s,new b.V9B({side:0,map:l,transparent:!0,opacity:1,color:new b.Q1f(0,0,0),polygonOffset:!0,polygonOffsetFactor:-10}),{createInstances:!0});_.current=0,_.addInstances(1e3,(e,t)=>{e.visible=!1,e.position.set(1e5,1e5,1e5)}),_.raycastOnlyFrustum=!0,_.computeBVH(),_.instanceMatrix.needsUpdate=!0;new b.zD7;function re(e){U.ITEMS_ADDED.getObjectByName("spawn")||mt(!1);var t,i=e;for(t of U.DYNAMIC_OBJECTS){var n=new b.Pq0(t.position.x,t.position.y-1,t.position.z);if(!t.holding){n.y+=1;for(var o,a,r=0;r<U.TRACTOR_BEAM.length;r++)U.TRACTOR_BEAM_BOUNDING_BOX[r]?U.TRACTOR_BEAM[r].item.userData.state?t.inTractor&&t.tractor!=r||(U.TRACTOR_BEAM[r].item.userData.opened?U.TRACTOR_BEAM_BOUNDING_BOX[r].containsPoint(n)?(o=U.TRACTOR_BEAM[r].dir,t.tractorID!=U.TRACTOR_BEAM[r].id?("player"==t.name&&(L.PLAYER_INSIDE_TRACTOR_BEAM.currentTime=0,D(L.PLAYER_INSIDE_TRACTOR_BEAM),U.TRACTOR_BEAM[r].item.userData.reversed?document.getElementById("panel-top").style.backgroundColor="#ff80004a":document.getElementById("panel-top").style.backgroundColor="#0035ff4a"),t.inTractorPositionY=t.position.clone().y,t.inTractor=!0,t.tractor=r,t.tractorID=U.TRACTOR_BEAM[r].id,U.TRACTOR_BEAM[r].inTractor=!0,(U.TRACTOR_BEAM[r].body=t).mass=0,t.velocity.setZero(),t.initVelocity.setZero(),t.angularVelocity.setZero(),t.initAngularVelocity.setZero(),t.force.setZero(),t.torque.setZero(),t.allowSleep=!1,t.wakeUp(),t.inArea||(a=new b.Pq0(Math.abs(Math.abs(o.x)-1)*U.TRACTOR_BEAM[r].position.x+t.position.x*Math.abs(o.x),Math.abs(Math.abs(o.y)-1)*U.TRACTOR_BEAM[r].position.y+t.position.y*Math.abs(o.y),Math.abs(Math.abs(o.z)-1)*U.TRACTOR_BEAM[r].position.z+t.position.z*Math.abs(o.z)),S(500,t.position,a))):(a=1.5,U.TRACTOR_BEAM[r].item.userData.reversed&&(a=-1.5),n.add(o.clone().multiplyScalar(a*i)),t.position.copy(n),t.angularVelocity.setZero(),t.velocity.setZero())):t.inTractor&&t.tractor==r&&te(t,r):t.inTractor&&te(t,r)):t.inTractor&&te(t,r):t.inTractor&&t.tractor==r&&te(t,r)}}var s=e;if(U.LEVEL_ENTERED)for(var l=0;l<window.pellets.length;l++)!window.pellets[l].item.userData.isActive||window.pellets[l].body.inTractor||(window.pellets[l].body.started||ae(window.pellets[l],!0),window.pellets[l].active&&(window.pellets[l].position.add(window.pellets[l].body.direction.clone().multiplyScalar(3*s)),window.pellets[l].body.position.copy(window.pellets[l].position),window.pellets[l].body.previousPosition.copy(window.pellets[l].position),window.pellets[l].body.angularVelocity.setZero(),window.pellets[l].body.velocity.setZero(),window.pellets[l].body.force.setZero(),window.pellets[l].position.copy(window.pellets[l].body.position),window.pellets[l].quaternion.copy(window.pellets[l].body.quaternion),window.pellets[l].body.sound.position.copy(window.pellets[l].body.position),window.pellets[l].body.sound.quaternion.copy(window.pellets[l].body.quaternion)),window.pellets[l].body.started=!0);var E,c=0;for(E of U.DYNAMIC_OBJECTS){var _=new b.Pq0(E.position.x,E.position.y,E.position.z);if("player"==E.name)for(var d=0;d<U.PORTAL_GUN_BOX.length;d++)U.PORTAL_GUN_BOX[d].containsPoint(_)&&U.PORTAL_GUN_BOX[d].item.visible&&(U.PORTAL_GUN_BOX[d].item.visible=!1,U.PORTAL_GUN_BOX[d].item.name.includes("portal_gun")?(U.PORTAL_GUN_INITIATE=U.PORTAL_GUN_BOX[d].item.userData.state,U.GUN.children[0].visible=!0,U.GUN_CLONE.children[0].visible=!0,U.GUN_CLONE2.children[0].visible=!0,document.getElementById("reticle-img").style.filter="none","left"==U.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalBlue.png":"right"==U.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalOrange.png":document.getElementById("reticle-img").src="./assets/textures/crosshairNone.png",U.GUN.visible=!0,U.GUN_MODE="portal","left"==U.PORTAL_GUN_INITIATE?document.getElementById("warning-game").innerHTML="Press Mouse Left to create Blue Portals!":document.getElementById("warning-game").innerHTML="Press Mouse Right to create Orange Portals!",document.getElementById("warning-game").style.opacity="1",setTimeout(()=>{document.getElementById("warning-game").style.opacity="0"},7e3)):U.PORTAL_GUN_BOX[d].item.name.includes("paint_gun")&&(U.GUN.visible=!1,U.GUN_MODE="paint"));100<_.distanceTo(new b.Pq0(0,0,0))&&(E.name.includes("pellet")||E.repawning||pt(E));for(var u=0;u<U.GOO_BOXES.length;u++)!U.GOO_BOXES[u].containsPoint(_)||E.repawning||pt(E);for(var A=[new b.Pq0(E.position.x+E.shapes[0].height/2,E.position.y,E.position.z),new b.Pq0(E.position.x-E.shapes[0].height/2,E.position.y,E.position.z),new b.Pq0(E.position.x,E.position.y+E.shapes[0].height/2,E.position.z),new b.Pq0(E.position.x,E.position.y-E.shapes[0].height/2,E.position.z),new b.Pq0(E.position.x,E.position.y,E.position.z+E.shapes[0].height/2),new b.Pq0(E.position.x,E.position.y,E.position.z-E.shapes[0].height/2)],d=0;d<U.CONNECTIONS.length;d++)if(!(U.CONNECTIONS[d].from.instancedName.includes("pedestal")||U.CONNECTIONS[d].from.instancedName.includes("laser_receiver")||U.CONNECTIONS[d].from.instancedName.includes("laser_relay")||U.CONNECTIONS[d].from.instancedName.includes("pellet_catcher")))for(var p,m,N,T=0,R=0;R<A.length;R++){if(U.CONNECTIONS[d].from.box3.containsPoint(A[R])){U.CONNECTIONS[d].from.box3.accept.includes(E.name)&&!U.CONNECTIONS[d].line.active&&(p=0,U.CONNECTIONS[d].from.item.userData.pedestalInfinity?(L.POSITIVE.play(),le(U.CONNECTIONS[d],c,!0,new b.Q1f(2,1.3,0)),U.CONNECTIONS[d].to.item.userData.buttons+=1):p=1e3*U.CONNECTIONS[d].from.item.userData.pedestalValue,O=U.CONNECTIONS[d].to,m=U.CONNECTIONS[d],N=c,U.CONNECTIONS[d].line.active=!0,((i,n,o,a,r)=>{var s=window.timeoutEvent.length;window.timeoutEvent.push(new se(function(){if(window.timeoutEvent.splice(s,1),0<n&&(le(a,o,!0,new b.Q1f(2,1.3,0)),i.item.userData.buttons+=1),a.from.itemName.includes("incinerator")){let e=U.ITEMS_ADDED.getObjectByName(r.name).scene.clone();e.position.set(r.position.x,r.position.y,r.position.z),e.quaternion.copy(r.quaternion),e.visible=!0,U.HOLDING_ITEM&&Et(),U.UNIFORMS_DISSOLVER.diffuseMap.value=e.material.map,e.material=U.MATERIAL_DISSOLVER,U.SCENE_FPS.add(e);var t=e.position.clone(),t=(t.y+=2,U.UNIFORMS_DISSOLVER.u_EffectOrigin.value=t,e.clone());t.position.y+=.5,G("audio-dissolve",e,!0,!1,!0,2,"sound"),S(3e3,U.UNIFORMS_DISSOLVER.u_EffectOrigin.value,e.position),S(3e3,e.position,t.position),setTimeout(()=>{U.SCENE_FPS&&e.sound&&(U.SCENE.remove(e),U.SCENE_FPS.remove(e.sound))},3e3),pt(r)}if(i.itemName.includes("angled_panel")){if(i.item.userData.connections==i.item.userData.buttons){S(500,i.item.getObjectByName("pivot2").rotation,new b.Pq0(i.item.userData.angleTrigger*Math.PI/180,i.item.getObjectByName("pivot2").rotation.y,i.item.getObjectByName("pivot2").rotation.z));let e=i.item;0!=e.getObjectByName("panel").hasPortal&&1!=e.getObjectByName("panel").hasPortal||M(e.getObjectByName("panel").hasPortal),e.getObjectByName("panel").hasPortal=100,setTimeout(()=>{Vn(e.getObjectByName("panel").body,e.getObjectByName("Cube"))},500)}}else if(i.itemName.includes("faith_plate"))i.item.userData.connections==i.item.userData.buttons&&(i.item.userData.state=!0);else if(i.itemName.includes("door")||i.itemName.includes("exitDoor"))i.item.userData.connections==i.item.userData.buttons&&qn(0,!0,!1,i.item);else if(i.itemName.includes("cube")||i.itemName.includes("sphere"))i.item.userData.connections==i.item.userData.buttons&&At(i.item);else if(i.itemName.includes("tractor"))i.item.userData.connections==i.item.userData.buttons&&ut(i);else if(i.itemName.includes("light_bridge")){if(i.item.userData.connections==i.item.userData.buttons){dt(i);for(var e of U.DYNAMIC_OBJECTS)e.wakeUp()}}else i.itemName.includes("laser_field")||i.itemName.includes("fizzler")?i.item.userData.connections==i.item.userData.buttons&&_t(i):i.itemName.includes("portal_0")||i.itemName.includes("portal_1")?(i.item.active=!0,i.itemName.includes("portal_0")?vt(0,i.item,U.MAIN_CAMERA):i.itemName.includes("portal_1")&&vt(2,i.item,U.MAIN_CAMERA)):(i.itemName.includes("piston_platforms")||i.itemName.includes("track_platforms")||i.itemName.includes("pellet_launcher"))&&(i.item.userData.isActive=!i.item.userData.isActive,i.item.body.pistonDown=!1,i.itemName.includes("piston_platforms")||i.itemName.includes("track_platforms"))&&(i.item.userData.isActive?i.item.body.sound.audio.play():i.item.body.sound.audio.pause());F(i.item.userData)},n))})(O,p,N,m,E));break}if(!U.CONNECTIONS[d].from.instancedName.includes("trigger")&&!U.CONNECTIONS[d].from.instancedName.includes("incinerator")&&6<=++T&&U.CONNECTIONS[d].line.active&&U.CONNECTIONS[d].line.idConnection==c){var O=!1;if(U.CONNECTIONS[d].to.item.userData.buttons==U.CONNECTIONS[d].to.item.userData.connections&&(O=!0),--U.CONNECTIONS[d].to.item.userData.buttons,le(U.CONNECTIONS[d],null,!1,new b.Q1f(0,2,5)),O)if(U.CONNECTIONS[d].to.itemName.includes("angled_panel")){S(500,U.CONNECTIONS[d].to.item.getObjectByName("pivot2").rotation,new b.Pq0(U.CONNECTIONS[d].to.item.userData.angle*Math.PI/180,U.CONNECTIONS[d].to.item.getObjectByName("pivot2").rotation.y,U.CONNECTIONS[d].to.item.getObjectByName("pivot2").rotation.z));let e=U.CONNECTIONS[d].to.item;0!=e.getObjectByName("panel").hasPortal&&1!=e.getObjectByName("panel").hasPortal||M(e.getObjectByName("panel").hasPortal),e.getObjectByName("panel").hasPortal=100,setTimeout(()=>{Vn(e.getObjectByName("panel").body,e.getObjectByName("Cube"))},500)}else U.CONNECTIONS[d].to.itemName.includes("faith_plate")?U.CONNECTIONS[d].to.item.userData.state=!1:U.CONNECTIONS[d].to.itemName.includes("door")||U.CONNECTIONS[d].to.itemName.includes("exitDoor")?U.CONNECTIONS[d].to.item.userData.buttons<U.CONNECTIONS[d].to.item.userData.connections&&qn(0,!1,!1,U.CONNECTIONS[d].to.item):U.CONNECTIONS[d].to.itemName.includes("tractor")?U.CONNECTIONS[d].to.item.userData.buttons<U.CONNECTIONS[d].to.item.userData.connections&&ut(U.CONNECTIONS[d].to):U.CONNECTIONS[d].to.itemName.includes("light_bridge")?U.CONNECTIONS[d].to.item.userData.buttons<U.CONNECTIONS[d].to.item.userData.connections&&dt(U.CONNECTIONS[d].to):U.CONNECTIONS[d].to.itemName.includes("laser_field")||U.CONNECTIONS[d].to.itemName.includes("fizzler")?U.CONNECTIONS[d].to.item.userData.buttons<U.CONNECTIONS[d].to.item.userData.connections&&_t(U.CONNECTIONS[d].to):U.CONNECTIONS[d].to.itemName.includes("portal_0")||U.CONNECTIONS[d].to.itemName.includes("portal_1")?U.CONNECTIONS[d].to.item.active=!1:(U.CONNECTIONS[d].to.itemName.includes("piston_platforms")||U.CONNECTIONS[d].to.itemName.includes("track_platforms")||U.CONNECTIONS[d].to.itemName.includes("pellet_launcher"))&&(U.CONNECTIONS[d].to.item.userData.isActive=!U.CONNECTIONS[d].to.item.userData.isActive,U.CONNECTIONS[d].to.item.body.pistonDown=!0,U.CONNECTIONS[d].to.itemName.includes("piston_platforms")||U.CONNECTIONS[d].to.itemName.includes("track_platforms"))&&(U.CONNECTIONS[d].to.item.userData.isActive?U.CONNECTIONS[d].to.item.body.sound.audio.play():U.CONNECTIONS[d].to.item.body.sound.audio.pause())}}c++}}var se=function(e,t){var i,n,o=t;this.pause=function(){window.clearTimeout(i),i=null,o-=Date.now()-n},this.resume=function(){i||(n=Date.now(),i=window.setTimeout(e,o))},this.resume()};function p(e,t,i){var n=U.PLANE_USER_DATA[e.userData.planeInstancedId];if(t){for(var o=0;o<U.CONNECTIONS.length;o++)if((U.CONNECTIONS[o].from.instancedName.includes("laser_receiver")||U.CONNECTIONS[o].from.instancedName.includes("laser_relay")||U.CONNECTIONS[o].from.instancedName.includes("pellet_catcher"))&&n==U.CONNECTIONS[o].from&&!U.CONNECTIONS[o].line.active)if(n.item.connection=U.CONNECTIONS[o],U.CONNECTIONS[o].from.item.userData.state=!0,U.CONNECTIONS[o].to.item.userData.buttons+=1,le(U.CONNECTIONS[o],"no",!0,new b.Q1f(2,1.3,0)),i||U.LASER_TRIGGERS.push(e),L.POSITIVE.play(),U.CONNECTIONS[o].to.itemName.includes("angled_panel")){if(U.CONNECTIONS[o].to.item.userData.connections==U.CONNECTIONS[o].to.item.userData.buttons){S(500,U.CONNECTIONS[o].to.item.getObjectByName("pivot2").rotation,new b.Pq0(U.CONNECTIONS[o].to.item.userData.angleTrigger*Math.PI/180,U.CONNECTIONS[o].to.item.getObjectByName("pivot2").rotation.y,U.CONNECTIONS[o].to.item.getObjectByName("pivot2").rotation.z));let e=U.CONNECTIONS[o].to.item;0!=e.getObjectByName("panel").hasPortal&&1!=e.getObjectByName("panel").hasPortal||M(e.getObjectByName("panel").hasPortal),e.getObjectByName("panel").hasPortal=100,setTimeout(()=>{Vn(e.getObjectByName("panel").body,e.getObjectByName("Cube"))},500)}}else U.CONNECTIONS[o].to.itemName.includes("faith_plate")?U.CONNECTIONS[o].to.item.userData.connections==U.CONNECTIONS[o].to.item.userData.buttons&&(U.CONNECTIONS[o].to.item.userData.state=!0):U.CONNECTIONS[o].to.itemName.includes("door")||U.CONNECTIONS[o].to.itemName.includes("exitDoor")?U.CONNECTIONS[o].to.item.userData.connections==U.CONNECTIONS[o].to.item.userData.buttons&&qn(0,!0,!1,U.CONNECTIONS[o].to.item):U.CONNECTIONS[o].to.itemName.includes("cube")||U.CONNECTIONS[o].to.itemName.includes("sphere")?U.CONNECTIONS[o].to.item.userData.connections==U.CONNECTIONS[o].to.item.userData.buttons&&At(U.CONNECTIONS[o].to.item):U.CONNECTIONS[o].to.itemName.includes("tractor")?U.CONNECTIONS[o].to.item.userData.connections==U.CONNECTIONS[o].to.item.userData.buttons&&ut(U.CONNECTIONS[o].to):U.CONNECTIONS[o].to.itemName.includes("light_bridge")?U.CONNECTIONS[o].to.item.userData.connections==U.CONNECTIONS[o].to.item.userData.buttons&&dt(U.CONNECTIONS[o].to):U.CONNECTIONS[o].to.itemName.includes("laser_field")||U.CONNECTIONS[o].to.itemName.includes("fizzler")?U.CONNECTIONS[o].to.item.userData.connections==U.CONNECTIONS[o].to.item.userData.buttons&&_t(U.CONNECTIONS[o].to):U.CONNECTIONS[o].to.itemName.includes("portal_0")||U.CONNECTIONS[o].to.itemName.includes("portal_1")?(U.CONNECTIONS[o].to.item.active=!0,U.CONNECTIONS[o].to.itemName.includes("portal_0")?vt(0,U.CONNECTIONS[o].to.item,U.MAIN_CAMERA):U.CONNECTIONS[o].to.itemName.includes("portal_1")&&vt(2,U.CONNECTIONS[o].to.item,U.MAIN_CAMERA)):(U.CONNECTIONS[o].to.itemName.includes("piston_platforms")||U.CONNECTIONS[o].to.itemName.includes("track_platforms")||U.CONNECTIONS[o].to.itemName.includes("pellet_launcher"))&&(U.CONNECTIONS[o].to.item.userData.isActive=!U.CONNECTIONS[o].to.item.userData.isActive,U.CONNECTIONS[o].to.item.body.pistonDown=!1,U.CONNECTIONS[o].to.itemName.includes("piston_platforms")||U.CONNECTIONS[o].to.itemName.includes("track_platforms"))&&(U.CONNECTIONS[o].to.item.userData.isActive?U.CONNECTIONS[o].to.item.body.sound.audio.play():U.CONNECTIONS[o].to.item.body.sound.audio.pause())}else if(!i){var t=U.LASER_TRIGGERS.indexOf(e),t=(-1<t&&U.LASER_TRIGGERS.splice(t,1),n.item.connection),a=!1;if(t.to.item.userData.buttons==t.to.item.userData.connections&&(a=!0),--t.to.item.userData.buttons,t.from.item.userData.state=!1,le(t,"no",!1,new b.Q1f(0,2,5)),a)if(t.to.itemName.includes("angled_panel")){S(500,t.to.item.getObjectByName("pivot2").rotation,new b.Pq0(t.to.item.userData.angle*Math.PI/180,t.to.item.getObjectByName("pivot2").rotation.y,t.to.item.getObjectByName("pivot2").rotation.z));let e=t.to.item;0!=e.getObjectByName("panel").hasPortal&&1!=e.getObjectByName("panel").hasPortal||M(e.getObjectByName("panel").hasPortal),e.getObjectByName("panel").hasPortal=100,setTimeout(()=>{Vn(e.getObjectByName("panel").body,e.getObjectByName("Cube"))},500)}else t.to.itemName.includes("faith_plate")?t.to.item.userData.state=!1:t.to.itemName.includes("door")||t.to.itemName.includes("exitDoor")?t.to.item.userData.buttons<t.to.item.userData.connections&&qn(0,!1,!1,t.to.item):t.to.itemName.includes("tractor")?t.to.item.userData.buttons<t.to.item.userData.connections&&ut(t.to):t.to.itemName.includes("light_bridge")?t.to.item.userData.buttons<t.to.item.userData.connections&&dt(t.to):t.to.itemName.includes("laser_field")||t.to.itemName.includes("fizzler")?t.to.item.userData.buttons<t.to.item.userData.connections&&_t(t.to):t.to.itemName.includes("portal_0")||t.to.itemName.includes("portal_1")?t.to.item.active=!1:(t.to.itemName.includes("piston_platforms")||t.to.itemName.includes("track_platforms")||t.to.itemName.includes("pellet_launcher"))&&(t.to.item.userData.isActive=!1,t.to.item.body.pistonDown=!0,t.to.itemName.includes("piston_platforms")||t.to.itemName.includes("track_platforms"))&&(t.to.item.userData.isActive?t.to.item.body.sound.audio.play():t.to.item.body.sound.audio.pause())}}function le(e,t,i,n){"no"!=t&&(e.line.idConnection=t),e.line.active=i,e.line.material.color=n,window.checkers.setColorAt(e.checker,n)}window.timeoutEvent=[];var Ee=1;function ce(e,t,i,n){var o=new b.B69,a=(o.position.copy(e.position),o.rotation.copy(e.rotation),new b.Pq0),r=new b.tBo,s=(a.copy(o.position),new b.Pq0),o=(s.copy(o.up).applyQuaternion(o.quaternion),r.set(a,s),r.item=e,r.intersectObject(U.PLANE_LEVEL_INSTANCED));if(0!=o.length){if(t){if(i.distance==o[0].distance)return;U.LASERS.remove(e.continuous),U.LASER_EMITTER_RAYCASTER[n]=r}else i.push(r);r.distance=o[0].distance,r.item=e;a=new b.Ho_(.01,.01,1,8,1,!0),s=new b.eaF(a,new b.V9B({color:new b.Q1f(Ee,0,0)})),t=(s.translateY(.5),new b.YJl),n=(t.position.copy(e.position),t.rotation.copy(e.rotation),t.scale.y=o[0].distance,t.add(s),U.LASERS.add(t),t.clone());n.visible=!1,t.clone=n,U.LASERS.add(n),e.continuous=t,(e.raycaster=r).laser=t}}"epic"==localStorage.getItem("quality-select")&&(Ee=10),U.SCENE_CHILDREN.add(U.LASERS);var _e=new b.tBo,de=new b.tBo;function ue(e,t){if(U.LEVEL_ENTERED&&(t.visible=t.active,t.clone.visible=!1,t.active)){var i=new b.Pq0,n=(e.getWorldDirection(i),i.negate(),_e.set(e.position,i),_e.intersectObject(U.PLANE_LEVEL_INSTANCED));t.position.copy(e.position),t.rotation.copy(e.rotation),t.rotateX(-Math.PI/2),0<n.length&&(t.scale.y=n[0].distance);for(var o,a,i=[U.ITEMS_ADDED.getObjectByName("laser_cube"),U.ITEMS_ADDED.getObjectByName("cube"),U.ITEMS_ADDED.getObjectByName("sphere"),U.ITEMS_ADDED.getObjectByName("cube_2"),U.ITEMS_ADDED.getObjectByName("scale_cube"),U.ITEMS_ADDED.getObjectByName("laser_receiver"),U.ITEMS_ADDED.getObjectByName("laser_relay")].filter(function(e){return null!=e}),n=_e.intersectObjects(i),r=0;r<n.length;r++)if(.5<n[r].distance)if("laser_receiver"==n[r].object.name?(U.DYMANIC_ITEMS.laser_receiver[n[r].instanceId].emitterState=!0,U.DYMANIC_ITEMS.laser_receiver[n[r].instanceId].fromLaserCube=!0,p(U.DYMANIC_ITEMS.laser_receiver[n[r].instanceId],!0,!1)):"laser_relay"==n[r].object.name&&(U.DYMANIC_ITEMS.laser_relay[n[r].instanceId].emitterState=!0,U.DYMANIC_ITEMS.laser_relay[n[r].instanceId].fromLaserCube=!0,p(U.DYMANIC_ITEMS.laser_relay[n[r].instanceId],!0,!1)),"laser_cube"!=n[r].object.name||(o=U.DYMANIC_ITEMS.laser_cube[n[r].instanceId]).body.laser.active||(o.body.laser.active=!0,(a=new b.B69).position.copy(o.body.position),a.quaternion.copy(o.body.quaternion),ue(a,o.body.laser)),"laser_relay"!=n[r].object.name)return void(t.scale.y=n[r].distance);if(null!==U.PORTALS[0]&&null!==U.PORTALS[1]){var s=_e.intersectObjects(U.PORTAL_SHADER);if(0<s.length){var l,E="portal-0"==s[0].object.name?(l=1,0):(l=0,1);t.clone.position.copy(U.PORTAL_SHADER[l].position);for(var c,E=U.PORTALS[E].mesh.quaternion.clone(),_=U.PORTALS[l].mesh.quaternion.clone(),E=(new b.PTz).copy(E).multiply(_.invert()),_=2*Math.acos(b.cj9.clamp(E.w,-1,1)),E=new b.Pq0(E.x,E.y,E.z).normalize(),d=new b.Pq0(0,1,0),E=E.dot(d),d=(0==(_*=Math.sign(E))||Math.abs(_)==Math.PI?(t.clone.rotation.copy(U.PORTALS[l].mesh.rotation),t.clone.translateZ(-1.8*(s[0].uv.y-.5)),t.clone.translateX(-1.1*(s[0].uv.x-.5)),t.clone.rotation.copy(t.rotation),t.clone.rotateZ(_-Math.PI)):Math.abs(_).toFixed(2)==(Math.PI/2).toFixed(2)||Math.abs(_).toFixed(2)==(Math.PI+Math.PI/2).toFixed(2)?(t.clone.rotation.copy(U.PORTALS[l].mesh.rotation),t.clone.translateZ(-1.8*(s[0].uv.y-.5)),t.clone.translateX(-1.1*(s[0].uv.x-.5)),t.clone.rotation.copy(t.rotation),t.clone.rotateZ(_)):(t.clone.rotation.copy(U.PORTALS[l].mesh.rotation),t.clone.translateZ(-1.8*(s[0].uv.y-.5)),t.clone.translateX(-.9*(s[0].uv.x-.5))),t.clone.visible=!0,new b.Pq0(0,1,0).applyQuaternion(t.clone.quaternion)),E=(de.set(t.clone.position,d),de.intersectObject(U.PLANE_LEVEL_INSTANCED)),u=(0<E.length&&(t.clone.scale.y=E[0].distance),de.intersectObjects(i)),A=0;A<u.length;A++)if("laser_receiver"==u[A].object.name?(U.DYMANIC_ITEMS.laser_receiver[u[A].instanceId].emitterState=!0,U.DYMANIC_ITEMS.laser_receiver[u[A].instanceId].fromLaserCube=!0,p(U.DYMANIC_ITEMS.laser_receiver[u[A].instanceId],!0,!1)):"laser_relay"==u[A].object.name&&(U.DYMANIC_ITEMS.laser_relay[u[A].instanceId].emitterState=!0,U.DYMANIC_ITEMS.laser_relay[u[A].instanceId].fromLaserCube=!0,p(U.DYMANIC_ITEMS.laser_relay[u[A].instanceId],!0,!1)),"laser_cube"!=u[A].object.name||(c=U.DYMANIC_ITEMS.laser_cube[u[A].instanceId]).body.laser.active||(c.body.laser.active=!0,(e=new b.B69).position.copy(c.body.position),e.quaternion.copy(c.body.quaternion),ue(e,c.body.laser)),t.clone.visible=!0,"laser_relay"!=u[A].object.name){t.clone.scale.y=u[A].distance;break}}}}}function Ae(e,t,i,n){e.userData.triggers=t,i.data("trigger",t),i.find(".title").text(t);i=new b.B69,i.position.copy(new b.Pq0(e.initialPosition.x,e.initialPosition.y,e.initialPosition.z)),i.rotation.set(e.initialRotation.x,e.initialRotation.y,e.initialRotation.z),"Top"==t?i.translateZ(-.6):"Bottom"==t?i.translateZ(.6):"Left"==t?(i.rotateY(Math.PI/2),i.translateZ(-.6)):"Right"==t&&(i.rotateY(Math.PI/2),i.translateZ(.6)),e.position.copy(i.position),e.rotation.copy(i.rotation),i.updateMatrix(),t=U.ITEMS_ADDED.getObjectByName(n);if(t.setMatrixAt(e.userData.idInstanced,i.matrix),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere(),"laser_receiver"!=n)for(var o=0;o<U.LASER_EMITTER_RAYCASTER.length;o++)U.LASER_EMITTER_RAYCASTER[o].distance=null,ce(U.LASER_EMITTER_RAYCASTER[o].item,!0,U.LASER_EMITTER_RAYCASTER[o],o)}B()("body").on("click",".laser_emitter-triggers",function(){U.LASER_EMITTER_TRIGGER=B()(this).data("trigger"),Ae(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item,B()(this).data("trigger"),B()("#laser_emitter-trigger"),"laser_emitter")}),B()("body").on("click",".laser_receiver-triggers",function(){U.LASER_RECEIVER_TRIGGER=B()(this).data("trigger"),Ae(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item,B()(this).data("trigger"),B()("#laser_receiver-trigger"),"laser_receiver")});a=new b.Gu$(.6,8,4);let pe=new b.V9B({color:new b.Q1f("rgb(30,144,255)")}),me=new b.V9B({color:new b.Q1f("rgb(255,140,0)")}),Ne=new b.V9B({color:new b.Q1f("rgb(75,0,130)")}),Te=new b.V9B({color:new b.Q1f(.8,.8,.8)}),Re=new b.V9B({color:new b.Q1f(11001053),transparent:!0,opacity:.5}),Oe=new b._4j({metalness:1,roughness:.25}),Ie=new b.eaF(a,pe);var De=[];let Le=new(A().Material);function ge(e,a,r,t){var i=Ie.clone(),s=(U.SCENE_FPS.add(i),De.push(i),i.material=t,new(A().Body)({shape:new(A().Sphere)(.3),mass:20,material:Le}));(i.body=s).sphereClone=i,s.position.copy(e.position),s.position.y-=.5,s.quaternion.copy(e.quaternion),s.collisionFilterGroup=U.CGROUP_DYNAMIC,s.collisionFilterMask=U.CGROUP_ALL,s.item=e,s.updateMassProperties(),s.clone=new b.B69,s.spawnPositions=[],s.typeGel=a,s.colorGel=r,U.CANNON_WORLD.addBody(s),U.CANNON_BODIES.push(s),U.DYNAMIC_OBJECTS.push(s),s.addEventListener("collide",function(e){var t,i,n,o;s.inArea||(e.body.dynamic&&(t=U.ITEMS_ADDED.getObjectByName(e.body.item.userData.instancedName),"clear"==s.typeGel?t.setColorAt(e.body.item.userData.idInstanced,new b.Q1f(1,1,1)):t.setColorAt(e.body.item.userData.idInstanced,s.colorGel)),s.sphereClone.visible=!1,s.mass=0,s.updateMassProperties(),s.position.copy(s.item.position),s.position.y-=.5,s.quaternion.copy(s.item.quaternion),s.velocity.setZero(),s.initVelocity.setZero(),s.angularVelocity.setZero(),s.initAngularVelocity.setZero(),s.force.setZero(),s.torque.setZero(),setTimeout(()=>{s.mass=20,s.updateMassProperties(),s.wakeUp(),s.sphereClone.visible=!0},1e3),"wall"!=e.body.name&&"panel"!=e.body.name)||((t=new b.B69).position.copy(C(Se(e.contact))),"wall"==e.body.name?t.rotation.copy("down"==(i=e.body.side)?new b.O9p(-Math.PI/2,0,0):"up"==i?new b.O9p(Math.PI/2,0,0):"front"==i?new b.O9p(0,0,0):"back"==i?new b.O9p(Math.PI,0,0):"left"==i?new b.O9p(0,Math.PI/2,0):"right"==i?new b.O9p(0,-Math.PI/2,0):void 0):(t.quaternion.copy(e.body.quaternion),t.rotateY(Math.PI),i=new b.Pq0,e.body.panel.getWorldPosition(i),t.position.copy(i)),n=C(Se(e.contact)),o=n,s.spawnPositions.some(e=>e.equals(o)))||(fe(t,r,a,e.body.side,!0,1),s.spawnPositions.push(n))})}function Se(e){var t=e.rj,i=new(A().Vec3);return e.bj.pointToWorldFrame(t,i),i}Le.friction=.4;r=new b.bdM(2,2),t=new b._4j({roughness:.2,normalMap:(new b.Tap).load("./assets/textures/decal/normal.webp"),polygonOffset:!0,polygonOffsetFactor:1});let he=new b.ZLX(r,t,1e3);he.current=0,he.frustumCulled=!0;for(var E=new b.B69,c=0;c<1e3;c++)E.position.set(1e5,1e5,1e5),E.updateMatrix(),he.setMatrixAt(c,E.matrix);he.instanceMatrix.needsUpdate=!0,he.computeBoundingSphere();n=new b.bdM(2,2),o=new b._4j({roughness:.2,normalMap:(new b.Tap).load("./assets/textures/decal/decal-normal.webp"),map:(new b.Tap).load("./assets/textures/decal/decal-diffuse.webp"),transparent:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1});let Ce=new b.ZLX(n,o,1e3);Ce.current=0,Ce.frustumCulled=!0;for(E=new b.B69,c=0;c<1e3;c++)E.position.set(1e5,1e5,1e5),E.updateMatrix(),Ce.setMatrixAt(c,E.matrix);Ce.instanceMatrix.needsUpdate=!0,Ce.computeBoundingSphere();s=new b.bdM(2,2),l=new b._4j({roughness:.2,normalMap:(new b.Tap).load("./assets/textures/decal/decal-normal.webp"),map:(new b.Tap).load("./assets/textures/decal/decal-diffuse.webp"),transparent:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,metalness:1,roughness:.25});let ye=new b.ZLX(s,l,1e3);ye.current=0,ye.frustumCulled=!0;for(E=new b.B69,c=0;c<1e3;c++)E.position.set(1e5,1e5,1e5),E.updateMatrix(),ye.setMatrixAt(c,E.matrix);ye.instanceMatrix.needsUpdate=!0,ye.computeBoundingSphere(),U.INSTANCED_WHITE_GEL=new b.ZLX(n,o,1e3),U.INSTANCED_WHITE_GEL.current=0,U.INSTANCED_WHITE_GEL.frustumCulled=!0,U.INSTANCED_WHITE_GEL.array=[];for(E=new b.B69,c=0;c<1e3;c++)E.position.set(1e5,1e5,1e5),E.updateMatrix(),U.INSTANCED_WHITE_GEL.setMatrixAt(c,E.matrix);function Me(){Pe(he),Pe(Ce),Pe(ye),Pe(U.INSTANCED_WHITE_GEL),he.material.envMap=U.ENV_MAP,U.SCENE_FPS.add(he),Ce.material.envMap=U.ENV_MAP,U.SCENE_FPS.add(Ce),ye.material.envMap=U.ENV_MAP,U.SCENE_FPS.add(ye),U.INSTANCED_WHITE_GEL.material.envMap=U.ENV_MAP,U.SCENE_FPS.add(U.INSTANCED_WHITE_GEL);for(var e=0;e<U.GELS.length;e++)fe(U.GELS[e],U.GELS[e].planeColor,U.GELS[e].gelType,U.GELS[e].side,!1,1);Oe.envMap=U.ENV_MAP;for(var t=0;t<U.DYMANIC_ITEMS.gel_blue.length;t++)0!=U.DYMANIC_ITEMS.gel_blue[t].length&&ge(U.DYMANIC_ITEMS.gel_blue[t],"blue",new b.Q1f("rgb(30,144,255)"),pe);for(t=0;t<U.DYMANIC_ITEMS.gel_orange.length;t++)0!=U.DYMANIC_ITEMS.gel_orange[t].length&&ge(U.DYMANIC_ITEMS.gel_orange[t],"orange",new b.Q1f("rgb(255,140,0)"),me);for(t=0;t<U.DYMANIC_ITEMS.gel_purple.length;t++)0!=U.DYMANIC_ITEMS.gel_purple[t].length&&ge(U.DYMANIC_ITEMS.gel_purple[t],"purple",new b.Q1f("rgb(75,0,130)"),Ne);for(t=0;t<U.DYMANIC_ITEMS.gel_white.length;t++)0!=U.DYMANIC_ITEMS.gel_white[t].length&&ge(U.DYMANIC_ITEMS.gel_white[t],"white",new b.Q1f(.8,.8,.8),Te);for(t=0;t<U.DYMANIC_ITEMS.gel_clear.length;t++)0!=U.DYMANIC_ITEMS.gel_clear[t].length&&ge(U.DYMANIC_ITEMS.gel_clear[t],"clear",new b.Q1f(11001053),Re);for(t=0;t<U.DYMANIC_ITEMS.gel_reflection.length;t++)0!=U.DYMANIC_ITEMS.gel_reflection[t].length&&ge(U.DYMANIC_ITEMS.gel_reflection[t],"reflection",new b.Q1f("rgb(128,128,128)"),Oe)}function Pe(e){for(var t=new b.B69,i=0;i<1e3;i++)t.scale.set(0,0,0),t.position.set(1e5,1e5,1e5),t.updateMatrix(),e.setMatrixAt(i,t.matrix)}function fe(e,t,i,n,o,a){var o="white"==i?U.INSTANCED_WHITE_GEL:"reflection"==i?ye:o?Ce:he,r=new b.B69,e=(r.position.copy(e.position),r.rotation.copy(e.rotation),r.updateMatrix(),o.setMatrixAt(o.current,r.matrix),o.setColorAt(o.current,new b.Q1f(t)),r),r=i,i=n,n=a,a=o;n=new(A().Box)(new(A().Vec3)(n,n,.01)),n=new(A().Body)({shape:n,mass:0,material:U.PHYSICS_MATERIAL}),e.translateZ(-.005),n.position.copy(e.position),n.quaternion.copy(e.quaternion),n.name="gel",n.type=r,n.collisionFilterGroup=U.CGROUP_ENVIRONMENT,n.collisionFilterMask=U.CGROUP_DYNAMIC|U.CGROUP_PLAYER,n.side=i,n.color=t,n.room=!0,e.gelBody=n,U.GEL_TRIGGER.push(e),"front"==i?n.normal=new b.Pq0(0,0,1):"back"==i?n.normal=new b.Pq0(0,0,-.01):"right"==i?n.normal=new b.Pq0(-.01,0,0):"left"==i?n.normal=new b.Pq0(1,0,0):"up"==i?n.normal=new b.Pq0(0,-.01,0):"down"==i&&(n.normal=new b.Pq0(0,1.01,0)),U.CANNON_BODIES.push(n),U.CANNON_WORLD.addBody(n),U.WALL_BODIES.push(n),"white"==r&&a.array.push(n),o.instanceMatrix.needsUpdate=!0,o.computeBoundingSphere(),o.current+=1}function ve(t){if(0!=t.body.collisionResponse)if("blue"!=t.body.type||t.target.gelJumping)"orange"==t.body.type?(t.target.OrangeContact||(L.PROPULSION.currentTime=0,L.PROPULSION.play(),L.WALK.volume=0),t.target.OrangeContact=!0):"purple"==t.body.type&&"down"!=t.body.side&&(clearTimeout(t.target.timeout),t.target.gelPurple=t.body,n=C(t.contact.ni).round().negate(),i=n,i=(new w.Vec3).copy(i),"player"==t.target.name?t.target.side!=t.body.side&&(U.HEAD_BOB_SPEED=3,U.PLAYER.PURPLE_CONTACT=!1,U.PLAYER.ROTATING=!0,setTimeout(()=>{U.PLAYER.ROTATING=!1,U.PLAYER.PURPLE_CONTACT=!0},400),t.target.side=t.body.side,t.target.customGravity=new(A().Vec3)(-9.8*i.x,-9.8*i.y,-9.8*i.z),U.PLAYER.upVector=i,U.PLAYER.upVectorThree=n,U.PLAYER.EULER||(U.MAIN_CAMERA_GROUP.position.copy(U.MAIN_CAMERA.position),U.MAIN_CAMERA.position.set(0,0,0),U.PIVOT=U.MAIN_CAMERA_GROUP,U.CUSTOM_GRAVITY.push(t.target)),window.direction=1,"front"==t.body.side?(U.PLAYER.EULER=new b.O9p(Math.PI/2,0,0,"XYZ"),S(400,U.MAIN_CAMERA_GROUP.rotation,new b.Pq0(Math.PI/2,0,0)),U.PLAYER.DIR=1):"back"==t.body.side?(U.PLAYER.EULER=new b.O9p(-Math.PI/2,0,0,"XYZ"),S(400,U.MAIN_CAMERA_GROUP.rotation,new b.Pq0(-Math.PI/2,0,0)),U.PLAYER.DIR=-1):"up"==t.body.side?(U.PLAYER.EULER=new b.O9p(Math.PI*U.PLAYER.DIR,0,0,"XYZ"),S(400,U.MAIN_CAMERA_GROUP.rotation,new b.Pq0(Math.PI*U.PLAYER.DIR,0,0))):"left"==t.body.side?(U.PLAYER.EULER=new b.O9p(0,0,-Math.PI/2,"XYZ"),S(400,U.MAIN_CAMERA_GROUP.rotation,new b.Pq0(0,0,-Math.PI/2)),U.PLAYER.DIR=-1):"right"==t.body.side&&(U.PLAYER.EULER=new b.O9p(0,0,Math.PI/2,"XYZ"),S(400,U.MAIN_CAMERA_GROUP.rotation,new b.Pq0(0,0,Math.PI/2)),U.PLAYER.DIR=1),window.nnn=!0,U.SPEED=.75,L.WALK_NORMAL.pause(),L.WALK=L.WALK_PAINT):t.target.customGravity||(U.CUSTOM_GRAVITY.push(t.target),t.target.customGravity=new(A().Vec3)(-9.8*i.x,-9.8*i.y,-9.8*i.z)));else{clearTimeout(t.target.timeout),t.target.firstCollisionHandled=!0,t.target.gelJumping=!0;let e=t.target;setTimeout(()=>{e.gelJumping=!1},100);var i,n=t.body.normal;if(t.target.impactSide!=t.body.side){if(0<Math.abs(n.x)?t.target.axisImpact="x":0<Math.abs(n.y)?t.target.axisImpact="y":0<Math.abs(n.z)&&(t.target.axisImpact="z"),Math.abs(t.target.velocity[t.target.axisImpact])<1&&"player"==t.target.name&&"down"==t.body.side)return t.target.jumpVelocity=-7,void(t.target.impactVelocity=-7);Math.abs(t.target.velocity[t.target.axisImpact])<7?t.target.impactVelocity=-7:t.target.impactVelocity=-Math.abs(t.target.velocity[t.target.axisImpact]),t.target.impactSide=t.body.side}else if(t.target.jumpVelocity)return;t.target.velocity[t.target.axisImpact]=t.target.impactVelocity,t.target.impactVelocity<0&&(i=-2.1*t.target.mass*t.target.impactVelocity,n=new(A().Vec3)(i*n.x,i*n.y,i*n.z),"down"!=t.body.side&&(t.target.velocity.y=.65,n.y=85),t.target.applyImpulse(n,t.target.position),t.target.soundRepulsion.position.copy(C(t.target.position)),t.target.soundRepulsion.audio.currentTime=0,t.target.soundRepulsion.audio.play())}}function we(e,t,i,n){"blue"==t?i="rgb(30,144,255)":"orange"==t?i="rgb(255,140,0)":"purple"==t&&(i="rgb(75,0,130)"),e.hasItem=!0,e.itemName="gel",e.gelType=t,e.planeColor=i,U.PLANE_LEVEL_INSTANCED.setColorAt(n,new b.Q1f(i)),U.GELS.indexOf(e)<=-1&&U.GELS.push(e)}U.INSTANCED_WHITE_GEL.instanceMatrix.needsUpdate=!0,U.INSTANCED_WHITE_GEL.computeBoundingSphere(),B()("body").on("click","#add-gel",function(){for(var e=0;e<U.SELECTED_ID.length;e++)we(U.PLANE_USER_DATA[U.SELECTED_ID[e]],B()("#gel-type").data("gel"),B()("#gel-type").data("color"),U.SELECTED_ID[e])}),B()("body").on("click","#remove-gel",function(){for(var e,t=0;t<U.SELECTED_ID.length;t++)U.PLANE_USER_DATA[U.SELECTED_ID[t]].gelType&&(U.PLANE_USER_DATA[U.SELECTED_ID[t]].hasItem=!1,U.PLANE_USER_DATA[U.SELECTED_ID[t]].itemName=null,U.PLANE_USER_DATA[U.SELECTED_ID[t]].gelType=null,e=U.PLANE_USER_DATA[U.SELECTED_ID[t]].portal?16777215:8421504,U.PLANE_USER_DATA[U.SELECTED_ID[t]].planeColor=e,U.PLANE_LEVEL_INSTANCED.setColorAt(U.SELECTED_ID[t],new b.Q1f(e)),-1<(e=U.GELS.indexOf(U.PLANE_USER_DATA[U.SELECTED_ID[t]])))&&U.GELS.splice(e,1)}),B()("body").on("click",".gel-type",function(){B()("#gel-type").find(".title").text("Gel type: "+B()(this).data("gel")),B()("#gel-type").data("gel",B()(this).data("gel")),B()("#gel-type").data("color",B()(this).data("color"))});var be,Be,Ue=e(423);class Ge extends b.eaF{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};super(e),this.isWater=!0;let i=this;var e=void 0!==t.textureWidth?t.textureWidth:512,n=void 0!==t.textureHeight?t.textureHeight:512;void 0!==t.clipBias&&t.clipBias;var o=void 0!==t.alpha?t.alpha:1,a=void 0!==t.time?t.time:0,r=void 0!==t.waterNormals?t.waterNormals:null,s=void 0!==t.sunDirection?t.sunDirection:new b.Pq0(.70707,.70707,0),l=new b.Q1f(void 0!==t.sunColor?t.sunColor:16777215),E=new b.Q1f(void 0!==t.waterColor?t.waterColor:8355711);let c=void 0!==t.eye?t.eye:new b.Pq0(0,0,0);var _=void 0!==t.distortionScale?t.distortionScale:20,d=void 0!==t.side?t.side:b.hB5,t=void 0!==t.fog&&t.fog;new b.Zcv,new b.Pq0,new b.Pq0,new b.Pq0,new b.kn4,new b.Pq0(0,0,-1),new b.IUQ,new b.Pq0,new b.Pq0,new b.IUQ;let u=new b.kn4,A=(new b.ubm,new b.nWS(e,n));e={name:"MirrorShader",uniforms:b.LlO.merge([b.fCn.fog,b.fCn.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:0},textureMatrix:{value:new b.kn4},sunColor:{value:new b.Q1f(8355711)},sunDirection:{value:new b.Pq0(.70707,.70707,0)},eye:{value:new b.Pq0},waterColor:{value:new b.Q1f(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>
					#include <fog_fragment>	
				}`};let p=new b.BKk({name:e.name,uniforms:b.LlO.clone(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,lights:!0,side:d,fog:t});p.uniforms.mirrorSampler.value=A.texture,p.uniforms.textureMatrix.value=u,p.uniforms.alpha.value=o,p.uniforms.time.value=a,p.uniforms.normalSampler.value=r,p.uniforms.sunColor.value=l,p.uniforms.waterColor.value=E,p.uniforms.sunDirection.value=s,p.uniforms.distortionScale.value=_,p.uniforms.eye.value=c,i.material=p;i.onBeforeRender=function(e,t,i){U.FPS_MODE}}}var xe=[],Ye=[],Ve=[];let He=function(t){Ye=[],Ve=[],function e(t){var i=g(t.position.x+1+"/"+(t.position.y+1)+"/"+t.position.z);0==i.length&&(t.hasGoo=!0,Ye.includes(t.position)||(Ye.push(t.position),Ve.push(t.id_instanced)),0<(n=g(t.position.x+2+"/"+t.position.y+"/"+t.position.z)).length)&&(Ve.includes(n[0].id_instanced)||e(n[0]));i=g(t.position.x-1+"/"+(t.position.y+1)+"/"+t.position.z);0==i.length&&(t.hasGoo=!0,Ye.includes(t.position)||(Ye.push(t.position),Ve.push(t.id_instanced)),0<(n=g(t.position.x-2+"/"+t.position.y+"/"+t.position.z)).length)&&(Ve.includes(n[0].id_instanced)||e(n[0]));i=g(t.position.x+"/"+(t.position.y+1)+"/"+(t.position.z+1));0==i.length&&(t.hasGoo=!0,Ye.includes(t.position)||(Ye.push(t.position),Ve.push(t.id_instanced)),0<(n=g(t.position.x+"/"+t.position.y+"/"+(t.position.z+2))).length)&&(Ve.includes(n[0].id_instanced)||e(n[0]));i=g(t.position.x+"/"+(t.position.y+1)+"/"+(t.position.z-1));{var n;0==i.length&&(t.hasGoo=!0,Ye.includes(t.position)||(Ye.push(t.position),Ve.push(t.id_instanced)),0<(n=g(t.position.x+"/"+t.position.y+"/"+(t.position.z-2))).length)&&(Ve.includes(n[0].id_instanced)||e(n[0]))}}(t);var e,i,n=new b.bdM(2,2),o=[];for(let e=0;e<Ye.length;e++){var a,r=new b.kn4,s=((a=new b.B69).rotation.set(0,0,0),a.rotation.x=-Math.PI/2,a.position.copy(Ye[e]),a.translateZ(1.79),a.updateMatrix(),r.compose(a.position,a.quaternion,a.scale),n.clone()),r=(s.applyMatrix4(r),new b.eaF(n.clone(),new b.V9B));r.rotation.set(0,0,0),r.rotation.x=-Math.PI/2,r.position.copy(Ye[e]),r.translateZ(1);(l=new b.NRn).setFromObject(r);var l,r=(l.min.y+l.max.y)/2;l.min.y=r-.75,l.max.y=.75+r,l.idPlane=t.id_instanced,U.GOO_BOXES.push(l),o.push(s)}(e=0<o.length?Ue.pP(o):(e=new b.kn4,(a=new b.B69).rotation.set(0,0,0),a.rotation.x=-Math.PI/2,a.position.copy(t.position),a.translateZ(1.79),a.updateMatrix(),e.compose(a.position,a.quaternion,a.scale),(i=n.clone()).applyMatrix4(e),i)).computeBoundingBox(),Be=new b.eaF(e,new b._4j({color:new b.Q1f(8142592),envMap:U.ENV_MAP,roughness:.2,transparent:!0,opacity:.8})),0==o.length&&((l=new b.NRn).setFromObject(Be),i=(l.min.y+l.max.y)/2,l.min.y=i-.75,l.max.y=.75+i,l.idPlane=t.id_instanced,U.GOO_BOXES.push(l)),be=new Ge(e,{textureWidth:512,textureHeight:512,waterNormals:(new b.Tap).load("assets/textures/waternormals.jpg",function(e){e.wrapS=e.wrapT=b.GJx}),sunDirection:new b.Pq0,sunColor:16777215,waterColor:7695,distortionScale:.2,alpha:.8}),xe.push(be),be.updateMatrixWorld(),be.material.transparent=!0,U.SCENE_CHILDREN.add(be),U.SCENE_CHILDREN.add(Be),t.item.lava=Be,t.item.water=be,t.item.ids=Ve,U.GOO_PLANES.push(t)};function ke(){if(be)for(var e=0;e<xe.length;e++)xe[e].material.uniforms.time.value+=5e-4}function Fe(){for(var e=0;e<U.TRACTOR_BEAM_RAYCASTER.length;e++)R("tractor_beam",U.TRACTOR_BEAM_RAYCASTER[e],U.TRACTOR_BEAM_RAYCASTER[e].item,null,!0,e);for(e=0;e<U.LIGHT_BRIDGE_RAYCASTER.length;e++)R("light_bridge",U.LIGHT_BRIDGE_RAYCASTER[e],U.LIGHT_BRIDGE_RAYCASTER[e].item,null,!0,e),O(U.LIGHT_BRIDGE_RAYCASTER[e].item,U.LIGHT_BRIDGE_RAYCASTER[e].item.userData.triggers,B()("#light-bridge-trigger"),"light_bridge");for(e=0;e<U.LASER_FIELD_RAYCASTER.length;e++)R("laser_field",U.LASER_FIELD_RAYCASTER[e],U.LASER_FIELD_RAYCASTER[e].item,U.ITEMS_ADDED.getObjectByName("laser_field"),!0,e),O(U.LASER_FIELD_RAYCASTER[e].item,U.LASER_FIELD_RAYCASTER[e].item.userData.triggers,B()("#laser-field-trigger"),"laser_field");for(e=0;e<U.FIZZLER_RAYCASTER.length;e++)R("fizzler",U.FIZZLER_RAYCASTER[e],U.FIZZLER_RAYCASTER[e].item,U.ITEMS_ADDED.getObjectByName("fizzler"),!0,e),O(U.FIZZLER_RAYCASTER[e].item,U.FIZZLER_RAYCASTER[e].item.userData.triggers,B()("#fizzler-trigger"),"fizzler");for(e=0;e<U.GLASS_RAYCASTER.length;e++)R("glass",U.GLASS_RAYCASTER[e],U.GLASS_RAYCASTER[e].item,null,!0,e),O(U.GLASS_RAYCASTER[e].item,U.GLASS_RAYCASTER[e].item.userData.triggers,B()("#glass-trigger"),"glass");for(e=0;e<U.LASER_EMITTER_RAYCASTER.length;e++)ce(U.LASER_EMITTER_RAYCASTER[e].item,!0,U.LASER_EMITTER_RAYCASTER[e],e);var t=new b.NRn;t.setFromObject(U.EXIT_DOOR.getObjectByName("trigger")),U.EXIT_DOOR.bb=t,U.EXIT_DOOR.add(U.EXIT_DOOR.getObjectByName("trigger")),(t=new b.NRn).setFromObject(U.ENTER_DOOR.getObjectByName("trigger")),U.ENTER_DOOR.bb=t,U.ENTER_DOOR.add(U.ENTER_DOOR.getObjectByName("trigger")),U.ENTER_DOOR.getObjectByName("trigger").material.color=new b.Q1f(65280),U.EXIT_DOOR.getObjectByName("trigger").material.color=new b.Q1f(65280);for(var i=0;i<U.BOUNDING_BOX.length;i++)U.BOUNDING_BOX[i].platform.material.color=new b.Q1f(65280);window.allowTest=!0;for(e=0;e<U.PLANE_USER_DATA.length;e++)if(U.PLANE_USER_DATA[e].exists){U.ENTER_DOOR.bb.containsPoint(U.PLANE_USER_DATA[e].position)&&(U.ENTER_DOOR.getObjectByName("trigger").material.color=new b.Q1f(16711680),window.allowTest=!1),U.EXIT_DOOR.bb.containsPoint(U.PLANE_USER_DATA[e].position)&&(U.EXIT_DOOR.getObjectByName("trigger").material.color=new b.Q1f(16711680),window.allowTest=!1);for(i=0;i<U.BOUNDING_BOX.length;i++)U.BOUNDING_BOX[i].containsPoint(U.PLANE_USER_DATA[e].position)&&("piston_platforms"==U.BOUNDING_BOX[i].platform.name?!U.PLANE_USER_DATA[e].hasItem&&"up"!=U.PLANE_USER_DATA[e].side||(U.BOUNDING_BOX[i].platform.material.color=new b.Q1f(16711680),window.allowTest=!1):"track_platforms"==U.BOUNDING_BOX[i].platform.name&&("front"==U.BOUNDING_BOX[i].platform.side||"back"==U.BOUNDING_BOX[i].platform.side?!U.PLANE_USER_DATA[e].hasItem&&"right"!=U.PLANE_USER_DATA[e].side&&"left"!=U.PLANE_USER_DATA[e].side||(U.BOUNDING_BOX[i].platform.material.color=new b.Q1f(16711680),window.allowTest=!1):"left"!=U.BOUNDING_BOX[i].platform.side&&"right"!=U.BOUNDING_BOX[i].platform.side||!U.PLANE_USER_DATA[e].hasItem&&"front"!=U.PLANE_USER_DATA[e].side&&"back"!=U.PLANE_USER_DATA[e].side||(U.BOUNDING_BOX[i].platform.material.color=new b.Q1f(16711680),window.allowTest=!1)))}for(e=0;e<U.PLANE_USER_DATA.length;e++)if(U.PLANE_USER_DATA[e].exists&&U.PLANE_USER_DATA[e].hasItem&&U.PLANE_USER_DATA[e].hasGoo){var n=U.PLANE_USER_DATA[e].item;if(n.ids){U.SCENE_CHILDREN.remove(n.water),U.SCENE_CHILDREN.remove(n.lava);for(i=0;i<n.ids.length;i++)U.PLANE_USER_DATA[n.ids[i]].hasGoo=!1;for(var o,i=U.GOO_BOXES.length-1;0<=i;i--)U.GOO_BOXES[i].idPlane==U.PLANE_USER_DATA[e].id_instanced&&-1<(o=U.GOO_BOXES.indexOf(U.GOO_BOXES[i]))&&U.GOO_BOXES.splice(o,1);var a=U.PLANE_USER_DATA[e];a.hasItem=!0,a.itemName="goo",a.item=n,He(a)}}}function ze(e,t){var i=t.item.platformBox,e=(i.parent.scale.y=e,t.item.userData.scaleY=e,U.BOUNDING_BOX.indexOf(i.bb)),e=(-1<e&&U.BOUNDING_BOX.splice(e,1),new b.NRn);e.setFromObject(i.parent),e.name=t.itemName,(i.bb=e).platform=i,U.BOUNDING_BOX.push(e)}function je(e,t,i){var i=U.ITEMS_ADDED.getObjectByName(i),n=new b.B69;n.position.copy(e.initialPosition),n.quaternion.copy(e.quaternion),n.updateMatrix(),i.setMatrixAt(t,n.matrix),i.instanceMatrix.needsUpdate=!0,i.computeBoundingSphere()}window.allowTest=!0,B()("body").on("change","#piston-max-height",function(){ze(B()(this).val(),U.PLANE_USER_DATA[U.SELECTED_ID[0]]),Fe()}),B()("body").on("change","#state-piston",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.isActive=this.checked}),B()("body").on("change","#state-piston-loop",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.loop=this.checked});let qe=new Map;function Xe(e){var{body:e,target:t}=e;qe.has(t)||qe.set(t,new Set),qe.get(t).add(e.id),t.bodiesInContact.includes(e)||t.bodiesInContact.push(e)}function We(){U.PLATFORM_BODIES.forEach(e=>{{var o=e;let n=qe.get(o);if(n){let i=new Set;U.CANNON_WORLD.contacts.forEach(e=>{e.bi!==o&&e.bj!==o||!n.has(e.bi.id)&&!n.has(e.bj.id)||(e=(e.bi===o?e.bj:e.bi).id,i.add(e))}),n.forEach(t=>{i.has(t)||(console.log(`Body ${t} is no longer colliding with the platform`),n.delete(t),o.bodiesInContact.forEach(e=>{e.id==t&&-1<(e=o.bodiesInContact.indexOf(e))&&o.bodiesInContact.splice(e,1)}))}),0===n.size&&qe.delete(o)}}})}let m=new w.World;m.quatNormalizeSkip=0,m.quatNormalizeFast=!1;var a=new w.GSSolver,Ze=(m.defaultContactMaterial.contactEquationStiffness=1e9,m.defaultContactMaterial.contactEquationRelaxation=4,a.iterations=10,a.tolerance=.1,m.solver=new w.SplitSolver(a),m.gravity.set(0,-9.8,0),m.allowSleep=!1,m.broadphase=new w.NaiveBroadphase,!1),Qe=!0;let Je,Ke;r=new w.Sphere(.1),(Je=new w.Body({mass:0})).addShape(r),Je.collisionFilterGroup=0,Je.collisionFilterMask=U.CGROUP_ENVIRONMENT|U.CGROUP_DYNAMIC,m.addBody(Je),t=new b.bdM(100,100);new b.eaF(t,new b.V9B).visible=!1;let $e=new i.A(U.DEBUGGER_GROUP,m,{onInit(e,t){t.visible=!1,B()("body").on("input","#debug-input",function(){Qe=this.checked,t.visible=this.checked})}});var et=new b.Pq0,tt=new b.tBo,it=!0;function nt(e){for(var t=0;t<U.CUSTOM_GRAVITY.length;t++){var i=U.CUSTOM_GRAVITY[t].customGravity,n=U.CUSTOM_GRAVITY[t],i=new(A().Vec3)(i.x-U.CANNON_WORLD.gravity.x,i.y-U.CANNON_WORLD.gravity.y,i.z-U.CANNON_WORLD.gravity.z),i=new(A().Vec3)(i.x*n.mass,i.y*n.mass,i.z*n.mass);n.applyForce(i,n.position)}for(var o,a,r,s,l,E,c=0;c<De.length;c++)De[c].position.copy(De[c].body.position),De[c].quaternion.copy(De[c].body.quaternion);for(E in U.HOLDING_ITEM&&(o=new b.Pq0,U.MAIN_CAMERA.getObjectByName("cubeHolder").getWorldPosition(o),a=!1,tt.setFromCamera(et,U.MAIN_CAMERA),null!=U.PORTAL_INNER_BOX[0]&&null!=U.PORTAL_INNER_BOX[1]&&0<(r=tt.intersectObjects(U.PORTAL_INNER_BOX)).length&&r[0].distance<1.25&&(a=!0),0<(r=tt.intersectObject(U.PLANE_LEVEL_INSTANCED)).length&&r[0].distance<1.25&&!a&&(l=r[0].point,s=new b.Pq0(0,0,-1).applyMatrix4(U.MAIN_CAMERA.matrixWorld).sub(U.MAIN_CAMERA.position).normalize(),l.add(s.clone().multiplyScalar(-U.CURRENT_ITEM.body.offset)),U.CURRENT_ITEM.body.position.copy(o=l)),0<(r=tt.intersectObjects(window.glass)).length&&r[0].distance<1.25&&!a&&(l=r[0].point,s=new b.Pq0(0,0,-1).applyMatrix4(U.MAIN_CAMERA.matrixWorld).sub(U.MAIN_CAMERA.position).normalize(),l.add(s.clone().multiplyScalar(-U.CURRENT_ITEM.body.offset)),o=l,U.CURRENT_ITEM.body.position.copy(l)),Ze||(Ze=!0,a=o,(r=U.CURRENT_ITEM.body).position.copy(a),s=(new w.Vec3).copy(a).vsub(r.position),l=(l=r.quaternion.inverse()).vmult(s),Je.position.copy(a),Ke=new w.PointToPointConstraint(r,l,Je,new w.Vec3(0,0,0)),m.addConstraint(Ke)),a=o,Je.position.copy(a),U.CURRENT_ITEM.body.quaternion.copy(U.PLAYER.quaternion),Ke.update()),it&&(()=>{if(U.LEVEL_ENTERED){for(var e=0;e<U.DYMANIC_ITEMS.laser_cube.length;e++)0!=U.DYMANIC_ITEMS.laser_cube[e].length&&(U.DYMANIC_ITEMS.laser_cube[e].body.laser.active=!1);for(var t=0;t<U.LASER_TRIGGERS.length;t++)U.LASER_TRIGGERS[t].emitterState=!1;for(t=0;t<U.LASER_EMITTER_RAYCASTER.length;t++){U.LASER_EMITTER_RAYCASTER[t].laser.clone.visible=!1;var i=U.LASER_EMITTER_RAYCASTER[t].intersectObject(U.PLANE_LEVEL_INSTANCED);0<i.length&&(U.LASER_EMITTER_RAYCASTER[t].laser.scale.y=i[0].distance);for(var i=[U.ITEMS_ADDED.getObjectByName("laser_cube"),U.ITEMS_ADDED.getObjectByName("cube"),U.ITEMS_ADDED.getObjectByName("sphere"),U.ITEMS_ADDED.getObjectByName("cube_2"),U.ITEMS_ADDED.getObjectByName("scale_cube"),U.ITEMS_ADDED.getObjectByName("laser_receiver"),U.ITEMS_ADDED.getObjectByName("laser_relay")].filter(function(e){return null!=e}),n=U.LASER_EMITTER_RAYCASTER[t].intersectObjects(i),o=!1,e=0;e<n.length;e++)if("laser_receiver"==n[e].object.name?(U.DYMANIC_ITEMS.laser_receiver[n[e].instanceId].emitterState=!0,U.DYMANIC_ITEMS.laser_receiver[n[e].instanceId].fromLaserCube=!1,p(U.DYMANIC_ITEMS.laser_receiver[n[e].instanceId],!0,!1)):"laser_relay"==n[e].object.name&&(U.DYMANIC_ITEMS.laser_relay[n[e].instanceId].emitterState=!0,U.DYMANIC_ITEMS.laser_relay[n[e].instanceId].fromLaserCube=!1,p(U.DYMANIC_ITEMS.laser_relay[n[e].instanceId],!0,!1)),"laser_cube"==n[e].object.name&&(U.DYMANIC_ITEMS.laser_cube[n[e].instanceId].body.laser.active=!0),"laser_relay"!=n[e].object.name){U.LASER_EMITTER_RAYCASTER[t].laser.scale.y=n[e].distance,o=!0;break}if(!o){if(null===U.PORTALS[0]||null===U.PORTALS[1])return;var a=U.LASER_EMITTER_RAYCASTER[t].intersectObjects(U.PORTAL_SHADER);if(0<a.length)for(var r,s,l="portal-0"==a[0].object.name?1:0,E=new b.Pq0,c=(U.PORTAL_SHADER[l].getWorldDirection(E),de.set(U.PORTAL_SHADER[l].position,E),de.intersectObject(U.PLANE_LEVEL_INSTANCED)),_=(0<c.length&&(U.LASER_EMITTER_RAYCASTER[t].laser.clone.scale.y=c[0].distance,U.LASER_EMITTER_RAYCASTER[t].laser.clone.position.copy(U.PORTAL_SHADER[l].position),U.LASER_EMITTER_RAYCASTER[t].laser.clone.rotation.copy(U.PORTAL_SHADER[l].rotation),U.LASER_EMITTER_RAYCASTER[t].laser.clone.translateY(1.8*(a[0].uv.y-.5)),U.LASER_EMITTER_RAYCASTER[t].laser.clone.translateX(-.9*(a[0].uv.x-.5)),U.LASER_EMITTER_RAYCASTER[t].laser.clone.rotateX(Math.PI/2),U.LASER_EMITTER_RAYCASTER[t].laser.clone.visible=!0),de.set(U.LASER_EMITTER_RAYCASTER[t].laser.clone.position,E),de.intersectObjects(i)),e=0;e<_.length;e++)if("laser_receiver"==_[e].object.name?(U.DYMANIC_ITEMS.laser_receiver[_[e].instanceId].fromLaserCube=!1,U.DYMANIC_ITEMS.laser_receiver[_[e].instanceId].emitterState=!0,p(U.DYMANIC_ITEMS.laser_receiver[_[e].instanceId],!0,!1)):"laser_relay"==_[e].object.name&&(U.DYMANIC_ITEMS.laser_relay[_[e].instanceId].fromLaserCube=!1,U.DYMANIC_ITEMS.laser_relay[_[e].instanceId].emitterState=!0,p(U.DYMANIC_ITEMS.laser_relay[_[e].instanceId],!0,!1)),"laser_cube"!=_[e].object.name||(r=U.DYMANIC_ITEMS.laser_cube[_[e].instanceId]).body.laser.active||(r.body.laser.active=!0,(s=new b.B69).position.copy(r.body.position),s.quaternion.copy(r.body.quaternion),ue(s,r.body.laser)),U.LASER_EMITTER_RAYCASTER[t].laser.clone.visible=!0,"laser_relay"!=_[e].object.name){U.LASER_EMITTER_RAYCASTER[t].laser.clone.scale.y=_[e].distance;break}}}for(t=0;t<U.LASER_TRIGGERS.length;t++)U.LASER_TRIGGERS[t].emitterState||U.LASER_TRIGGERS[t].fromLaserCube||p(U.LASER_TRIGGERS[t],!1,!1)}})(),U.DYMANIC_ITEMS){var _=U.ITEMS_ADDED.getObjectByName(E);if("gel_gun_blue"!=E&&"gel_gun_orange"!=E&&"gel_gun_white"!=E&&"pedestal_button"!=E&&"button_weight"!=E&&"button_box"!=E&&"button_sphere"!=E&&"dispenser"!=E&&"ramp"!=E&&"ramp_half"!=E&&"ramp_half2"!=E&&"stairs"!=E&&"light_bridge"!=E&&"laser_emitter"!=E&&"angled_panel"!=E&&"door"!=E&&"light"!=E&&"stripe"!=E&&"gel_blue"!=E&&"gel_orange"!=E&&"laser_field"!=E&&"fizzler"!=E&&"portal_0"!=E&&"portal_1"!=E&&"pellet_launcher"!=E&&"gel_recharger"!=E&&"gel_white"!=E&&"gel_clear"!=E&&"gel_reflection"!=E&&"pellet_catcher"!=E&&"faith_plate"!=E&&"gel_purple"!=E&&"bed"!=E&&"toilet"!=E&&"desk"!=E&&"cabinet"!=E&&"sign"!=E&&"incinerator"!=E&&"step"!=E)for(var d,u=0;u<U.DYMANIC_ITEMS[E].length;u++)0!=U.DYMANIC_ITEMS[E][u].length&&(U.DYMANIC_ITEMS[E][u].body&&U.DYMANIC_ITEMS[E][u].body.sound&&(U.DYMANIC_ITEMS[E][u].body.sound.position.copy(U.DYMANIC_ITEMS[E][u].body.position),U.DYMANIC_ITEMS[E][u].body.sound.quaternion.copy(U.DYMANIC_ITEMS[E][u].body.quaternion)),"piston_platforms"==E||"track_platforms"==E?((e,t,i,n)=>{var o,a,r,s,l;e.body&&e.userData.isActive&&0!=e.platformBox.parent.scale.y?!e.userData.loop&&e.body.pistonDown||(o=e.body.pistonDown?-.7*n:.7*n,a="y",r=new w.Vec3(0,1,0),"track_platforms"==e.platformBox.name?(s="front"==e.platformBox.side||"back"==e.platformBox.side?(a="x",r=new w.Vec3(1,0,0),new b.Pq0(e.body.position.x,e.initialPosition.y,e.initialPosition.z)):(a="z",r=new w.Vec3(0,0,1),new b.Pq0(e.initialPosition.x,e.initialPosition.y,e.body.position.z)),e.platformBox.parent.scale.y<0&&(o*=-1)):s=e.body.position,e.body.position[a]+=o,0<e.platformBox.parent.scale.y?e.body.position[a]>e.initialPosition[a]+2*e.platformBox.parent.scale.y?e.body.pistonDown=!0:e.body.position[a]<=e.initialPosition[a]&&(e.body.pistonDown=!1):e.body.position[a]<e.initialPosition[a]+2*e.platformBox.parent.scale.y?e.body.pistonDown=!0:e.body.position[a]>=e.initialPosition[a]&&(e.body.pistonDown=!1),(l=new b.B69).quaternion.copy(e.body.quaternion),l.position.copy(s),l.updateMatrix(),t.setMatrixAt(i,l.matrix),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere(),e.body.bodiesInContact.forEach(e=>{var t=new w.Vec3(o*r.x,o*r.y,o*r.z);e.position.vadd(t,e.position)})):e.body&&!e.userData.isActive&&0!=e.platformBox.parent.scale.y&&e.body.pistonDown&&!e.userData.loop&&(o=-.7*n,a="y",r=new w.Vec3(0,1,0),"track_platforms"==e.platformBox.name?(s="front"==e.platformBox.side||"back"==e.platformBox.side?(a="x",r=new w.Vec3(1,0,0),new b.Pq0(e.body.position.x,e.initialPosition.y,e.initialPosition.z)):(a="z",r=new w.Vec3(0,0,1),new b.Pq0(e.initialPosition.x,e.initialPosition.y,e.body.position.z)),e.platformBox.parent.scale.y<0&&(o*=-1)):s=e.body.position,e.body.position[a]+=o,0<e.platformBox.parent.scale.y?e.body.position[a]>e.initialPosition[a]+2*e.platformBox.parent.scale.y?e.body.pistonDown=!0:e.body.position[a]<=e.initialPosition[a]&&(e.body.pistonDown=!1):e.body.position[a]<e.initialPosition[a]+2*e.platformBox.parent.scale.y?e.body.pistonDown=!0:e.body.position[a]>=e.initialPosition[a]&&(e.body.pistonDown=!1),(l=new b.B69).quaternion.copy(e.body.quaternion),l.position.copy(s),l.updateMatrix(),t.setMatrixAt(i,l.matrix),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere(),e.body.bodiesInContact.forEach(e=>{var t=new w.Vec3(o*r.x,o*r.y,o*r.z);e.position.vadd(t,e.position)}))})(U.DYMANIC_ITEMS[E][u],_,u,e):"tractor_beam"==E||"laser_receiver"==E||"laser_relay"==E?U.DYMANIC_ITEMS[E][u].userData.state&&("tractor_beam"==E?ot(_,U.DYMANIC_ITEMS[E][u],u,.05):"laser_receiver"!=E&&"laser_relay"!=E||ot(_,U.DYMANIC_ITEMS[E][u],u,-.075)):((d=new b.B69).position.copy(U.DYMANIC_ITEMS[E][u].body.position),d.quaternion.copy(U.DYMANIC_ITEMS[E][u].body.quaternion),d.updateMatrix(),_.setMatrixAt(u,d.matrix),_.instanceMatrix.needsUpdate=!0,_.computeBoundingSphere(),"laser_cube"==E&&it&&ue(d,U.DYMANIC_ITEMS[E][u].body.laser)))}for(u=0;u<U.LASER_TRIGGERS.length;u++)!U.LASER_TRIGGERS[u].emitterState&&U.LASER_TRIGGERS[u].fromLaserCube&&p(U.LASER_TRIGGERS[u],!1);for(u=0;u<U.CAMERAS.length;u++)U.CAMERAS[u].fixed||(U.CAMERAS[u].position.copy(U.CAMERAS[u].body.position),U.CAMERAS[u].quaternion.copy(U.CAMERAS[u].body.quaternion),U.CAMERAS[u].cube.position.copy(U.CAMERAS[u].body.position),U.CAMERAS[u].cube.quaternion.copy(U.CAMERAS[u].body.quaternion));Qe&&$e.update(),U.HOLDING_ITEM?it=!0:it&&(it=!1,setTimeout(()=>{it=!0},100))}function ot(e,t,i,n){var o=new b.Pq0,o=(o.copy(t.up).applyQuaternion(t.quaternion),t.userData.reversed&&(n=-n),1==Math.round(Math.abs(o.z))?t.rotation.y+=n:1==Math.round(Math.abs(o.x))?t.rotation.x+=n:1==Math.round(Math.abs(o.y))&&(t.rotation.y+=n),new b.B69);o.position.copy(t.position),o.rotation.copy(t.rotation),o.updateMatrix(),e.setMatrixAt(i,o.matrix),e.instanceMatrix.needsUpdate=!0,e.computeBoundingSphere()}function at(){m.removeConstraint(Ke),Ke=void 0,Ze=!1,Je.position.set(1e4,1e3,1e3)}U.CANNON_WORLD=m;var rt=null,st=new b.Pq0,lt=new b.tBo;function Et(){lt.setFromCamera(st,U.MAIN_CAMERA);var e=lt.intersectObjects(window.glass),t=lt.intersectObjects(U.INTERACTIVE);if(U.HOLDING_ITEM)L.HOLD.pause(),S(250,U.GUN.children[0].children[0].position,new b.Pq0(.007,-.01,-.0095)),U.HOLDING_ITEM=!1,rt&&(rt.gelJumping=!1,rt.sleeping=!1),U.CURRENT_ITEM.body.collisionFilterMask=U.CGROUP_ALL,U.CURRENT_ITEM.body.sideContact=null,U.CURRENT_ITEM.body.contactID=null,U.CURRENT_ITEM.body.holding=!1,U.CURRENT_ITEM.body.angularDamping=0,U.CURRENT_ITEM.body.allowSleep=!0,U.CURRENT_ITEM=null,U.CURRENT_ITEM_ID=null,rt=null,at();else if(0<t.length){if(0<e.length&&e[0].distance<t[0].distance)return L.PICK_FAIL.pause(),L.PICK_FAIL.currentTime=0,void D(L.PICK_FAIL);if("pedestal_button"==t[0].object.name){if(t[0].distance<1)for(var e=U.DYMANIC_ITEMS[t[0].object.name][t[0].instanceId],i=U.PLANE_USER_DATA[e.userData.planeInstancedId],n=0;n<U.CONNECTIONS.length;n++)if(U.CONNECTIONS[n].from.instancedName.includes("pedestal")&&i==U.CONNECTIONS[n].from&&!U.CONNECTIONS[n].line.active){if(U.CONNECTIONS[n].to.item.userData.buttons+=1,le(U.CONNECTIONS[n],"no",!0,new b.Q1f(2,1.3,0)),L.POSITIVE.play(),U.CONNECTIONS[n].to.itemName.includes("angled_panel")){if(U.CONNECTIONS[n].to.item.userData.connections==U.CONNECTIONS[n].to.item.userData.buttons){S(500,U.CONNECTIONS[n].to.item.getObjectByName("pivot2").rotation,new b.Pq0(U.CONNECTIONS[n].to.item.userData.angleTrigger*Math.PI/180,U.CONNECTIONS[n].to.item.getObjectByName("pivot2").rotation.y,U.CONNECTIONS[n].to.item.getObjectByName("pivot2").rotation.z));let e=U.CONNECTIONS[n].to.item;0!=e.getObjectByName("panel").hasPortal&&1!=e.getObjectByName("panel").hasPortal||M(e.getObjectByName("panel").hasPortal),e.getObjectByName("panel").hasPortal=100,setTimeout(()=>{Vn(e.getObjectByName("panel").body,e.getObjectByName("Cube"))},500)}}else U.CONNECTIONS[n].to.itemName.includes("faith_plate")?U.CONNECTIONS[n].to.item.userData.connections==U.CONNECTIONS[n].to.item.userData.buttons&&(U.CONNECTIONS[n].to.item.userData.state=!0):U.CONNECTIONS[n].to.itemName.includes("door")||U.CONNECTIONS[n].to.itemName.includes("exitDoor")?U.CONNECTIONS[n].to.item.userData.connections==U.CONNECTIONS[n].to.item.userData.buttons&&qn(0,!0,!1,U.CONNECTIONS[n].to.item):U.CONNECTIONS[n].to.itemName.includes("cube")||U.CONNECTIONS[n].to.itemName.includes("sphere")?U.CONNECTIONS[n].to.item.userData.connections==U.CONNECTIONS[n].to.item.userData.buttons&&At(U.CONNECTIONS[n].to.item):U.CONNECTIONS[n].to.itemName.includes("tractor")?U.CONNECTIONS[n].to.item.userData.connections==U.CONNECTIONS[n].to.item.userData.buttons&&ut(U.CONNECTIONS[n].to):U.CONNECTIONS[n].to.itemName.includes("light_bridge")?U.CONNECTIONS[n].to.item.userData.connections==U.CONNECTIONS[n].to.item.userData.buttons&&dt(U.CONNECTIONS[n].to):U.CONNECTIONS[n].to.itemName.includes("laser_field")||U.CONNECTIONS[n].to.itemName.includes("fizzler")?U.CONNECTIONS[n].to.item.userData.connections==U.CONNECTIONS[n].to.item.userData.buttons&&_t(U.CONNECTIONS[n].to):(U.CONNECTIONS[n].to.itemName.includes("portal_0")||U.CONNECTIONS[n].to.itemName.includes("portal_1"))&&(U.CONNECTIONS[n].to.item.active=!0,U.CONNECTIONS[n].to.itemName.includes("portal_0")?vt(0,U.CONNECTIONS[n].to.item,U.MAIN_CAMERA):U.CONNECTIONS[n].to.itemName.includes("portal_1")&&vt(2,U.CONNECTIONS[n].to.item,U.MAIN_CAMERA));if(!U.CONNECTIONS[n].from.item.userData.pedestalInfinity){if(!U.CONNECTIONS[n].to.itemName.includes("portal_0")&&!U.CONNECTIONS[n].to.itemName.includes("portal_1")){let e=document.getElementById("tiktok").cloneNode(!0);e.play(),setTimeout(()=>{e.pause()},1e3*U.CONNECTIONS[n].from.item.userData.pedestalValue)}setTimeout(ct,1e3*U.CONNECTIONS[n].from.item.userData.pedestalValue,U.CONNECTIONS[n])}}}else if(t[0].distance<1.5){var e=t[0].instanceId,o=t[0].object.name;if("camera"!=t[0].object.name&&0==U.DYMANIC_ITEMS[o][e].body.mass)return;("camera"!=t[0].object.name?U.DYMANIC_ITEMS[o][e]:t[0].object).body.mass,U.HOLDING_ITEM=!0,S(250,U.GUN.children[0].children[0].position,new b.Pq0(.007,-.01,-.004)),"camera"!=t[0].object.name?(U.CURRENT_ITEM=U.DYMANIC_ITEMS[o][e],U.CURRENT_INSTANCED=U.ITEMS_ADDED.getObjectByName(o),U.CURRENT_ITEM_ID=e,rt=U.DYMANIC_ITEMS[o][e].body):U.CURRENT_ITEM=t[0].object,U.CURRENT_ITEM.body.angularDamping=1,U.CURRENT_ITEM.body.allowSleep=!1,U.CURRENT_ITEM.body.holding=!0,U.CURRENT_ITEM.body.collisionResponse=1,U.CURRENT_ITEM.body.wakeUp(),"none"!=U.PORTAL_GUN_INITIATE&&(L.PICK_SUCESS.pause(),L.PICK_SUCESS.currentTime=0,D(L.PICK_SUCESS),D(L.HOLD)),U.CURRENT_ITEM.body.collisionFilterMask=U.CGROUP_ENVIRONMENT|U.CGROUP_DYNAMIC,U.CURRENT_ITEM.body.impactVelocity=null,U.CURRENT_ITEM.body.customGravity=null,U.CURRENT_ITEM.body.side=null,U.CURRENT_ITEM.body.impactSide=null;o=U.CUSTOM_GRAVITY.indexOf(U.CURRENT_ITEM.body);-1<o&&U.CUSTOM_GRAVITY.splice(o,1)}else L.PICK_FAIL.pause(),L.PICK_FAIL.currentTime=0,D(L.PICK_FAIL)}else L.PICK_FAIL.pause(),L.PICK_FAIL.currentTime=0,D(L.PICK_FAIL);U.LIGHTNIN_STRIKE_1.visible=U.HOLDING_ITEM,U.LIGHTNIN_STRIKE_2.visible=U.HOLDING_ITEM,U.LIGHTNIN_STRIKE_3.visible=U.HOLDING_ITEM}function ct(t){var e=!1;if(t.to.item.userData.buttons==t.to.item.userData.connections&&(e=!0),--t.to.item.userData.buttons,le(t,"no",!1,new b.Q1f(0,2,5)),e)if(t.to.itemName.includes("angled_panel")){S(500,t.to.item.getObjectByName("pivot2").rotation,new b.Pq0(t.to.item.userData.angle*Math.PI/180,t.to.item.getObjectByName("pivot2").rotation.y,t.to.item.getObjectByName("pivot2").rotation.z));let e=t.to.item;0!=e.getObjectByName("panel").hasPortal&&1!=e.getObjectByName("panel").hasPortal||M(e.getObjectByName("panel").hasPortal),e.getObjectByName("panel").hasPortal=100,setTimeout(()=>{Vn(e.getObjectByName("panel").body,e.getObjectByName("Cube"))},500)}else t.to.itemName.includes("faith_plate")?t.to.item.userData.state=!1:t.to.itemName.includes("door")||t.to.itemName.includes("exitDoor")?t.to.item.userData.buttons<t.to.item.userData.connections&&qn(0,!1,!1,t.to.item):t.to.itemName.includes("tractor")?t.to.item.userData.buttons<t.to.item.userData.connections&&ut(t.to):t.to.itemName.includes("light_bridge")?t.to.item.userData.buttons<t.to.item.userData.connections&&dt(t.to):t.to.itemName.includes("laser_field")||t.to.itemName.includes("fizzler")?t.to.item.userData.buttons<t.to.item.userData.connections&&_t(t.to):(t.to.itemName.includes("portal_0")||t.to.itemName.includes("portal_1"))&&(t.to.item.active=!1)}function _t(e){e.item.userData.state=!e.item.userData.state,e.item.continuous.visible=!e.item.continuous.visible,U.CANNON_BODIES.push(e.item.bodyLaserField),e.item.userData.state?U.CANNON_WORLD.addBody(e.item.bodyLaserField):U.CANNON_WORLD.removeBody(e.item.bodyLaserField)}function dt(e){e.item.userData.state=!e.item.userData.state,e.item.continuous.visible=!e.item.continuous.visible,U.CANNON_BODIES.push(e.item.bodyBridge),e.item.userData.state?U.CANNON_WORLD.addBody(e.item.bodyBridge):U.CANNON_WORLD.removeBody(e.item.bodyBridge),e.item.clone&&e.item.clone.bodyBridge&&(e.item.clone.visible=e.item.continuous.visible,U.CANNON_BODIES.push(e.item.clone.bodyBridge),e.item.userData.state?U.CANNON_WORLD.addBody(e.item.clone.bodyBridge):U.CANNON_WORLD.removeBody(e.item.clone.bodyBridge))}function ut(e){"State"!=e.item.userData.triggers&&"Both"!=e.item.userData.triggers||(e.item.userData.state=!e.item.userData.state,e.item.continuous.visible=!e.item.continuous.visible,e.item.clone&&(e.item.clone.visible=e.item.continuous.visible)),"Direction"!=e.item.userData.triggers&&"Both"!=e.item.userData.triggers||(e.item.userData.reversed=!e.item.userData.reversed,e.item.userData.reversed?e.item.continuous.material=U.MATERIAL_TRACTOR_BEAM_REVERSE:e.item.continuous.material=U.MATERIAL_TRACTOR_BEAM,e.item.clone&&(e.item.clone.material=e.item.continuous.material))}function At(e){e.body.position.set(e.dispenserPosition.x,e.dispenserPosition.y-1,e.dispenserPosition.z),e.body.mass=e.body.initialMass,e.body.allowSleep=!0,e.body.velocity.setZero(),e.body.initVelocity.setZero(),e.body.angularVelocity.setZero(),e.body.initAngularVelocity.setZero(),e.body.force.setZero(),e.body.torque.setZero(),e.body.wakeUp()}function pt(e){if(!(e.name.includes("gel")||e.name.includes("camera")||e.name.includes("pellet"))){e.velocity.setZero(),e.initVelocity.setZero(),e.angularVelocity.setZero(),e.initAngularVelocity.setZero(),e.force.setZero(),e.torque.setZero(),e.repawning=!0;var t=500,i=500;if("player"==e.name){U.HOLDING_ITEM&&Et(),document.getElementById("death-screen").style.backgroundColor="rgb(255, 0, 0)",document.getElementById("death-screen").style.opacity=.75,L.DEATH.currentTime=0,D(L.DEATH),i=t=500,M(0),M(1),U.PORTAL_BOX=[];for(var n=0;n<U.CONNECTIONS.length;n++)U.CONNECTIONS[n].from.instancedName&&U.CONNECTIONS[n].to.instancedName&&U.CONNECTIONS[n].from.instancedName.includes("trigger")&&U.CONNECTIONS[n].to.instancedName.includes("portal")&&(U.CONNECTIONS[n].line.active=!1)}setTimeout(()=>{e.repawning=!1,e.velocity.setZero(),e.initVelocity.setZero(),e.angularVelocity.setZero(),e.initAngularVelocity.setZero(),e.force.setZero(),e.torque.setZero(),e.position.copy(e.spawnPosition),"player"!=e.name&&(e.mass=0),setTimeout(()=>{"player"!=e.name?(0==e.item.userData.connections||e.item.userData.connections==e.item.userData.buttons?e.mass=5:e.mass=0,e.wakeUp()):document.getElementById("death-screen").style.opacity=0},t)},i)}}function mt(e){U.LEVEL_ENTERED||(U.ENTER_DOOR.box3.containsPoint(U.PLAYER.position)||e||U.ITEMS_ADDED.getObjectByName("spawn"))&&(U.LEVEL_ENTERED=!0,U.RENDERER.compile(U.SCENE,U.MAIN_CAMERA),setTimeout(()=>{for(var e=0;e<U.BOX_BODY.length;e++)U.BOX_BODY[e].item.userData.opened&&At(U.BOX_BODY[e].item);"none"==U.PORTAL_GUN_INITIATE&&(document.getElementById("warning-game").innerHTML="Press E to interact with objects!",document.getElementById("warning-game").style.opacity="1",setTimeout(()=>{document.getElementById("warning-game").style.opacity="0"},7e3))},1e3),qn(1e3,!1,!0,U.ENTER_DOOR))}function R(e,t,i,n,o,a){var r=new b.B69,s=(r.position.copy(i.position),r.rotation.copy(i.rotation),new b.Pq0),l=new b.tBo,E=(s.copy(r.position),new b.Pq0),c=(E.copy(r.up).applyQuaternion(r.quaternion),l.set(s,E),l.item=i,l.intersectObject(U.PLANE_LEVEL_INSTANCED));if(o){if(t.distance==c[0].distance)return;U.ITEMS_ADDED.remove(i.continuous),i.bodyBridge&&U.CANNON_WORLD.removeBody(i.bodyBridge),i.bodyLaserField&&U.CANNON_WORLD.removeBody(i.bodyLaserField),t.distance=c[0].distance}var s=U.MATERIAL_LIGHT_BRIDGERS,_=(U.SCENE.remove(r),new b.B69);if(_.position.copy(i.position),_.rotation.copy(i.rotation),_.rotateX(Math.PI),_.translateY(-c[0].distance),_.position.copy(_.position.round()),"light_bridge"==e)var d=new b.iNn(.9,c[0].distance,.1);else if("glass"==e)var d=new b.iNn(2,c[0].distance,.1);else if("laser_field"==e||"fizzler"==e)"laser_field"==e?(d=new b.bdM(2,c[0].distance),s=U.MATERIAL_LASER_FIELD,i.cloneLaserID=i.userData.idInstanced+10):"fizzler"==e&&(d=new b.iNn(2,c[0].distance,.025),s=U.MATERIAL_FIZZLER,i.cloneFizzlerID=i.userData.idInstanced+10),_.updateMatrix(),n.setMatrixAt(i.userData.idInstanced+10,_.matrix),n.instanceMatrix.needsUpdate=!0,n.computeBoundingSphere(),i.cloneLaserDistance=c[0].distance,i.cloneLaserField=_;else if("tractor_beam"==e){for(var n=(d=new b.Ho_(.8,.8,c[0].distance+0,32,1,!0)).attributes.position.array,u=new Float32Array(n.length/3),A=0;A<u.length;A++)u[A]=c[0].distance/5;d.setAttribute("height",new b.THS(u,1)),s=i.userData.reversed?U.MATERIAL_TRACTOR_BEAM_REVERSE:U.MATERIAL_TRACTOR_BEAM}l.name=e,l.far=c[0].distance+.1,o?t=l:t.push(l);var n=new b.eaF(d,s),t=(U.ITEMS_ADDED.add(n),window.uuuu=n,"tractor_beam"==e&&(n.updateMatrix(),n.geometry.applyMatrix4(n.matrix)),n.position.copy(r.position),n.rotation.copy(r.rotation),n.translateY(c[0].distance/2),n.distance=c[0].distance/2,n.renderOrder=-1,"laser_field"!=e&&"fizzler"!=e||n.rotateX(Math.PI),(0,N.dZ)(n,{type:N.IO.BOX})),d=new w.Material,s=(d.friction=.4,new w.Body({shape:t.shape,mass:d.restitution=0,material:d})),r=(s.position.copy(n.position),s.quaternion.copy(n.quaternion),i.continuous=n,i.raycaster=l,g(_.position.x+"/"+_.position.y+"/"+_.position.z));l.distance=c[0].distance,"tractor_beam"!=e&&"light_bridge"!=e&&(U.PLANE_USER_DATA[r[0].id_instanced].portal=!1,U.PLANE_USER_DATA[r[0].id_instanced].planeColor=8421504,U.PLANE_LEVEL_INSTANCED.setColorAt(r[0].id_instanced,new b.Q1f(8421504))),0<r.length&&"tractor_beam"!=e&&(r[0].continuousEnding=!0,n.otherSide=r[0]),"glass"==e&&(i.userData.grid?H(n,U.MATERIAL_GRID,c[0].distance/3):n.material=U.MATERIAL_GLASS,window.glass.push(n)),i.userData.state||(n.visible=!1),"light_bridge"==e||"glass"==e?(s.collisionFilterGroup=U.CGROUP_ENVIRONMENT,s.collisionFilterMask=U.CGROUP_DYNAMIC|U.CGROUP_PLAYER,s.name=e,i.bodyBridge=s,U.CANNON_BODIES_CONTINUOUS.push(s),i.userData.state&&U.CANNON_WORLD.addBody(s)):"laser_field"==e||"fizzler"==e?(s.collisionFilterGroup=U.CGROUP_ENVIRONMENT,s.collisionFilterMask=U.CGROUP_DYNAMIC|U.CGROUP_PLAYER,s.collisionResponse=0,(i.bodyLaserField=s).isItem=!0,U.CANNON_BODIES_CONTINUOUS.push(s),i.userData.state&&U.CANNON_WORLD.addBody(s),"laser_field"==e?s.addEventListener("collide",function(e){e.body===U.PLAYER&&(document.getElementById("death-screen").style.backgroundColor="rgb(255 0 0)",document.getElementById("death-screen").style.opacity=1,pt(e.body))}):"fizzler"==e&&(s.name="fizzler",kn(s))):"tractor_beam"==e&&((t=new b.NRn).setFromObject(n),t.side=1,n.inTractor=!1,n.item=i,n.dir=E,o?(U.TRACTOR_BEAM[a]=n,U.TRACTOR_BEAM_BOUNDING_BOX[a]=t):(U.TRACTOR_BEAM.push(n),U.TRACTOR_BEAM_BOUNDING_BOX.push(t)))}function Nt(e,t){if(null!==U.PORTALS[0]&&null!==U.PORTALS[1])for(var i=0;i<t.length;i++){var n=t[i].intersectObjects(U.PORTAL_SHADER);if(0<n.length){e="portal-0"==n[0].object.name?1:0,"light_bridge"==t[i].name?U.LIGHT_BRIDGE_CLONE[i]&&(U.ITEMS_ADDED.remove(U.LIGHT_BRIDGE_CLONE[i]),U.CANNON_WORLD.removeBody(U.LIGHT_BRIDGE_COLLIDER_CLONE[i]),U.LIGHT_BRIDGE_CLONE[i].item.clone=null):"tractor_beam"==t[i].name&&U.TRACTOR_BEAM[U.TRACTOR_BEAM_LENGTH+i]&&(U.ITEMS_ADDED.remove(U.TRACTOR_BEAM[U.TRACTOR_BEAM_LENGTH+i]),U.TRACTOR_BEAM_BOUNDING_BOX[U.TRACTOR_BEAM_LENGTH+i]=null);var o=new b.Pq0,a=(U.PORTAL_SHADER[e].getWorldDirection(o),new b.tBo),r=(a.set(U.PORTAL_SHADER[e].position,o),a.intersectObject(U.PLANE_LEVEL_INSTANCED));if(0<n.length)if("light_bridge"==t[i].name){if(!(.3<n[0].uv.x&&n[0].uv.x<.7))return;U.LIGHT_BRIDGE_CLONE[i]&&(U.ITEMS_ADDED.remove(U.LIGHT_BRIDGE_CLONE[i]),U.CANNON_WORLD.removeBody(U.LIGHT_BRIDGE_COLLIDER_CLONE[i]),U.LIGHT_BRIDGE_CLONE[i].item.clone=null)}else if("tractor_beam"==t[i].name){if(!(.3<n[0].uv.x&&n[0].uv.x<.7&&.3<n[0].uv.y&&n[0].uv.y<.7))return;U.TRACTOR_BEAM[U.TRACTOR_BEAM_LENGTH+i]&&(U.ITEMS_ADDED.remove(U.TRACTOR_BEAM[U.TRACTOR_BEAM_LENGTH+i]),U.TRACTOR_BEAM_BOUNDING_BOX[U.TRACTOR_BEAM_LENGTH+i]=null)}a=U.MATERIAL_LIGHT_BRIDGERS;if("light_bridge"==t[i].name)var s=new b.iNn(.9,.025,r[0].distance);else if("tractor_beam"==t[i].name){for(var l=(s=new b.Ho_(.9,.9,r[0].distance+0,32,1,!0)).attributes.position.array,E=new Float32Array(l.length/3),c=0;c<E.length;c++)E[c]=r[0].distance/5;s.setAttribute("height",new b.THS(E,1)),a=U.MATERIAL_TRACTOR_BEAM}var l=new b.eaF(s,a),a=(U.ITEMS_ADDED.add(l),"tractor_beam"==t[i].name&&(l.rotation.x=Math.PI/2,l.updateMatrix(),l.geometry.applyMatrix4(l.matrix)),l.position.copy(U.PORTAL_SHADER[e].position),l.rotation.copy(U.PORTAL_SHADER[e].rotation),!1),_=("light_bridge"==t[i].name&&((_=new b.B69).rotation.copy(l.rotation),_.position.copy(l.position),"Middle Vertical"!=t[i].item.userData.triggers&&"Left"!=t[i].item.userData.triggers&&"Right"!=t[i].item.userData.triggers||(_.rotateZ(Math.PI/2),a=!0),l.rotation.copy(_.rotation)),l.translateZ(r[0].distance/2),a?(l.translateX(1.8*(n[0].uv.y-.5)),l.translateY(.9*(n[0].uv.x-.5))):(l.translateY(1.8*(n[0].uv.y-.5)),l.translateX(-.9*(n[0].uv.x-.5))),(0,N.dZ)(l,{type:N.IO.BOX})),a=new w.Material,n=(a.friction=.4,new w.Body({shape:_.shape,mass:a.restitution=0,material:a}));n.position.copy(l.position),n.quaternion.copy(l.quaternion),l.visible=t[i].item.continuous.visible,l.material=t[i].item.continuous.material,l.item=t[i].item,t[i].item.clone=l,U.PORTALS[e].field=l,"light_bridge"==t[i].name?(n.collisionFilterGroup=U.CGROUP_ENVIRONMENT,n.collisionFilterMask=U.CGROUP_DYNAMIC|U.CGROUP_PLAYER,U.CANNON_BODIES_CONTINUOUS.push(n),U.CANNON_WORLD.addBody(n),U.LIGHT_BRIDGE_CLONE[i]=l,U.LIGHT_BRIDGE_COLLIDER_CLONE[i]=n,t[i].item.clone.bodyBridge=n,U.PORTALS[e].fieldBody=n,U.PORTALS[e].fieldBodyClone=t[i].item.clone):"tractor_beam"==t[i].name&&((a=new b.NRn).setFromObject(l),a.side=1,l.inTractor=!1,l.dir=o,U.TRACTOR_BEAM[U.TRACTOR_BEAM_LENGTH+i]=l,U.TRACTOR_BEAM_BOUNDING_BOX[U.TRACTOR_BEAM_LENGTH+i]=a,U.PORTALS[e].fieldTrigger=a)}else"light_bridge"==t[i].name?U.LIGHT_BRIDGE_CLONE[i]&&(U.ITEMS_ADDED.remove(U.LIGHT_BRIDGE_CLONE[i]),U.CANNON_WORLD.removeBody(U.LIGHT_BRIDGE_COLLIDER_CLONE[i]),U.LIGHT_BRIDGE_CLONE[i].item.clone=null):"tractor_beam"==t[i].name&&U.TRACTOR_BEAM[U.TRACTOR_BEAM_LENGTH+i]&&(U.ITEMS_ADDED.remove(U.TRACTOR_BEAM[U.TRACTOR_BEAM_LENGTH+i]),U.TRACTOR_BEAM_BOUNDING_BOX[U.TRACTOR_BEAM_LENGTH+i]=null)}}function O(e,t,i,n){e.userData.triggers=t,i.data("trigger",t),i.find(".title").text(t);var i=new b.B69,o=(i.position.copy(new b.Pq0(e.position.x,e.position.y,e.position.z)),i.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),.8);"glass"==n&&(o=.99),"Middle Vertical"==t?i.rotateY(Math.PI/2):"Top"==t?i.translateZ(-o):"Bottom"==t?i.translateZ(o):"Left"==t?(i.rotateY(Math.PI/2),i.translateZ(-o)):"Right"==t&&(i.rotateY(Math.PI/2),i.translateZ(o)),e.raycaster.ray.origin=i.position,e.continuous.position.copy(i.position),e.continuous.rotation.copy(i.rotation),e.continuous.translateY(e.continuous.distance),"light_bridge"!=n&&"glass"!=n||(e.bodyBridge.position.copy(e.continuous.position),e.bodyBridge.quaternion.copy(i.quaternion)),"glass"!=n&&(i.updateMatrix(),(t=U.ITEMS_ADDED.getObjectByName(n)).setMatrixAt(e.userData.idInstanced,i.matrix),"laser_field"!=n&&"fizzler"!=n||(e.bodyLaserField.position.copy(e.continuous.position),e.bodyLaserField.quaternion.copy(i.quaternion),i.rotateX(Math.PI),i.translateY(-e.cloneLaserDistance),i.updateMatrix(),"laser_field"==n?t.setMatrixAt(e.cloneLaserID,i.matrix):"fizzler"==n&&t.setMatrixAt(e.cloneFizzlerID,i.matrix)),t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere())}window.glass=[];class Tt{constructor(e,t,i,n,o){var a=new b.Pq0(e,t,i).multiplyScalar(.5),a=(this.baseBB=new b.NRn(a.clone().negate(),a.clone()),this.t=n.clone(),this.inverse_t=this.t.clone(),this.inverse_t.invert(),new b.iNn(e,t,i)),n=new b.XJ7(a),e=new b.DXC(n,new b.mrM({color:o,opacity:.5,transparent:!1}));e.applyMatrix4(this.t),this.helper=e}containsPoint(e){var e=new b.IUQ(e.x,e.y,e.z,1),e=(e.applyMatrix4(this.inverse_t),e=e,new b.Pq0(e.x,e.y,e.z).multiplyScalar(1/e.w));return this.baseBB.containsPoint(e)}intersectsBox(e){e=new b.NRn(e.min.clone().applyMatrix4(this.inverse_t),e.max.clone().applyMatrix4(this.inverse_t));return this.baseBB.intersectsBox(e)}}var Rt=!(window.tractorClones=[]);function Ot(e,t){var i=(new b.kn4).makeScale(-1,-1,1),i=t.CDBB.inverse_t.clone().premultiply(i).premultiply(t.output.CDBB.t);e.applyMatrix4(i)}function It(e,t){return Math.sqrt(2*t*e)}function Dt(e,t){var i=(new b.kn4).makeScale(-1,-1,1),i=t.CDBB.inverse_t.clone().premultiply(i).premultiply(t.output.CDBB.t);return $(K(e).applyMatrix4(i))}function Lt(e,t){var i=(new b.kn4).makeScale(-1,-1,1),n=new b.kn4,o=(n.extractRotation(t.CDBB.inverse_t),new b.kn4),t=(o.extractRotation(t.output.CDBB.t),n.clone().premultiply(i).premultiply(o));return $(K(e).applyMatrix4(t))}function gt(){var e=C(U.PLAYER.position);if(U.PIVOT.position.copy(e),U.PLAYER.PURPLE_CONTACT?U.PIVOT.translateY(.3):U.PIVOT.position.y+=.3,U.GUN.position.copy(U.PIVOT.position),U.PORTAL_GUN_CAMERA.position.copy(U.PIVOT.position),U.PORTAL_GUN_CAMERA.quaternion.copy(U.PIVOT.quaternion),Rt&&(Rt=!1,U.PLAYER_MODEL.visible=!0),null!==U.PORTALS[0]&&null!==U.PORTALS[1]){for(var t,i,n,o,a=0,r=0;r<U.CAMERAS.length;r++)(U.CAMERAS[r].box3.containsPoint(U.PORTAL_BOX[0].position)||U.CAMERAS[r].box3.containsPoint(U.PORTAL_BOX[1].position))&&U.CAMERAS[r].fixed&&(U.CAMERAS[r].fixed=!1,n=i=t=void 0,t=U.CAMERAS[r],(i=new w.Material).friction=.4,i.restitution=0,n=new w.Box(new w.Vec3(.15,.25,.25)),n=new w.Body({shape:n,mass:5,material:i}),U.CANNON_BODIES.push(n),n.position.copy(t.cube.position),n.quaternion.copy(t.quaternion),n.collisionFilterGroup=U.CGROUP_DYNAMIC,n.collisionFilterMask=U.CGROUP_ALL,n.offset=.2,t.body=n,t.cube.body=n,t.name="camera",n.name="camera",n.item=t,U.DYNAMIC_OBJECTS.push(n),U.CANNON_WORLD.addBody(n),U.INTERACTIVE.push(t.cube),(i=t.clone()).visible=!1,U.SCENE_FPS.add(i),n.clone=i);for(o of U.DYNAMIC_OBJECTS){var s,l=new b.Pq0(o.position.x,o.position.y,o.position.z);if(o.centering&&!o.centered&&((s=C(o.position)).lerp(o.newPosition,.1),s.y=o.position.y,o.position.copy(s),s.x==o.newPosition.x)&&s.z==o.newPosition.z&&(o.centered=!0),o.collisionFilterMask=U.CGROUP_ALL,o.inArea=!1,null!==U.PORTALS[0]&&null!==U.PORTALS[1]){0==a?(U.PLAYER_MODEL_CLONE.visible=!1,U.GUN_CLONE.visible=!1,U.GUN_CLONE2.visible=!1):(o.clone.visible=!1,o.clone.position.copy(o.position),o.clone.quaternion.copy(o.quaternion));let e=!1;for(let i=0;i<U.PORTALS.length;i++)if(U.PORTALS[i].CDBB.containsPoint(l)&&("player"!=o.name&&o.wakeUp(),o.collisionFilterMask&=~U.PORTALS[i].hostObjects.collisionFilterGroup,o.inArea=!0,0==a?(0==i||0<i&&!e)&&(e=!0,Ot(U.PLAYER_MODEL_CLONE,U.PORTALS[i]),U.PLAYER_MODEL_CLONE.visible=!0,U.PLAYER_MODEL_CLONE.traverse(e=>{var t;e.isBone&&"wrist_R"==e.name&&(t=new b.Pq0,e.getWorldPosition(t),window.posW=t)})):(0==i||0<i&&!e)&&(e=!0,Ot(o.clone,U.PORTALS[i]),o.clone.visible=!0)),U.PORTALS[i].STBB.containsPoint(l)){if(!o.holding){{E=void 0;c=void 0;_=void 0;d=void 0;u=void 0;A=void 0;var E=o;var c=U.PORTALS[i];var _=(new b.kn4).makeScale(-1,-1,1),_=c.CDBB.inverse_t.clone().premultiply(_).premultiply(c.output.CDBB.t);let e=C(E.position);var d=C(E.position);let t=C(E.velocity);1==Math.abs(U.PORTALS[0].normal.y)&&1==Math.abs(U.PORTALS[1].normal.y)&&U.PORTALS[0].normal.y!=U.PORTALS[1].normal.y&&(A=c.portalShader.position,u=c.output.portalShader.position,A=A.y-u.y,E.heightDifference&&E.looping2&&E.heightDifference!=A&&(E.looping2=!1,E.looping=!1,E.centered=!1,E.centering=!1),E.looping2?t.y=-It(Math.abs(E.heightDifference),9.8):1==E.looping?(E.looping2=!0,t.y=-It(Math.abs(A),9.8),E.heightDifference=A):E.looping=!0);var u=C(E.force),A=(new b.PTz).copy(E.quaternion),_=(new b.PTz).setFromRotationMatrix(_);A.premultiply(_),d=Dt(d,c),t=Lt(t,c),u=Lt(u,c),1==Math.abs(U.PORTALS[0].normal.y)&&1==Math.abs(U.PORTALS[1].normal.y)&&(t.x<3&&(t.x=0),t.z<3)&&(t.z=0),E.previousPosition.copy(d),E.velocity.copy(t),E.force.copy(u),E.quaternion.copy(A),1==Math.abs(U.PORTALS[0].normal.y)&&1==Math.abs(U.PORTALS[1].normal.y)&&1==E.looping2?E.centering?(e=Dt(c.portalShader.position,c),E.position.copy(e)):(E.centering=!0,e=Dt(e,c),E.position.copy(e),_=Dt(c.portalShader.position,c),E.newPosition=_):(e=Dt(e,c),E.position.copy(e))}"pellet"==o.name&&(d=new b.Pq0(0,1,0).applyQuaternion(U.PORTALS[i].output.mesh.quaternion),o.direction=d,o.previousDirection=d,o.pellet.position.copy(o.position),o.pellet.quaternion.copy(o.quaternion),o.pellet.infinity||(clearTimeout(o.pellet.timeout),ae(o.pellet,!1))),0==a&&(U.CURRENT_ITEM&&(U.CURRENT_ITEM.body.collisionResponse=0,setTimeout(()=>{U.CURRENT_ITEM.body.collisionResponse=1},100)),L.PORTAL_ENTER.currentTime=0,D(L.PORTAL_ENTER),at(),Ot(U.PIVOT,U.PORTALS[i]),U.PLAYER_MODEL_CLONE.visible=!1,U.PLAYER_MODEL.visible=!1,Rt=!0,u=new b.Pq0(0,1,0),A=new b.Pq0,U.MAIN_CAMERA.getWorldDirection(A),A.normalize(),c=(_=A.clone().cross(u).normalize()).clone().cross(A).normalize(),E=(new b.kn4).makeBasis(_,c,A.negate()),(d=new b.PTz).setFromRotationMatrix(E),U.TELEPORTING_TARGET_QUATERNION=d),o.collisionFilterMask|=U.PORTALS[i].hostObjects.collisionFilterGroup,o.collisionFilterMask&=~U.PORTALS[1-i].hostObjects.collisionFilterGroup;break}o.teleportingHolding=!0}else o.portal==i&&o.teleportingHolding&&(o.teleportingHolding=!1);a++}}}}class St extends b.YJl{constructor(e,t,i,n,o,a,r){var s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[],n=(super(),this.pos=e.clone(),this.output=n,this.hostObjects=o,this.plane=new b.Zcv(new b.Pq0(0,1,0),0),this.debugMeshes=new b.YJl,this.ty=t.clone().normalize(),this.tz=i.clone().projectOnPlane(this.ty).normalize(),this.tz.length()<.1&&(this.tz=new b.Pq0(0,1,0)),this.tx=this.tz.clone().cross(this.ty),void 0!==(this.portalPoints=s)&&0!=s.length||(this.portalPoints=[this.pos.clone().add(this.tz.clone().multiplyScalar(U.PORTAL_DEPTH/2+2*U.PORTAL_EPS).add(this.tx.clone().multiplyScalar(U.PORTAL_WIDTH/2+2*U.PORTAL_EPS))),this.pos.clone().add(this.tz.clone().multiplyScalar(-U.PORTAL_DEPTH/2-2*U.PORTAL_EPS).add(this.tx.clone().multiplyScalar(U.PORTAL_WIDTH/2+2*U.PORTAL_EPS))),this.pos.clone().add(this.tz.clone().multiplyScalar(-U.PORTAL_DEPTH/2-2*U.PORTAL_EPS).add(this.tx.clone().multiplyScalar(-U.PORTAL_WIDTH/2-2*U.PORTAL_EPS))),this.pos.clone().add(this.tz.clone().multiplyScalar(U.PORTAL_DEPTH/2+2*U.PORTAL_EPS).add(this.tx.clone().multiplyScalar(-U.PORTAL_WIDTH/2-2*U.PORTAL_EPS)))]),(new b.kn4).makeBasis(this.tx,this.ty,this.tz)),o=new b.E0M(this.tx,e,1,16711680),i=new b.E0M(this.ty,e,1,65280),s=new b.E0M(this.tz,e,1,255),{width:o,height:i}=(this.debugMeshes.add(o,i,s),this.transform=n.clone().setPosition(e),this.plane.applyMatrix4(this.transform),this.plane.translate(t.clone().multiplyScalar(1e-4)),U.RENDERER.domElement),s=new b.Ho_(U.PORTAL_WIDTH,U.PORTAL_WIDTH,U.PORTAL_HEIGHT),o={texture1:{type:"t",value:new b.gPd},ww:{type:"f",value:o},wh:{type:"f",value:i}},i=new b.BKk({vertexShader:`
        void main() 
        {
            vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
            gl_Position = projectionMatrix * modelViewPosition;
        }
        `,fragmentShader:`
        uniform sampler2D texture1;
        uniform float ww;
        uniform float wh;
        
        void main() {
            gl_FragColor = texture2D(texture1, gl_FragCoord.xy / vec2(ww, wh));


            #include <tonemapping_fragment>
            #include <colorspace_fragment>
        }
        `,uniforms:o,stencilWrite:!0,stencilFunc:b.jsO,stencilRef:1,stencilFail:b.kG0,depthTest:!0,depthWrite:!0,polygonOffset:!1,polygonOffsetFactor:-2,side:b.$EB}),o=(this.mesh=new b.eaF(s,i),this.mesh.applyMatrix4(this.transform),this.mesh.updateMatrix(),this.mesh.matrixAutoUpdate=!0,this.matrixAutoUpdate=!0,this.mesh.frustumCulled=!0,this.add(this.mesh),this.mesh.renderOrder=100,this.mesh.translateY(-.1),0==r?(this.mesh.userData.this=0,this.mesh.userData.other=1,(l=U.LIGHT_PORTAL_0).intensity=3):(this.mesh.userData.this=1,this.mesh.userData.other=0,(l=U.LIGHT_PORTAL_1).intensity=3),l.position.copy(this.mesh.position),l.visible=!0,this.light=l,U.PORTAL_SHADER[r].parent),s=(o&&(o.remove(U.PORTAL_SHADER[r]),U.PORTAL_SHADER[r].matrix.identity().decompose(U.PORTAL_SHADER[r].position,U.PORTAL_SHADER[r].quaternion,U.PORTAL_SHADER[r].scale)),U.PORTAL_SHADER[r].applyMatrix4((new b.kn4).makeRotationX(-Math.PI/2)),U.PORTAL_SHADER[r].applyMatrix4(this.transform),U.PORTAL_SHADER[r].updateMatrix(),U.PORTAL_SHADER[r].matrixAutoUpdate=!0,this.portalShader=U.PORTAL_SHADER[r],this.portalShader.frustumCulled=!0,this.add(U.PORTAL_SHADER[r]),new b.iNn(1.4,2,.1)),i=new b.V9B({color:65280}),l=(U.PORTAL_BOX[r]=new b.eaF(s,i),U.PORTAL_BOX[r].applyMatrix4((new b.kn4).makeRotationX(-Math.PI/2)),U.PORTAL_BOX[r].applyMatrix4(this.transform),U.PORTAL_BOX[r].updateMatrix(),U.PORTAL_BOX[r].matrixAutoUpdate=!0,U.PORTAL_BOX[r].visible=!1,this.add(U.PORTAL_BOX[r]),new b.iNn(.75,1.2,.1)),o=(U.PORTAL_INNER_BOX[r]=new b.eaF(l,i),U.PORTAL_INNER_BOX[r].applyMatrix4((new b.kn4).makeRotationX(-Math.PI/2)),U.PORTAL_INNER_BOX[r].applyMatrix4(this.transform),U.PORTAL_INNER_BOX[r].updateMatrix(),U.PORTAL_INNER_BOX[r].matrixAutoUpdate=!0,U.PORTAL_INNER_BOX[r].visible=!1,this.add(U.PORTAL_INNER_BOX[r]),this.transform.clone()),s=e.clone().add(t.clone().multiplyScalar(-U.PORTAL_CDBB_HEIGHT/4)),l=n.clone().setPosition(s);this.CDBB=new Tt(U.PORTAL_WIDTH,U.PORTAL_CDBB_HEIGHT,U.PORTAL_DEPTH,o,16711680),this.STBB=new Tt(U.PORTAL_WIDTH,U.PORTAL_CDBB_HEIGHT/2,U.PORTAL_DEPTH,l,65280),this.debugMeshes.add(this.CDBB.helper),this.debugMeshes.add(this.STBB.helper),this.debugMeshes.visible=!1,this.add(this.debugMeshes)}}function ht(e,t,i,n,o,a){var r=Ct(U.PAINTING_GUN_MODE[e]),s=new b.B69;s.position.copy(t),s.rotation.copy("down"==(t=n.side)?new b.O9p(-Math.PI/2,0,0):"up"==t?new b.O9p(Math.PI/2,0,0):"front"==t?new b.O9p(0,0,0):"back"==t?new b.O9p(Math.PI,0,0):"left"==t?new b.O9p(0,Math.PI/2,0):"right"==t?new b.O9p(0,-Math.PI/2,0):void 0),fe(s,r,U.PAINTING_GUN_MODE[e],a.side,!0,1)}function Ct(e){return"blue"==e?new b.Q1f("rgb(30,144,255)"):"orange"==e?new b.Q1f("rgb(255,140,0)"):"purple"==e?new b.Q1f("rgb(75,0,130)"):"white"==e?new b.Q1f(.8,.8,.8):"clear"==e?new b.Q1f(11001053):"reflection"==e?new b.Q1f("rgb(128,128,128)"):void 0}function yt(e,t){B()("#gel_recharger-type").find(".title").text("Gel type: "+e),B()("#gel-type").data("gel",e),t.userData.gel=e,U.ITEMS_ADDED.getObjectByName("gel_recharger").setColorAt(t.userData.idInstanced,Ct(e))}B()("body").on("click",".gel_recharger-type",function(){yt(B()(this).data("gel"),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item)});var Mt=new b.Pq0,Pt=new b.tBo,ft=!0;function vt(i,n,o,a){var r,s;if((U.LEVEL_ENTERED||n)&&((n||!("none"==U.PORTAL_GUN_INITIATE||"left"==U.PORTAL_GUN_INITIATE&&2==i||"right"==U.PORTAL_GUN_INITIATE&&0==i)||"portal"!=U.GUN_MODE)&&ft&&(!U.HOLDING_ITEM||n)&&U.FPS_MODE&&(2==i||0==i||1==i)&&U.ALLOW_PLACE_PORTALS)){Pt.setFromCamera(Mt,o),a||(e=Pt.intersectObjects(U.BLOCK_PORTAL));var e,t=null;if(!n&&!a)for(var l=0;l<e.length;l++)if(e[l].object.visible){t=e[l];break}var o=Pt.intersectObjects(U.ANGLED_PANELS),a=Pt.intersectObject(U.INSTANCED_WHITE_GEL),E=Pt.intersectObject(U.PLANE_LEVEL_INSTANCED);if(n&&(n.point=n.position,n.instanceId=n.userData.planeInstancedId,E=[n.object=n]),0<E.length){var c=U.PLANE_USER_DATA[E[0].instanceId],_=E[0].object,d=new b.Pq0,d=(E[0].object.getWorldPosition(d),new b.Pq0(0,1,0).applyQuaternion(_.quaternion)),_=new b.Pq0(0*d.x,0*d.y,0*d.z),d=E[0].point.x+_.x,u=E[0].point.y+_.y,_=E[0].point.z+_.z;if(n||(2==i?U.FLASH.color=new b.Q1f(1,.25,0):0==i&&(U.FLASH.color=new b.Q1f(0,.3,1)),A=new b.Pq0,U.PORTAL_GUN_FLASH.getWorldPosition(A),0!=i&&2!=i||(U.FLASH.position.copy(A),2<U.PLAYER.position.distanceTo(E[0].point)&&(U.FLASH.visible=!0),S(300,U.FLASH.position,t?t.point:new b.Pq0(d,u,_)),S(150,U.GUN.children[0].position,new b.Pq0(U.GUN.children[0].position.x,U.GUN.children[0].position.y,.003)),setTimeout(()=>{S(150,U.GUN.children[0].position,new b.Pq0(U.GUN.children[0].position.x,U.GUN.children[0].position.y,0))},150)),setTimeout(()=>{U.FLASH.scale.set(.02,.02,.02),U.FLASH.visible=!1,ft=!0},300)),!(0<o.length&&0<o[0].normal.y))if(t)L.PORTAL_INVALID.currentTime=0,D(L.PORTAL_INVALID);else{var A=!1;if((0==i&&U.PAINTING_GUN_MODE[0]||2==i&&U.PAINTING_GUN_MODE[1])&&(A=!0),c.itemName||(c.itemName=""),0<o.length||(c.portal||0<a.length||A)&&(!c.hasItem||n||c.itemName.includes("camera")||c.itemName.includes("radio")||c.itemName.includes("trigger")))if(0<o.length&&(console.log(o[0].object.hasPortal),0==o[0].object.hasPortal||1==o[0].object.hasPortal))console.log("returned");else{d=new b.Pq0(d,u,_);let e=new b.Pq0(0,1,0),t=new b.Pq0;n&&c.item.getWorldDirection(t),"front"==c.side?m=new b.Pq0(0,0,1):"back"==c.side?m=new b.Pq0(0,0,-1):"right"==c.side?m=new b.Pq0(-1,0,0):"left"==c.side?m=new b.Pq0(1,0,0):"up"==c.side?(e.applyQuaternion(U.MAIN_CAMERA.quaternion),m=new b.Pq0(0,-1,0),n&&(e=t)):"down"==c.side&&(e.applyQuaternion(U.MAIN_CAMERA.quaternion),m=new b.Pq0(0,1,0),n)&&(e=t);var p,m,u=e.clone().projectOnPlane(m).normalize(),_=u.clone().cross(m),N=U.PORTAL_WIDTH,T=U.PORTAL_DEPTH,R=3*-U.PORTAL_EPS,u=[d.clone().add(u.clone().multiplyScalar(T/2+R).add(_.clone().multiplyScalar(N/2+R))),d.clone().add(u.clone().multiplyScalar(-T/2-R).add(_.clone().multiplyScalar(N/2+R))),d.clone().add(u.clone().multiplyScalar(-T/2-R).add(_.clone().multiplyScalar(-N/2-R))),d.clone().add(u.clone().multiplyScalar(T/2+R).add(_.clone().multiplyScalar(-N/2-R)))];if(0==i?p=1:2==i&&(p=0),!A&&!n&&0==o.length){if(U.PORTAL_BOX[p])for(var O of u)if(O=O,E[0].object,r=p,s=void 0,(s=new b.NRn).setFromObject(U.PORTAL_BOX[r]),s.containsPoint(O))return L.PORTAL_INVALID.pause(),L.PORTAL_INVALID.currentTime=0,void D(L.PORTAL_INVALID);y=[];for(var I of u)((e,t)=>{let i=e.clone().add(t.clone().multiplyScalar(1)),n=new b.tBo(i,t.clone().multiplyScalar(-1),0,1e3),o=n.intersectObject(U.PLANE_LEVEL_INSTANCED);if(0==o.length)return y.push([]);if(0<o.length){e=U.PLANE_USER_DATA[o[0].instanceId];if(!e.portal||1.1<o[0].distance||e.hasItem)return y.push([])}y.push(o)})(I,m,E[0].object);"up"==c.side||"down"==c.side?0!=y[1].length&&0!=y[1].length&&0!=y[2].length&&0!=y[3].length||(d.z=c.position.z,d.x=c.position.x):(0!=y[1].length&&0!=y[1].length&&0!=y[2].length&&0!=y[3].length||(d.y=c.position.y-.1),0!=y[0].length&&0!=y[3].length||(d.x=c.position.x,d.z=c.position.z))}if(N=(0<o.length?(T=(new b.dwI).getNormalMatrix(o[0].object.matrixWorld),(m=o[0].face.normal.clone().applyMatrix3(T).normalize()).negate(),e.applyQuaternion(U.MAIN_CAMERA.quaternion),_=new b.Pq0,o[0].object.getWorldPosition(_),d=_,o[0].object):(0<a.length&&(d=C(U.INSTANCED_WHITE_GEL.array[a[0].instanceId].position)),c)).body,0==i){if("paint"==U.GUN_MODE)return void(U.PAINTING_GUN_MODE[0]&&ht(0,d,0,N,e,c));n||(document.getElementById("reticle-img").style.filter="none","left"==U.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalBlue.png":"right"==U.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalOrange.png":document.getElementById("reticle-img").src="./assets/textures/crosshairBlue.png"),null!==U.PORTALS[0]&&M(0),wt(0,1,d,m,N,e,u,c.side),U.UNIFORMS_PORTAL_GUN_ENERGY.iColor.value=new b.Pq0(0,1.25,2.5),n||0==U.UNIFORMS_PORTAL_GUN_ENERGY.iAlpha.value&&new h.Tween(U.UNIFORMS_PORTAL_GUN_ENERGY.iAlpha).to({value:.5},300).start(),U.PORTALS[0].normal=m,L.PORTAL_GUN_ORANGE.pause(),L.PORTAL_GUN_ORANGE.currentTime=0,D(L.PORTAL_GUN_ORANGE)}else if(2==i){if("paint"==U.GUN_MODE)return void(U.PAINTING_GUN_MODE[1]&&ht(1,d,0,N,e,c));n||(document.getElementById("reticle-img").style.filter="none","left"==U.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalBlue.png":"right"==U.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalOrange.png":document.getElementById("reticle-img").src="./assets/textures/crosshairOrange.png"),null!==U.PORTALS[1]&&M(1),wt(1,0,d,m,N,e,c.rotation,c.side),U.UNIFORMS_PORTAL_GUN_ENERGY.iColor.value=new b.Pq0(2.5,.7,0),n||0==U.UNIFORMS_PORTAL_GUN_ENERGY.iAlpha.value&&new h.Tween(U.UNIFORMS_PORTAL_GUN_ENERGY.iAlpha).to({value:.5},300).start(),U.PORTALS[1].normal=m,L.PORTAL_GUN_BLUE.pause(),L.PORTAL_GUN_BLUE.currentTime=0,D(L.PORTAL_GUN_BLUE)}0<o.length&&(o[0].object.hasPortal=0==i?0:1),setTimeout(()=>{0==i?(Nt(1,U.LIGHT_BRIDGE_RAYCASTER),Nt(1,U.TRACTOR_BEAM_RAYCASTER)):2==i&&(Nt(0,U.LIGHT_BRIDGE_RAYCASTER),Nt(0,U.TRACTOR_BEAM_RAYCASTER))},300)}else L.PORTAL_INVALID.pause(),L.PORTAL_INVALID.currentTime=0,D(L.PORTAL_INVALID)}}}}var y=[];function M(e){for(var t=0;t<U.ANGLED_PANELS.length;t++)if(U.ANGLED_PANELS[t].hasPortal==e){U.ANGLED_PANELS[t].hasPortal=100;break}if(null===U.PORTALS[0]&&null===U.PORTALS[1]&&L.PORTAL_GUN_LOOP.pause(),null!==U.PORTALS[e]){for(var i,t=0;t<U.PORTALS[e].gels.length;t++)U.PORTALS[e].gels[t].collisionResponse=1;if(U.PORTALS[e].field&&(U.SCENE_CHILDREN.remove(U.PORTALS[e].field),U.PORTALS[e].field=null),U.PORTALS[e].fieldBody&&(i=U.PORTALS[e].fieldBody,setTimeout(()=>{U.CANNON_WORLD.removeBody(i)},10),U.PORTALS[e].fieldBodyClone=null,U.PORTALS[e].fieldBody=null),U.PORTALS[e].fieldTrigger){var n=U.TRACTOR_BEAM_BOUNDING_BOX.indexOf(U.PORTALS[e].fieldTrigger);if(-1<n){for(var o of U.DYNAMIC_OBJECTS)o.inTractor&&o.tractor==n&&te(o,n);U.ITEMS_ADDED.remove(U.TRACTOR_BEAM[n]),U.TRACTOR_BEAM_BOUNDING_BOX[n]=null,U.TRACTOR_BEAM.splice(n,1),U.TRACTOR_BEAM_BOUNDING_BOX.splice(n,1)}U.PORTALS[e].fieldTrigger=null}if(U.PORTALS[e].light.visible=!1,U.PORTAL_AUDIO[e].sound.audio.pause(),null!==U.PORTALS[e].hostObjects){U.PORTALS[e].hostObjects.portal=!1;for(t=0;t<U.WALL_BODIES.length;t++)U.WALL_BODIES[t].collisionFilterGroup&=~U.CGROUP_PORTAL_HOST_CDISABLE[e],U.WALL_BODIES[t].collisionFilterGroup&U.CGROUP_PORTAL_HOST_CDISABLE[0]||U.WALL_BODIES[t].collisionFilterGroup&U.CGROUP_PORTAL_HOST_CDISABLE[1]||(U.WALL_BODIES[t].collisionFilterGroup|=U.CGROUP_ENVIRONMENT)}U.SCENE.remove(U.PORTALS[e]),U.PORTALS[e].portalShader.material.uniforms.iOpened.value=0,U.PORTALS[e]=null}}function wt(e,t,i,n,o,a,r,s){U.STATS_UI.portals+=1;for(var l of U.DYNAMIC_OBJECTS)l.looping=!1,l.looping2=!1,l.centered=!1,l.centering=!1;var E=U.PORTAL_COLORS[e];U.PORTALS[e]=new St(i,n,a,U.PORTALS[t],o,E,e,r),U.PORTALS[e].mesh.scale.set(0,0,0),U.PORTALS[e].portalShader.scale.set(0,0,0),U.PORTALS[e].side=s,U.PORTALS[e].normal=n,U.PORTALS[e].hostObjects.portal=!0;for(var c=0;c<U.WALL_BODIES.length;c++)U.WALL_BODIES[c].side==s&&(U.WALL_BODIES[c].collisionFilterGroup|=U.CGROUP_PORTAL_HOST_CDISABLE[e],U.WALL_BODIES[c].collisionFilterGroup&=~U.CGROUP_ENVIRONMENT);null!==U.PORTALS[t]&&(U.PORTALS[t].output=U.PORTALS[e]),U.SCENE.add(U.PORTALS[e]),S(300,U.PORTALS[e].mesh.scale,new b.Pq0(.6,1,1)),S(300,U.PORTALS[e].portalShader.scale,new b.Pq0(.6,1,1)),null!==U.PORTALS[t]&&(U.PORTALS[t].output=U.PORTALS[e]),null!==U.PORTALS[0]&&null!==U.PORTALS[1]&&(U.PORTALS[0].portalShader.material.uniforms.iOpened.value=1,U.PORTALS[1].portalShader.material.uniforms.iOpened.value=1),U.PORTAL_AUDIO[e].sound.position.copy(U.PORTALS[e].mesh.position),U.PORTAL_AUDIO[e].sound.quaternion.copy(U.PORTALS[e].mesh.quaternion),D(U.PORTAL_AUDIO[e].sound.audio),U.PORTALS[e].gels=[];for(c=0;c<U.GEL_TRIGGER.length;c++)for(var _=0;_<9;_++){var d=U.GEL_TRIGGER[c].clone();U.SCENE.add(d),1==_?d.translateX(1):2==_?d.translateX(-1):3==_?d.translateY(1):4==_?d.translateY(-1):5==_?(d.translateX(1),d.translateY(1)):6==_?(d.translateX(1),d.translateY(-1)):7==_?(d.translateX(-1),d.translateY(1)):8==_&&(d.translateX(-1),d.translateY(-1)),U.SCENE.remove(d),U.PORTALS[e].CDBB.containsPoint(d.position)&&(U.GEL_TRIGGER[c].gelBody.collisionResponse=0,U.PORTALS[e].gels.push(U.GEL_TRIGGER[c].gelBody),_=10)}}s=(new b.Tap).load("./assets/textures/target.png"),l=new b.bdM(2,2),n=new b.V9B({map:s,transparent:!0,polygonOffset:!0,polygonOffsetUnits:-10});let bt=new b.eaF(l,n);function Bt(e,t){var i,n;t.holding||e.launch||(e.sound.audio.currentTime=0,e.sound.audio.play(),e.launch=!0,setTimeout(()=>{e.launch=!1},150),S(200,i=e.item.ToRotate.rotation,new b.Pq0(.7*Math.PI,0,0)),setTimeout(()=>{S(200,i,new b.Pq0(Math.PI/2,0,0))},200),t.velocity.setZero(),t.initVelocity.setZero(),t.angularVelocity.setZero(),t.initAngularVelocity.setZero(),t.force.setZero(),t.torque.setZero(),n=e.item.target.position.clone(),n=((e,t,i,n,o)=>{(r=new w.Vec3(t.x-e.x,0,t.z-e.z)).normalize();var a=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.z-e.z,2)),t=t.y-e.y,e=(e=Math.sqrt(2*i/9.81))+Math.sqrt(2*(i-t)/9.81),t=a/e*r.x,a=a/e*r.z,r=Math.sqrt(19.62*i),i=new w.Vec3(n*t,n*r,n*a);return"player"==o&&(L.AERIAL.timeout=setTimeout(()=>{U.BLOCK_PLAYER_MOVE=!1,j(L.AERIAL)},1e3*e)),i})(new w.Vec3(t.position.x,t.position.y,t.position.z),new w.Vec3(n.x,n.y,n.z),e.item.userData.height,t.mass,t.name),t.applyImpulse(n,t.position))}function Ut(e){U.FAITH_PLATE_TARGET=e,U.CONNECTING=!0,U.MATERIAL_PORTAL_EDITOR.opacity=.25,U.MATERIAL_NON_PORTAL_EDITOR.opacity=.25,U.MATERIAL_PORTAL_EDITOR.transparent=!0,U.MATERIAL_NON_PORTAL_EDITOR.transparent=!0}function Gt(e){e=new b.Pq0(e.position.x,U.FAITH_PLATE_TARGET.position.y,e.position.z);U.FAITH_PLATE_TARGET.lookAt(e)}function xt(e,t){var i=bt.clone(),e=(i.position.copy(e.position),i.rotation.copy(e.rotation),U.SCENE.add(i),U.FAITH_PLATE_TARGET.target=i,2);t&&(e=t),U.FAITH_PLATE_TARGET.userData.targetPos=i.position,U.FAITH_PLATE_TARGET.userData.targetRot=i.rotation,U.FAITH_PLATE_TARGET.userData.target=i,Yt(U.FAITH_PLATE_TARGET.position,i.position,e,i,U.FAITH_PLATE_TARGET),U.FAITH_PLATE_TARGET=null}function Yt(e,t,i,n,o){var a=(new b.Pq0).addVectors(e,t).multiplyScalar(.5);e.y>t.y?a.y=i+e.y:a.y=i+t.y,o.userData.height=Math.abs(e.y-a.y),o.userData.heightLine=i;o=new b.B6O([e,a,t]).getPoints(50),i=(new b.LoY).setFromPoints(o),e=new b.mrM({color:16711680}),a=new b.N1A(i,e);n.line=a,U.GROUP_LINE_TRAGECTORY.add(a)}U.SCENE.add(U.GROUP_LINE_TRAGECTORY),B()("#plate-max-height-value").on("change",function(){U.GROUP_LINE_TRAGECTORY.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.target.line),Yt(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.position,U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.target.position,parseInt(this.value),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.target,U.PLANE_USER_DATA[U.SELECTED_ID[0]].item)}),B()("#faith-plate-line").on("change",function(){U.GROUP_LINE_TRAGECTORY.visible=this.checked}),B()("#plate-change-target").on("click",function(){U.SCENE.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.target),U.GROUP_LINE_TRAGECTORY.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.target.line),Ut(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item)});var Vt,o=new w.Material,a=(o.friction=0,new w.Box(new w.Vec3(.25,.625,.25)));a.height=1.25,a.width=.5,U.PLAYER=new w.Body({mass:50,material:o}),U.PLAYER.allowSleep=!1,U.PLAYER.addShape(a),U.PLAYER.position.set(5,5,5),U.PLAYER.linearDamping=.999,U.PLAYER.name="player",U.PLAYER.angularDamping=1,U.PLAYER.inJump=!0,U.PLAYER.DIR=1,U.PLAYER.updateMassProperties(),U.CANNON_WORLD.addBody(U.PLAYER),U.PLAYER.upVector=new w.Vec3(0,1,0),U.PLAYER.upVectorThree=new b.Pq0(0,1,0);let Ht=new w.Vec3(0,0,0);U.PLAYER.addEventListener("collide",function(e){"gel"==e.body.name&&ve(e),U.PLAYER.ROTATING||("orange"==e.body.type?(U.SPEED=3,U.HEAD_BOB_SPEED=10):e.target.OrangeContact&&(e.target.OrangeContact=!1,U.SPEED=1,U.HEAD_BOB_SPEED=6,L.WALK.volume=.25,j(L.PROPULSION)),"purple"!=e.body.type&&U.PLAYER.customGravity&&(clearTimeout(e.target.timeout),e.target.timeout=setTimeout(()=>{kt()},10)),"blue"!=e.body.type&&e.target.impactVelocity&&(clearTimeout(e.target.timeout),e.target.timeout=setTimeout(()=>{e.target.impactVelocity=null,e.target.jumpVelocity=null,e.target.impactSide=null},10)),U.PLAYER.looping=!1,"faith_plate"==e.body.name&&!U.PLAYER.block&&e.body.item.userData.state&&(U.PLAYER.block=!0,setTimeout(()=>{U.PLAYER.block=!1},10),clearTimeout(L.AERIAL.timeout),L.AERIAL.volume=1,0<L.AERIAL.duration&&!L.AERIAL.paused||(L.AERIAL.currentTime=0,L.AERIAL.play()),U.BLOCK_PLAYER_MOVE=!0,U.PLAYER.inJump=!0,U.PLAYER_MOVING=!0,U.PLAYER.linearDamping=.01,Bt(e.body,e.target)),"light_bridge"==e.contact.bj.name?U.PLAYER.lightBridge=!0:U.PLAYER.lightBridge=!1,U.PLAYER.inJump&&D(L.JUMP))}),U.CANNON_WORLD.addEventListener("postStep",e=>{if(We(),U.PLAYER.inJump=!0,!U.BLOCK_PLAYER_MOVE){if(0<U.CANNON_WORLD.contacts.length)for(var t of U.CANNON_WORLD.contacts)if(0!=t.bi.collisionResponse&&0!=t.bj.collisionResponse&&(t.bi.id==U.PLAYER.id||t.bj.id==U.PLAYER.id)){Ht=t.bi.id==U.PLAYER.id?new b.Pq0(-1*t.ni.x,-1*t.ni.y,-1*t.ni.z):t.ni,U.PLAYER.inJump=Ht.dot(U.PLAYER.upVector)<=.5;break}U.PLAYER_MOVING=U.PLAYER.inJump;for(var i of U.DYNAMIC_OBJECTS)i.firstCollisionHandled=!1}}),U.DYNAMIC_OBJECTS.push(U.PLAYER);for(Vt of U.DYNAMIC_OBJECTS)Vt.collisionFilterGroup=U.CGROUP_DYNAMIC,Vt.collisionFilterMask=U.CGROUP_ALL;function kt(){U.HEAD_BOB_SPEED=6,U.PLAYER.PURPLE_CONTACT=!1,U.PLAYER.customGravity=null,U.PLAYER.side=null,U.PLAYER.EULER=null,U.PLAYER.DIR=1;var e=U.CUSTOM_GRAVITY.indexOf(U.PLAYER);-(U.SPEED=1)<e&&(L.WALK_PAINT.pause(),L.WALK=L.WALK_NORMAL,U.PLAYER.EULER=null,U.CUSTOM_GRAVITY.splice(e,1),U.PLAYER.upVector=new w.Vec3(0,1,0),U.PLAYER.upVectorThree=new b.Pq0(0,1,0),window.nnn=!1,U.POINTER_CONTROLS.maxPolarAngle=Math.PI,U.POINTER_CONTROLS._euler=new b.O9p(0,0,0,"YXZ"),U.PLAYER.velocity.setZero(),U.PLAYER.initVelocity.setZero(),U.PLAYER.angularVelocity.setZero(),U.PLAYER.initAngularVelocity.setZero(),U.PLAYER.force.setZero(),U.PLAYER.torque.setZero(),S(400,U.MAIN_CAMERA_GROUP.rotation,new b.Pq0(0,0,0)),setTimeout(()=>{U.MAIN_CAMERA.position.copy(U.MAIN_CAMERA_GROUP.position),U.MAIN_CAMERA_GROUP.position.set(0,0,0),U.PIVOT=U.MAIN_CAMERA},500))}function Ft(){U.PLAYER.position.set(0,0,0),U.PLAYER.previousPosition.set(0,0,0),U.PLAYER.interpolatedPosition.set(0,0,0),U.PLAYER.initPosition.set(0,0,0),U.PLAYER.quaternion.set(0,0,0,1),U.PLAYER.initQuaternion.set(0,0,0,1),U.PLAYER.interpolatedQuaternion.set(0,0,0,1),U.PLAYER.velocity.set(0,0,0),U.PLAYER.initVelocity.set(0,0,0),U.PLAYER.angularVelocity.set(0,0,0),U.PLAYER.initAngularVelocity.set(0,0,0),U.PLAYER.force.set(0,0,0),U.PLAYER.torque.set(0,0,0),U.PLAYER.inJump=!1}function zt(){U.STATS.dom.style.display="none",U.EXIT_DOOR.finished=!1,U.STATS_UI.time=0,U.STATS_UI.steps=0,window.curentTimeOffset=0,window.pellets=[],Ft(),U.MAIN_CAMERA.remove(U.MAIN_CAMERA.getObjectByName("listener")),window.listernAdded=!1;for(var e=0;e<U.SOUNDS_FPS.length;e++)U.SCENE_FPS.remove(U.SOUNDS_FPS[e]),U.SOUNDS_FPS[e].audio.currentTime=0,U.SOUNDS_FPS[e].audio.pause();U.SCENE_FPS.remove(_);for(var t=_.current=0;t<_.instances.length;t++)_.instances[t].position.x=1e5,_.instances[t].position.y=1e5,_.instances[t].position.z=1e5,_.instances[t].scale.x=0,_.instances[t].scale.y=0,_.instances[t].scale.z=0,_.instances[t].visible=!1,_.instances[t].updateMatrix();_.instanceMatrix.needsUpdate=!0,_.computeBoundingSphere(),U.HOLDING_ITEM&&Et();for(var i=0;i<U.BOUNDING_BOX.length;i++)U.BOUNDING_BOX[i].platform.material.color=new b.Q1f(65280),U.BOUNDING_BOX[i].platform.material.emissive=null,U.BOUNDING_BOX[i].platform.material.transparent=!0,U.BOUNDING_BOX[i].platform.scale.x=1,U.BOUNDING_BOX[i].platform.scale.z=1;for(e=0;e<U.DYMANIC_ITEMS.piston_platforms.length;e++)0!=U.DYMANIC_ITEMS.piston_platforms[e].length&&je(U.DYMANIC_ITEMS.piston_platforms[e],e,"piston_platforms");for(e=0;e<U.DYMANIC_ITEMS.track_platforms.length;e++)0!=U.DYMANIC_ITEMS.track_platforms[e].length&&je(U.DYMANIC_ITEMS.track_platforms[e],e,"track_platforms");for(e=0;e<U.GOO_PLANES.length;e++)U.GOO_PLANES[e].item.visible=!0;for(var n=0;n<U.TRIGGER_BOXES.length;n++)U.TRIGGER_BOXES[e]&&(U.TRIGGER_BOXES[e].item.visible=!0,U.TRIGGER_BOXES[n].item.userData.active=!1,U.TRIGGER_BOXES[n].item.userData.played=!1);U.ENTER_DOOR.getObjectByName("trigger").visible=!0,U.EXIT_DOOR.getObjectByName("trigger").visible=!0;for(e=0;e<window.instances.length;e++)U.SCENE_FPS.remove(window.instances[e]);U.ITEMS_ADDED.getObjectByName("spawn")&&(U.CORRIDOR_ENTER.visible=!1,U.ITEMS_ADDED.getObjectByName("spawn").visible=!0,U.ENTER_DOOR.visible=!0),U.DEBUGGER_GROUP.visible=!1,U.GROUP_LINE_TRAGECTORY.visible=!0,U.ROOM.visible=!0,U.CONTROLS.enabled=!0,U.SCENE.environment=U.ENV_MAP,U.LIGHT_GROUP.visible=!1,U.SCENE.background=null,U.CORRIDOR_ENTER.visible=!1,U.SCENE.getObjectByName("window").visible=!0,U.OBSERVATION_ROOM.visible=!1,U.SCENE_CHILDREN.remove(U.SCENE_FPS),U.SCENE_FPS=null,U.LEVEL_ENTERED=!1,U.DOOR_OPEN_STATE=!1,U.FINISHED=!1,B()("#ui").css("display","block"),B()(".img").removeClass("image"),B()("#mobile-controls").css("display","none"),B()("#container").css("filter","none"),B()("#blocker").css("display","none"),B()("#blocker").css("pointer-events","none"),B()("#reticle").css("display","none"),M(0),M(1),U.PORTAL_BOX=[],U.MAIN_CAMERA.position.set(-12.2,17.4,26.3),U.LIGHT_PORTAL_0.visible=!1,U.LIGHT_PORTAL_1.visible=!1,U.FLASH.visible=!1;for(e=U.CANNON_BODIES.length-1;0<=e;e--)U.CANNON_WORLD.remove(U.CANNON_BODIES[e]);for(var o=0;o<U.LIGHT_BRIDGE_CLONE.length;o++)U.ITEMS_ADDED.remove(U.LIGHT_BRIDGE_CLONE[o]),U.CANNON_WORLD.removeBody(U.LIGHT_BRIDGE_COLLIDER_CLONE[o]),U.LIGHT_BRIDGE_CLONE[o].item.clone=null;U.CANNON_BODIES=[],U.WALL_BODIES=[],U.RADIO_MUSIC=[],U.BLOCK_PORTAL=[],U.DYNAMIC_OBJECTS=[],U.DYNAMIC_OBJECTS.push(U.PLAYER),U.TRACTOR_BEAM_LENGTH=0,U.LASER_EMITTER_LENGTH=0,U.CONTROLS.update(),D(L.EDITOR),L.AMBIENT.pause(),U.ENTER_DOOR.children[0].rotation.z+=Math.PI,qn(0,!1,!1,U.ENTER_DOOR,!0),qn(0,!1,!1,U.EXIT_DOOR,!0),U.CORRIDOR_ENTER.getObjectByName("elevatorOBJ").visible=!0,U.CORRIDOR_ENTER.getObjectByName("leftDoor").visible=!0,U.CORRIDOR_ENTER.getObjectByName("rightDoor").visible=!0,U.CORRIDOR_ENTER.getObjectByName("rightDoor").rotation.y=Math.PI/2,U.CORRIDOR_ENTER.getObjectByName("leftDoor").rotation.y=Math.PI/2,U.MATERIAL_TRACTOR_BEAM.depthWrite=!0,U.MATERIAL_TRACTOR_BEAM_REVERSE.depthWrite=!0,U.FPS_MODE=!1;for(var a=0;a<U.CONNECTIONS.length;a++)if(U.CONNECTIONS[a].line.active){var r=!1;if(U.CONNECTIONS[a].to.item.userData.buttons==U.CONNECTIONS[a].to.item.userData.connections&&(r=!0),--U.CONNECTIONS[a].to.item.userData.buttons,le(U.CONNECTIONS[a],null,!1,new b.Q1f(0,2,5)),r)if(U.CONNECTIONS[a].to.itemName.includes("angled_panel")){S(500,U.CONNECTIONS[a].to.item.getObjectByName("pivot2").rotation,new b.Pq0(U.CONNECTIONS[a].to.item.userData.angle*Math.PI/180,U.CONNECTIONS[a].to.item.getObjectByName("pivot2").rotation.y,U.CONNECTIONS[a].to.item.getObjectByName("pivot2").rotation.z));let e=U.CONNECTIONS[a].to.item;0!=e.getObjectByName("panel").hasPortal&&1!=e.getObjectByName("panel").hasPortal||M(e.getObjectByName("panel").hasPortal),e.getObjectByName("panel").hasPortal=100,setTimeout(()=>{Vn(e.getObjectByName("panel").body,e.getObjectByName("Cube"))},500)}else U.CONNECTIONS[a].to.itemName.includes("faith_plate")?U.CONNECTIONS[a].to.item.userData.state=!1:U.CONNECTIONS[a].to.itemName.includes("door")||U.CONNECTIONS[a].to.itemName.includes("exitDoor")?U.CONNECTIONS[a].to.item.userData.buttons<U.CONNECTIONS[a].to.item.userData.connections&&qn(0,!1,!1,U.CONNECTIONS[a].to.item):U.CONNECTIONS[a].to.itemName.includes("tractor")?U.CONNECTIONS[a].to.item.userData.buttons<U.CONNECTIONS[a].to.item.userData.connections&&ut(U.CONNECTIONS[a].to):U.CONNECTIONS[a].to.itemName.includes("light_bridge")?U.CONNECTIONS[a].to.item.userData.buttons<U.CONNECTIONS[a].to.item.userData.connections&&dt(U.CONNECTIONS[a].to):U.CONNECTIONS[a].to.itemName.includes("laser_field")||U.CONNECTIONS[a].to.itemName.includes("fizzler")?U.CONNECTIONS[a].to.item.userData.buttons<U.CONNECTIONS[a].to.item.userData.connections&&_t(U.CONNECTIONS[a].to):U.CONNECTIONS[a].to.itemName.includes("portal_0")||U.CONNECTIONS[a].to.itemName.includes("portal_1")?U.CONNECTIONS[a].to.item.active=!1:(U.CONNECTIONS[a].to.itemName.includes("piston_platforms")||U.CONNECTIONS[a].to.itemName.includes("track_platforms")||U.CONNECTIONS[a].to.itemName.includes("pellet_launcher"))&&(U.CONNECTIONS[a].to.item.userData.isActive=!U.CONNECTIONS[a].to.item.userData.isActive,U.CONNECTIONS[a].to.item.body.pistonDown=!0,U.CONNECTIONS[a].to.itemName.includes("piston_platforms")||U.CONNECTIONS[a].to.itemName.includes("track_platforms"))&&(U.CONNECTIONS[a].to.item.userData.isActive?U.CONNECTIONS[a].to.item.body.sound.audio.play():U.CONNECTIONS[a].to.item.body.sound.audio.pause())}for(var s=["cube","cube_2","radio","sphere","laser_cube","scale_cube"],e=0;e<s.length;e++)for(var l,E,i=0;i<U.DYMANIC_ITEMS[s[e]].length;i++)U.DYMANIC_ITEMS[s[e]][i].visible&&(E=l=void 0,l=U.DYMANIC_ITEMS[s[e]][i],E=s[e],l.position.copy(l.position),l.updateMatrix(),(E=U.ITEMS_ADDED.getObjectByName(E)).setMatrixAt(l.userData.idInstanced,l.matrix),E.instanceMatrix.needsUpdate=!0,E.computeBoundingSphere());for(e=0;e<U.CAMERAS.length;e++){U.CAMERAS[e].fixed=!0,U.CAMERAS[e].position.copy(U.CAMERAS[e].initialPosition),U.CAMERAS[e].rotation.copy(U.CAMERAS[e].initialRotation);var c=new b.Pq0,c=(U.CAMERAS[e].children[1].getWorldPosition(c),c.y-=.25,U.CAMERAS[e].cube.position.copy(c),U.CAMERAS[e].cube.body=null,U.INTERACTIVE.indexOf(U.CAMERAS[e].cube));-1<c&&U.INTERACTIVE.splice(c,1)}U.SCENE_FPS=[],setTimeout(()=>{U.ENTER_DOOR.getObjectByName("portal_door_right_04").position.z=10,U.ENTER_DOOR.getObjectByName("portal_door_left_06").position.z=10,U.EXIT_DOOR.getObjectByName("portal_door_right_04").position.z=10,U.EXIT_DOOR.getObjectByName("portal_door_left_06").position.z=10},1500),U.PORTAL_GUN_INITIATE=U.PORTAL_GUN_INITIATE_HOLDER;for(e=0;e<U.PORTAL_GUN_BOX.length;e++)U.PORTAL_GUN_BOX[e].item.visible=!0,U.PORTAL_GUN_BOX[e]=U.PORTAL_GUN_BOX[e].item;for(e=0;e<U.CONNECTIONS.length;e++)U.CONNECTIONS[e].from.instancedName.includes("trigger_area")&&(U.CONNECTIONS[e].from.item.visible=!0),U.CONNECTIONS[e].line.active=!1,U.CONNECTIONS[e].to.item.userData.buttons=0;U.SCENE_FPS=new b.YJl;for(e=0;e<U.LASER_EMITTER_RAYCASTER.length;e++)U.LASER_EMITTER_RAYCASTER[e].laser.clone.visible=!1}U.PLAYER.collisionFilterGroup=U.CGROUP_PLAYER,B()("body").on("click","#back-editor",function(){zt()});var jt,qt={},Xt=[],Wt=new b.YJl;function Zt(e,t,n,o,i){Wt=new b.YJl,Xt=[],qt={};var a=[],r=new b.bdM(.5,.5),s=new b.V9B({color:256252,side:b.$EB,polygonOffset:!0,polygonOffsetFactor:-7,map:U.IMG_CLOSE}),r=new b.eaF(r,s),s=!0;"up"==n.side?(r.rotation.x=Math.PI/2,r.position.set(1.3*n.normal.z+t.x,t.y,1.3*n.normal.x+t.z)):"down"==n.side?(r.rotation.x=-Math.PI/2,r.position.set(t.x,t.y,t.z),s=!1):r.position.set(1.3*n.normal.z+t.x,t.y,1.3*n.normal.x+t.z),U.CONNECTING=!1,U.MATERIAL_PORTAL_EDITOR.opacity=1,U.MATERIAL_NON_PORTAL_EDITOR.opacity=1,U.MATERIAL_PORTAL_EDITOR.transparent=!1,U.MATERIAL_NON_PORTAL_EDITOR.transparent=!1,U.SCENE_CHILDREN.remove(jt);for(var l=0;l<U.PLANE_USER_DATA.length;l++)U.PLANE_USER_DATA[l].exists&&!U.PLANE_USER_DATA[l].hasItem&&a.push(U.PLANE_USER_DATA[l]);a.push(n),a.push(o);for(var E={},l=0;l<a.length;l++){var c=new b.B69;c.position.copy(a[l].position),c.rotation.copy(a[l].rotation),c.node=a[l],c.name=a[l].name,Wt.add(c),Xt.push(c)}for(var _=0;_<Xt.length;_++){E[Xt[_].id]={};for(l=1;l<Xt.length;l++){var d=Kt(Xt[_].position,Xt[l].position);Xt[_].id!=Xt[l].id&&d<=2&&(E[Xt[_].id][Xt[l].id]=d)}}for(var r=new ii(E),n=Wt.getObjectByName(e.x+"/"+e.y+"/"+e.z).id,e=Wt.getObjectByName(t.x+"/"+t.y+"/"+t.z).id,t=s,s=o,o=i,u=r.findShortestPath(n,e),A=[],p=[],m=[],N=[],T=[],R=[],O=0;O<u.length-1;O++){var I=u[O],D=(u[O]in qt||(qt[u[O]]=!0),u[O+1]),I=(u[O+1]in qt||(qt[u[O+1]]=!0),Wt.getObjectById(parseInt(I),!0)),D=Wt.getObjectById(parseInt(D),!0);Kt(I.position,D.position),I.node.hasLine=!0,N.push(I.position),m.push(I.rotation),O>=u.length-2&&(N.push(D.position),m.push(D.rotation))}A.push(N[0]),p.push(m[0]);for(var L=1;L<N.length;L++){if(!m[L-1].equals(m[L]))for(var g=((e,t)=>{var i=new b.bdM(2,2),n=new b.V9B,t=((n=new b.eaF(i,n)).position.copy(e),n.rotation.copy(t),n.updateMatrixWorld(!0),U.SCENE.add(n),(e=i.parameters.width)/2),e=i.parameters.height/2,i=n.matrixWorld,o=new b.Pq0(0,e,0),e=new b.Pq0(0,-e,0),a=new b.Pq0(-t,0,0),t=new b.Pq0(t,0,0);return o.applyMatrix4(i),e.applyMatrix4(i),a.applyMatrix4(i),t.applyMatrix4(i),U.SCENE.remove(n),[o.round(),e.round(),a.round(),t.round()]})(N[L-1],m[L-1]),S=0;S<g.length;S++)if(g[S].distanceTo(N[L])<=1){p.push(m[L-1]),A.push(g[S]);break}N[L]=Jt(N[L],m[L]),p.push(m[L]),A.push(N[L]),(new b.Pq0).subVectors(A[L-1],N[L]).normalize()}if(r=new b.Pq0,A[A.length-2]&&A[A.length-1]){r.subVectors(A[A.length-2],A[A.length-1]).normalize(),t&&(A[A.length-1].x+=r.x,A[A.length-1].y+=r.y,A[A.length-1].z+=r.z);let i=0;for(let e=0;e<A.length-1;e++)i+=A[e].distanceTo(A[e+1]);var h=4*i,C=new b.Gu$(.04,16,8),n=new b.V9B({color:new b.Q1f(0,2,5)});for(let e=0;e<h;e++){var y=e/(h-1)*i;let t=0;for(let e=0;e<A.length-1;e++){var M=A[e].distanceTo(A[e+1]);if(t+M>=y){var P=(y-t)/M,P=(new b.Pq0).lerpVectors(A[e],A[e+1],P);T.push(P),R.push(p[e]);break}t+=M}}var f=new b.kn4,v=[];for(let e=0;e<T.length;e++){var w=new b.B69,w=(w.position.copy(T[e]),w.rotation.copy(R[e]),w.updateMatrix(),f.compose(w.position,w.quaternion,w.scale),C.clone());w.applyMatrix4(f),v.push(w)}e=Ue.pP(v),t=new b.eaF(e,n);"trigger_area"!=s.instancedName&&U.SCENE_FPS.add(t),o.line2=t}else o.line.visible=!0,o.line2=o.line}var Qt=[];function Jt(e,t){var i,n=new b.B69;return n.position.copy(e),n.rotation.copy(t),n.translateY(.2*(i=e,Qt.filter(e=>e.equals(i)).length)),t=n.position.clone(),Qt.push(e.clone()),t}function Kt(e,t){var i=t.x-e.x,n=t.y-e.y,t=t.z-e.z;return Math.sqrt(i*i+n*n+t*t)}ei=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i},ti=function(e,t){return parseFloat(e)-parseFloat(t)},ai.prototype.findShortestPath=function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?oi(this.map,e):oi(this.map,2===arguments.length?[e,t]:((t,i)=>{try{return Array.prototype.slice.call(t,i)}catch(e){for(var n=[],o=i||0,a=t.length;o<a;++o)n.push(t[o]);return n}})(arguments))},ai.prototype.map=function(){return this.map},ai.prototype.nodes=function(){return this.keys},ai.prototype.edges=function(){return this.connectors};var $t,ei,ti,ii=ai;function ni(e,t,i,n){this.start=t,this.end=i;var o,a={},r={0:[t]},s={};for(a[t]=0;r&&(o=ei(r)).length;){o.sort(ti);var l,E,c,_,d=o[0],u=r[d],A=u.shift(),p=parseFloat(d),m=e[A]||{};for(l in u.length||delete r[d],m)Object.prototype.hasOwnProperty.call(m,l)&&(E=m[l]+p,(c=a[l])===$t||E<c)&&(_=c=void 0,c=a[l]=E,_=l,r[c=""+c]||(r[c]=[]),r[c].push(_),s[l]=A)}return a[i]===$t?null:s}function oi(e,t){for(var i,n,o=t.shift(),a=[];t.length;){if(i=t.shift(),!(n=new ni(e,o,i)))return null;if(n=((e,t)=>{for(var i=[],n=t;n;)i.push(n),n=e[n];return i.reverse(),i})(n,i),!t.length)return a.concat(n);a.push.apply(a,n.slice(0,-1)),o=i}}function ai(t){this.map=t,this.keys=Object.keys(t);for(var i=this.keys.map(function(e){return t[e]}),e=[],n=0;n<this.keys.length;n++)for(var o=Object.keys(i[n]),a=o.map(function(e){return i[n][e].toString()}),r=0;r<o.length;r++)e.push([this.keys[n],o[r],a[r]]);this.connectors=e}var ri=e(812),r=new b.Gu$(.1,8,4),t=new b._4j({color:16777215,depthTest:!1,transparent:!0});window.checkers=new ie.t9(r,t,{createInstances:!0}),window.checkers.addInstances(1e3,(e,t)=>{e.color="white",e.visible=!1}),window.checkers.instanceMatrix.needsUpdate=!0,U.SCENE.add(window.checkers),window.checkersIndexes=[];for(var si=0;si<1e3;si++)window.checkersIndexes.push(!1);let li=new b.Q1f(0,2,5);function Ei(e,t){if(U.CONNECTING=!1,U.MATERIAL_PORTAL_EDITOR.opacity=1,U.MATERIAL_NON_PORTAL_EDITOR.opacity=1,U.MATERIAL_PORTAL_EDITOR.transparent=!1,U.MATERIAL_NON_PORTAL_EDITOR.transparent=!1,U.SCENE_CHILDREN.remove(U.CURRENT_LINE),!U.PLANE_USER_DATA[e].item||U.PLANE_USER_DATA[e].item.userData){if(U.FAITH_PLATE_TARGET)xt(U.PLANE_USER_DATA[e]);else if(U.PLANE_USER_DATA[e].allowconnection&&!U.SELECTED_FOR_CONNECTION.item.userData.connectedTo.includes(U.PLANE_USER_DATA[e].id_instanced)&U.PLANE_USER_DATA[e].item.userData.connections<10){var i,n;U.PLANE_USER_DATA[e].item.userData.connections+=1;for(var o=0;o<10;o++)if(!(n=U.PLANE_USER_DATA[e].item.checkersSlots[o]).visible){n.visible=!0;for(var a=n.position,r=0;r<window.checkersIndexes.length;r++)if(!window.checkersIndexes[r]){window.checkersIndexes[r]=!0,window.checkers.instances[r].position.copy(a),window.checkers.setVisibilityAt(r,!0),window.checkers.setColorAt(r,li),window.checkers.instances[r].updateMatrix(),window.checkers.computeBoundingSphere(),i=r;break}break}var s=ci(t,a);U.LINES.add(s),U.CONNECTIONS.push({line:s,from:t,line2:null,to:U.PLANE_USER_DATA[e],checker:i,clone:n}),t.item.userData.connectedTo.push(e)}U.ITEM_CUBE.visible=!1,U.CURRENT_LINE=null}}function ci(e,t){var i=[],t=(i.push(e.position),i.push(t),(new b.LoY).setFromPoints(i)),i=new b.mrM({transparent:!0,color:li}),t=new b.N1A(t,i);return t.visible=e.item.userData.showLines,t}B()("body").on("click",".removeConnection",function(){U.LINES.remove(U.CONNECTIONS[B()(this).data("id")].line),window.checkers.instances[U.CONNECTIONS[B()(this).data("id")].checker].visible=!1,window.checkersIndexes[U.CONNECTIONS[B()(this).data("id")].checker]=!1,U.CONNECTIONS[B()(this).data("id")].clone.visible=!1,--U.CONNECTIONS[B()(this).data("id")].to.item.userData.connections;var e=U.CONNECTIONS[B()(this).data("id")].from.item.userData.connectedTo.indexOf(U.CONNECTIONS[B()(this).data("id")].to.id_instanced);-1<e&&U.CONNECTIONS[B()(this).data("id")].from.item.userData.connectedTo.splice(e,1),U.CONNECTIONS.splice(B()(this).data("id"),1),B()("#connections").empty();for(var t,i=0;i<U.CONNECTIONS.length;i++)U.CONNECTIONS[i].from.itemName==U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName&&(t='<li data-id="'+i+'" class="menu-item removeConnection"><button type="button" class="menu-btn"><i class="fas fa-times"></i><span class="menu-text">'+U.CONNECTIONS[i].to.itemName+"</span></button></li>",B()("#connections").append(t))}),B()("body").on("mouseenter",".removeConnection",function(){U.CONNECTIONS[B()(this).data("id")]&&(U.ITEM_CUBE.position.copy(U.CONNECTIONS[B()(this).data("id")].to.position),U.ITEM_CUBE.rotation.copy(U.CONNECTIONS[B()(this).data("id")].to.rotation),U.ITEM_CUBE.translateZ(1),U.ITEM_CUBE.material.color=new b.Q1f(16711680),U.ITEM_CUBE.visible=!0)}),B()("body").on("mouseleave",".removeConnection",function(){U.ITEM_CUBE.visible=!1});var _i=e(500),i=e(453);let di=new b.Q1f("rgb(255, 165, 0)");var ui,Ai=null,pi=null;function mi(e,t,i){B()("#delete").css("display","none"),document.querySelector(".menu").classList.remove("menu-show");var n=e.instanceId;if(U.CONNECTING)Ei(n,U.SELECTED_FOR_CONNECTION);else if(U.PLANE_USER_DATA[n].itemName&&(B()("#sample-audio").prop("value",""),U.PLANE_USER_DATA[n].itemName.includes("trigger_voice"))?(B()("#sample-audio").prop("value",U.PLANE_USER_DATA[n].item.userData.speech),B()("#audio-trigger").css("display","flex")):B()("#audio-trigger").css("display","none"),2==t.button){if("enterDoor"!=U.PLANE_USER_DATA[n].itemName&&"window"!=U.PLANE_USER_DATA[n].itemName){if(U.PLANE_USER_DATA[n].hasItem&&(U.PLANE_USER_DATA[n].itemName.includes("door")||U.PLANE_USER_DATA[n].itemName.includes("portal_0")||U.PLANE_USER_DATA[n].itemName.includes("portal_1")||U.PLANE_USER_DATA[n].itemName.includes("angled_panel")||U.PLANE_USER_DATA[n].itemName.includes("pedestal_button")||U.PLANE_USER_DATA[n].itemName.includes("light")||U.PLANE_USER_DATA[n].itemName.includes("bed")||U.PLANE_USER_DATA[n].itemName.includes("incinerator")||U.PLANE_USER_DATA[n].itemName.includes("toilet")||U.PLANE_USER_DATA[n].itemName.includes("desk")||U.PLANE_USER_DATA[n].itemName.includes("cabinet")||U.PLANE_USER_DATA[n].itemName.includes("sign")||U.PLANE_USER_DATA[n].itemName.includes("step")||U.PLANE_USER_DATA[n].itemName.includes("portal_gun"))?B()("#rotate-item").css("display","block"):B()("#rotate-item").css("display","none"),B()(".hasItem").css("display","none"),1==U.SELECTED_ID.length&&U.PLANE_USER_DATA[n].hasItem){if(B()("#delete").css("display","block"),"exitDoor"==U.PLANE_USER_DATA[n].itemName&&B()("#delete").css("display","none"),"sphere"==U.PLANE_USER_DATA[n].instancedName||"cube"==U.PLANE_USER_DATA[n].instancedName||"cube_2"==U.PLANE_USER_DATA[n].instancedName||"laser_cube"==U.PLANE_USER_DATA[n].instancedName||"scale_cube"==U.PLANE_USER_DATA[n].instancedName?(B()(".dispenser").css("display","block"),B()("#state-dispenser").prop("checked",U.PLANE_USER_DATA[n].item.userData.hasDispenser),B()("#dispenser-opened").prop("checked",U.PLANE_USER_DATA[n].item.userData.opened)):B()(".dispenser").css("display","none"),U.PLANE_USER_DATA[n].itemName.includes("button")||U.PLANE_USER_DATA[n].itemName.includes("laser_receiver")||U.PLANE_USER_DATA[n].itemName.includes("trigger")||U.PLANE_USER_DATA[n].itemName.includes("laser_relay")||U.PLANE_USER_DATA[n].itemName.includes("pellet_catcher")||U.PLANE_USER_DATA[n].itemName.includes("incinerator")){B()(".buttons").css("display","block"),B()("#connections").empty();for(var o,a=0;a<U.CONNECTIONS.length;a++)U.CONNECTIONS[a].from.itemName==U.PLANE_USER_DATA[n].itemName&&(o='<li data-id="'+a+'" class="menu-item removeConnection"><button type="button" class="menu-btn"><i class="fas fa-times"></i><span class="menu-text">'+U.CONNECTIONS[a].to.itemName+"</span></button></li>",B()("#connections").append(o),B()("#state-lines").prop("checked",U.CONNECTIONS[a].line.visible))}else B()(".buttons").css("display","none");(U.PLANE_USER_DATA[n].itemName.includes("pedestal")||U.PLANE_USER_DATA[n].itemName.includes("trigger"))&&(B()(".pedestal").css("display","block"),B()("#state-pedetsal-infinity").prop("checked",U.PLANE_USER_DATA[n].item.userData.pedestalInfinity),B()("#pedestal-timer-value").prop("value",U.PLANE_USER_DATA[n].item.userData.pedestalValue),U.PLANE_USER_DATA[n].item.userData.pedestalInfinity?B()("#pedestal-timer").addClass("disabled"):B()("#pedestal-timer").removeClass("disabled"),U.PLANE_USER_DATA[n].itemName.includes("pedestal")?B()("#pedestal-inifinity").find("span").text("Activation Lasts"):B()("#pedestal-inifinity").find("span").text("Wait to activate")),U.PLANE_USER_DATA[n].itemName.includes("tractor")&&(B()(".tractor").css("display","block"),B()("#tractor-state-input").prop("checked",U.PLANE_USER_DATA[n].item.userData.state),B()("#tractor-direction-input").prop("checked",U.PLANE_USER_DATA[n].item.userData.reversed),B()("#tractor-trigger").find(".title").text("Triggers: "+U.PLANE_USER_DATA[n].item.userData.triggers)),U.PLANE_USER_DATA[n].itemName.includes("light_bridge")&&(B()(".light-bridge").css("display","block"),B()("#light-bridge-state-input").prop("checked",U.PLANE_USER_DATA[n].item.userData.state),B()("#light-bridge-trigger").find(".title").text(U.PLANE_USER_DATA[n].item.userData.triggers)),U.PLANE_USER_DATA[n].itemName.includes("laser_field")&&(B()(".laser-field").css("display","block"),B()("#laser-field-state-input").prop("checked",U.PLANE_USER_DATA[n].item.userData.state),B()("#laser-field-trigger").find(".title").text(U.PLANE_USER_DATA[n].item.userData.triggers)),U.PLANE_USER_DATA[n].itemName.includes("fizzler")&&(B()(".fizzler").css("display","block"),B()("#fizzler-state-input").prop("checked",U.PLANE_USER_DATA[n].item.userData.state),B()("#fizzler-trigger").find(".title").text(U.PLANE_USER_DATA[n].item.userData.triggers)),(U.PLANE_USER_DATA[n].itemName.includes("observation_room")||U.PLANE_USER_DATA[n].itemName.includes("light"))&&(B()(".light-color").css("display","block"),B()("#ligh-color-input").val(U.PLANE_USER_DATA[n].item.userData.lightColor)),"sphere"!=U.PLANE_USER_DATA[n].instancedName&&"cube"!=U.PLANE_USER_DATA[n].instancedName&&"cube_2"!=U.PLANE_USER_DATA[n].instancedName&&"laser_cube"!=U.PLANE_USER_DATA[n].instancedName&&"scale_cube"!=U.PLANE_USER_DATA[n].instancedName||(B()(".physics").css("display","block"),B()("#restitution").val(U.PLANE_USER_DATA[n].item.userData.restitution),B()("#friction").val(U.PLANE_USER_DATA[n].item.userData.friction)),U.PLANE_USER_DATA[n].itemName.includes("glass")&&(B()(".glass").css("display","block"),B()("#glass-trigger").find(".title").text(U.PLANE_USER_DATA[n].item.userData.triggers),B()("#grid-state-input").prop("checked",U.PLANE_USER_DATA[n].item.userData.grid)),U.PLANE_USER_DATA[n].itemName.includes("portal_gun")&&(B()(".portal_gun").css("display","block"),B()("#portal_gun-state").find(".title").text(U.PLANE_USER_DATA[n].item.userData.state+" Portals")),U.PLANE_USER_DATA[n].itemName.includes("laser_emitter")&&(B()(".laser_emitter").css("display","block"),B()("#laser_emitter-trigger").find(".title").text(U.PLANE_USER_DATA[n].item.userData.triggers)),U.PLANE_USER_DATA[n].itemName.includes("laser_receiver")&&(B()(".laser_receiver").css("display","block"),B()("#laser_receiver-trigger").find(".title").text(U.PLANE_USER_DATA[n].item.userData.triggers)),U.PLANE_USER_DATA[n].itemName.includes("pellet_launcher")&&(B()(".pellet").css("display","block"),B()("#state-pellet-infinity").prop("checked",U.PLANE_USER_DATA[n].item.userData.pedestalInfinity),B()("#pellet-timer-value").prop("value",U.PLANE_USER_DATA[n].item.userData.pedestalValue),U.PLANE_USER_DATA[n].item.userData.pedestalInfinity?B()("#pellet-timer").addClass("disabled"):B()("#pellet-timer").removeClass("disabled")),U.PLANE_USER_DATA[n].itemName.includes("faith_plate")&&(B()(".faith_plate").css("display","block"),B()("#plate-max-height-value").prop("value",U.PLANE_USER_DATA[n].item.userData.heightLine),B()("#plate-state-input").prop("checked",U.PLANE_USER_DATA[n].item.userData.state)),U.PLANE_USER_DATA[n].itemName.includes("angled_panel")&&(B()(".angled_panel").css("display","block"),B()("#angled_panel_option").find(".title").text("Angle on Start: "+U.PLANE_USER_DATA[n].item.userData.angle),B()("#angled_panel_trigger").find(".title").text("Angle on Trigger: "+U.PLANE_USER_DATA[n].item.userData.angleTrigger)),U.PLANE_USER_DATA[n].itemName.includes("gel_recharger")&&B()(".gel_recharger").css("display","block"),U.PLANE_USER_DATA[n].itemName.includes("trigger")&&(B()(".trigger").css("display","block"),B()("#state-trigger-visibility").prop("checked",U.PLANE_USER_DATA[n].item.userData.triggerVisibility)),U.PLANE_USER_DATA[n].itemName.includes("trigger_voice")&&(B()(".trigger_voice").css("display","block"),B()("#state-trigger-voice-link").prop("value",U.PLANE_USER_DATA[n].item.userData.link),B()("#state-trigger-multiple").prop("checked",U.PLANE_USER_DATA[n].item.userData.multipleTrigger)),U.PLANE_USER_DATA[n].itemName.includes("exitDoor")&&(B()(".exitDoor").css("display","block"),B()("#state-trigger-voice-link").prop("value",U.PLANE_USER_DATA[n].item.userData.link)),U.PLANE_USER_DATA[n].itemName.includes("trigger_audio")&&(B()(".trigger_audio").css("display","block"),B()("#state-trigger-loop").prop("checked",U.PLANE_USER_DATA[n].item.userData.soundEffectLoop)),U.PLANE_USER_DATA[n].itemName.includes("trigger")&&!U.PLANE_USER_DATA[n].itemName.includes("trigger_save")&&B()(".trigger-multiple").css("display","block"),(U.PLANE_USER_DATA[n].itemName.includes("piston_platforms")||U.PLANE_USER_DATA[n].itemName.includes("track_platforms"))&&(B()(".piston_platforms").css("display","block"),B()("#piston-max-height").prop("value",U.PLANE_USER_DATA[n].item.platformBox.parent.scale.y),B()("#state-piston").prop("checked",U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.isActive),B()("#state-piston-loop").prop("checked",U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.loop),U.PLANE_USER_DATA[n].itemName.includes("track_platforms")?B()("#piston-max-height").prop("min",-100):B()("#piston-max-height").prop("min",0)),U.PLANE_USER_DATA[n].itemName.includes("pellet_launcher")&&(B()(".pellet_launcher").css("display","block"),B()("#state-piston").prop("checked",U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.isActive)),(U.PLANE_USER_DATA[n].itemName.includes("pellet_catcher")||U.PLANE_USER_DATA[n].itemName.includes("door"))&&(B()(".soundPlay").css("display","block"),B()("#state-trigger-voice-link").prop("value",U.PLANE_USER_DATA[n].item.userData.link))}U.SELECTED_ID.includes(n)||U.SELECTED_ID.push(n),B()(".gel").css("display","block");for(a=0;a<U.SELECTED_ID.length;a++)if(U.PLANE_USER_DATA[U.SELECTED_ID[a]].hasItem){B()(".gel").css("display","none");break}e=t.pageX,s=t.pageY,(r=document.querySelector(".menu")).style.left=e+"px",r.style.top=s+"px",r.classList.add("menu-show"),U.PLANE_LEVEL_INSTANCED.setColorAt(n,di)}}else if("move"==i&&!U.PLANE_USER_DATA[n].hasItem&&U.PLANE_USER_DATA[U.SELECTED_ID[0]]&&U.PLANE_USER_DATA[U.SELECTED_ID[0]].hasItem&&U.SELECTED_ID[0]!=n){var r,e=U.PLANE_USER_DATA[U.SELECTED_ID[0]],s=U.PLANE_USER_DATA[n];if(e.isInstanced)U.DRAGGING=!0,e.item.continuous&&(-1<(r=U.TRACTOR_BEAM.indexOf(e.item.continuous))&&(U.TRACTOR_BEAM.splice(r,1),U.TRACTOR_BEAM_BOUNDING_BOX.splice(r,1),U.TRACTOR_BEAM_RAYCASTER.splice(r,1)),-1<(E=U.LIGHT_BRIDGE_RAYCASTER.indexOf(e.item.raycaster))&&U.LIGHT_BRIDGE_RAYCASTER.splice(E,1),-1<(E=U.LASER_FIELD_RAYCASTER.indexOf(e.item.raycaster))&&U.LASER_FIELD_RAYCASTER.splice(E,1),-1<(E=U.FIZZLER_RAYCASTER.indexOf(e.item.raycaster))&&U.FIZZLER_RAYCASTER.splice(E,1),-1<(E=U.LASER_EMITTER_RAYCASTER.indexOf(e.item.raycaster))&&U.LASER_EMITTER_RAYCASTER.splice(E,1),U.SCENE_CHILDREN.remove(e.item.continuous)),e.item.bodyBridge&&(U.LIGHT_BRIDGE_TRIGGER=e.item.userData.triggers,U.CANNON_WORLD.removeBody(e.item.bodyBridge)),e.item.cloneLaserID&&(U.LASER_FIELD_TRIGGER=e.item.userData.triggers),e.item.cloneFizzlerID&&(U.FIZZLER_TRIGGER=e.item.userData.triggers),e.item.bodyLaserField&&U.CANNON_WORLD.removeBody(e.item.bodyLaserField),window.moving=!0,B()("#delete").trigger("click"),bn(e,!1,null,null,null,null,null,null,null,!1,null,!1,!1);else{if("down"==s.side){if(!e.floor)return void W("You can not move this item on the floor!")}else if("up"==s.side){if(!e.ceiling)return void W("You can not move this item on the ceiling!")}else if(!e.walls)return void W("You can not move this item on the walls!");if(U.DRAGGING=!0,e.item.continuous)return-1<(E=U.GLASS_RAYCASTER.indexOf(e.item.raycaster))&&U.GLASS_RAYCASTER.splice(E,1),U.GRID_STATE=e.item.userData.grid,U.SCENE_CHILDREN.remove(e.item.continuous),U.ITEMS_ADDED.remove(e.item),e.item.bodyBridge&&U.CANNON_WORLD.removeBody(e.item.bodyBridge),Dn(B()("#"+e.item.userData.instancedName)),bn(e,!1,null,null,null,null,null,null,null,!1,null,!1,!1),Ni(),void(U.SELECTED_ID[0]=n);e.item.namePosition=s.position.x+"/"+s.position.y+"/"+s.position.z,e.item.position.copy(s.position),e.item.name.includes("camera")?e.item.translateY(.3):e.item.name.includes("spawn")?e.item.translateY(-1):e.item.name.includes("portal_gun")?e.item.translateY(.65):e.item.name.includes("trigger_area")?e.item.translateZ(1):e.item.name.includes("faith_plate")&&(window.faithPlateMoved=s,e.item.translateY(.025),U.SCENE.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.target),U.GROUP_LINE_TRAGECTORY.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.target.line)),e.item.name.includes("camera")||e.item.name.includes("observation")||e.item.name.includes("portal_")?e.item.rotation.set(s.normal.x,s.normal.y,s.normal.z):e.item.name.includes("door-")||e.item.name.includes("faith_plate")||e.item.name.includes("spawn")||e.item.rotation.copy(s.rotation),bn(s,!0,e.item.name,e.item,e.state,e.canRotate,e.floor,e.ceiling,e.walls,!1,e.instancedName,e.allowconnection,e.continuousEnding),bn(e,!1,null,null,null,null,null,null,null,!1,null,!1,!1),window.changingPosition=!0,window.changingPositionPlane=e,Ln(s),An(s,!1),s.item&&s.item.name.includes("Door")&&setTimeout(()=>{Fe()},10)}Ni(),U.SELECTED_ID[0]=n}else if("down"==i&&0<U.SELECTED_ID.length&&0==t.button&&Ni(),!U.DRAGGING&&pi!=n){pi=n;for(a=0;a<U.SELECTED_ID_ORANGE.length;a++)U.PLANE_USER_DATA[U.SELECTED_ID_ORANGE[a].id_instanced].planeColor&&U.PLANE_LEVEL_INSTANCED.setColorAt(U.SELECTED_ID_ORANGE[a].id_instanced,new b.Q1f(U.PLANE_USER_DATA[U.SELECTED_ID_ORANGE[a].id_instanced].planeColor));if(U.SELECTED_ID_ORANGE=[],0==U.SELECTED_ID.length)Ai=U.PLANE_USER_DATA[n].position,U.SELECTED_ID.includes(n)||U.SELECTED_ID.push(n),U.PLANE_LEVEL_INSTANCED.setColorAt(U.PLANE_USER_DATA[n].id_instanced,di),ui=n;else{U.SELECTED_ID=[];var l=Ai,E=U.PLANE_USER_DATA[n].position,c=-1*Math.sign(l.x-E.x),_=-1*Math.sign(l.y-E.y),d=-1*Math.sign(l.z-E.z),e=(new b.Pq0).subVectors(E,l),i=(new b.Pq0).addVectors(l,E).multiplyScalar(.5),u=Math.abs(e.x),A=Math.abs(e.y),p=Math.abs(e.z),t=new b.iNn(u,A,p),E=new b.V9B({color:new b.Q1f("rgb(0, 0, 255)")}),e=new b.eaF(t,E),t=(e.position.copy(i),new b.Pq0);e.getWorldDirection(t);new b.Pq0(Math.abs(t.x-1),Math.abs(t.y-1),Math.abs(t.z-1));for(var m=0,a=0;m<=u/2;m++,a+=2)for(var N=0,T=0;N<=A/2;N++,T+=2)for(var R=0,O=0;R<=p/2;R++,O+=2){var I=g(l.x+a*c+"/"+(l.y+T*_)+"/"+(l.z+O*d));I[0]&&I[0].side==U.PLANE_USER_DATA[ui].side&&I[0]&&(U.PLANE_LEVEL_INSTANCED.setColorAt(I[0].id_instanced,di),U.SELECTED_ID_ORANGE.push(I[0]),U.SELECTED_ID.includes(I[0].id_instanced)||U.SELECTED_ID.push(I[0].id_instanced))}}}}function Ni(){ui=null;for(var e=0;e<U.SELECTED_ID.length;e++)U.PLANE_USER_DATA[U.SELECTED_ID[e]].planeColor&&U.PLANE_LEVEL_INSTANCED.setColorAt(U.SELECTED_ID[e],new b.Q1f(U.PLANE_USER_DATA[U.SELECTED_ID[e]].planeColor)),U.PLANE_USER_DATA[U.SELECTED_ID[e]].selected=!1;U.SELECTED_ID=[],U.SELECTED_COLOR=[]}var Ti,Ri=[],Oi=["left","right","up","down","front","back"];function Ii(e){if(Ti=!1,"plus"==e){for(var t=0;t<U.SELECTED_ID.length;t++)for(var i=0;i<6;i++)if(Di(t,1,Oi[i]))return;for(t=0;t<U.SELECTED_ID.length;t++)Li(U.SELECTED_ID[t],1,U.PLANE_USER_DATA[U.SELECTED_ID[t]].portal,U.PLANE_USER_DATA[U.SELECTED_ID[t]])}else if("minus"==e){for(t=0;t<U.SELECTED_ID.length;t++)for(i=0;i<6;i++)if(Di(t,-1,Oi[i]))return;for(t=0;t<U.SELECTED_ID.length;t++)Li(U.SELECTED_ID[t],-1,U.PLANE_USER_DATA[U.SELECTED_ID[t]].portal,U.PLANE_USER_DATA[U.SELECTED_ID[t]])}for(t=0;t<Ri.length;t++){var n=new b.B69;n.scale.set(0,0,0),n.updateMatrix(),U.PLANE_LEVEL_INSTANCED.setMatrixAt(Ri[t],n.matrix),U.PLANE_LEVEL_INSTANCED.setVisibilityAt(Ri[t],!1),U.PLANE_USER_DATA[Ri[t]]={},U.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),U.BUDGET+=1}Ri=[],Fe(),Ti&&Ni()}function Di(e,t,i){var n,o=new b.B69,i=(o.position.copy(U.PLANE_USER_DATA[U.SELECTED_ID[e]].position),o.rotation.copy(U.PLANE_USER_DATA[U.SELECTED_ID[e]].rotation),o.translateZ(t),"left"==i?o.rotation.set(0,Math.PI/2,0):"right"==i?o.rotation.set(0,-Math.PI/2,0):"up"==i?o.rotation.set(Math.PI/2,0,0):"down"==i?o.rotation.set(-Math.PI/2,0,0):"front"==i?o.rotation.set(0,0,0):"back"==i&&o.rotation.set(0,Math.PI,0),"left"==U.PLANE_USER_DATA[U.SELECTED_ID[e]].side?n="right":"right"==U.PLANE_USER_DATA[U.SELECTED_ID[e]].side?n="left":"up"==U.PLANE_USER_DATA[U.SELECTED_ID[e]].side?n="down":"down"==U.PLANE_USER_DATA[U.SELECTED_ID[e]].side?n="up":"front"==U.PLANE_USER_DATA[U.SELECTED_ID[e]].side?n="back":"back"==U.PLANE_USER_DATA[U.SELECTED_ID[e]].side&&(n="front"),o.translateZ(t),o.position.copy(o.position.round()),g(o.position.x+"/"+o.position.y+"/"+o.position.z));return!!(0<i.length&&(i[0].hasItem&&U.PLANE_USER_DATA[U.SELECTED_ID[e]].side!=i[0].side||i[0].side==n&&U.PLANE_USER_DATA[U.SELECTED_ID[e]].hasItem))&&(W("Conflict!"),!0)}function Li(e,t,i){var n=new b.B69,o=(n.position.copy(U.PLANE_USER_DATA[e].position),n.rotation.copy(U.PLANE_USER_DATA[e].rotation),n.translateZ(2*t),n.position.copy(n.position.round()),g(n.position.x+"/"+n.position.y+"/"+n.position.z)),a=n.clone();if(a.translateZ(2*-t),"front"==U.PLANE_USER_DATA[e].side||"back"==U.PLANE_USER_DATA[e].side?(gi(a.clone(),t,0,"left",i),gi(a.clone(),t,0,"right",i),gi(a.clone(),t,0,"up",i),gi(a.clone(),t,0,"down",i)):"up"==U.PLANE_USER_DATA[e].side||"down"==U.PLANE_USER_DATA[e].side?(gi(a.clone(),t,0,"left",i),gi(a.clone(),t,0,"right",i),gi(a.clone(),t,0,"front",i),gi(a.clone(),t,0,"back",i)):"left"!=U.PLANE_USER_DATA[e].side&&"right"!=U.PLANE_USER_DATA[e].side||(gi(a.clone(),t,0,"front",i),gi(a.clone(),t,0,"back",i),gi(a.clone(),t,0,"up",i),gi(a.clone(),t,0,"down",i)),0<o.length){U.PLANE_LEVEL_INSTANCED.setColorAt(e,new b.Q1f(16777215));a=new b.B69;a.scale.set(0,0,0),a.updateMatrix(),U.PLANE_LEVEL_INSTANCED.setMatrixAt(e,a.matrix),U.PLANE_LEVEL_INSTANCED.setVisibilityAt(e,!1),U.PLANE_USER_DATA[e]={},U.PLANE_LEVEL_INSTANCED.setColorAt(o[0].id_instanced,new b.Q1f(16777215)),(a=new b.B69).scale.set(0,0,0),a.updateMatrix(),U.PLANE_LEVEL_INSTANCED.setMatrixAt(o[0].id_instanced,a.matrix),U.PLANE_LEVEL_INSTANCED.setVisibilityAt(o[0].id_instanced,!1),U.PLANE_USER_DATA[o[0].id_instanced]={},U.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,U.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),U.BUDGET+=2,Ti=!0}else if(U.PLANE_USER_DATA[e].position=n.position.clone(),U.PLANE_USER_DATA[e].rotation=n.rotation.clone(),U.PLANE_USER_DATA[e].name=n.position.x+"/"+n.position.y+"/"+n.position.z,n.updateMatrix(),U.PLANE_LEVEL_INSTANCED.setMatrixAt(e,n.matrix),U.PLANE_LEVEL_INSTANCED.setVisibilityAt(e,!0),U.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,U.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),U.PLANE_USER_DATA[e].hasItem){for(var r,s,l=U.PLANE_USER_DATA[e],E=0;E<U.CONNECTIONS.length;E++)U.CONNECTIONS[E].from==l?(U.CONNECTIONS[E].from=l,U.SCENE_CHILDREN.remove(U.CONNECTIONS[E].line),s=ci(U.CONNECTIONS[E].from,U.CONNECTIONS[E].to.position),U.SCENE_CHILDREN.add(s),U.CONNECTIONS[E].line=s,s=new b.iNn(1,.5,1),r=new b.V9B,(s=new b.eaF(s,r)).position.copy(l.position),s.rotation.copy(l.rotation),(r=new b.NRn).setFromObject(s),"button_box"==l.instancedName?r.accept="cube-cube_2-laser_cube-scale_cube":"button_sphere"==l.instancedName?r.accept="sphere":"button_weight"==l.instancedName&&(r.accept="sphere-cube-player-laser_cube-cube_2-scale_cube"),l.box3=r):U.CONNECTIONS[E].to==l&&(U.CONNECTIONS[E].to=l,U.SCENE_CHILDREN.remove(U.CONNECTIONS[E].line),s=ci(U.CONNECTIONS[E].from,U.CONNECTIONS[E].to.position),U.SCENE_CHILDREN.add(s),U.CONNECTIONS[E].line=s);"gel"!=U.PLANE_USER_DATA[e].itemName&&(U.PLANE_USER_DATA[e].isInstanced?(l.item.position.copy(l.position),(t=new b.B69).position.copy(l.position),t.rotation.copy(l.item.rotation),"cube"!=l.instancedName&&"sphere"!=l.instancedName&&"cube_2"!=l.instancedName&&"laser_cube"!=l.instancedName&&"scale_cube"!=l.instancedName||(t.translateY(-1),t.translateY(2),(i=new b.B69).position.copy(l.position),i.updateMatrix(),U.ITEMS_ADDED.getObjectByName("dispenser").setMatrixAt(l.item.dispenserID,i.matrix),U.ITEMS_ADDED.getObjectByName("dispenser").instanceMatrix.needsUpdate=!0,l.item.dispenserPosition=i.position.clone()),l.item.initialPosition=t.position.clone(),l.item.initialRotation=t.rotation.clone(),t.updateMatrix(),U.ITEMS_ADDED.getObjectByName(l.instancedName).setMatrixAt(l.item.userData.id,t.matrix),U.ITEMS_ADDED.getObjectByName(l.instancedName).instanceMatrix.needsUpdate=!0):l.item.position.copy(l.position))}}function gi(e,t,i,n,o){e.translateZ(t),"left"==n?e.rotation.set(0,Math.PI/2,0):"right"==n?e.rotation.set(0,-Math.PI/2,0):"up"==n?e.rotation.set(Math.PI/2,0,0):"down"==n?e.rotation.set(-Math.PI/2,0,0):"front"==n?e.rotation.set(0,0,0):"back"==n&&e.rotation.set(0,Math.PI,0),e.translateZ(t),e.position.copy(e.position.round());var a,t=g(e.position.x+"/"+e.position.y+"/"+e.position.z);if(0==t.length){e.updateMatrix();for(var r=0;r<U.PLANE_USER_DATA.length;r++)if(!U.PLANE_USER_DATA[r].exists){a=r;break}U.PLANE_LEVEL_INSTANCED.setMatrixAt(a,e.matrix),U.PLANE_LEVEL_INSTANCED.setVisibilityAt(a,!0);var s,l=8421504,E=(o?(U.PLANE_LEVEL_INSTANCED.setColorAt(a,(new b.Q1f).setHex(16777215)),l=16777215):U.PLANE_LEVEL_INSTANCED.setColorAt(a,(new b.Q1f).setHex(8421504)),U.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,U.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),e.position.copy(e.position.round()),new b.Pq0);e.getWorldDirection(E),1==E.round().z?n="front":-1==E.round().z?n="back":1==E.round().x?n="left":-1==E.round().x?n="right":1==E.round().y?n="down":-1==E.round().y&&(n="up"),"down"==n?s=new b.Pq0(0,0,0):"up"==n?s=new b.Pq0(Math.PI,0,0):"front"==n?s=new b.Pq0(Math.PI/2,0,0):"back"==n?s=new b.Pq0(-Math.PI/2,0,0):"right"==n?s=new b.Pq0(Math.PI/2,0,Math.PI/2):"left"==n&&(s=new b.Pq0(Math.PI/2,0,-Math.PI/2)),U.PLANE_USER_DATA[a]={iniPos:e.position.clone(),base:!0,side:n,name:e.position.x+"/"+e.position.y+"/"+e.position.z,selected:!1,position:e.position.clone(),rotation:e.rotation.clone(),exists:!0,id_instanced:a,portal:o,tile:1,normal:s,planeColor:l},--U.BUDGET}else Ri.push(t[0].id_instanced)}var Si=0;U.PLANE_USER_DATA=[];for(var hi=0;hi<U.BUDGET;hi++)U.PLANE_USER_DATA.push({});function Ci(e,t,i,n,o,a,r,s,l,E,c){for(var _=t,d=new b.B69,u=0;u<s;u++){e+=2;for(var A=0;A<r;A++){t+=2,d.rotation.set(E.x,E.y,E.z),d.scale.set(1,1,1),d.position[n]=e,d.position[o]=t,d.position[a]=i,d.updateMatrix(),U.PLANE_LEVEL_INSTANCED.setMatrixAt(Si,d.matrix),U.PLANE_LEVEL_INSTANCED.setVisibilityAt(Si,!0);var p,m=8421504,N=(d.position.x<=5&&7<=d.position.z&&d.position.y<=5||10<=d.position.x&&d.position.z<=1&&d.position.y<=3||8==d.position.y?(p=!1,U.PLANE_LEVEL_INSTANCED.setColorAt(Si,(new b.Q1f).setHex(8421504))):(p=!0,U.PLANE_LEVEL_INSTANCED.setColorAt(Si,(new b.Q1f).setHex(16777215)),m=16777215),!1),T=null,R=!1,O=null,I=!1;d.position.equals(new b.Pq0(3,1,12))?(T="enterDoor",O=U.ENTER_DOOR,I=R=N=!0):d.position.equals(new b.Pq0(13,1,0))?(T="exitDoor",O=U.EXIT_DOOR,I=R=N=!0):d.position.equals(new b.Pq0(16,7,7))&&(T="window",R=N=!0,O=U.OBSERVATION_ROOM_IMG),d.position.copy(d.position.round()),U.PLANE_USER_DATA[Si]={iniPos:d.position.clone(),base:!0,side:l,name:d.position.x+"/"+d.position.y+"/"+d.position.z,selected:!1,position:d.position.clone(),rotation:d.rotation.clone(),exists:!0,id_instanced:Si,portal:p,tile:1,hasItem:N,itemName:T,merged:!1,checked:!1,canRotate:!1,floor:!1,walls:R,ceiling:!1,isInstanced:!1,item:O,allowconnection:I,connected:[],idConnection:[],line:[],normal:c,planeColor:m,connectionPoints:[]},--U.BUDGET,"exitDoor"==T&&Ln(U.PLANE_USER_DATA[Si]),Si++}t=_}U.RENDERER.renderLists.dispose()}var yi,Mi,Pi,fi,vi,wi,s=window.innerWidth,l=window.innerHeight,n=`
varying vec2 vUv; 
void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`,o=`
// inspired by shader from VoidChicken
// https://www.shadertoy.com/view/XtdXR2
// ... and portal of course ;)

uniform vec2 resolution;
uniform float iTime;
uniform sampler2D iChannel0;
uniform sampler2D iChannel1;
uniform bool start;

uniform int dir;
uniform float dirVal;

// 1 .. 3
const int transitionType = 1;
bool transitionStarted = false; // Variable to track if the transition has started
float transitionProgress = 0.0; // Variable to control the transition progress

varying vec2 vUv;

void main()
{

    gl_FragColor = vec4(0);
    float depth = -1e3;
    for (float i=0. ; i<=1. ; ++i)
    {
        vec2 fragCoord = vUv * resolution;
        vec2 xy = fragCoord - resolution.xy / 2.0;

        //vec2 xy = fragCoord - iResolution / 2.0;
        //vec2 xy = vUv * resolution / 2.0;
        //vec2 xy = vUv;
        //vec2 xy = -0.1 + 1.0 *vUv;

        float grid_width = 100.0;//159
        xy /= grid_width;
        xy.y += i + .5;
        xy.y /= 2.;
        vec2 grid = floor(xy);
        xy -= grid + 0.5;
        xy.y *= 2.;
        grid.y = grid.y * 2. - i;

        float phase = 0.0;
        float offset = (grid.y - grid.x)*dirVal;
        float time = iTime*1.5 - offset;
        if (transitionType == 1)
        {
            // Check if the transition has not started yet
            if (!transitionStarted)
            {
                // Increment the transitionProgress only once
                transitionProgress += 1.0;
                
                // Set time based on transitionProgress
                float time = mod(transitionProgress, 6.0);
                
                // If one full cycle has occurred, set the transitionStarted flag to true
                if (transitionProgress >= 6.0)
                {
                    transitionStarted = true;
                    
                    // Reset transitionProgress to ensure the transition effect doesn't continue
                    transitionProgress = 0.0;
                }
                
                // Apply your transition effect here based on the value of 'time'
                // This effect will run once and then stop
                // For example, you can use 'time' to control the progress of the transition.
                // The effect will complete in one cycle, and then the flag will be set, stopping further transitions.
            }
        }

        //phase += smoothstep(0.0, 1.0, time);
        phase += 1.0 - smoothstep(3.0, 4.0, time);
        phase = abs(mod(phase, 2.0)-1.0);
        
        float side = step(0.5, phase);

        float angle = radians(phase * 180.), z = 2.;
        vec3 p = inverse(mat3(cos(angle),0,-sin(angle), 0,1,0, 0,0,z)) * vec3(xy, z);
        vec2 uv = p.xy / p.z + .5;

        float alpha = 1.;
        if (uv.x>0.0&&uv.y>0.0&&uv.x<1.0&&uv.y<1.0 && p.z>depth)
            depth = p.z;
        else
            alpha = 0.;

        vec2 scale = grid_width / resolution.xy;
        vec2 uv1 = (grid + uv) * scale + .5;
        vec2 uv2 = (grid + vec2(1. - uv.x, uv.y)) * scale + .5;

        vec4 c1;
        vec4 c2;

        if(dir == 0){
            c1 = texture(iChannel0, uv1);
            c2 = texture(iChannel1, uv2);
        }else{
            c1 = texture(iChannel1, uv1);
            c2 = texture(iChannel0, uv2);
        }
        

        gl_FragColor = mix(gl_FragColor, mix(c1, c2, side), alpha);
        //gl_FragColor = mix(gl_FragColor, vec4(p.z-1., 1.-p.z, 0, 1)*10., alpha);
    }
}
`,a=(new b.Tap).load("./assets/loading/3.webp");async function bi(e,t){clearTimeout(Mi),yi&&(yi.currentTime=0,yi.pause()),yi=new Audio(e.link);try{t&&(await yi.play(),setTimeout(()=>{yi.pause()},5e3)),e.voice=yi}catch(e){}}U.TEXTURE_MENU_GRID=(new b.Tap).load("./assets/ui/grid.webp"),U.MATERIAL_MAIN_MENU=new b.BKk({uniforms:{iTime:{type:"f",value:1.2},resolution:{type:"v2",value:new b.I9Y(s,l)},iChannel0:{type:"t",value:a},iChannel1:{type:"t",value:U.TEXTURE_MENU_GRID},dir:{value:0},dirVal:{value:-.1}},vertexShader:n,fragmentShader:o,side:2,transparent:!0}),U.MATERIAL_SUB_MENU=new b.BKk({uniforms:{iTime:{type:"f",value:1.2},resolution:{type:"v2",value:new b.I9Y(s,l)},iChannel0:{type:"t",value:a},iChannel1:{type:"t",value:U.TEXTURE_MENU_GRID},dir:{value:1},dirVal:{value:.1}},vertexShader:n,fragmentShader:o,side:2,transparent:!0}),B()("body").on("change","#state-trigger-multiple",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.multipleTrigger=this.checked}),B()("body").on("change","#state-trigger-visibility",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.triggerVisibility=this.checked}),B()("body").on("change","#state-trigger-loop",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectLoop=this.checked}),B()("#ambient-sound-select").on("change",function(){L.AMBIENT.pause(),L.AMBIENT.currentTime=0,L.AMBIENT=document.getElementById("ambient-"+B()(this).val()),L.AMBIENT.value=B()(this).val(),U.LOADED_LEVEL||(D(L.AMBIENT),clearTimeout(Pi),Pi=setTimeout(()=>{L.AMBIENT.pause(),L.AMBIENT.currentTime=0},5e3))}),B()(".trigger_audio-state").on("click",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffect=B()(this).data("state"),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectElem&&(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectElem.pause(),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectElem.currentTime=0),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectElem=new Audio("/audio/effect/"+B()(this).data("state")),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectElem.play(),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectElem.loop=!1,clearTimeout(Pi),Pi=setTimeout(()=>{U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectElem.pause(),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectElem.currentTime=0},5e3)}),B()("body").on("input","#state-trigger-voice-link",function(){var e=(e=B()(this).val().replace("dl=0","dl=1")).replace(/&st=.*&dl=1/,"");e=(e+="&dl=1").replace("www","dl"),B()(this).val(e),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.link=e}),B()("body").on("click","#play-trigger-voice",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.link&&bi(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData,!0)});var Bi,Ui=!1,Gi=!1;window.stopMenuLoop=!1;let xi=new b.zD7;function Yi(){U.RENDERER.setSize(window.innerWidth,window.innerHeight),U.MAIN_CAMERA.aspect=window.innerWidth/window.innerHeight,U.MAIN_CAMERA.updateProjectionMatrix(),U.MATERIAL_MAIN_MENU.uniforms.resolution.value=new b.I9Y(window.innerWidth,window.innerHeight),U.MATERIAL_SUB_MENU.uniforms.resolution.value=new b.I9Y(window.innerWidth,window.innerHeight),Vi(fi,U.MAIN_CAMERA)}function Vi(e,t,i){var i=2<arguments.length&&void 0!==i?i:null,i=(null!==i?i:t.position.z)-e.position.z,n=t.fov*Math.PI/180,n=2*Math.tan(n/2)*i,i=n*t.aspect;e.scale.set(i,n,1),vi.scale.set(i,n,1)}function Hi(){var e="./levels/tutorial_"+window.currentLevel+"_by_rafadante.json";Fi&&(e=Bi),window.isCustom&&!Fi?(wi=Bi,Zi="tutorial_"+window.currentLevel+"_by_rafadante",B()("#portal-gun-select").val(wi[0][0]).change(),B()("#ambient-sound-select").val(wi[0][1]).change(),zi()):fetch(e).then(e=>e.json()).then(e=>{wi=e,Zi="tutorial_"+window.currentLevel+"_by_rafadante",B()("#portal-gun-select").val(wi[0][0]).change(),B()("#ambient-sound-select").val(wi[0][1]).change(),zi()})}window.unlockedFPS=0,window.isCustom=!1,B()("#blocker").css("display","flex"),B()("#options-main").css("display","block"),B()("#loading-parent").css("opacity","0"),B()("#loading-parent").css("pointer-events","none"),B()("body").on("click","#option-community-build, #option-single-load",function(){B()("#alert").css("opacity","1"),B()("#alert span").text("The level editor is still very unstable, and things will change a lot in the coming weeks, so maps can break in future updates. Feel free to mess around with it."),setTimeout(()=>{B()("#alert").css("opacity","0")},1e4),setTimeout(()=>{D(L.EDITOR),ha()},2e3)}),B()("body").on("click","#back-main-map-btn, #back-main-menu",function(){B()("#blocker .body").css("opacity","1"),B()("#blocker").css("display","flex"),B()("#ui").css("display","none"),B()("#blocker .body").css("opacity","1"),B()(".optionMenu").css("display","none"),B()("#options-main").css("display","block"),B()("#options-settings").css("display","none"),B()("#settings-close").css("display","none"),B()("#next-map").css("display","none"),B()("#options-main .option").css("display","block"),window.stopMenuLoop=!1}),window.stopMenuLoop||setTimeout(()=>{var e=new b.bdM(1,1),e=(fi=new b.eaF(e,U.MATERIAL_MAIN_MENU),U.SCENE_CHILDREN.add(fi),new b.bdM(1,1));vi=new b.eaF(e,U.MATERIAL_SUB_MENU),U.SCENE.background=new b.Q1f(0),Vi(fi,U.MAIN_CAMERA),Wi(),window.addEventListener("resize",Yi)},1e3),B()("body").on("click","#option-single-load",function(){window.chamberID=null,B()("#next-map-btn").css("display","block"),ji(),setTimeout(()=>{window.currentLevel=1,window.stopMenuLoop=!0,U.LOADED_LEVEL=!0},2e3)}),B()("#next-map-btn").on("click",function(){window.chamberID=null,B()("#loading-parent").css("opacity",1),B()("#loading-parent").css("pointer-events","all"),B()("#next-map").css("display","none"),zt(),setTimeout(()=>{Hi()},2e3)}),B()("body").on("click",".load-custom",function(){window.isCustom=!0,ha(),fetch("./levels/custom/"+B()(this).data("id")+".json").then(e=>e.json()).then(e=>{wi=e,U.LOADED_LEVEL=!0,ji()})});var ki=!0,Fi=window.allowEdit=!1;function zi(){B()("#option-single").css("display","none"),B()("#option-community").css("display","none"),B()("#option-about").css("display","none"),window.allowEdit?B()("#back-editor").css("display","block"):B()("#back-editor").css("display","none"),Qi(wi[1])}function ji(){B()("#blocker .body").css("opacity","0"),B()("#logo").css("opacity","0"),U.MATERIAL_MAIN_MENU.uniforms.iChannel0.value=U.MATERIAL_MAIN_MENU.uniforms.iChannel1.value,U.MATERIAL_MAIN_MENU.uniforms.iChannel1.value=null,U.MATERIAL_MAIN_MENU.uniforms.iTime.value=1.2,Gi=!(Ui=!0),U.SCENE_CHILDREN.add(fi),U.SCENE_CHILDREN.remove(vi),setTimeout(()=>{B()("#loading-parent").css("opacity","1"),B()("#loading-parent").css("pointer-events","all"),setTimeout(()=>{B()("#blocker").css("display","none"),B()("#ui").css("display","block"),B()("#container #back-effect").css("display","none"),B()("#blocker .body").css("opacity","1"),B()(".option-main").css("display","none"),B()("#options-settings").css("display","block"),B()("#settings-menu-title").text("OPTIONS"),B()("#back-main").css("display","none"),B()("#settings-close").css("display","block"),B()("#main-container").css("display","block"),U.SCENE_CHILDREN.remove(fi),U.SCENE_CHILDREN.remove(vi),U.SCENE.background=null,window.stopMenuLoop=!0},1e3)},1e3)}function qi(e,t,i){U.MATERIAL_MAIN_MENU.uniforms.iChannel1.value=e,U.MATERIAL_SUB_MENU.uniforms.iChannel1.value=e,U.MATERIAL_MAIN_MENU.uniforms.iTime.value=1.2,U.MATERIAL_SUB_MENU.uniforms.iTime.value=1.2,Ui=!0,Gi&&(Gi=!1,U.SCENE_CHILDREN.add(fi),U.SCENE_CHILDREN.remove(vi)),Xi("block","none",t,"flex",i)}function Xi(e,t,i,n,o){B()("#blocker .body").css("opacity","0"),B()("#logo").css("opacity","0"),B()("#blocker").css("pointer-events","none"),setTimeout(()=>{B()("#options-main").css("display",t),B()(o).css("display",e),B()("#back-main").css("display",e),B()("#settings-menu-title").css("display",n),B()("#settings-menu-title").text(i),B()("#blocker").css("pointer-events","all"),B()("#blocker .body").css("opacity","1"),B()("#logo").css("opacity","1")},2e3)}function Wi(e){window.stopMenuLoop||(Ui&&(U.MATERIAL_MAIN_MENU.uniforms.iTime.value+=xi.getDelta()),Gi&&(U.MATERIAL_SUB_MENU.uniforms.iTime.value+=xi.getDelta()),U.RENDERER.render(U.SCENE,U.MAIN_CAMERA),requestAnimationFrame(Wi))}B()("body").on("click",".custom-chamber1",function(){Fi=!0,B()("#next-map-btn").css("display","none"),window.isCustom=!0,"list-custm-chambers"==B()(this).parent().attr("id")?B()("#next-map-btn").css("display","none"):(B()("#next-map-btn").css("display","block"),window.currentLevel=B()(this).data("id")),setTimeout(()=>{Bi=B()(this).data("name")+".json",window.stopMenuLoop=!0,U.LOADED_LEVEL=!0},2e3),ki?(setTimeout(()=>{ha()},2e3),ji()):(B()("#loading-parent").css("opacity",1),B()("#loading-parent").css("pointer-events","all"),B()("#next-map").css("display","none"),B()("#options-settings").css("display","block"),B()("#options-main").css("display","none"),B()("#options-single").css("display","none"),B()("#options-community").css("display","none"),B()("#container").css("display","block"),B()("#back-main").css("display","none"),B()("#settings-close").css("display","block"),zt(),setTimeout(()=>{Hi()},2100)),ki=!1}),B()("body").on("click",".span-chamber",async function(){Fi=!1,window.allowEdit=!1,B()("#next-map-btn").css("display","none"),window.isCustom=!0,"list-custm-chambers"==B()(this).parent().parent().attr("id")?B()("#next-map-btn").css("display","none"):(B()("#next-map-btn").css("display","block"),window.currentLevel=B()(this).parent().data("id")),B()(this).parent().hasClass("mine")&&(window.allowEdit=!0);let t=await window.getSession();setTimeout(()=>{var e=window.arrayJSON[B()(this).parent().data("jsonid")],e=(Bi=JSON.parse(e),window.chamberID=B()(this).parent().data("id"),window.chamberUSERID=B()(this).parent().data("userid"),window.chamberFinished=B()(this).parent().data("finished"),parseInt(B()(this).parent().data("played"))+1);window.session=t,B()(this).parent().data("userid")!=t.user.id&&window.updateChamberPlayedValue(B()(this).parent().data("id"),e),window.stopMenuLoop=!0,U.LOADED_LEVEL=!0},2e3),B()("#chamber-name-to-save").val(B()(this).parent().data("name")),ki?(setTimeout(()=>{ha()},2100),ji()):(B()("#loading-parent").css("opacity",1),B()("#loading-parent").css("pointer-events","all"),B()("#next-map").css("display","none"),B()("#options-settings").css("display","block"),B()("#options-main").css("display","none"),B()("#options-single").css("display","none"),B()("#options-community").css("display","none"),B()("#container").css("display","block"),B()("#back-main").css("display","none"),B()("#settings-close").css("display","block"),zt(),setTimeout(()=>{Hi()},2100)),ki=!1}),"true"==localStorage.getItem("load")&&(B()("#loading-parent").css("opacity","1"),B()("#loading-parent").css("pointer-events","all"),localStorage.setItem("load","false"),setTimeout(()=>{window.currentLevel=parseInt(localStorage.getItem("level")),ha(),fetch("./levels/"+window.currentLevel+".json").then(e=>e.json()).then(e=>{wi=e,U.LOADED_LEVEL=!0,ji()})},1e3)),B()("body").on("click","#option-community-build",function(){window.allowEdit=!0,ji()}),B()("body").on("click","#option-single-reset",function(){1==window.confirm("Are you sure you want to reset your progress?")&&(localStorage.setItem("level",1),window.location.reload())}),B()("body").on("click","#option-single",function(){qi(U.TEXTURE_MENU_GRID,"SINGLE PLAYER","#options-single")}),B()("body").on("click","#option-community",function(){qi(U.TEXTURE_MENU_GRID,"COMMUNITY CHAMBERS","#options-community"),B()(".main-option").css("display","flex"),B()(".sub-option").css("display","none")}),B()("body").on("click","#option-options",function(){B()("#back-editor").css("display","none"),qi(U.TEXTURE_MENU_GRID,"OPTIONS","#options-settings")}),B()("body").on("click","#option-about",function(){qi(U.TEXTURE_MENU_GRID,"ABOUT","#options-about")}),B()("body").on("click","#option-patreon",function(){qi(U.TEXTURE_MENU_GRID,"PATREON","#options-patreon")}),B()("body").on("click","#back-main",function(){U.MATERIAL_SUB_MENU.uniforms.iTime.value=1.2,Ui=!(Gi=!0),U.SCENE_CHILDREN.remove(fi),U.SCENE_CHILDREN.add(vi),Xi("none","block","","none",".option-main")}),B()("body").on("click","#load-level",function(){B()("#load-level-panel").css("display","flex")}),B()("body").on("click","#close-load-level-panel",function(){B()("#load-level-panel").css("display","none")}),B()("body").on("click","#option-community-play",function(){B()(".main-option").css("display","none"),B()(".sub-option").css("display","grid")});var Zi="null";function Qi(e){for(var t=U.CANNON_BODIES_CONTINUOUS.length-1;0<=t;t--)U.CANNON_WORLD.remove(U.CANNON_BODIES_CONTINUOUS[t]);for(var i,t=U.LASERS.children.length-1;0<=t;t--)U.LASERS.remove(U.LASERS.children[t]);U.EXIT_DOOR.finished=!1,U.CORRIDOR_ENTER&&((i=(new b.Tap).load("./levels/signs/"+window.currentLevel+".webp")).colorSpace=b.er$,i.wrapS=i.wrapT=b.GJx,i.flipY=!1,U.CORRIDOR_ENTER.getObjectByName("sign").visible=!0,U.CORRIDOR_ENTER.getObjectByName("sign").material.map=i,U.CORRIDOR_ENTER.getObjectByName("sign").material.envMapIntensity=0,U.CORRIDOR_ENTER.getObjectByName("sign").scale.z=-1),window.chamberID||(B()("#chamber-name-to-save").val(Zi.substring(0,Zi.indexOf("_by_"))),B()("#author-name-to-save").val(Zi.split("_by_").pop().replace(".json","")));for(var n=[],t=0;t<U.ITEMS_ADDED.children.length;t++)if(U.ITEMS_ADDED.children[t].instanceMatrix)for(var o=0;o<U.ITEMS_ADDED.children[t].count;o++){var a=U.ITEMS_ADDED.children[t],r=new b.B69;r.scale.set(0,0,0),r.position.set(1e5,1e5,1e5),r.updateMatrix(),a.setMatrixAt(o,r.matrix),a.instanceMatrix.needsUpdate=!0,a.computeBoundingSphere()}else n.push(U.ITEMS_ADDED.children[t]);for(var s,t=0;t<U.PLANE_USER_DATA.length;t++)U.PLANE_USER_DATA[t].gelType&&(U.PLANE_USER_DATA[t].hasItem=!1,U.PLANE_USER_DATA[t].itemName=null,U.PLANE_USER_DATA[t].gelType=null,s=U.PLANE_USER_DATA[t].portal?16777215:8421504,U.PLANE_USER_DATA[t].planeColor=s,U.PLANE_LEVEL_INSTANCED.setColorAt(t,new b.Q1f(s)),-1<(s=U.GELS.indexOf(U.PLANE_USER_DATA[t])))&&U.GELS.splice(s,1);for(var l,t=0;t<n.length;t++)U.ITEMS_ADDED.remove(n[t]);for(l in U.STATS_UI={time:0,portals:0,steps:0},U.BOUNDING_BOX=[],U.PLATFORM_BODIES=[],U.FINISHED=!1,window.glass=[],U.BOX_BODY=[],U.ITEMS_COUNT=v(),U.TRIGGER_BOXES=[],U.SELECTED_ID=[],U.SELECTED_ID_ORANGE=[],U.SELECTED_COLOR=[],U.LASER_EMITTER=[],U.LASER_EMITTER_OBJ=[],U.LASER_EMITTER_LENGTH=0,U.LASER_EMITTER_BOUNDING_BOX=[],U.LASER_EMITTER_RAYCASTER=[],U.LASER_CUBE=null,U.TRACTOR_BEAM=[],U.TRACTOR_BEAM_BOUNDING_BOX=[],U.TRACTOR_BEAM_RAYCASTER=[],U.TRACTOR_BEAM_LENGTH=0,U.LIGHT_BRIDGE_RAYCASTER=[],U.LIGHT_BRIDGE_CLONE=[],U.LIGHT_BRIDGE_COLLIDER_CLONE=[],U.LASER_FIELD_RAYCASTER=[],U.FIZZLER_RAYCASTER=[],U.GLASS_RAYCASTER=[],U.CAMERA_OBJ_HORIZONTAL=[],U.CAMERA_OBJ_VERTICAL=[],U.GOO_PLANES=[],U.GOO_BOXES=[],U.FAITH_PLATE_TO_ROTATE=[],U.FAITH_PLATE_CONTACT_BOX=[],U.DOORS=[],U.RADIO_MUSIC=[],U.CAMERAS=[],U.CANNON_BODIES=[],U.CANNON_BODIES_CONTINUOUS=[],U.CONNECTIONS=[],U.GLASS_PANELS=[],U.BLOCK_PORTAL=[],U.LOADED_CONNECTIONS=[],U.PORTAL_GUN_BOX=[],U.WALL_BODIES=[],U.ACTIVATED=[],U.SOUNDS_FPS=[],U.LASER_EMITTER_PORTAL_CLONES=[],U.DYNAMIC_BODIES=[],U.LASER_TRIGGERS=[],U.CUSTOM_GRAVITY=[],U.ANGLED_PANELS=[],U.PAINTING_GUN_MODE=[],U.DYMANIC_ITEMS)for(t=0;t<U.DYMANIC_ITEMS[l].length;t++)U.DYMANIC_ITEMS[l][t]=[];U.PLANE_USER_DATA=e;for(var E,c=new b.B69,_=[],t=0;t<e.length;t++)e[t].exists?(c.rotation.copy(e[t].rotation),c.position.copy(e[t].position),c.scale.set(1,1,1),c.updateMatrix(),U.PLANE_LEVEL_INSTANCED.setMatrixAt(t,c.matrix),U.PLANE_LEVEL_INSTANCED.setVisibilityAt(t,!0),e[t].portal?U.PLANE_LEVEL_INSTANCED.setColorAt(t,(new b.Q1f).setHex(16777215)):U.PLANE_LEVEL_INSTANCED.setColorAt(t,(new b.Q1f).setHex(8421504)),E=8421504,e[t].portal&&(E=16777215),e[t].planeColor=E):U.PLANE_LEVEL_INSTANCED.setVisibilityAt(t,!1),"exitDoor"==e[t].itemName?(U.EXIT_DOOR.position.set(e[t].position.x,e[t].position.y,e[t].position.z),U.EXIT_DOOR.rotation.copy(e[t].rotation),U.EXIT_DOOR.userData=e[t].item,U.EXIT_DOOR.userData.connections=0,U.EXIT_DOOR.userData.buttons=0,U.EXIT_DOOR.userData.played=!1,e[t].item=U.EXIT_DOOR,bi(e[t].item.userData,!1),Ln(e[t])):"enterDoor"==e[t].itemName?(U.ENTER_DOOR.position.set(e[t].position.x,e[t].position.y,e[t].position.z),U.ENTER_DOOR.rotation.copy(e[t].rotation),U.ENTER_DOOR.userData=e[t].item,e[t].item=U.ENTER_DOOR,Ln(e[t])):"window"==e[t].itemName?(U.OBSERVATION_ROOM_IMG.position.set(e[t].position.x,e[t].position.y,e[t].position.z),U.OBSERVATION_ROOM_IMG.rotation.copy(e[t].rotation),U.OBSERVATION_ROOM_IMG.userData=e[t].item,e[t].item=U.OBSERVATION_ROOM_IMG):"gel"==e[t].itemName&&we(e[t],e[t].gelType,e[t].planeColor,e[t].id_instanced),e[t].hasGoo=!1;U.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,U.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),window.totalItemsToLoad=0,window.totalItemsLoaded=0,window.gooToLoad=[];for(t=0;t<e.length;t++)e[t].exists&&e[t].hasItem&&"gel"!=e[t].itemName&&("exitDoor"!=e[t].itemName.split("-")[0]&&"enterDoor"!=e[t].itemName.split("-")[0]&&"window"!=e[t].itemName.split("-")[0]&&"dispenser"!=e[t].itemName.split("-")[0]&&"goo"!=e[t].itemName.split("-")[0]?window.totalItemsToLoad++:"goo"==e[t].itemName.split("-")[0]&&window.gooToLoad.push(e[t]));for(var d,t=0;t<e.length;t++)e[t].exists&&e[t].hasItem&&"gel"!=e[t].itemName&&"exitDoor"!=e[t].itemName.split("-")[0]&&"enterDoor"!=e[t].itemName.split("-")[0]&&"window"!=e[t].itemName.split("-")[0]&&"dispenser"!=e[t].itemName.split("-")[0]&&"goo"!=e[t].itemName.split("-")[0]&&(d=e[t].state,In(e[t],!0),e[t].state=d,e[t].trigger)&&_.push(e[t]);for(t=0;t<window.checkers.instances.length;t++)window.checkers.instances[t].visible=!1;for(t=U.LINES.children.length-1;0<=t;t--)U.LINES.remove(U.LINES.children[t])}B()("#input-level").on("change",function(e){window.chamberID=null,U.LOADED_LEVEL=!1;var t,i,e=e.target.files[0],e=(Zi=e.name,(window.URL||window.webkitURL).createObjectURL(e));e=e,t=function(e){e=JSON.parse(e);B()("#portal-gun-select").val(e[0][0]).change(),B()("#ambient-sound-select").val(e[0][1]).change(),Qi(e[1])},(i=new XMLHttpRequest).overrideMimeType("application/json"),i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&"200"==i.status&&t(i.responseText)},i.send(null)}),window.totalItemsToLoad=0,window.totalItemsLoaded=0;var Ji=e(47),Ki=(U.SELECTED_FOR_BLOOM=new Ji.LN,!1);let $i=function(){var e=new b.YJl,t=(e.visible=!1,new b.$p8(4210752)),t=(e.add(t),new b.nCl(16777215,20));return t.name="spotLightMain",t.position.set(-1,0,-2),t.angle=Math.PI/3,t.penumbra=1,t.decay=1,t.distance=0,t.castShadow=!0,U.MOBILE?(t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048):(t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024),t.shadow.camera.near=1,t.shadow.camera.far=500,t.shadow.focus=1,t.shadow.bias=0,U.SPOTLIGHT=t,U.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select")||e.add(t),e};var en=0;function tn(e,t){if(0!=e.length){t.polygonOffset=!0;var i=new b.bdM(t.polygonOffsetFactor=2,2),n=(i.computeBoundsTree(),new b.ZLX(i.clone(),t,e.length)),o=(n.castShadow=!0,n.receiveShadow=!0,n.name="Instanced-"+en,n.frustumCulled=!0,U.SCENE_FPS.add(n),en++,new b.B69);o.position.copy(U.OBSERVATION_ROOM_IMG.position),o.rotation.copy(U.OBSERVATION_ROOM_IMG.rotation),U.SCENE.add(o),o.translateX(-2);for(var a=0;a<e.length;a++){var r=new b.B69;("window"==e[a].itemName||e[a].position.x==Math.round(o.position.x)&&e[a].position.y==Math.round(o.position.y)&&e[a].position.z==Math.round(o.position.z))&&(r.scale.set(0,0,0),r.position.set(1e5,1e5,1e5),e[a].portal=!1),e[a].itemName&&e[a].itemName.includes("observation_room")&&(r.scale.set(0,0,0),r.position.set(1e5,1e5,1e5)),r.rotation.set(0,0,0),r.position.copy(e[a].position),r.rotation.copy(e[a].rotation),r.updateMatrix(),n.setMatrixAt(a,r.matrix)}U.SCENE.remove(o),n.instanceMatrix.needsUpdate=!0,n.computeBoundingSphere()}}window.instances=[],B()("body").on("click","#view-fps",function(){window.allowTest?(B()("#chamberName").css("opacity",1),B()("#chamberName").text(B()("#chamber-name-to-save").val()+"_by_"+B()("#author-name-to-save").val()),B()("#loading-parent").css("opacity",1),B()("#loading-parent").css("pointer-events","all"),(U.PLAYER_MODEL?on:_n)()):alert("The corridor enter and exit bounding box must be green!")});var nn=0;function on(v){Ft(),nn=0,function e(){nn+=1,B()(".introduction-text").addClass("loading-disabled"),B()("#p"+nn).removeClass("loading-disabled"),nn<4&&setTimeout(()=>{e()},3e3)}(),L.EDITOR.pause(),U.SCENE_CHILDREN.add(U.SCENE_FPS),U.ITEM_CUBE.visible=!1;var e=U.ENTER_DOOR.clone();e.translateZ(1),U.PLAYER.spawnPosition=e.position.clone(),B()("#container").css("filter","blur(3px)"),B()(".img").addClass("image"),U.FLASH.visible=!0,G("audio-portal-ambient",U.PORTAL_AUDIO[0],!1,!0,!1,3,"sound"),G("audio-portal-ambient",U.PORTAL_AUDIO[1],!1,!0,!1,3,"sound"),setTimeout(()=>{"epic"!=localStorage.getItem("quality-select")||Ki||(Ki=!0,U.COMPOSER=new Ji.s0(U.RENDERER,{multisampling:Math.min(4,U.RENDERER.capabilities.maxSamples),frameBufferType:b.ix0}),U.COMPOSER.addPass(new Ji.AH(U.SCENE,U.MAIN_CAMERA)),(d=new Ji.AH(U.GUN_GROUP,U.PORTAL_GUN_CAMERA)).clearColor=new b.Q1f(1,1,1),d.clearAlpha=0,d.clearPass.enabled=!0,d.clearPass.color=!1,d.clearPass.camera=U.PORTAL_GUN_CAMERA,U.COMPOSER.addPass(d),d=new Ji.i4({mode:Ji.se.ACES_FILMIC,resolution:64,whitePoint:4,middleGrey:.6,minLuminance:.01,averageLuminance:.01,adaptationRate:1}),new Ji.d4(U.GUN,U.PORTAL_GUN_CAMERA,{intensity:20,mipmapBlur:!0,luminanceThreshold:.3,luminanceSmoothing:.2,radius:.618,resolutionScale:1}).selection=U.SELECTED_FOR_BLOOM,u=new Ji.bv({luminanceThreshold:1.1}),U.MOBILE?U.COMPOSER.addPass(new Ji.Vu(U.MAIN_CAMERA,d)):U.COMPOSER.addPass(new Ji.Vu(U.MAIN_CAMERA,d,u)));var e=[],t=[],i=[],n=[],o=[],a=[],r=[],s=[],l=[],E=[],c="enterDoor";U.ITEMS_ADDED.getObjectByName("spawn")&&(c="..");for(var _=0;_<U.PLANE_USER_DATA.length;_++)U.PLANE_USER_DATA[_].exists&&(U.PLANE_USER_DATA[_].item&&U.PLANE_USER_DATA[_].item.userData&&(U.PLANE_USER_DATA[_].item.userData.played=!1),U.PLANE_USER_DATA[_].itemName!=c)&&"exitDoor"!=U.PLANE_USER_DATA[_].itemName&&"gel"!=U.PLANE_USER_DATA[_].itemName&&(U.PLANE_USER_DATA[_].checked=!1,U.PLANE_USER_DATA[_].position.checked=!1,"front"==U.PLANE_USER_DATA[_].side?r.push(U.PLANE_USER_DATA[_]):"back"==U.PLANE_USER_DATA[_].side?s.push(U.PLANE_USER_DATA[_]):"right"==U.PLANE_USER_DATA[_].side?l.push(U.PLANE_USER_DATA[_]):"left"==U.PLANE_USER_DATA[_].side?E.push(U.PLANE_USER_DATA[_]):"down"==U.PLANE_USER_DATA[_].side?o.push(U.PLANE_USER_DATA[_]):"up"==U.PLANE_USER_DATA[_].side&&a.push(U.PLANE_USER_DATA[_]),(U.PLANE_USER_DATA[_].portal?"up"==U.PLANE_USER_DATA[_].side||"down"==U.PLANE_USER_DATA[_].side?i:e:"up"==U.PLANE_USER_DATA[_].side||"down"==U.PLANE_USER_DATA[_].side?n:t).push(U.PLANE_USER_DATA[_]));Fn(o,"down","z","x","y","x"),Fn(a,"up","z","x","y","x"),Fn(r,"front","y","x","z","x"),Fn(s,"back","y","x","z","x"),Fn(l,"right","y","z","x","z"),Fn(E,"left","y","z","x","z");var d=[5,85,5,5],u=Z(Q(e),d),A=(tn(u[0],U.MATERIAL_WALL_PORTAL),tn(u[1],U.MATERIAL_WALL_PORTAL2),tn(u[2],U.MATERIAL_WALL_PORTAL3),tn(u[3],U.MATERIAL_WALL_PORTAL4),d=[50,50],tn((u=Z(Q(t),d))[0],U.MATERIAL_WALL_NON_PORTAL),tn(u[1],U.MATERIAL_WALL_NON_PORTAL2),tn(i,U.MATERIAL_FLOOR_PORTAL),tn(n,U.MATERIAL_FLOOR_NON_PORTAL),G("audio-door",U.EXIT_DOOR,!1,!1,!0,8,"sound"),G("audio-door",U.ENTER_DOOR,!1,!1,!0,8,"sound"),U.UNIFORMS_LASER_FIELD.fade=1,U.MATERIAL_TRACTOR_BEAM.depthWrite=!1,U.MATERIAL_TRACTOR_BEAM_REVERSE.depthWrite=!1,U.ENTER_DOOR.children[0].rotation.z+=Math.PI,U.RENDERER.setPixelRatio(window.devicePixelRatio*U.PIXEL_RATIO),localStorage.getItem("option-stats")&&B()("#option-stats").prop("checked","true"==localStorage.getItem("option-stats")),localStorage.getItem("fov-val-range")&&B()("#fov-val-range").val(localStorage.getItem("fov-val-range")).trigger("input"),localStorage.getItem("mouse-val-range")&&B()("#mouse-val-range").val(localStorage.getItem("mouse-val-range")).trigger("input"),localStorage.getItem("quality-select")&&B()("#quality-select").val(localStorage.getItem("quality-select")).change(),U.ENTER_DOOR.cube.clone()),p=new b.Pq0,m=(U.ENTER_DOOR.cube.getWorldPosition(p),new b.PTz),N=(U.ENTER_DOOR.cube.getWorldQuaternion(m),A.position.copy(p),A.quaternion.copy(m),new b.NRn),p=(N.setFromObject(A),U.ENTER_DOOR.box3=N,setTimeout(()=>{v&&G("audio-repulsion",U.PLAYER,!1,!1,!0,20,"soundRepulsion"),an()},500),U.CONTROLS.enabled=!1,U.ROOM.visible=!1,U.SCENE.environment=null,U.LIGHT_GROUP.visible=!0,U.OBSERVATION_ROOM.visible=!0,U.SCENE.getObjectByName("window").visible=!1,U.ENTER_DOOR.add(U.CORRIDOR_ENTER),U.OBSERVATION_ROOM.position.copy(U.OBSERVATION_ROOM_IMG.position),U.OBSERVATION_ROOM.rotation.copy(U.OBSERVATION_ROOM_IMG.rotation),(U.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select"))&&!window.playerState||(U.SCENE_FPS.add(U.GUN_CLONE),U.SCENE_FPS.add(U.GUN_CLONE2)),U.GUN.children[0].children[0].add(U.LIGHTNIN_STRIKE_1,U.LIGHTNIN_STRIKE_2,U.LIGHTNIN_STRIKE_3),U.GUN.visible=!0,U.GUN_SPHERE.material=U.MATERIAL_GUN,U.GUN_CYLINDER.material=U.MATERIAL_GUN,new b.Pq0);U.CORRIDOR_ENTER.getObjectByName("spawnElevator").getWorldPosition(p),U.PLAYER.position.copy(p);for(var T,R,O,I,D=0;D<U.GOO_PLANES.length;D++)U.GOO_PLANES[D].item.visible=!1;for(zn(U.CORRIDOR_ENTER,!1),x(U.DYMANIC_ITEMS.dispenser,"dispenser",0,1),x(U.DYMANIC_ITEMS.dispenser,"dispenser",0,2),x(U.DYMANIC_ITEMS.dispenser,"dispenser",0,3),x(U.DYMANIC_ITEMS.dispenser,"dispenser",0,4),x(U.DYMANIC_ITEMS.cube,"cube",5),x(U.DYMANIC_ITEMS.cube_2,"cube_2",5),x(U.DYMANIC_ITEMS.scale_cube,"scale_cube",5),x(U.DYMANIC_ITEMS.sphere,"sphere",5),x(U.DYMANIC_ITEMS.gel_gun_blue,"gel_gun_blue",0),x(U.DYMANIC_ITEMS.gel_gun_orange,"gel_gun_orange",0),x(U.DYMANIC_ITEMS.gel_gun_white,"gel_gun_white",0),x(U.DYMANIC_ITEMS.pedestal_button,"pedestal_button",0),x(U.DYMANIC_ITEMS.radio,"radio",5),x(U.DYMANIC_ITEMS.button_weight,"button_weight",0),x(U.DYMANIC_ITEMS.button_box,"button_box",0,1),x(U.DYMANIC_ITEMS.button_box,"button_box",0,2),x(U.DYMANIC_ITEMS.button_box,"button_box",0,3),x(U.DYMANIC_ITEMS.button_box,"button_box",0,4),x(U.DYMANIC_ITEMS.button_sphere,"button_sphere",0,1),x(U.DYMANIC_ITEMS.button_sphere,"button_sphere",0,2),x(U.DYMANIC_ITEMS.button_sphere,"button_sphere",0,3),x(U.DYMANIC_ITEMS.button_sphere,"button_sphere",0,4),x(U.DYMANIC_ITEMS.ramp,"ramp",0),x(U.DYMANIC_ITEMS.ramp_half,"ramp_half",0),x(U.DYMANIC_ITEMS.ramp_half2,"ramp_half2",0),x(U.DYMANIC_ITEMS.stairs,"stairs",0),x(U.DYMANIC_ITEMS.laser_cube,"laser_cube",5),x(U.DOORS,"door",0),x(U.DYMANIC_ITEMS.pellet_launcher,"pellet_launcher",0),x(U.DYMANIC_ITEMS.pellet_catcher,"pellet_catcher",0),x(U.DYMANIC_ITEMS.faith_plate,"faith_plate",0),x(U.DYMANIC_ITEMS.bed,"bed",0),x(U.DYMANIC_ITEMS.toilet,"toilet",0),x(U.DYMANIC_ITEMS.trash,"trash",5),x(U.DYMANIC_ITEMS.desk,"desk",0),x(U.DYMANIC_ITEMS.step,"step",0,1),x(U.DYMANIC_ITEMS.cabinet,"cabinet",0),x(U.DYMANIC_ITEMS.sign,"sign",0),x(U.DYMANIC_ITEMS.track_platforms,"track_platforms",0),x(U.DYMANIC_ITEMS.piston_platforms,"piston_platforms",0),Hn(U.ENTER_DOOR,"enter"),Hn(U.EXIT_DOOR,"exit"),x(U.DYMANIC_ITEMS.incinerator,"incinerator",0),D=0;D<U.DYMANIC_ITEMS.angled_panel.length;D++)0!=U.DYMANIC_ITEMS.angled_panel[D].length&&(T=U.DYMANIC_ITEMS.angled_panel[D].getObjectByName("panel"),U.ANGLED_PANELS.push(T),R=U.DYMANIC_ITEMS.angled_panel[D].getObjectByName("Cube"),O=new w.Box(new w.Vec3(1,1,.1)),(O=new w.Body({shape:O,mass:0,material:window.materialB})).name="panel",O.panel=T,I=new b.Pq0,R.getWorldPosition(I),O.position.copy(I),I=new b.PTz,R.getWorldQuaternion(I),O.quaternion.copy(I),O.collisionFilterGroup=U.CGROUP_DYNAMIC,O.collisionFilterMask=U.CGROUP_ALL,U.CANNON_BODIES.push(O),U.CANNON_WORLD.addBody(O),T.body=O);z(U.DYMANIC_ITEMS.fizzler,"audio-fizzler"),z(U.DYMANIC_ITEMS.laser_field,"audio-fizzler"),z(U.DYMANIC_ITEMS.tractor_beam,"audio-tractor-beam");for(var L=0;L<U.DYMANIC_ITEMS.tractor_beam.length;L++)0!=U.DYMANIC_ITEMS.tractor_beam[L].length&&U.TRACTOR_BEAM_LENGTH++;for(L=0;L<U.DYMANIC_ITEMS.laser_emitter.length;L++)0!=U.DYMANIC_ITEMS.laser_emitter[L].length&&U.LASER_EMITTER_LENGTH++;U.SCENE.traverse(e=>{e.frustumCulled=!0});m=U.ITEMS_ADDED.getObjectByName("light");m&&(m.material.color=new b.Q1f(2,2,2));for(var g,S,h=0;h<U.DYMANIC_ITEMS.light.length;h++)U.DYMANIC_ITEMS.light[h].id&&(S=new b.bdM(1,1),g=new b._4j({side:b.$EB,emissive:new b.Q1f(1,1,1),emissiveIntensity:2}),(S=new b.eaF(S,g)).position.copy(U.DYMANIC_ITEMS.light[h].position),S.rotation.copy(U.DYMANIC_ITEMS.light[h].rotation),S.rotateX(-Math.PI/2),S.scale.set(.2,2,2),S.translateZ(.025),U.SCENE_FPS.add(S));for(var C,y,h=0;h<U.ITEMS_ADDED.children.length;h++)U.ITEMS_ADDED.children[h].name.includes("observation_room")&&(U.ITEMS_ADDED.children[h].visible=!1,(C=U.OBSERVATION_ROOM_HALF.clone()).visible=!0,U.SCENE_FPS.add(C),C.position.copy(U.ITEMS_ADDED.children[h].position),C.rotation.copy(U.ITEMS_ADDED.children[h].rotation),C.getObjectByName("pointLight")&&(C.getObjectByName("pointLight").color=new b.Q1f(U.ITEMS_ADDED.children[h].userData.lightColor)),y=U.SPOTLIGHT.clone(),C.add(y),C.getObjectByName("pointLight")&&(y.color=C.getObjectByName("pointLight").color),y.intensity=5,y.distance=12,y.position.set(0,-1,-.5),y.target=C.getObjectByName("targetLight"));U.FLASH.visible=!1;for(var M=0;M<U.LIGHT_BRIDGE_RAYCASTER.length;M++)U.BLOCK_PORTAL.push(U.LIGHT_BRIDGE_RAYCASTER[M].item.continuous);for(M=0;M<U.LASER_FIELD_RAYCASTER.length;M++)U.BLOCK_PORTAL.push(U.LASER_FIELD_RAYCASTER[M].item.continuous);for(M=0;M<U.FIZZLER_RAYCASTER.length;M++)U.BLOCK_PORTAL.push(U.FIZZLER_RAYCASTER[M].item.continuous);for(M=0;M<U.GLASS_RAYCASTER.length;M++)U.GLASS_RAYCASTER[M].item.userData.grid||U.BLOCK_PORTAL.push(U.GLASS_RAYCASTER[M].item.continuous);for(M=0;M<U.DOORS.length;M++)U.BLOCK_PORTAL.push(U.DOORS[M].children[1].children[0]),U.BLOCK_PORTAL.push(U.DOORS[M].children[1].children[1]);U.RENDERER.renderLists.dispose(),U.PORTAL_GUN_INITIATE_HOLDER=U.PORTAL_GUN_INITIATE,"none"==U.PORTAL_GUN_INITIATE?(U.GUN.children[0].visible=!1,U.GUN_CLONE.children[0].visible=!1,U.GUN_CLONE2.children[0].visible=!1,document.getElementById("reticle-img").src="./assets/textures/crosshairNull.png",document.getElementById("reticle-img").style.filter="invert(1)"):(U.GUN.children[0].visible=!0,U.GUN_CLONE.children[0].visible=!0,U.GUN_CLONE2.children[0].visible=!0,document.getElementById("reticle-img").style.filter="none","left"==U.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalBlue.png":"right"==U.PORTAL_GUN_INITIATE?document.getElementById("reticle-img").src="./assets/ui/mobile/portalOrange.png":document.getElementById("reticle-img").src="./assets/textures/crosshairNone.png");for(var P=[],f=0;f<U.PORTAL_GUN_BOX.length;f++)U.PORTAL_GUN_BOX[f].parent&&((N=new b.NRn).setFromObject(U.PORTAL_GUN_BOX[f]),N.item=U.PORTAL_GUN_BOX[f],P.push(N));U.PORTAL_GUN_BOX=P,U.FPS_MODE=!0,U.GROUP_LINE_TRAGECTORY.visible=!1,(U.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select"))&&(U.SCENE.environment=U.ENV_MAP),window.checkers.material.envMap=U.ENV_MAP,U.ITEMS_ADDED.getObjectByName("spawn")&&(U.CORRIDOR_ENTER.visible=!1,U.ITEMS_ADDED.getObjectByName("spawn").visible=!1,U.PLAYER.spawnPosition=U.ITEMS_ADDED.getObjectByName("spawn").position.clone(),U.ENTER_DOOR.visible=!1,U.PLAYER.position.copy(U.PLAYER.spawnPosition),setTimeout(()=>{mt(!0)},5e3))},500)}function an(){U.STATS.dom.style.display="block";for(var e=0;e<U.CONNECTIONS.length;e++)U.CONNECTIONS[e].line.visible||(window.checkers.instances[U.CONNECTIONS[e].checker].visible=!1);for(var t=0;t<U.BOUNDING_BOX.length;t++)U.BOUNDING_BOX[t].platform.material.color=new b.Q1f(16777215),U.BOUNDING_BOX[t].platform.material.emissive=new b.Q1f(0,1.5,0),U.BOUNDING_BOX[t].platform.material.transparent=!1,U.BOUNDING_BOX[t].platform.scale.x=.1,U.BOUNDING_BOX[t].platform.scale.z=.1;U.ENTER_DOOR.getObjectByName("trigger").visible=!1,U.EXIT_DOOR.getObjectByName("trigger").visible=!1,Me(),U.DEBUGGER_GROUP.visible=!0,U.MAIN_CAMERA.lookAt(U.ENTER_DOOR.position),U.PAUSED=!1,U.CORRIDOR_ENTER.visible=!0,setTimeout(()=>{U.PAUSED=!0},100),B()("#ui").css("display","none"),B()("#reticle").css("display","flex"),B()("#blocker").css("display","block"),B()("#blocker").css("pointer-events","all"),B()("#loading-parent").css("opacity",0),B()("#loading-parent").css("pointer-events","none"),U.MOBILE&&B()("#mobile-controls").css("display","block"),window.loaded=!0}U.SCENE_FPS=new b.YJl;var rn=0,sn=0,ln=!1;var En=new i.Z;En.setDecoderPath("draco/"),En.preload();let T=(new _i.B).setPath("./assets/3ds/");async function cn(e,s,l,E,c,_,d,u,A,p,t,i,n,m){var o=new b.KPJ,a=new _i.B(o).setPath("./assets/3ds/medium");a.setDRACOLoader(En),o.onStart=function(e,t,i){B()("#loading-parent").css("opacity",1),B()("#loading-parent").css("pointer-events","all")},o.onLoad=function(){var e;rn<3?3==++rn&&((e=new b.bdM(2,2)).computeBoundsTree(),U.PLANE_LEVEL_INSTANCED=new ie.t9(e,U.MATERIAL_PORTAL_EDITOR),U.PLANE_LEVEL_INSTANCED.sortObjects=!0,U.PLANE_LEVEL_INSTANCED.customSort=(0,ie.nR)(U.PLANE_LEVEL_INSTANCED),U.PLANE_LEVEL_INSTANCED.addInstances(U.BUDGET,(e,t)=>{e.visible=!1}),U.PLANE_LEVEL_INSTANCED.raycastOnlyFrustum=!0,U.PLANE_LEVEL_INSTANCED.computeBVH(),U.PLANE_LEVEL_INSTANCED.frustumCulled=!0,U.PLANE_LEVEL_INSTANCED.castShadow=!1,U.PLANE_LEVEL_INSTANCED.receiveShadow=!1,U.PLANE_LEVEL_INSTANCED.name="cube-parent",U.CUBES.add(U.PLANE_LEVEL_INSTANCED),Ci(-1,-1,0,"x","z","y",6,8,"down",new b.Pq0(-Math.PI/2,0,0),new b.Pq0(0,0,0)),Ci(-1,-1,8,"x","z","y",6,8,"up",new b.Pq0(Math.PI/2,0,0),new b.Pq0(Math.PI,0,0)),Ci(-1,-1,0,"x","y","z",4,8,"front",new b.Pq0(0,0,0),new b.Pq0(Math.PI/2,0,0)),Ci(-1,-1,12,"x","y","z",4,8,"back",new b.Pq0(0,Math.PI,0),new b.Pq0(-Math.PI/2,Math.PI,0)),Ci(-1,-1,16,"z","y","x",4,6,"right",new b.Pq0(0,-Math.PI/2,0),new b.Pq0(Math.PI/2,0,Math.PI/2)),Ci(-1,-1,0,"z","y","x",4,6,"left",new b.Pq0(0,Math.PI/2,0),new b.Pq0(Math.PI/2,0,-Math.PI/2)),U.PLANE_LEVEL_INSTANCED.instanceMatrix.needsUpdate=!0,U.PLANE_LEVEL_INSTANCED.computeBoundingSphere(),U.LOADED_LEVEL?Hi():(B()("#loading-parent").css("opacity",0),B()("#loading-parent").css("pointer-events","none"))):ln?2==++sn&&on(!(ln=!1)):(t&&(U.ITEM_HOLDED_NAME=s,U.DRAGGED_ITEM_ELEMENT=n,In(t,i)),U.LOADED_LEVEL||(B()("#loading-parent").css("opacity",0),B()("#loading-parent").css("pointer-events","none")))},o.onProgress=function(e,t,i){},a.load(e,async function(e){var t,i,n,o,a,r,e=e.scene;e.instanced=l,e.traverse(e=>{e.frustumCulled=!0}),l?((t=((e,t,i,n,o,a)=>{var r=e.children[0].geometry.clone();r.computeVertexNormals(),r.computeBoundsTree(),(r=new ie.t9(r,e.children[0].material.clone(),{createInstances:!0})).addInstances(a,(e,t)=>{e.visible=!1}),r.raycastOnlyFrustum=!0,r.computeBVH(),r.name=t,r.receiveShadow=!0,r.castShadow=!0,r.material.envMap=U.ENV_MAP,r.material.envMapIntensity=o,r.material.roughness=n,r.frustumCulled=!0,r.instanceMatrix.needsUpdate=!0,i&&U.INTERACTIVE.push(r),"laser_cube"==t&&((U.LASER_CUBE=r).material.transparent=!0,r.material.opacity=.9,r.material.roughness=0);for(var s=0;s<a;s++)U.DYMANIC_ITEMS[t].push([]);return U.ITEMS_ADDED.add(r),r})(e,s,E,c,_,m)).userData.wall=d,t.userData.ground=u,t.userData.ceiling=A,t.userData.trigger=p,E&&(t.scene=e.children[0],t.clone=e,t.clone.children[0].material.envMap=U.ENV_MAP,t.clone.children[0].material.envMapIntensity=.5,t.clone.children[0].material.roughness=.2)):"door"==s?((t=e).userData.connections=0,t.name="enterDoor",t.rotation.y=Math.PI,t.position.set(3,1,12),t.namePosition=t.position.x+"/"+t.position.y+"/"+t.position.z,U.ENTER_DOOR=t,U.SCENE_CHILDREN.add(t),n=new b.bdM(2,2),i=new b.V9B({color:16776960,side:2,visible:!1}),n=new b.eaF(n,i),t.add(n),i=new b.iNn(2,2,.1),n=new b.V9B({color:65280}),(i=new b.eaF(i,n)).visible=!1,t.add(i),(t.cube=i).translateZ(.3),t.traverse(e=>{e.userData.wall=!0,e.userData.ground=!1,e.userData.ceiling=!1,e.material&&(e.material.envMap=U.ENV_MAP,e.material.envMapIntensity=.5,e.name.includes("dif"))&&(e.material=new b.V9B,e.material.color=new b.Q1f(0))}),U.EXIT_DOOR=ri.o8(U.ENTER_DOOR),U.EXIT_DOOR.position.set(13,1,0),U.EXIT_DOOR.userData.buttons=0,U.EXIT_DOOR.userData.connections=0,U.EXIT_DOOR.name="exitDoor",U.EXIT_DOOR.rotation.y+=Math.PI,U.SCENE_CHILDREN.add(U.EXIT_DOOR),U.EXIT_DOOR.namePosition=U.EXIT_DOOR.position.x+"/"+U.EXIT_DOOR.position.y+"/"+U.EXIT_DOOR.position.z,(n=(new b.Tap).load("./assets/exit.jpg")).colorSpace=b.er$,i=new b.bdM(1,1),t=new b.V9B({map:n}),(n=new b.eaF(i,t)).position.set(-.6,.8,.16),n.scale.set(.8,.4,.8),U.EXIT_DOOR.add(n),i=new b.iNn(5.99,5.99,11.5),t=new b.V9B({color:65280,transparent:!0,opacity:.5}),(n=new b.eaF(i,t)).geometry.computeBoundingBox(),n.updateMatrixWorld(!0),n.name="trigger",n.position.set(0,0,-5.76),U.EXIT_DOOR.add(n),(i=n.clone()).material=new b.V9B({color:65280,transparent:!0,opacity:.5}),U.ENTER_DOOR.add(i),t=new b.bdM(2,2),(n=new b.eaF(t,U.MATERIAL_FIZZLER)).name="fizzler",n.translateZ(-.5),U.ENTER_DOOR.fizzler=n,U.ENTER_DOOR.add(n),i=n.clone(),U.EXIT_DOOR.fizzler=i,U.EXIT_DOOR.add(i)):"gun"==s?(n=e,U.GUN=new b.YJl,U.GUN.visible=!1,i=new b.YJl,U.GUN.add(i),U.GUN_CLONE=new b.YJl,i.add(n),(i=n.clone()).rotation.x=b.cj9.degToRad(10),i.position.set(-.05,.075,-.1),U.GUN_CLONE.add(i),U.GUN_CLONE2=U.GUN_CLONE.clone(),n.traverse(e=>{e.castShadow=!0,e.layers.mask=2,e.renderOrder=100,e.material&&(e.receiveShadow=!0,e.material.envMap=U.ENV_MAP,e.material.envMapIntensity=.5),"sphere"==e.name?(U.GUN_SPHERE=e,U.SELECTED_FOR_BLOOM.add(e)):"cylinder"==e.name?(U.GUN_CYLINDER=e,U.SELECTED_FOR_BLOOM.add(e)):"cube_4"==e.name?window.gun_holder=e:"cube_5"==e.name?U.PORTAL_GUN_FLASH=e:"gel_left"!=e.name&&"gel_right"!=e.name||(e.visible=!1,e.material=new b._4j,e.material.roughness=0,e.material.envMap=U.ENV_MAP,e.material.envMapIntensity=1)}),localStorage.getItem("portal_gun_color")&&(i=ee(localStorage.getItem("portal_gun_color")),n.getObjectByName("Object_6").material.color=new b.Q1f(i.r/255,i.g/255,i.b/255)),localStorage.getItem("portal_gun_roughness")&&(n.getObjectByName("Object_6").material.roughness=localStorage.getItem("portal_gun_roughness")),localStorage.getItem("portal_gun_metalness")&&(n.getObjectByName("Object_6").material.metalnessMap=null,n.getObjectByName("Object_6").material.metalness=localStorage.getItem("portal_gun_metalness")),U.GUN.name="GUN",U.GUN_GROUP.add(U.GUN),n.scale.set(.07,.07,.05),n.position.set(.007,-.01,-.0095),n.rotation.y=-.1,U.GUN_CLONE.scale.setScalar(.7),U.GUN_CLONE2.scale.setScalar(.7)):"window"==s?((r=e).traverse(e=>{var t,i;e.name.includes("Cube")&&(e.castShadow=!0,e.material=new b.V9B({color:new b.Q1f(0)})),"room_light"==e.name&&(t=new b.HiM(16777215,50,3),i=new b.Pq0,e.getWorldPosition(i),t.position.copy(i),t.translateY(-.2),U.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select")||r.add(t)),e.name.includes("image")&&(e.material.side=2,e.material.envMap=U.ENV_MAP,e.material.envMapIntensity=.5,e.material.roughness=.3)}),r.rotation.y=-Math.PI/2,r.position.set(16,6,6),r.visible=!1,r.name="OBSERVATION_ROOM",U.SCENE_CHILDREN.add(r),U.SPOTLIGHT.target=r.getObjectByName("lightTarget"),U.OBSERVATION_ROOM=r,U.OBSERVATION_ROOM.add(U.LIGHT_GROUP)):"corridor"==s?((a=(a=e).clone()).visible=!1,a.traverse(e=>{e.material&&(e.material.envMap=U.ENV_MAP,"lambert5"==e.material.name&&(e.material=new b.V9B),"back"==e.name&&(U.WALL_CORRIDOR_BACK=e),"spawn"==e.name)&&(e.name="spawnElevator")}),U.CORRIDOR_ENTER=a,U.CORRIDOR_ENTER.name="corridorEnter",U.ENTER_DOOR.add(U.CORRIDOR_ENTER)):"faith_plate"==s?((a=e).name="faith_plate",a.userData.wall=!1,a.userData.ground=!0,a.userData.ceiling=!0,a.visible=!1,U.ITEMS_ADDED.add(a),a.traverse(e=>{e.receiveShadow=!0,e.castShadow=!0,e.material&&(e.material.envMap=U.ENV_MAP,e.material.envMapIntensity=1,e.material.roughness=.2)})):"camera"==s?(o=e,T.load("/medium/items/camera2.glb",async function(e){window.cameraClone=e.scene.children[0]}),o.name="camera",o.visible=!1,o.userData.wall=!0,o.userData.ground=!1,o.userData.ceiling=!1,U.ITEMS_ADDED.add(o),o.traverse(e=>{e.receiveShadow=!0,e.castShadow=!0,e.material&&(e.material.envMap=U.ENV_MAP,e.material.envMapIntensity=.5,e.material.roughness=.2,"Sphere"==e.name)&&(e.material=new b.V9B,e.material.roughness=0,e.material.color=new b.Q1f(16187426))})):"portal_gun"==s?((o=e).traverse(e=>{e.material&&(e.material.envMap=U.ENV_MAP)}),o.name="portal_gun",o.visible=!1,U.ITEMS_ADDED.add(o)):"angled_panel"==s&&((e=e).name="angled_panel",e.userData.wall=!0,e.userData.ground=!0,e.userData.ceiling=!0,e.visible=!1,U.ITEMS_ADDED.add(e),e.traverse(e=>{e.name.includes("panel")&&e.material&&(e.material.side=2,e.material.envMap=U.ENV_MAP,e.material.envMapIntensity=.2,e.material.roughness=1),e.material&&(e.material.polygonOffset=!0,e.material.polygonOffsetFactor=2)}))})}function _n(){ln=!0;var e=T.loadAsync("/avatar/medium/chell.glb"),i=(cn("/items/window.glb","window",!1),cn("/items/corridor.glb","corridor",!1),U.PLAYER_ANIMATIONS={ANIM_STANDING_IDLE:T.loadAsync("/avatar/StandingIdle.glb"),ANIM_JUMP:T.loadAsync("/avatar/Jump.glb"),ANIM_STATIONARY_RUNNING:T.loadAsync("/avatar/StationaryRunning.glb"),ANIM_BACKWARD_RUNNING:T.loadAsync("/avatar/RunningBackward.glb"),ANIM_RIGHT_STRAFE:T.loadAsync("/avatar/RightStrafe.glb"),ANIM_LEFT_STRAFE:T.loadAsync("/avatar/LeftStrafe.glb"),ANIM_FALLING_IDLE:T.loadAsync("/avatar/FallingIdle.glb"),ANIM_STANDING_IDLE_NO_GUN:T.loadAsync("/avatar/noGun/StandingIdle.glb"),ANIM_JUMP_NO_GUN:T.loadAsync("/avatar/noGun/Jump.glb"),ANIM_STATIONARY_RUNNING_NO_GUN:T.loadAsync("/avatar/noGun/StationaryRunning.glb"),ANIM_BACKWARD_RUNNING_NO_GUN:T.loadAsync("/avatar/noGun/RunningBackward.glb"),ANIM_RIGHT_STRAFE_NO_GUN:T.loadAsync("/avatar/noGun/RightStrafe.glb"),ANIM_LEFT_STRAFE_NO_GUN:T.loadAsync("/avatar/noGun/LeftStrafe.glb")},e.then(e=>{e=e.scene;e.scale.setScalar(.015),U.MIXERS=new b.Iw4(e),e.traverse(e=>{e.castShadow=!0,e.material&&(e.material.envMap=U.ENV_MAP,e.material.envMapIntensity=.5,e.material.transparent=!0,e.material.opacity=0,e.material.colorWrite=!1,e.material.depthWrite=!1,e.material.side=0),e.isBone&&("wrist_R"==e.name?window.hand=e:"elbow_L"==e.name?window.handLeft=e:"neck1"==e.name&&(window.neck=e))}),U.PLAYER_MODEL=e,U.PLAYER_MODEL_CLONE=ri.o8(U.PLAYER_MODEL),U.MIXERS_CLONE=new b.Iw4(U.PLAYER_MODEL_CLONE),U.PLAYER_MODEL.position.y=1e5,U.PLAYER_MODEL_CLONE.position.y=1e5,(U.MOBILE||"epic"!=localStorage.getItem("quality-select")&&"high"!=localStorage.getItem("quality-select"))&&!window.playerState||(U.SCENE_CHILDREN.add(U.PLAYER_MODEL),U.SCENE_CHILDREN.add(U.PLAYER_MODEL_CLONE)),U.PLAYER_MODEL.animationActions={},U.PLAYER_MODEL_CLONE.animationActions={},U.PLAYER_MODEL.modelReady=!0}).then(()=>{var e=[];for(let i in U.PLAYER_ANIMATIONS){var t=U.PLAYER_ANIMATIONS[i];t.then(e=>{var t=U.MIXERS.clipAction(e.animations[0]),t=(U.PLAYER_MODEL.animationActions[i]=t,U.MIXERS_CLONE.clipAction(e.animations[0]));U.PLAYER_MODEL_CLONE.animationActions[i]=t}),e.push(t)}Promise.all(e).then(()=>U.PLAYER_MODEL.modelReady=!0)}),b.$Kf.prototype.update);b.$Kf.prototype.update=function(e,t){i.call(this,e,t),this.updateMatrixWorld(!0)}}T.setDRACOLoader(En),T.load("/medium/items/WINDOW_IMG.glb",e=>{e.scene.traverse(e=>{var t;e.userData.wall=!0,e.userData.ground=!1,e.userData.ceiling=!1,e.material&&(t=e.material.map,e.material=new b.V9B,e.material.map=t,e.material.polygonOffset=!0,e.material.polygonOffsetFactor=-1)}),e.scene.rotation.y=-Math.PI/2,e.scene.position.set(16,8,8),e.scene.translateY(-1),e.scene.translateX(-1),e.scene.name="window",U.SCENE_CHILDREN.add(e.scene),U.OBSERVATION_ROOM_IMG=e.scene,U.OBSERVATION_ROOM_IMG.visible=!1}),U.LIGHT_PORTAL_1=new b.HiM(new b.Q1f(1,.25,0),0,2),U.LIGHT_PORTAL_0=new b.HiM(new b.Q1f(0,.3,1),0,2),U.FLASH=new b.HiM(16711680,10),localStorage.getItem("quality-select");var dn,un=0;for(dn in U.ITEMS_COUNT)B()("#"+dn).parent().children("span").text(U.ITEMS_COUNT[dn].max);function An(e,t){if(window.changingPosition)for(var i,n,o=0;o<U.CONNECTIONS.length;o++)if(U.CONNECTIONS[o].from==window.changingPositionPlane){U.CONNECTIONS[o].from=e,U.SCENE_CHILDREN.remove(U.CONNECTIONS[o].line);var a=ci(U.CONNECTIONS[o].from,U.CONNECTIONS[o].to.position);U.SCENE_CHILDREN.add(a),U.CONNECTIONS[o].line=a}else if(U.CONNECTIONS[o].to==window.changingPositionPlane){U.CONNECTIONS[o].to=e,t&&(U.CONNECTIONS[o].to.item.userData.connections+=1);for(var r=0;r<10;r++)if(!(n=e.item.checkersSlots[r]).visible){n.visible=!0,i=n.position,window.checkers.instances[U.CONNECTIONS[o].checker].position.copy(i),window.checkers.instances[U.CONNECTIONS[o].checker].updateMatrix(),window.checkers.computeBoundingSphere(),U.CONNECTIONS[o].clone=n;break}U.SCENE_CHILDREN.remove(U.CONNECTIONS[o].line);a=ci(U.CONNECTIONS[o].from,i);U.SCENE_CHILDREN.add(a),U.CONNECTIONS[o].line=a}}r=new b.Tap;let pn=r.load("./assets/textures/trigger_border.png"),mn=r.load("./assets/textures/trigger_connection.png"),Nn=r.load("./assets/textures/trigger_save.png"),Tn=r.load("./assets/textures/trigger_voice.png"),Rn=r.load("./assets/textures/trigger_audio.png"),On=r.load("./assets/textures/falling.png");async function In(e,t){if(t&&(U.ITEM_HOLDED_NAME=e.itemName.split("-")[0],U.DRAGGED_ITEM_ELEMENT=B()("#"+U.ITEM_HOLDED_NAME)),U.ITEMS_ADDED.getObjectByName(U.ITEM_HOLDED_NAME)||"glass"==U.ITEM_HOLDED_NAME||"trigger_area"==U.ITEM_HOLDED_NAME||"trigger_save"==U.ITEM_HOLDED_NAME||"trigger_voice"==U.ITEM_HOLDED_NAME||"trigger_audio"==U.ITEM_HOLDED_NAME||"spawn"==U.ITEM_HOLDED_NAME||"goo"==U.ITEM_HOLDED_NAME||"door"==U.ITEM_HOLDED_NAME){if(U.ITEM_CUBE.place||t)if("goo"==U.ITEM_HOLDED_NAME||t&&"goo"==e.itemName)(r=t?e:U.PLANE_USER_DATA[e[0].instanceId]).hasGoo?(B()("#alert").css("opacity","1"),B()("#alert span").text("Already has goo!"),setTimeout(()=>{B()("#alert").css("opacity","0")},5e3)):(r.hasItem=!0,r.hasGoo=!0,r.itemName="goo",E=new b.iNn(1.98,2,1.98),d=((E=new b.eaF(E,new b.V9B({color:new b.Q1f("rgb(150,75,0)"),side:2,transparent:!0,opacity:.5,map:pn}))).position.copy(r.position),E.translateY(1),U.SCENE.add(E),r.item=E,new b.bdM(2,2)),a=new b.V9B({color:new b.Q1f("rgb(150,75,0)"),map:On,side:2,depthTest:!1,transparent:!0}),d=new b.eaF(d,a),E.add(d),He(r));else{var i,n,o;if(U.CONNECTING){var a=U.PLANE_USER_DATA[e[0].instanceId];U.SELECTED_FOR_CONNECTION.trigger=a,U.SELECTED_FOR_CONNECTION.normal=e[0].normal,Zt(U.SELECTED_FOR_CONNECTION.position,a.position,e[0])}else{if(t)o=(r=e).item;else if("cube"==U.ITEM_HOLDED_NAME||"cube_2"==U.ITEM_HOLDED_NAME||"sphere"==U.ITEM_HOLDED_NAME||"laser_cube"==U.ITEM_HOLDED_NAME||"scale_cube"==U.ITEM_HOLDED_NAME){for(var r=U.PLANE_USER_DATA[e[0].instanceId],s=0,l=2;s<100;s++,l+=2)if(0<(A=g(r.position.x+"/"+(r.position.y+l)+"/"+r.position.z)).length){r=A[0];break}}else(r=U.PLANE_USER_DATA[e[0].instanceId]).hasItem=!1;if(!r.hasItem&&!r.continuousEnding||t){if("spawn"==U.ITEM_HOLDED_NAME?(E=new b.qFE(.75,2,8),d=new b.V9B({color:16711680}),n=new b.eaF(E,d)):U.ITEM_HOLDED_NAME.includes("trigger")?(a=new b.iNn(1.98,2,1.98),(E=new b.eaF(a,new b.V9B({color:new b.Q1f(B()("#"+U.ITEM_HOLDED_NAME).data("color")),side:2,transparent:!0,opacity:.5,map:pn}))).userData.multipleTrigger=!1,E.userData.triggerVisibility=!0,E.userData.soundEffect=null,E.userData.soundEffectLoop=!1,E.userData.link=null,"trigger_area"==U.ITEM_HOLDED_NAME?_=mn:"trigger_save"==U.ITEM_HOLDED_NAME?_=Nn:"trigger_voice"==U.ITEM_HOLDED_NAME?_=Tn:"trigger_audio"==U.ITEM_HOLDED_NAME&&(_=Rn),d=new b.bdM(1,1),a=new b.V9B({color:new b.Q1f(B()("#"+U.ITEM_HOLDED_NAME).data("color")),map:_,transparent:!0,side:2,opacity:.5,depthWrite:!1}),_=new b.eaF(d,a),E.add(_),n=E):"paint_gun"==U.ITEM_HOLDED_NAME?((n=U.PAINT_GUN.clone()).name="paint_gun",n.visible=!0):"glass"==U.ITEM_HOLDED_NAME?n=new b.B69:"camera"==U.ITEM_HOLDED_NAME?((n=U.ITEMS_ADDED.getObjectByName(U.ITEM_HOLDED_NAME).clone()).visible=!0,n.traverse(e=>{"horizontal"==e.name?U.CAMERA_OBJ_HORIZONTAL.push(e):"vertical"==e.name&&U.CAMERA_OBJ_VERTICAL.push(e)})):"faith_plate"==U.ITEM_HOLDED_NAME||"portal_gun"==U.ITEM_HOLDED_NAME?(n=U.ITEMS_ADDED.getObjectByName(U.ITEM_HOLDED_NAME).clone()).visible=!0:"observation_room"==U.ITEM_HOLDED_NAME?n=U.ITEMS_ADDED.getObjectByName(U.ITEM_HOLDED_NAME).clone():"door"==U.ITEM_HOLDED_NAME?(n=new b.YJl,d=new b.tcD(1,10),a=new b.V9B({color:new b.Q1f(0,2,5),transparent:!0,opacity:.5}),(_=new b.eaF(d,a)).rotation.x=-Math.PI/2,_.name="circle_rotation",n.add(_),_.translateZ(.01),(E=ri.o8(U.ENTER_DOOR)).remove(E.getObjectByName("trigger")),E.remove(E.getObjectByName("fizzler")),E.position.set(0,0,0),E.rotation.set(0,0,0),n.add(E),E.translateZ(-1),E.translateY(1),n.getObjectByName("portal_door_right_04").scale.set(1,1,1),n.getObjectByName("portal_door_left_06").scale.set(1,1,1)):"angled_panel"==U.ITEM_HOLDED_NAME?((n=U.ITEMS_ADDED.getObjectByName(U.ITEM_HOLDED_NAME).clone()).visible=!0,n.userData.angleTrigger=45):(i=U.ITEMS_ADDED.getObjectByName(U.ITEM_HOLDED_NAME),n=new b.B69),!(U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].count<U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].max))return B()("#alert").css("opacity","1"),B()("#alert span").text("Max Number of this item on the scene reached!"),void setTimeout(()=>{B()("#alert").css("opacity","0")},5e3);if(U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].count+=1,B()("#"+U.ITEM_HOLDED_NAME).parent().children("span").text(U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].max-U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].count),"piston_platforms"!=U.ITEM_HOLDED_NAME&&"track_platforms"!=U.ITEM_HOLDED_NAME||((d=new b.YJl).scale.y=0,U.ITEMS_ADDED.add(d),d.position.copy(r.position),a=new b.iNn(2,2,2),_=new b.eaF(a,new b._4j({color:new b.Q1f(0,2,0),envMap:U.ENV_MAP,emissiveIntensity:1,transparent:!0,opacity:.5})),"track_platforms"==U.ITEM_HOLDED_NAME&&("front"==r.side?(d.rotation.z=-Math.PI/2,d.translateZ(1)):"back"==r.side?(d.rotation.z=-Math.PI/2,d.translateZ(-1)):"left"==r.side?(d.rotation.x=Math.PI/2,d.translateX(1)):"right"==r.side&&(d.rotation.x=Math.PI/2,d.translateX(-1)),d.position.y+=.5),d.add(_),_.position.y=1.01,_.side=r.side,_.name=U.ITEM_HOLDED_NAME,n.platformBox=_,n.initialPosition=r.position,n.userData.isActive=!0,n.userData.loop=!0),"pellet_launcher"==U.ITEM_HOLDED_NAME&&(n.userData.isActive=!0),bn(r,!0,U.ITEM_HOLDED_NAME+"-"+un,n,"open",U.DRAGGED_ITEM_ELEMENT.data("rotate"),U.DRAGGED_ITEM_ELEMENT.data("floor"),U.DRAGGED_ITEM_ELEMENT.data("ceiling"),U.DRAGGED_ITEM_ELEMENT.data("walls"),U.DRAGGED_ITEM_ELEMENT.data("instanced"),U.ITEM_HOLDED_NAME,U.DRAGGED_ITEM_ELEMENT.data("allowconnection"),!1),n.position.copy(r.position),("camera"==U.ITEM_HOLDED_NAME||"track_platforms"==U.ITEM_HOLDED_NAME)&&"back"==r.side&&0==r.normal.y?n.rotation.set(r.normal.x,Math.PI,r.normal.z):n.rotation.set(r.normal.x,r.normal.y,r.normal.z),n.renderOrder=2,n.name=U.ITEM_HOLDED_NAME+"-"+un,"radio"!=U.ITEM_HOLDED_NAME&&"trash"!=U.ITEM_HOLDED_NAME||n.translateY(.5),"cube"==U.ITEM_HOLDED_NAME||"cube_2"==U.ITEM_HOLDED_NAME||"sphere"==U.ITEM_HOLDED_NAME||"laser_cube"==U.ITEM_HOLDED_NAME||"scale_cube"==U.ITEM_HOLDED_NAME){r.dispenser=!0,n.translateY(1);for(l=0;l<U.DYMANIC_ITEMS.dispenser.length;l++)if(0==U.DYMANIC_ITEMS.dispenser[l].length){U.DYMANIC_ITEMS.dispenser[l]=n,u=l;break}var E=U.ITEMS_ADDED.getObjectByName("dispenser"),c=new b.B69;c.position.copy(r.position);for(s=0,l=2;s<100;s++,l+=2)if(0<(A=g(r.position.x+"/"+(r.position.y+l)+"/"+r.position.z)).length){A[0].hasItem=!0,A[0].itemName="dispenser",A[0].item=c,A[0].isInstanced=!0,A[0].dispenserPosition=c.position,A[0].dispenserID=u,A[0].instancedName="dispenser",c.translateY(l);break}n.dispenserPosition=c.position,n.dispenserID=u,c.item=n,c.userData.id=u,!t||o.hasDispenser?c.scale.set(1,1,1):c.scale.set(0,0,0),c.updateMatrix(),E.setMatrixAt(u,c.matrix),1==c.scale.x&&E.setVisibilityAt(u,!0),E.instanceMatrix.needsUpdate=!0,E.computeBoundingSphere()}if(U.ITEM_HOLDED_NAME.includes("button")&&(a=new b.iNn(1,.5,1),d=new b.V9B({color:65280}),(_=new b.eaF(a,d)).position.copy(n.position),_.rotation.copy(n.rotation),(p=new b.NRn).setFromObject(_),"button_box"==r.instancedName?p.accept="cube-cube_2-laser_cube-scale_cube":"button_sphere"==r.instancedName?p.accept="sphere":"button_weight"==r.instancedName&&(p.accept="sphere-cube-player-laser_cube-cube_2-scale_cube"),r.box3=p,n.userData.connectedTo=[],n.userData.showLines=!0,U.LOADED_CONNECTIONS.push({data:o,item:r})),"laser_emitter"==U.ITEM_HOLDED_NAME?ce(n,!1,U.LASER_EMITTER_RAYCASTER):"laser_receiver"!=U.ITEM_HOLDED_NAME&&"laser_relay"!=U.ITEM_HOLDED_NAME&&"pellet_catcher"!=U.ITEM_HOLDED_NAME||(n.userData.connectedTo=[],U.LOADED_CONNECTIONS.push({data:o,item:r})),"incinerator"==U.ITEM_HOLDED_NAME&&(E=new b.Ho_(.7,.7,1,12),a=new b.V9B({color:16711680}),(d=new b.eaF(E,a)).position.copy(r.position),d.position.y+=.5,U.ITEMS_ADDED.add(d),n.trigger=d,(p=new b.NRn).setFromObject(d),p.accept="cube-cube_2-laser_cube-scale_cube",r.box3=p,n.userData.connectedTo=[],U.LOADED_CONNECTIONS.push({data:o,item:r}),d.position.y-=.4),n.initialPosition=n.position.clone(),n.initialRotation=n.rotation.clone(),"faith_plate"!=U.ITEM_HOLDED_NAME||t||Ut(n),"spawn"==U.ITEM_HOLDED_NAME)U.ITEMS_ADDED.add(n),n.translateY(1),n.rotation.x=-Math.PI,n.name="spawn";else if("angled_panel"==U.ITEM_HOLDED_NAME)U.DYMANIC_ITEMS.angled_panel.push(n),U.ITEMS_ADDED.add(n),n.getObjectByName("panel").hasPortal=100,n.translateY(.02);else if(U.ITEM_HOLDED_NAME.includes("trigger"))U.ITEMS_ADDED.add(n),n.translateY(1),(p=new b.NRn).setFromObject(n),p.accept="player",r.box3=p,n.userData.connectedTo=[],U.LOADED_CONNECTIONS.push({data:o,item:r}),U.TRIGGER_BOXES.push(r);else if("paint_gun"==U.ITEM_HOLDED_NAME)n.scale.set(1,1,1),n.position.y+=.65,U.ITEMS_ADDED.add(n),U.PORTAL_GUN_BOX.push(n);else if("glass"==U.ITEM_HOLDED_NAME)U.ITEMS_ADDED.add(n);else if("camera"==U.ITEM_HOLDED_NAME){n.translateY(.3);var _=new b.iNn(.6,.6,.6),E=new b.V9B({color:65280}),a=new b.eaF(_,E),d=(a.name="camera",a.visible=!1,new b.Pq0);n.children[1].getWorldPosition(d),d.y-=.25,a.position.copy(d),U.SCENE.add(a),(p=new b.NRn).setFromObject(a),n.box3=p,n.fixed=!0,(n.cube=a).item=n,U.CAMERAS.push(n),U.ITEMS_ADDED.add(n),n.initialPosition=n.position.clone()}else if("observation_room"==U.ITEM_HOLDED_NAME)U.ITEMS_ADDED.add(n);else if("faith_plate"==U.ITEM_HOLDED_NAME)n.translateY(.025),n.traverse(e=>{"launch"==e.name&&(n.ToRotate=e)}),U.DYMANIC_ITEMS.faith_plate.push(n),U.ITEMS_ADDED.add(n);else if("door"==U.ITEM_HOLDED_NAME)U.ITEMS_ADDED.add(n),U.DOORS.push(n);else if("portal_gun"==U.ITEM_HOLDED_NAME)U.ITEMS_ADDED.add(n),U.PORTAL_GUN_BOX.push(n);else{for(var u,l=0;l<U.DYMANIC_ITEMS[U.ITEM_HOLDED_NAME].length;l++)if(0==U.DYMANIC_ITEMS[U.ITEM_HOLDED_NAME][l].length){n.laser=!1,U.DYMANIC_ITEMS[U.ITEM_HOLDED_NAME][l]=n,u=l;break}if("dispenser"==U.ITEM_HOLDED_NAME)for(var A,s=0,l=2;s<100;s++,l+=2)if(0<(A=g(r.position.x+"/"+(r.position.y+l)+"/"+r.position.z)).length){n.translateY(l);break}"track_platforms"==U.ITEM_HOLDED_NAME&&n.translateZ(-.5),n.userData.id=u,n.userData.idInstanced=u,n.scale.set(1,1,1),n.updateMatrix(),n.initialPosition=n.position.clone(),i.setVisibilityAt(u,!0),i.setMatrixAt(u,n.matrix),r.isInstanced=!0,"gel_gun_blue"==U.ITEM_HOLDED_NAME?i.setColorAt(u,new b.Q1f(255)):"gel_gun_orange"==U.ITEM_HOLDED_NAME?i.setColorAt(u,new b.Q1f(16753920)):"gel_gun_white"==U.ITEM_HOLDED_NAME&&i.setColorAt(u,new b.Q1f(16777215)),i.computeBoundingSphere(),i.dispose(),i.instanceMatrix.needsUpdate=!0}if(un++,t){var _=n,E=o,d=i,p=r;if(_.userData.state=E.state,_.userData.buttons=0,_.userData.showLines=E.showLines,_.userData.connections=0,_.userData.opened=E.opened,_.userData.instancedName=E.instancedName,_.userData.planeInstancedId=E.planeInstancedId,_.userData.lightColor=E.lightColor,_.userData.pedestalInfinity=E.pedestalInfinity,_.userData.pedestalValue=E.pedestalValue,_.userData.friction=E.friction,_.userData.restitution=E.restitution,_.userData.multipleTrigger=E.multipleTrigger,_.userData.triggerVisibility=E.triggerVisibility,_.userData.soundEffectLoop=E.soundEffectLoop,_.userData.link=E.link,_.userData.rotationY=E.rotationY,_.userData.angle=E.angle,_.userData.isActive=E.isActive,_.userData.loop=E.loop,_.userData.link&&bi(_.userData,!1),"track_platforms"==U.ITEM_HOLDED_NAME||"piston_platforms"==U.ITEM_HOLDED_NAME)_.platformBox.parent.scale.y=E.scaleY,_.userData.scaleY=E.scaleY,ze(E.scaleY,p);else if("portal_gun"==U.ITEM_HOLDED_NAME)_.userData.state=E.state,_.rotation.y=_.userData.rotationY;else if("door"==U.ITEM_HOLDED_NAME)_.rotation.y=_.userData.rotationY;else if("angled_panel"==U.ITEM_HOLDED_NAME)"right"==p.side||"left"==p.side?_.rotation.x=_.userData.rotationY:_.rotation.y=_.userData.rotationY,_.getObjectByName("pivot2").rotation.x=Math.PI/180*_.userData.angle,_.userData.angleTrigger=E.angleTrigger;else if("pedestal_button"==U.ITEM_HOLDED_NAME||"light"==U.ITEM_HOLDED_NAME||"bed"==U.ITEM_HOLDED_NAME||"toilet"==U.ITEM_HOLDED_NAME||"desk"==U.ITEM_HOLDED_NAME||"cabinet"==U.ITEM_HOLDED_NAME||"sign"==U.ITEM_HOLDED_NAME||"portal_0"==U.ITEM_HOLDED_NAME||"portal_1"==U.ITEM_HOLDED_NAME||"incinerator"==U.ITEM_HOLDED_NAME||"step"==U.ITEM_HOLDED_NAME){_.userData.rotationY=E.rotationY;var p=U.ITEMS_ADDED.getObjectByName(U.ITEM_HOLDED_NAME),m=new b.B69;m.position.copy(_.position),m.rotation.copy(_.rotation),m.rotation.y=_.userData.rotationY,m.updateMatrix(),p.setMatrixAt(_.userData.id,m.matrix),p.instanceMatrix.needsUpdate=!0,p.computeBoundingSphere(),_.rotation.copy(m.rotation)}else if("cube"==U.ITEM_HOLDED_NAME||"cube_2"==U.ITEM_HOLDED_NAME||"sphere"==U.ITEM_HOLDED_NAME||"laser_cube"==U.ITEM_HOLDED_NAME||"scale_cube"==U.ITEM_HOLDED_NAME)_.userData.hasDispenser=E.hasDispenser,_.userData.state=E.state;else if("laser_field"==U.ITEM_HOLDED_NAME)_.userData.state=E.state,_.userData.triggers=E.triggers,R("laser_field",U.LASER_FIELD_RAYCASTER,_,d,!1),O(_,_.userData.triggers,B()("#laser-field-trigger"),"laser_field");else if("fizzler"==U.ITEM_HOLDED_NAME)_.userData.state=E.state,_.userData.triggers=E.triggers,R("fizzler",U.FIZZLER_RAYCASTER,_,d,!1),O(_,_.userData.triggers,B()("#laser-field-trigger"),"fizzler");else if("light_bridge"==U.ITEM_HOLDED_NAME)console.log(E.state),_.userData.state=E.state,_.userData.triggers=E.triggers,R("light_bridge",U.LIGHT_BRIDGE_RAYCASTER,_,null,!1),O(_,_.userData.triggers,B()("#light-bridge-trigger"),"light_bridge");else if("glass"==U.ITEM_HOLDED_NAME)_.userData.state=!0,_.userData.triggers=E.triggers,_.userData.grid=E.grid,R("glass",U.GLASS_RAYCASTER,_,null,!1),O(_,_.userData.triggers,B()("#glass-trigger"),"glass");else if("tractor_beam"==U.ITEM_HOLDED_NAME)_.userData.state=E.state,_.userData.reversed=E.reversed,_.userData.triggers=E.triggers,R("tractor_beam",U.TRACTOR_BEAM_RAYCASTER,_,null,!1);else if("laser_emitter"==U.ITEM_HOLDED_NAME)_.userData.state=E.state,_.userData.triggers=E.triggers,Ae(_,_.userData.triggers,B()("#laser_emitter-trigger"),"laser_emitter");else if("laser_receiver"==U.ITEM_HOLDED_NAME)_.userData.state=!1,_.userData.triggers=E.triggers,Ae(_,_.userData.triggers,B()("#laser_receiver-trigger"),"laser_receiver");else if("faith_plate"==U.ITEM_HOLDED_NAME){1==E.state||0==E.state||"true"==E.state||"false"==E.state?_.userData.state=E.state:_.userData.state=!0,_.userData.target=E.target,U.FAITH_PLATE_TARGET=_;let e=new b.B69;e.position.copy(E.targetPos),e.rotation.copy(E.targetRot),Gt(e),xt(e,E.heightLine)}else"gel_recharger"==U.ITEM_HOLDED_NAME&&(_.userData.gel=E.gel,yt(_.userData.gel,_))}else a=r,o=i,(m=n).userData.buttons=0,m.userData.showLines=!0,m.userData.connections=0,m.userData.opened=!0,m.userData.instancedName=U.ITEM_HOLDED_NAME,m.userData.planeInstancedId=a.id_instanced,m.userData.lightColor="#ffffff",m.userData.pedestalInfinity=!0,m.userData.pedestalValue=3,m.userData.friction=.4,m.userData.restitution=0,m.userData.rotationY=0,m.userData.angle=45,m.userData.link=null,"faith_plate"==U.ITEM_HOLDED_NAME?m.userData.state=!0:"portal_gun"==U.ITEM_HOLDED_NAME?m.userData.state="all":"cube"==U.ITEM_HOLDED_NAME||"cube_2"==U.ITEM_HOLDED_NAME||"sphere"==U.ITEM_HOLDED_NAME||"laser_cube"==U.ITEM_HOLDED_NAME||"scale_cube"==U.ITEM_HOLDED_NAME?(m.userData.hasDispenser=!0,m.userData.state="open"):"laser_field"==U.ITEM_HOLDED_NAME?(m.userData.state=!0,m.userData.triggers=U.LASER_FIELD_TRIGGER,R("laser_field",U.LASER_FIELD_RAYCASTER,m,o,!1),O(m,m.userData.triggers,B()("#laser-field-trigger"),"laser_field")):"fizzler"==U.ITEM_HOLDED_NAME?(m.userData.state=!0,m.userData.triggers=U.FIZZLER_TRIGGER,R("fizzler",U.FIZZLER_RAYCASTER,m,o,!1),O(m,m.userData.triggers,B()("#laser-field-trigger"),"fizzler")):"light_bridge"==U.ITEM_HOLDED_NAME?(m.userData.state=!0,m.userData.triggers=U.LIGHT_BRIDGE_TRIGGER,R("light_bridge",U.LIGHT_BRIDGE_RAYCASTER,m,null,!1),O(m,m.userData.triggers,B()("#light-bridge-trigger"),"light_bridge")):"glass"==U.ITEM_HOLDED_NAME?(m.userData.state=!0,m.userData.triggers=U.GLASS_TRIGGER,m.userData.grid=U.GRID_STATE,R("glass",U.GLASS_RAYCASTER,m,null,!1),O(m,m.userData.triggers,B()("#glass-trigger"),"glass")):"tractor_beam"==U.ITEM_HOLDED_NAME?(m.userData.state=!0,m.userData.reversed=!1,m.userData.triggers="State",R("tractor_beam",U.TRACTOR_BEAM_RAYCASTER,m,null,!1)):"laser_emitter"==U.ITEM_HOLDED_NAME?(m.userData.state=!0,m.userData.triggers=U.LASER_EMITTER_TRIGGER,Ae(m,m.userData.triggers,B()("#laser_emitter-trigger"),"laser_emitter")):"laser_receiver"==U.ITEM_HOLDED_NAME&&(m.userData.state=!1,m.userData.triggers=U.LASER_RECEIVER_TRIGGER,Ae(m,m.userData.triggers,B()("#laser_receiver-trigger"),"laser_receiver"));if(window.totalItemsLoaded++,Ln(r),An(r,!0),window.totalItemsToLoad==window.totalItemsLoaded){for(var N=0;N<window.gooToLoad.length;N++)In(window.gooToLoad[N],!0);for(N=0;N<U.LOADED_CONNECTIONS.length;N++)for(var T=0;T<U.LOADED_CONNECTIONS[N].data.connectedTo.length;T++)U.SELECTED_FOR_CONNECTION=U.PLANE_USER_DATA[U.LOADED_CONNECTIONS[N].data.planeInstancedId],Ei(U.LOADED_CONNECTIONS[N].data.connectedTo[T],U.LOADED_CONNECTIONS[N].item);U.LOADED_LEVEL&&(B()("#chamberName").css("opacity",1),B()("#chamberName").text(B()("#chamber-name-to-save").val()+"_by_"+B()("#author-name-to-save").val()),B()("#loading-parent").css("opacity",1),B()("#loading-parent").css("pointer-events","all"),(U.PLAYER_MODEL?on:_n)())}}}U.ITEM_HOLDED_NAME=null,B()("#follow").css("display","none"),window.changingPosition=!1,Fe()}}else B()("#follow").css("display","none"),await cn("/items/"+U.ITEM_HOLDED_NAME+".glb",U.ITEM_HOLDED_NAME,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].instanced,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].interactive,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].roughness,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].envIntensity,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].wall,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].ground,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].ceiling,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].trigger,e,t,U.DRAGGED_ITEM_ELEMENT,U.ITEMS_COUNT[U.ITEM_HOLDED_NAME].max)}function Dn(e){U.ITEM_HOLDED_NAME=e.data("name"),B()("#follow").attr("src",e.attr("src")),U.DRAGGED_ITEM_ELEMENT=e}function Ln(e){e.item.checkersSlots=[];var t=new b.B69,i=(t.visible=!1,e.item.dispenserPosition?t.position.copy(e.item.dispenserPosition):t.position.copy(e.position),t.rotation.copy(e.rotation),t.clone());i.translateX(.9),e.item.checkersSlots.push(i),(i=t.clone()).translateX(.9),i.translateY(.4),e.item.checkersSlots.push(i),(i=t.clone()).translateX(.9),i.translateY(.8),e.item.checkersSlots.push(i),(i=t.clone()).translateX(.9),i.translateY(-.4),e.item.checkersSlots.push(i),(i=t.clone()).translateX(.9),i.translateY(-.8),e.item.checkersSlots.push(i),(i=t.clone()).translateX(-.9),e.item.checkersSlots.push(i),(i=t.clone()).translateX(-.9),i.translateY(.4),e.item.checkersSlots.push(i),(i=t.clone()).translateX(-.9),i.translateY(.8),e.item.checkersSlots.push(i),(i=t.clone()).translateX(-.9),i.translateY(-.4),e.item.checkersSlots.push(i),(i=t.clone()).translateX(-.9),i.translateY(-.8),e.item.checkersSlots.push(i)}let gn,Sn=!1;var hn,Cn=0,yn=new b.Pq0;let Mn=new b.mrM({color:16711680,linewidth:2});function Pn(e,t,i){hn[3*Cn+0]=e,hn[3*Cn+1]=t,hn[3*Cn+2]=i,Cn++,gn.geometry.setDrawRange(0,Cn)}B()("body").on("pointerdown",".item",function(e){e.preventDefault(),Dn(B()(this))}),document.addEventListener("keydown",e=>{"Escape"==e.code&&Sn&&(Sn=!1,U.SCENE_CHILDREN.remove(gn),U.CONNECTING=!1,U.MATERIAL_PORTAL_EDITOR.opacity=1,U.MATERIAL_NON_PORTAL_EDITOR.opacity=1,U.MATERIAL_PORTAL_EDITOR.transparent=!1,U.MATERIAL_NON_PORTAL_EDITOR.transparent=!1,Cn=0)}),B()("body").on("click","#conection",function(e){U.CONNECTING=!0,U.MATERIAL_PORTAL_EDITOR.opacity=.25,U.MATERIAL_NON_PORTAL_EDITOR.opacity=.25,U.MATERIAL_PORTAL_EDITOR.transparent=!0,U.MATERIAL_NON_PORTAL_EDITOR.transparent=!0,B()(".menu").removeClass("menu-show");var t=new b.LoY;hn=new Float32Array(1500),t.setAttribute("position",new b.THS(hn,3)),gn=new b.N1A(t,Mn),U.CURRENT_LINE=gn,U.SCENE_CHILDREN.add(gn),Sn=!0,U.SELECTED_FOR_CONNECTION=U.PLANE_USER_DATA[U.SELECTED_ID[0]],Pn(U.PLANE_USER_DATA[U.SELECTED_ID[0]].position.x,U.PLANE_USER_DATA[U.SELECTED_ID[0]].position.y,U.PLANE_USER_DATA[U.SELECTED_ID[0]].position.z),Pn(U.PLANE_USER_DATA[U.SELECTED_ID[0]].position.x,U.PLANE_USER_DATA[U.SELECTED_ID[0]].position.y,U.PLANE_USER_DATA[U.SELECTED_ID[0]].position.z)}),document.body.addEventListener("mousemove",function(e){U.CONNECTING&&(yn.x=e.clientX/window.innerWidth*2-1,yn.y=-e.clientY/window.innerHeight*2+1,yn.z=0,yn.unproject(U.MAIN_CAMERA),0!==Cn&&U.CONNECTING&&(hn[3*Cn-3]=yn.x,hn[3*Cn-2]=yn.y,hn[3*Cn-1]=yn.z,gn.geometry.attributes.position.needsUpdate=!0),vn.x=e.clientX/window.innerWidth*2-1,vn.y=-e.clientY/window.innerHeight*2+1,fn.setFromCamera(vn,U.MAIN_CAMERA),wn(fn.intersectObject(U.PLANE_LEVEL_INSTANCED),!0))});var fn=new b.tBo;let vn=new b.I9Y(1,1);function wn(e,t){0!=e.length&&(e=U.PLANE_USER_DATA[e[0].instanceId],U.FAITH_PLATE_TARGET&&Gt(U.ITEM_CUBE),t?U.FAITH_PLATE_TARGET||e.allowconnection&&!U.SELECTED_FOR_CONNECTION.item.userData.connectedTo.includes(e.id_instanced)&&e.item.userData.connections<10?(U.ITEM_CUBE.material.color=new b.Q1f(65280),U.ITEM_CUBE.place=!0):(U.ITEM_CUBE.material.color=new b.Q1f(16711680),U.ITEM_CUBE.place=!1):e.hasItem||e.continuousEnding||"down"==e.side&&!U.DRAGGED_ITEM_ELEMENT.data("floor")||"up"==e.side&&!U.DRAGGED_ITEM_ELEMENT.data("ceiling")||("front"==e.side||"back"==e.side||"left"==e.side||"right"==e.side)&&!U.DRAGGED_ITEM_ELEMENT.data("walls")?(U.ITEM_CUBE.material.color=new b.Q1f(16711680),U.ITEM_CUBE.place=!1):(U.ITEM_CUBE.material.color=new b.Q1f(65280),U.ITEM_CUBE.place=!0),U.ITEM_CUBE.position.copy(e.position),U.ITEM_CUBE.visible=!0)}function bn(e,t,i,n,o,a,r,s,l,E,c,_,d){e.item&&e.item.continuous&&e.item.continuous.otherSide&&(e.item.continuous.otherSide.continuousEnding=d),e.hasItem=t,e.itemName=i,e.item=n,e.state=o,e.canRotate=a,e.floor=r,e.ceiling=s,e.walls=l,e.isInstanced=E,e.instancedName=c,e.allowconnection=_}window.addEventListener("contextmenu",e=>e.preventDefault());var d,Bn=!1,Un=new b.tBo;B()("body").on("click","#side-bar-left, #ui-top",function(){document.querySelector(".menu").classList.remove("menu-show")}),B()("body").on("click","#rotate-item",function(){var e,t;U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName.includes("door")||U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName.includes("faith_plate")||U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName.includes("portal_0")||U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName.includes("portal_0")||U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName.includes("angled_panel")||U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName.includes("portal_gun")?(e=U.ITEMS_ADDED.getObjectByName(U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName),!U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName.includes("angled_panel")||"left"!=U.PLANE_USER_DATA[U.SELECTED_ID[0]].side&&"right"!=U.PLANE_USER_DATA[U.SELECTED_ID[0]].side?(e.rotation.y+=Math.PI/2,e.userData.rotationY=e.rotation.y):(e.rotation.x+=Math.PI/2,e.userData.rotationY=e.rotation.x)):(e=U.ITEMS_ADDED.getObjectByName(U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName),(t=new b.B69).position.copy(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.position),t.rotation.copy(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.rotation),t.rotation.y+=Math.PI/2,U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.rotationY=t.rotation.y,t.updateMatrix(),e.setMatrixAt(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.id,t.matrix),e.instanceMatrix.needsUpdate=!0,e.computeBoundingSphere(),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.rotation.copy(t.rotation))}),B()("body").on("click","#delete",function(){for(var e=[],t=0;t<U.CONNECTIONS.length;t++)(U.CONNECTIONS[t].from==U.PLANE_USER_DATA[U.SELECTED_ID[0]]||U.CONNECTIONS[t].to==U.PLANE_USER_DATA[U.SELECTED_ID[0]])&&e.push(t);for(var i,n,t=e.length-1;0<=t;t--){var o,a=U.CONNECTIONS[e[t]];a.from.item.userData.connectedTo.includes(a.to.id_instanced)&&(o=a.from.item.userData.connectedTo.indexOf(a.to.id_instanced),a.from.item.userData.connectedTo.splice(o)),U.LINE.remove(U.CONNECTIONS[e[t]].line),window.checkers.setVisibilityAt(a.checker,!1),window.checkersIndexes[a.checker]=!1,a.clone.visible=!1,U.CONNECTIONS.splice(e[t],1)}if(U.PLANE_USER_DATA[U.SELECTED_ID[0]].isInstanced)"incinerator"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&U.ITEMS_ADDED.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.trigger),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous&&(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous.otherSide&&(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous.otherSide.hasItem=!1),U.ITEMS_ADDED.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous)),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyBridge&&U.CANNON_WORLD.removeBody(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyBridge),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyLaserField&&U.CANNON_WORLD.removeBody(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyLaserField),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.cloneLaserField&&(i=U.ITEMS_ADDED.getObjectByName(U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName),(n=new b.B69).scale.set(0,0,0),n.updateMatrix(),"laser_field"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName?i.setMatrixAt(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.cloneLaserID,n.matrix):"fizzler"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&i.setMatrixAt(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.cloneFizzlerID,n.matrix),i.instanceMatrix.needsUpdate=!0),"tractor_beam"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&-1<(n=U.TRACTOR_BEAM.indexOf(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous))&&(U.TRACTOR_BEAM.splice(n,1),U.TRACTOR_BEAM_BOUNDING_BOX.splice(n,1),U.TRACTOR_BEAM_RAYCASTER.splice(n,1)),"laser_emitter"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&-1<(i=U.LASER_EMITTER_RAYCASTER.indexOf(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.raycaster))&&U.LASER_EMITTER_RAYCASTER.splice(i,1),"fizzler"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&-1<(n=U.FIZZLER_RAYCASTER.indexOf(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.raycaster))&&U.FIZZLER_RAYCASTER.splice(n,1),"laser_field"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&-1<(i=U.LASER_FIELD_RAYCASTER.indexOf(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.raycaster))&&U.LASER_FIELD_RAYCASTER.splice(i,1),"light_bridge"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&-1<(n=U.LIGHT_BRIDGE_RAYCASTER.indexOf(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.raycaster))&&U.LIGHT_BRIDGE_RAYCASTER.splice(n,1),i=U.PLANE_USER_DATA[U.SELECTED_ID[0]],n=window.moving,--U.ITEMS_COUNT[i.instancedName].count,E=U.ITEMS_ADDED.getObjectByName(i.instancedName),(l=new b.B69).scale.set(0,0,0),l.updateMatrix(),E.setMatrixAt(i.item.userData.idInstanced,l.matrix),E.instanceMatrix.needsUpdate=!0,"cube"==i.instancedName||"sphere"==i.instancedName||"cube_2"==i.instancedName||"laser_cube"==i.instancedName||"scale_cube"==i.instancedName?(E=U.ITEMS_ADDED.getObjectByName("dispenser"),(l=new b.B69).scale.set(0,0,0),l.updateMatrix(),E.setMatrixAt(i.item.dispenserID,l.matrix),E.instanceMatrix.needsUpdate=!0,U.DYMANIC_ITEMS.dispenser[i.item.dispenserID].dispenserPosition.y!=i.position.y&&bn(g(U.DYMANIC_ITEMS.dispenser[i.item.dispenserID].dispenserPosition.x+"/"+U.DYMANIC_ITEMS.dispenser[i.item.dispenserID].dispenserPosition.y+"/"+U.DYMANIC_ITEMS.dispenser[i.item.dispenserID].dispenserPosition.z)[0],!1,null,null,null,null,null,null,null,!1,null,!1,!1),U.DYMANIC_ITEMS.dispenser[i.item.dispenserID]=[]):"piston_platforms"!=i.instancedName&&"track_platforms"!=i.instancedName||(U.ITEMS_ADDED.remove(i.item.platformBox.parent),-1<(l=U.BOUNDING_BOX.indexOf(i.item.platformBox.bb))&&U.BOUNDING_BOX.splice(l,1)),U.DYMANIC_ITEMS[i.instancedName][i.item.userData.idInstanced]=[],n&&(window.changingPosition=!0,window.changingPositionPlane=i,Dn(B()("#"+i.instancedName))),B()("#"+i.instancedName).parent().children("span").text(U.ITEMS_COUNT[i.instancedName].max-U.ITEMS_COUNT[i.instancedName].count),window.moving=!1;else if("goo"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName){var r=U.PLANE_USER_DATA[U.SELECTED_ID[0]].item;U.SCENE_CHILDREN.remove(r.water),U.SCENE_CHILDREN.remove(r.lava),U.SCENE.remove(r);for(t=0;t<r.ids.length;t++)U.PLANE_USER_DATA[r.ids[t]].hasGoo=!1;for(var s,t=U.GOO_BOXES.length-1;0<=t;t--)U.GOO_BOXES[t].idPlane==U.PLANE_USER_DATA[U.SELECTED_ID[0]].id_instanced&&-1<(s=U.GOO_BOXES.indexOf(U.GOO_BOXES[t]))&&U.GOO_BOXES.splice(s,1)}else{var l,E=U.TRIGGER_BOXES.indexOf(U.PLANE_USER_DATA[U.SELECTED_ID[0]]);-1<E&&U.TRIGGER_BOXES.splice(E,1),"faith_plate"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&(U.SCENE.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.target),U.GROUP_LINE_TRAGECTORY.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.target.line)),"glass"==U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName&&-1<(l=U.GLASS_RAYCASTER.indexOf(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.raycaster))&&U.GLASS_RAYCASTER.splice(l,1),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous&&(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous.otherSide.hasItem=!1,U.ITEMS_ADDED.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous)),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyBridge&&U.CANNON_WORLD.removeBody(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyBridge),--U.ITEMS_COUNT[U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName].count,U.ITEMS_ADDED.remove(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item),B()("#"+U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName).parent().children("span").text(U.ITEMS_COUNT[U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName].max-U.ITEMS_COUNT[U.PLANE_USER_DATA[U.SELECTED_ID[0]].instancedName].count)}bn(U.PLANE_USER_DATA[U.SELECTED_ID[0]],!1,null,null,null,null,null,null,null,!1,null,!1,!1),B()(".menu").removeClass("menu-show"),Fe()}),B()("body").on("input","#state-dispenser",function(){this.checked?new b.Pq0(1,1,1):new b.Pq0(0,0,0);U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.hasDispenser=this.checked;var e=U.ITEMS_ADDED.getObjectByName("dispenser"),t=new b.B69;t.position.copy(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.dispenserPosition),t.rotation.set(0,0,0),t.updateMatrix(),e.setMatrixAt(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.dispenserID,t.matrix),e.setVisibilityAt(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.dispenserID,this.checked),e.instanceMatrix.needsUpdate=!0}),B()("body").on("input","#dispenser-opened",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.opened=this.checked}),B()("body").on("input","#state-lines",function(){for(var e=0;e<U.CONNECTIONS.length;e++)U.CONNECTIONS[e].from.itemName==U.PLANE_USER_DATA[U.SELECTED_ID[0]].itemName&&(U.CONNECTIONS[e].line.visible=this.checked,U.CONNECTIONS[e].from.item.userData.showLines=this.checked)}),B()("body").on("input","#state-pedetsal-infinity",function(){this.checked?B()("#pedestal-timer").addClass("disabled"):B()("#pedestal-timer").removeClass("disabled"),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.pedestalInfinity=this.checked}),B()("body").on("input","#pedestal-timer-value",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.pedestalValue=parseInt(this.value)}),B()("body").on("click",".tile-nonPortal",function(){for(var e=0;e<U.SELECTED_ID.length;e++)U.PLANE_USER_DATA[U.SELECTED_ID[e]].portal||(U.PLANE_USER_DATA[U.SELECTED_ID[e]].tile=B()(this).data("id"));B()(".menu").removeClass("menu-show")}),B()("body").on("click",".tile-portal",function(){for(var e=0;e<U.SELECTED_ID.length;e++)U.PLANE_USER_DATA[U.SELECTED_ID[e]].portal&&(U.PLANE_USER_DATA[U.SELECTED_ID[e]].tile=B()(this).data("id"));B()(".menu").removeClass("menu-show")}),B()("body").on("input","#tractor-state-input, #light-bridge-state-input, #laser-field-state-input, #fizzler-state-input",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.state=this.checked,U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous.visible=this.checked,"light-bridge-state-input"==B()(this).attr("id")?this.checked?U.CANNON_WORLD.addBody(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyBridge):U.CANNON_WORLD.removeBody(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyBridge):"laser-field-state-input"!=B()(this).attr("id")&&"fizzler-state-input"!=B()(this).attr("id")||(this.checked?U.CANNON_WORLD.addBody(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyLaserField):U.CANNON_WORLD.removeBody(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.bodyLaserField))}),B()("body").on("input","#tractor-direction-input",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.reversed=this.checked,this.checked?U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous.material=U.MATERIAL_TRACTOR_BEAM_REVERSE:U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous.material=U.MATERIAL_TRACTOR_BEAM}),B()("body").on("click",".tractor-triggers",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.triggers=B()(this).data("trigger"),B()("#tractor-trigger").data("trigger",B()(this).data("trigger")),B()("#tractor-trigger").find(".title").text("Triggers: "+B()(this).data("trigger"))}),B()("body").on("input","#ligh-color-input",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.lightColor=this.value}),B()("body").on("click",".light-bridge-triggers",function(){U.LIGHT_BRIDGE_TRIGGER=B()(this).data("trigger"),O(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item,B()(this).data("trigger"),B()("#light-bridge-trigger"),"light_bridge")}),B()("body").on("click",".laser-field-triggers",function(){U.LASER_FIELD_TRIGGER=B()(this).data("trigger"),O(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item,B()(this).data("trigger"),B()("#laser-field-trigger"),"laser_field")}),B()("body").on("click",".fizzler-triggers",function(){U.FIZZLER_TRIGGER=B()(this).data("trigger"),O(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item,B()(this).data("trigger"),B()("#fizzler-trigger"),"fizzler")}),B()("body").on("click",".glass-triggers",function(){U.GLASS_TRIGGER=B()(this).data("trigger"),O(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item,B()(this).data("trigger"),B()("#glass-trigger"),"glass")}),B()("body").on("input","#grid-state-input",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.grid=this.checked,this.checked?H(U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous,U.MATERIAL_GRID,2*U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous.distance/3):U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.continuous.material=U.MATERIAL_GLASS}),B()("body").on("input","#plate-state-input",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.state=this.checked}),document.getElementById("container").addEventListener("pointerdown",function(e){U.FPS_MODE||xn(e,"down")},!1),document.getElementById("container").addEventListener("pointermove",function(e){U.FPS_MODE||(Gn.x=e.clientX/window.innerWidth*2-1,Gn.y=-e.clientY/window.innerHeight*2+1,xn(e,"move"))},!1),document.getElementById("container").addEventListener("pointerup",function(e){U.FPS_MODE||(window.faithPlateMoved&&(window.faithPlateMoved.portal=!1,window.faithPlateMoved.planeColor=8421504,U.PLANE_LEVEL_INSTANCED.setColorAt(window.faithPlateMoved.id_instanced,new b.Q1f(8421504)),Ut(window.faithPlateMoved.item)),U.RESIZING_GLASS_PANEL=!1,U.SELECTED_SIDE=null,U.SELECTING=!1,U.CONTROLS.enabled=!0,U.CONTROLS.update(),!U.ITEM_HOLDED_NAME&&!U.CONNECTING||window.faithPlateMoved||xn(e,"up"),U.ITEM_HOLDED_NAME=null,U.DRAGGED_ITEM_ELEMENT=null,B()("#follow").css("display","none"),U.DRAGGING&&(U.SELECTED_ID=[],U.DRAGGING=!1),U.SELECTED&&U.SELECTED.userData.hasItem||(U.ITEM_CUBE.visible=!1),window.faithPlateMoved=null)},!1),B()(document).on("keypress",function(e){U.FPS_MODE||(45!==e.keyCode||Bn?43!==e.keyCode&&61!==e.keyCode||Bn||Ii("plus"):Ii("minus"),Bn)||(Bn=!0,setTimeout(()=>{Bn=!1},100))});let Gn=new b.I9Y(1,1);function xn(e,t){var i,n,o;!U.FPS_MODE&&U.PLANE_LEVEL_INSTANCED&&(Un.setFromCamera(Gn,U.MAIN_CAMERA),0<(i=Un.intersectObject(U.PLANE_LEVEL_INSTANCED)).length?(n=new b.Q1f,o=i[0].instanceId,U.PLANE_LEVEL_INSTANCED.getColorAt(o,n),"move"==t&&U.SELECTING?mi(i[0],e,t):"down"==t&&(U.SELECTING=!0,U.CONTROLS.enabled=!1,U.PLANE_USER_DATA[o].selected=!0,U.SELECTED_SIDE=U.PLANE_USER_DATA[o].side,mi(i[0],e,t)),"up"==t&&0<i.length&&In(i,!1),U.ITEM_HOLDED_NAME&&(B()("#follow").css("display","block"),B()("#follow").css({left:e.pageX-25,top:e.pageY-25}),wn(i,!1))):"down"==t&&document.querySelector(".menu").classList.remove("menu-show"))}function Yn(e){for(var t=[],i=[],n=[],o=0;o<U.PLANE_USER_DATA.length;o++)U.PLANE_USER_DATA[o].item&&(i.push(U.PLANE_USER_DATA[o]),n.push(U.PLANE_USER_DATA[o].item),U.PLANE_USER_DATA[o].item=U.PLANE_USER_DATA[o].item.userData),U.PLANE_USER_DATA[o].body=null;var a=[U.PORTAL_GUN_INITIATE,L.AMBIENT.value],a=(t.push(a),t.push(U.PLANE_USER_DATA),"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)));window.dataChamber=JSON.stringify(t),e?window.chamberID?window.updateChamber(B()("#chamber-name-to-save").val(),window.chamberID):window.saveChamber(B()("#chamber-name-to-save").val()):((t=document.createElement("a")).setAttribute("href",a),B()("#chamber-name-to-save").val()?t.setAttribute("download",B()("#chamber-name-to-save").val()+"_by_"+B()("#author-name-to-save").val()+".json"):t.setAttribute("download","chamber.json"),t.click());for(o=0;o<i.length;o++)i[o].item=n[o]}function Vn(e,t){var i=new b.Pq0,i=(t.getWorldPosition(i),e.position.copy(i),new b.PTz);t.getWorldQuaternion(i),e.quaternion.copy(i)}function Hn(e,t){var i=new w.Box(new w.Vec3(1,1,.01)),n=new w.Body({shape:i,mass:0,material:new w.Material}),n=(n.name=t,U.CANNON_BODIES.push(n),n.position.copy(e.position),n.quaternion.copy(e.quaternion),n.collisionFilterGroup=U.CGROUP_DYNAMIC,n.collisionFilterMask=U.CGROUP_ALL,e.body=n,U.CANNON_BODIES.push(n),U.CANNON_WORLD.addBody(n),new b.B69),e=(n.position.copy(e.position),n.quaternion.copy(e.quaternion),n.translateZ(-.5),new w.Body({shape:i,mass:0,material:new w.Material}));e.name=t,U.CANNON_BODIES.push(e),e.position.copy(n.position),e.quaternion.copy(n.quaternion),e.collisionFilterGroup=U.CGROUP_DYNAMIC,e.collisionFilterMask=U.CGROUP_ALL,e.collisionResponse=0,U.CANNON_BODIES.push(e),U.CANNON_WORLD.addBody(e),kn(e)}function kn(e){e.addEventListener("collide",function(t){if(1!=t.target.collisionResponse)if(t.body===U.PLAYER){for(var e=0;e<U.CONNECTIONS.length;e++)U.CONNECTIONS[e].from.instancedName.includes("trigger")&&(U.CONNECTIONS[e].line.active=!1);"exit"!=t.target.name||U.EXIT_DOOR.finished||qn(0,!(U.EXIT_DOOR.finished=!0),!1,U.EXIT_DOOR),M(0),M(1),U.PORTAL_BOX=[];for(e=0;e<U.LASER_TRIGGERS.length;e++)!U.LASER_TRIGGERS[e].emitterState&&U.LASER_TRIGGERS[e].fromLaserCube&&p(U.LASER_TRIGGERS[e],!1)}else if("sphere"==t.body.name||"cube"==t.body.name||"radio"==t.body.name||"cube_2"==t.body.name||"laser_cube"==t.body.name||"scale_cube"==t.body.name||"camera"==t.body.name||"trash"==t.body.name){var i=("camera"==t.body.name?window.cameraClone:U.ITEMS_ADDED.getObjectByName(t.body.name).scene).clone(),n=(i.position.set(t.body.position.x,t.body.position.y,t.body.position.z),i.quaternion.copy(t.body.quaternion),i.visible=!0,U.HOLDING_ITEM&&Et(),U.UNIFORMS_DISSOLVER.diffuseMap.value=i.material.map,i.material=U.MATERIAL_DISSOLVER,U.SCENE_FPS.add(i),i.position.clone()),n=(n.y+=2,U.UNIFORMS_DISSOLVER.u_EffectOrigin.value=n,i.clone());if(n.position.y+=1,G("audio-dissolve",i,!0,!1,!0,2,"dissolve"),S(3e3,U.UNIFORMS_DISSOLVER.u_EffectOrigin.value,i.position),S(3e3,i.position,n.position),setTimeout(()=>{U.SCENE_FPS&&(U.SCENE_FPS.remove(i),i.dissolve)&&U.SCENE_FPS.remove(i.dissolve)},3e3),"camera"==t.body.name){U.ITEMS_ADDED.remove(t.body.item);let e=t.body;setTimeout(()=>{U.CANNON_WORLD.removeBody(e)},100)}else if("radio"==t.body.name||"trash"==t.body.name){"radio"==t.body.name&&(t.body.sound.audio.pause(),U.SCENE_FPS.remove(t.body.sound));n=U.ITEMS_ADDED.getObjectByName(t.body.item.userData.instancedName);n.setVisibilityAt(t.body.item.userData.idInstanced,!1),n.instanceMatrix.needsUpdate=!0,n.computeBoundingSphere();let e=t.body;setTimeout(()=>{U.CANNON_WORLD.removeBody(e)},100)}else pt(t.body)}})}function x(e,t,i,n){for(var o,a,r,s=0;s<e.length;s++)if(0!=e[s].length){var l,E=new w.Material,c=(E.friction=e[s].userData.friction,e[s].position.clone()),_=e[s].quaternion,d=new b.B69;if(d.position.copy(c),d.quaternion.copy(_),U.SCENE.add(d),"incinerator"==t)var u=(0,N.dZ)(U.ITEMS_ADDED.getObjectByName(t),{type:N.IO.HULL}),A=u.shape;else if("step"==t)var u=(0,N.dZ)(U.ITEMS_ADDED.getObjectByName(t),{type:N.IO.HULL}),A=u.shape;else if("desk"==t||"cabinet"==t||"sign"==t)var u=(0,N.dZ)(U.ITEMS_ADDED.getObjectByName(t),{type:N.IO.HULL}),A=u.shape;else if("bed"==t){var A=new w.Box(new w.Vec3(.5,.5,1));d.translateY(.25)}else if("toilet"==t){var A=new w.Box(new w.Vec3(.22,.5,.44));d.translateY(.25)}else if("piston_platforms"==t){var A=new w.Box(new w.Vec3(1,.1,1));d.translateY(.05)}else if("track_platforms"==t){var A=new w.Box(new w.Vec3(1,1,.1));d.translateY(1),d.translateZ(-.275)}else if("trash"==t){var A=new w.Box(new w.Vec3(.05,.09,.05));n=.09}else if("door"==t)var A=new w.Box(new w.Vec3(1,1,.01)),c=new b.Pq0,c=(e[s].children[1].getWorldPosition(c),d.position.copy(c),new b.PTz),_=(e[s].children[1].getWorldQuaternion(c),c);else if("cube"==t||"cube_2"==t||"laser_cube"==t||"scale_cube"==t){(A=new w.Box(new w.Vec3(.3,.3,.3))).height=.6,A.width=.6,n=.5;c=new w.ContactMaterial(U.PHYSICS_MATERIAL,E,{friction:0,restitution:e[s].userData.restitution});U.CANNON_WORLD.addContactMaterial(c)}else if("sphere"==t){(A=new w.Sphere(.3)).height=.6,A.width=.6,n=.5;c=new w.ContactMaterial(U.PHYSICS_MATERIAL,E,{friction:0,restitution:e[s].userData.restitution});U.CANNON_WORLD.addContactMaterial(c)}else if("gel_gun_blue"==t||"gel_gun_orange"==t||"gel_gun_white"==t)var A=new w.Box(new w.Vec3(.1,.5,.1));else if("pedestal_button"==t){var A=new w.Box(new w.Vec3(.126,.35,.126));d.translateY(.35)}else if("radio"==t){var A=new w.Box(new w.Vec3(.15,.07,.1));n=.07}else if("button_weight"==t){A=new w.Box(new w.Vec3(.5,.117,.5));d.translateY(.117)}else if("button_box"==t||"button_sphere"==t)"button_box"==t?(l=.45,0):"button_sphere"==t&&(l=.4,0),1==n?(A=new w.Box(new w.Vec3(.5,.14,.1)),d.translateY(.14),d.translateZ(l)):2==n?(A=new w.Box(new w.Vec3(.5,.14,.1)),d.translateY(.14),d.translateZ(-l)):3==n?(A=new w.Box(new w.Vec3(.1,.14,.5)),d.translateY(.14),d.translateX(l)):4==n&&(A=new w.Box(new w.Vec3(.1,.14,.5)),d.translateY(.14),d.translateX(-l));else if("dispenser"==t){if(!e[s].userData.hasDispenser)return;d.position.copy(e[s].dispenserPosition),d.rotation.set(0,0,0),1==n?(A=new w.Box(new w.Vec3(.7,.77,.01)),d.translateZ(.7)):2==n?(A=new w.Box(new w.Vec3(.7,.77,.01)),d.translateZ(-.7)):3==n?(A=new w.Box(new w.Vec3(.01,.77,.7)),d.translateX(.7)):4==n&&(A=new w.Box(new w.Vec3(.01,.77,.7)),d.translateX(-.7)),d.translateY(-.8)}else if("ramp"==t||"ramp_half"==t||"ramp_half2"==t||"stairs"==t){let e=(0,N.dZ)(U.ITEMS_ADDED.getObjectByName(t),{type:N.IO.HULL});A=e.shape}else"pellet_launcher"==t?(A=new w.Box(new w.Vec3(.6,.3,.6)),d.translateY(.3),oe(e[s])):"pellet_catcher"==t?(A=new w.Box(new w.Vec3(.5,.3,.5)),d.translateY(.3),c=e[s],a=r=a=p=o=void 0,o=new b.Pq0(0,1,0).applyQuaternion(c.quaternion),(ne=new b.tBo).set(c.position,o),o=ne.intersectObject(U.PLANE_LEVEL_INSTANCED),(p=new b.B69).position.copy(c.position),p.rotation.copy(c.rotation),a=new b.Ho_(1,.1,o[0].distance,16,1,!0),a=new b.eaF(a,U.MATERIAL_CONE),p.add(a),a.translateY(o[0].distance/2),a=new b.tcD(1,16),r=new b.V9B({color:16776960,transparent:!0,opacity:.05,side:1,polygonOffset:!0,polygonOffsetFactor:-10}),a=new b.eaF(a,r),p.add(a),a.rotation.x=-Math.PI/2,a.translateZ(o[0].distance-.01),U.SCENE_FPS.add(p),c.cone=p):"faith_plate"==t&&(A=new w.Box(new w.Vec3(.5,.1,1)));var p,m=new w.Body({shape:A,mass:i,material:E});m.position.copy(d.position),m.quaternion.copy(_),m.collisionFilterGroup=U.CGROUP_DYNAMIC,m.collisionFilterMask=U.CGROUP_ALL,(e[s].body=m).state=e[s].state,m.updateMassProperties(),m.item=e[s],m.name=t,m.initialMass=i,U.SCENE.remove(d),"radio"==t?G("audio-radio",m,!0,!0,!1,4,"sound"):"door"==t?G("audio-door",e[s],!1,!1,!0,8,"sound"):"laser_cube"==t&&(r=m,o=a=void 0,a=new b.Ho_(.01,.01,1,8,1,!0),(a=new b.eaF(a,new b.V9B({color:new b.Q1f(Ee,0,0)}))).translateY(.5),(o=new b.B69).position.copy(r.position),o.quaternion.copy(r.quaternion),o.add(a),o.visible=!1,(a=o.clone()).visible=!1,o.clone=a,U.SCENE_FPS.add(a),U.SCENE_FPS.add(o),r.laser=o),"faith_plate"==t&&(m.collisionResponse=0,G("faith_plate_hit",m,!1,!1,!0,12,"sound")),"piston_platforms"!=t&&"track_platforms"!=t||(m.collisionFilterGroup=U.CGROUP_ENVIRONMENT,(c=m).bodiesInContact=[],U.PLATFORM_BODIES.push(c),c.addEventListener("collide",Xe),G("AUDIO-PLATFORM",m,e[s].userData.isActive,!0,!1,5,"sound")),0<i&&(G("audio-repulsion",m,!1,!1,!0,20,"soundRepulsion"),"cube"!=t&&"cube_2"!=t&&"laser_cube"!=t&&"sphere"!=t&&"scale_cube"!=t||(e[s].userData.hasDispenser?(m.mass=0,m.allowSleep=!1):m.allowSleep=!0,m.position.copy(new b.Pq0(e[s].dispenserPosition.x,e[s].dispenserPosition.y-1,e[s].dispenserPosition.z)),e[s].position.copy(m.position),U.BOX_BODY.push(m)),m.spawnPosition=e[s].position.clone(),m.sleepSpeedLimit=.1,m.sleepTimeLimit=1,U.DYNAMIC_OBJECTS.push(m),m.gelJumping=!1,m.waiting=!1,m.offset=n,m.arrayPos=[],m.arrayRot=[],m.dynamic=!0,m.playingAudioGel=!1,(p=U.ITEMS_ADDED.getObjectByName(t).clone.clone()).visible=!1,U.SCENE_FPS.add(p),m.clone=p,"radio"!=t&&"trash"!=t&&G("audio-impact",m,!1,!1,!0,8,"sound"),m.addEventListener("collide",function(t){t.body.looping=!1,t.body.looping2=!1,t.body.centered=!1,t.body.centering=!1,t.body.heightDifference=null,"blue"!=t.body.type&&t.target.impactVelocity&&(clearTimeout(t.target.timeout),t.target.timeout=setTimeout(()=>{t.target.impactVelocity=null,t.target.impactSide=null},10)),"purple"!=t.body.type&&t.target.customGravity&&(clearTimeout(t.target.timeout),t.target.timeout=setTimeout(()=>{t.target.customGravity=null;var e=U.CUSTOM_GRAVITY.indexOf(t.target);-1<e&&(U.CUSTOM_GRAVITY.splice(e,1),t.target.velocity.setZero(),t.target.initVelocity.setZero(),t.target.angularVelocity.setZero(),t.target.initAngularVelocity.setZero(),t.target.force.setZero(),t.target.torque.setZero())},10)),"gel"==t.body.name&&"blue"==t.body.type?(t.target.playingAudioGel||(t.target.playingAudioGel=!0,setTimeout(()=>{t.target.playingAudioGel=!1},2e3)),ve(t)):("faith_plate"==t.body.name&&Bt(t.body,t.target),"radio"!=t.target.name&&"trash"!=t.target.name&&(1.5<Math.abs(t.target.velocity.x)||1.5<Math.abs(t.target.velocity.y)||1.5<Math.abs(t.target.velocity.z))&&(t.target.sound.position.copy(t.target.position),t.target.sound.audio.play()))}),m.addEventListener("sleep",function(e){m.sleeping=!0,m.name}),m.addEventListener("wakeup",e=>{m.sleeping=!1})),U.CANNON_WORLD.addBody(m),U.CANNON_BODIES.push(m)}}function Fn(e,t,i,n,o,a){for(var r=[],s=0;s<e.length;s++){for(var l=e[s].position[i],E=[],c=0;c<e.length;c++)e[c].checked||e[c].position[i]==l&&(e[c].position.checked=!1,e[c].position.i=e[c].id_instanced,E.push(e[c].position),e[c].checked=!0);0<E.length&&r.push(E.sort((e,t)=>e[n]-t[n]))}for(var _=[],s=0;s<r.length;s++){_.push([]);for(c=0;c<r[s].length;c++){for(var d=r[s][c][o],E=[],u=0;u<r[s].length;u++)r[s][u].checked||r[s][u][o]!=d||0<E.length&&r[s][u][n]-2!=E[E.length-1][n]||(r[s][u].checked=!0,E.push(r[s][u]));0<E.length&&_[s].push(E)}}for(s=0;s<_.length;s++)for(c=0;c<_[s].length;c++){var A,p=0,m=0,N=0,T=("up"==t?m=.09:"down"==t?m=-.09:"front"==t?N=-.09:"back"==t?N=.09:"right"==t?p=.09:"left"==t&&(p=-.09),"up"==t||"down"==t?A=new w.Vec3(_[s][c].length,.1,1):"front"==t||"back"==t?A=new w.Vec3(_[s][c].length,1,.1):"right"!=t&&"left"!=t||(A=new w.Vec3(.1,1,_[s][c].length)),new w.Box(A)),R=new w.Body({mass:0,shape:T,material:U.PHYSICS_MATERIAL}),T=new b.B69;T.position.copy(new b.Pq0(_[s][c][0].x+p,_[s][c][0].y+m,_[s][c][0].z+N)),R.position.copy(T.position),R.position[a]+=_[s][c].length-1,R.collisionFilterGroup=U.CGROUP_ENVIRONMENT,R.collisionFilterMask=U.CGROUP_DYNAMIC|U.CGROUP_PLAYER,R.room=!0,R.side=t,R.name="wall",R.wallRotation=e[0].normal;for(u=0;u<_[s][c].length;u++)U.PLANE_USER_DATA[_[s][c][u].i].body=R;U.CANNON_WORLD.addBody(R),U.CANNON_BODIES.push(R),U.WALL_BODIES.push(R)}}function zn(e,a){for(var t=0;t<U.CORRIDOR_COLLIDERS.length;t++)U.CANNON_WORLD.removeBody(U.CORRIDOR_COLLIDERS[t]);U.CORRIDOR_COLLIDERS=[];let r=U.MATERIAL_FLOOR_NON_PORTAL.clone(),s=(r.side=2,U.MATERIAL_FLOOR_NON_PORTAL.clone()),l=(s.side=2,s.envMapIntensity=.35,s.roughness=1,s.roughnessMap=null,U.MATERIAL_WALL_NON_PORTAL.clone());l.side=2,e.traverse(e=>{var t,i,n,o;e.name.includes("collider")?(e.visible=!1,t=e,i=(0,N.dZ)(t,{type:N.IO.BOX}),i=new w.Body({shape:i.shape,mass:0,material:U.PHYSICS_MATERIAL}),U.CANNON_BODIES.push(i),o=new b.Pq0,t.getWorldPosition(o),n=new b.PTz,t.getWorldQuaternion(n),i.position.copy(o),i.quaternion.copy(n),i.collisionFilterGroup=U.CGROUP_ENVIRONMENT,i.collisionFilterMask=U.CGROUP_DYNAMIC|U.CGROUP_PLAYER,U.CANNON_WORLD.addBody(i),U.CANNON_BODIES.push(i),U.CORRIDOR_COLLIDERS.push(i),t.name.includes("collider_door")&&(U.BODY_ELEVATOR=i).addEventListener("collide",function(e){var t,i;!U.LEVEL_ENTERED||U.LOADED_LEVEL&&!window.allowEdit||U.FINISHED?U.LEVEL_ENTERED&&U.LOADED_LEVEL&&!U.FINISHED&&(window.chamberID&&window.chamberUSERID!=window.session.user.id&&window.updateChamberFinishedValue(window.chamberID,window.chamberFinished+1),U.FINISHED=!0,window.currentLevel++,localStorage.setItem("level",window.currentLevel),window.isCustom=!1,U.MOBILE||document.exitPointerLock(),B()("#test-name").text(B()("#chamber-name-to-save").val()),B()("#test-author").text(B()("#author-name-to-save").val()),t=Math.floor(U.STATS_UI.time/60),i=Math.floor(U.STATS_UI.time-60*t),B()("#test-portals").text(U.STATS_UI.portals),B()("#test-time").text(t+":"+i),B()("#test-steps").text(parseInt(U.STATS_UI.steps)),window.curentTimeOffset=0,document.getElementById("next-map").style.display="flex"):(U.FINISHED=!0,setTimeout(()=>{zt()},100),B()("#loading-parent").css("opacity",1),B()("#loading-parent").css("pointer-events","all"),setTimeout(()=>{1==window.confirm("Publish Chamber?")&&Yn(!0)},1e3))})):e.name.includes("floor")?a||(e.material=r):e.name.includes("ceiling")?a||(e.material=s):e.name.includes("wall")?a||(e.material=l):e.name.includes("emissive")?a?(e.getWorldPosition(window.worlPos.position),window.worlPos.position.y-=4):(e.material=new b.V9B({color:new b.Q1f(2,2,2)}),e.children[0]&&e.remove(e.children[0]),(o=new b.nCl(16777215,20)).angle=Math.PI/2,o.penumbra=1,o.decay=1,o.distance=6,o.position.set(0,.1,0),o.name="spot",e.add(o),window.worlPos=new b.B69,e.getWorldPosition(window.worlPos.position),U.SCENE_FPS.add(window.worlPos),window.worlPos.position.y-=4,o.target=window.worlPos):e.name.includes("light")?a||(e.material.envMapIntensity=.25):e.name.includes("Cylinder")&&!a&&(e.material=new b._4j)})}B()("#main-container").on("click","#plus-portal",function(){Ii("plus"),document.querySelector(".menu").classList.remove("menu-show")}),B()("body").on("click","#minus-portal",function(){Ii("minus"),document.querySelector(".menu").classList.remove("menu-show")}),B()("body").on("click","#portalable",function(){if(0<U.SELECTED_ID.length){U.PLANE_USER_DATA[U.SELECTED_ID[0]].portal=!U.PLANE_USER_DATA[U.SELECTED_ID[0]].portal;for(var e=0;e<U.SELECTED_ID.length;e++)U.PLANE_USER_DATA[U.SELECTED_ID[e]].portal=U.PLANE_USER_DATA[U.SELECTED_ID[0]].portal,U.PLANE_USER_DATA[U.SELECTED_ID[e]].portal?(U.PLANE_USER_DATA[U.SELECTED_ID[e]].planeColor=16777215,U.PLANE_LEVEL_INSTANCED.setColorAt(U.SELECTED_ID[e],new b.Q1f(16777215))):(U.PLANE_USER_DATA[U.SELECTED_ID[e]].planeColor=8421504,U.PLANE_LEVEL_INSTANCED.setColorAt(U.SELECTED_ID[e],new b.Q1f(8421504)))}document.querySelector(".menu").classList.remove("menu-show")}),B()("body").on("click","#save-level",function(){Yn(!1)}),B()("body").on("input","#friction",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.friction=this.value}),B()("body").on("input","#restitution",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.restitution=parseFloat(this.value)}),B()("body").on("click","#header-items",function(){B()(this).css("background-color","black"),B()(this).css("color","white"),B()("#header-settings").css("background-color","white"),B()("#header-settings").css("color","black"),B()("#items").css("display","grid"),B()("#settings").css("display","none")}),B()("body").on("click","#header-settings",function(){B()(this).css("background-color","black"),B()(this).css("color","white"),B()("#header-items").css("background-color","white"),B()("#header-items").css("color","black"),B()("#items").css("display","none"),B()("#settings").css("display","flex")}),B()("#portal-gun-select").on("change",function(){U.PORTAL_GUN_INITIATE=B()(this).val()}),B()("body").on("click",".portal_gun-state",function(){U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.state=B()(this).data("state"),B()("#portal_gun-state").find(".title").text(B()(this).data("state")+" Portals")}),B()("body").on("input","#portal-gun-color",function(){var e=ee(this.value);localStorage.setItem("portal_gun_color",this.value),U.GUN.getObjectByName("Object_6").material.color=new b.Q1f(e.r/255,e.g/255,e.b/255)}),B()("body").on("input","#portal-gun-roughness",function(){localStorage.setItem("portal_gun_roughness",this.value),U.GUN.getObjectByName("Object_6").material.roughness=this.value}),B()("body").on("input","#portal-gun-metalness",function(){localStorage.setItem("portal_gun_metalness",this.value),U.GUN.getObjectByName("Object_6").material.metalness=this.value}),B()("body").on("change","#option-goo-reflections",function(){U.GOO_REFLECTIONS=this.checked,localStorage.setItem("goo_reflections",this.checked)}),localStorage.getItem("goo_reflections")&&(U.GOO_REFLECTIONS="true"==localStorage.getItem("goo_reflections"),B()("#option-goo-reflections").prop("checked",U.GOO_REFLECTIONS)),B()("body").on("click",".angled_panel_option",function(){B()("#angled_panel_option").find(".title").text("Angle on Start: "+B()(this).data("angle")),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.angle=B()(this).data("real"),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.getObjectByName("pivot2").rotation.x=Math.PI/180*B()(this).data("real")}),B()("body").on("click",".angled_panel_trigger",function(){B()("#angled_panel_trigger").find(".title").text("Angle on Trigger: "+B()(this).data("angle")),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.angleTrigger=B()(this).data("real")}),B()("body").on("click","#reset-check-point",function(){U.LEVEL_ENTERED&&pt(U.PLAYER)}),window.arrayJSON=[],B()("body").on("click","#options-custom span",async function(){window.arrayJSON=[],B()("#options-custom span").css("background","none"),B()(this).css("background","grey"),document.getElementById("loading-parent").style.opacity="1",document.getElementById("loading-parent").style.pointerEvents="all",d=d||await window.selectAllChambers(),B()(".custom-chamber").remove();var e=await window.getSession();if("all"==B()(this).data("value"))for(var t,i=0,n=0;i<d.length;i++)d[i].tested&&(t='<div data-jsonid="'+n+'"  data-name="'+d[i].name+'"  data-finished="'+d[i].finished+'"   data-userid="'+d[i].user_id+'" data-played="'+d[i].played+'"  data-id="'+d[i].id+'" class="custom-chamber"style="background-image: url('+d[i].thumb+')"><div class="chamber-stats"><span>played: '+d[i].played+"</span><span>finished: "+d[i].finished+'</span></div><span class="span-chamber">'+d[i].name+" by "+d[i].author+"</span></div>",window.arrayJSON.push(d[i].json),n++,B()("#list-custm-chambers").append(t));else if("new"==B()(this).data("value"))for(var o,i=0,n=0;i<d.length;i++)d[i].tested||(o='<div data-jsonid="'+n+'" data-name="'+d[i].name+'"  data-finished="'+d[i].finished+'"   data-userid="'+d[i].user_id+'"  data-played="'+d[i].played+'"  data-id="'+d[i].id+'" class="custom-chamber"style="background-image: url('+d[i].thumb+')"><div class="chamber-stats"><span>played: '+d[i].played+"</span><span>finished: "+d[i].finished+'</span></div><span class="span-chamber">'+d[i].name+" by "+d[i].author+"</span></div>",window.arrayJSON.push(d[i].json),n++,B()("#list-custm-chambers").append(o));else if("mine"==B()(this).data("value"))for(var a,i=0,n=0;i<d.length;i++)d[i].user_id==e.user.id&&(a='<div data-jsonid="'+n+'"  data-name="'+d[i].name+'" data-finished="'+d[i].finished+'"  data-userid="'+d[i].user_id+'"  data-played="'+d[i].played+'" data-id="'+d[i].id+'" class="custom-chamber mine"style="background-image: url('+d[i].thumb+')"><div class="chamber-stats"><span>played: '+d[i].played+"</span><span>finished: "+d[i].finished+'</span></div><button class="delete-my-chamber">DELETE</button><span class="span-chamber">'+d[i].name+" by "+d[i].author+"</span></div>",window.arrayJSON.push(d[i].json),n++,B()("#list-custm-chambers").append(a));document.getElementById("loading-parent").style.opacity="0",document.getElementById("loading-parent").style.pointerEvents="none"}),B()("body").on("click",".delete-my-chamber",async function(){window.deleteChamber(B()(this).parent().data("id")),d=await window.selectAllChambers(),B()(this).parent().remove(),window.location.reload()}),document.onkeypress=function(e){U.FPS_MODE&&"p"==e.key&&(U.RENDERER.render(U.SCENE,U.MAIN_CAMERA),window.thumbDataURL=U.RENDERER.domElement.toDataURL("image/jpeg",.25),B()("#alert").css("opacity","1"),B()("#alert span").text("thumbnail set!"),setTimeout(()=>{B()("#alert").css("opacity","0")},5e3))};var jn=!0;function qn(e,t,i,n,o){console.log("door"),i||o?(n.getObjectByName("portal_door_right_04").position.z=10,n.getObjectByName("portal_door_left_06").position.z=10):(n.getObjectByName("portal_door_right_04").position.z=-10,n.getObjectByName("portal_door_left_06").position.z=-10),n.timeOutDoor1&&(clearTimeout(n.timeOutDoor1),clearTimeout(n.timeOutDoor2)),n.timeOutDoor1=setTimeout(()=>{var e;jn&&n.sound&&(n.sound.audio.currentTime=0,D(n.sound.audio)),jn=!1,setTimeout(()=>{jn=!0},100),e=t?(Xn(Math.PI,n,o),400):(Wn(-65,n,o),800),n.body&&(n.body.collisionResponse=t?0:1),n.timeOutDoor2=setTimeout(()=>{U.LEVEL_ENTERED&&n==U.ENTER_DOOR&&(U.CORRIDOR_ENTER.visible=!1),t?Wn(25,n,o):Xn(0,n,o),i&&setTimeout(()=>{U.EXIT_DOOR.add(U.CORRIDOR_ENTER),zn(U.CORRIDOR_ENTER,!0),U.CORRIDOR_ENTER.getObjectByName("sign").visible=!1},300),U.LEVEL_ENTERED&&(n==U.EXIT_DOOR&&U.FPS_MODE&&!U.EXIT_DOOR.finished&&(U.CORRIDOR_ENTER.visible=t),U.EXIT_DOOR.finished&&(U.CORRIDOR_ENTER.visible=!0),n==U.EXIT_DOOR)&&t&&F(n.userData)},e)},e)}function Xn(e,t,i){i=i?0:400;S(i,t.getObjectByName("central_spinner_right_05").rotation,new b.Pq0(e,t.getObjectByName("central_spinner_right_05").rotation.y,t.getObjectByName("central_spinner_right_05").rotation.z)),S(i,t.getObjectByName("central_spinner_left_07").rotation,new b.Pq0(e,t.getObjectByName("central_spinner_left_07").rotation.y,t.getObjectByName("central_spinner_left_07").rotation.z))}function Wn(e,t,i){i=i?0:400;S(i,t.getObjectByName("portal_door_right_04").position,new b.Pq0(e,t.getObjectByName("portal_door_right_04").position.y,t.getObjectByName("portal_door_right_04").position.z)),S(i,t.getObjectByName("portal_door_left_06").position,new b.Pq0(-e,t.getObjectByName("portal_door_left_06").position.y,t.getObjectByName("portal_door_left_06").position.z))}var u={fwdValue:0,bkdValue:0,rgtValue:0,lftValue:0,shouldJump:!1,headBobActive:!1,headBobTimer:0,controller:{KeyE:{pressed:!1},KeyW:{pressed:!1},KeyS:{pressed:!1},KeyA:{pressed:!1},KeyD:{pressed:!1},Space:{pressed:!1}},blocked_bottom:!1,blocked_top:!1,crouched:!1},Zn=!0;if(U.MOBILE){window.targetRotationOnMouseDownX=0;window.targetRotationOnMouseDownY=0;var Qn,Jn,Kn,$n=0,eo=0,to=window.innerWidth/2,io=window.innerHeight/2,no=0;let e;document.getElementById("camera2").addEventListener("touchstart",function(e){0<e.touches.length&&(0!=(no=e.touches.length-1)&&1!=no||($n=e.touches[no].pageX-to,window.targetRotationOnMouseDownX=U.TARGET_ROTATION_X,eo=e.touches[no].pageY-io,window.targetRotationOnMouseDownY=U.TARGET_ROTATION_Y))},!1),document.getElementById("camera2").addEventListener("touchmove",function(e){0<e.touches.length&&(0==no||1==no)&&(Qn=e.touches[no].pageX-to,U.TARGET_ROTATION_X=window.targetRotationOnMouseDownX+-.01*(Qn-$n),Qn=e.touches[no].pageY-io,Jn=e.touches[no].pageY-Kn,Kn=e.touches[no].pageY,0<Jn?u.blocked_bottom||(U.TARGET_ROTATION_Y=window.targetRotationOnMouseDownY+-.01*(Qn-eo)):u.blocked_top||(U.TARGET_ROTATION_Y=window.targetRotationOnMouseDownY+-.01*(Qn-eo)))},!1),document.getElementById("camera2").addEventListener("touchup",function(e){no=0},!1),t={zone:document.getElementById("joystickWrapper1"),size:120,multitouch:!0,maxNumberOfNipples:2,mode:"static",restJoystick:!0,shape:"circle",position:{top:"60px",left:"60px"},dynamicPage:!0},(e=f().create(t))[0].on("move",function(e,t){var i=t.vector.y,t=t.vector.x;0<i?(u.fwdValue=Math.abs(i),u.bkdValue=0):i<0&&(u.fwdValue=0,u.bkdValue=Math.abs(i)),0<t?(u.lftValue=0,u.rgtValue=Math.abs(t)):t<0&&(u.lftValue=Math.abs(t),u.rgtValue=0),u.headBobActive=!0}),e[0].on("end",function(e){u.bkdValue=0,u.fwdValue=0,u.lftValue=0,u.rgtValue=0,U.PLAYER_MOVING=!1,u.headBobTimer=0,S(500,U.GUN.children[0].position,new b.Pq0(0,0,0)),no=0})}var oo,ao=!1;document.addEventListener("keydown",e=>{U.FPS_MODE&&Zn&&(u.controller[e.code]&&(u.controller[e.code].pressed=!0),u.headBobActive=!0,"ControlLeft"!=e.code||u.crouched?"KeyE"!=e.code||ao||(ao=!0,Et()):(u.crouched=!0,uo(-.25)))}),B()("body").on("click","#close",function(){B()("#blocker").css("display","block"),B()("#container").css("filter","blur(2px)")}),B()("body").on("click","#item",function(){Et()}),window.blockCamRotation=!1;let ro=Math.PI/2,so=2*Math.PI;document.body.addEventListener("mousemove",e=>{document.pointerLockElement!==document.body||U.PAUSED||(U.MAIN_CAMERA.rotation.y-=e.movementX/1e3,U.MAIN_CAMERA.rotation.x-=e.movementY/1e3,U.MAIN_CAMERA.rotation.x=Math.max(-ro,Math.min(ro,U.MAIN_CAMERA.rotation.x)),U.MAIN_CAMERA.rotation.y>Math.PI?U.MAIN_CAMERA.rotation.y-=so:U.MAIN_CAMERA.rotation.y<-Math.PI&&(U.MAIN_CAMERA.rotation.y+=so),U.TELEPORTING_TARGET_QUATERNION||U.GUN.quaternion.slerp(U.MAIN_CAMERA.quaternion,.075),window.blockCamRotation=!0,clearTimeout(oo),oo=setTimeout(function(){window.blockCamRotation=!1},10))});var lo=!1;function Eo(){document.body.requestFullscreen?document.body.requestFullscreen():document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullscreen?document.body.webkitRequestFullscreen():document.body.msRequestFullscreen&&document.body.msRequestFullscreen()}B()("body").on("click","#settings-close",function(){U.FPS_MODE&&Zn&&(!lo&&window.allowEdit&&(lo=!0,B()("#alert").css("opacity","1"),B()("#alert span").text("To take a snapshot, press the P key on your keyboard!"),setTimeout(()=>{B()("#alert").css("opacity","0")},5e3)),L.AMBIENT.currentTime=0,D(L.AMBIENT),document.getElementById("blocker").style.display="none",U.PAUSED=!1,window.clockTimer=new b.zD7,setTimeout(()=>{U.ALLOW_PLACE_PORTALS=!0},1e3),u.controller={KeyE:{pressed:!1},KeyW:{pressed:!1},KeyS:{pressed:!1},KeyA:{pressed:!1},KeyD:{pressed:!1},Space:{pressed:!1}},U.PAUSED=!1,B()("#chamberName").css("opacity",0),U.MOBILE?(B()("#blocker").css("display","none"),B()("#mobile-controls").css("display","block"),Eo()):document.body.requestPointerLock(),B()("#container").css("filter","none"),U.DOOR_OPEN_STATE||(U.DOOR_OPEN_STATE=!0,setTimeout(()=>{S(1e3,U.CORRIDOR_ENTER.getObjectByName("rightDoor").rotation,new b.Pq0(U.CORRIDOR_ENTER.getObjectByName("rightDoor").rotation.x,Math.PI/8,U.CORRIDOR_ENTER.getObjectByName("rightDoor").rotation.z)),S(1e3,U.CORRIDOR_ENTER.getObjectByName("leftDoor").rotation,new b.Pq0(U.CORRIDOR_ENTER.getObjectByName("leftDoor").rotation.x,.9*Math.PI,U.CORRIDOR_ENTER.getObjectByName("leftDoor").rotation.z)),setTimeout(()=>{U.BODY_ELEVATOR.position.y=1e4},500),setTimeout(()=>{qn(1e3,!0,!1,U.ENTER_DOOR)},1e3)},500)))});var co=!1;function _o(){if(B()("#container").css("filter","blur(2px)"),document.getElementById("blocker").style.display="block",U.ALLOW_PLACE_PORTALS=!1,Zn=!1,U.PAUSED=!0,window.curentTimeOffset=U.STATS_UI.time,B()("#chamberName").css("opacity",1),!U.FINISHED){!window.previousAudio||window.previousAudio.paused||(co=!0,window.previousAudio.pause());for(var e=0;e<window.timeoutEvent.length;e++)window.timeoutEvent[e].pause()}setTimeout(()=>{Zn=!0},1500)}function uo(e){U.PLAYER.shapes[0].halfExtents.y+=e,U.PLAYER.shapes[0].updateConvexPolyhedronRepresentation(),U.PLAYER.computeAABB(),U.PLAYER.updateMassProperties()}document.addEventListener("pointerlockchange",()=>{if(document.pointerLockElement===document.body){if(!U.FINISHED){co&&(co=!1,window.previousAudio.play());for(var e=0;e<window.timeoutEvent.length;e++)window.timeoutEvent[e].resume()}}else _o()}),document.addEventListener("keyup",e=>{U.FPS_MODE&&(ao=!1,U.FPS_MODE&&Zn&&(u.controller[e.code]&&(u.controller[e.code].pressed=!1),U.PLAYER_MOVING=!1,u.headBobTimer=0,S(300,U.GUN.children[0].position,new b.Pq0(0,0,0)),u.crouched)&&(u.crouched=!1,uo(.25)),L.WALK.pause())}),B()("body").on("pointerdown","#crouch",function(){u.crouched=!0,uo(-.25)}),B()("body").on("pointerup","#crouch",function(){uo(.25)}),document.addEventListener("mousedown",e=>{U.MOBILE||null===document.pointerLockElement||vt(e.button,null,U.MAIN_CAMERA)}),document.getElementById("portal_l").addEventListener("pointerdown",function(){U.ALLOW_PLACE_PORTALS=!0,vt(0,null,U.MAIN_CAMERA)},!1),document.getElementById("portal_r").addEventListener("pointerdown",function(){U.ALLOW_PLACE_PORTALS=!0,vt(2,null,U.MAIN_CAMERA)},!1),document.getElementById("jump").addEventListener("pointerdown",function(){U.PLAYER.inJump||(u.shouldJump=!0)},!1),U.MOBILE||B()(".mobile").css("display","none"),B()("body").on("click","#close-warning",function(){B()("#initial-warning").css("display","none"),U.MOBILE&&Eo()}),B()("body").on("click",".settings-audio",function(){B()("#options-audio").css("display","block"),B()("#options-settings").css("display","none"),B()(".settings-menu").css("width","50%"),B()("#settings-menu-title").text("AUDIO"),B()("#done").css("display","block")}),B()("body").on("click",".settings-video",function(){B()("#options-video").css("display","block"),B()("#options-settings").css("display","none"),B()(".settings-menu").css("width","50%"),B()("#settings-menu-title").text("GRAPHICS"),B()("#done").css("display","block")}),B()("body").on("click",".settings-controls",function(){B()("#options-controls").css("display","block"),B()("#options-settings").css("display","none"),B()(".settings-menu").css("width","50%"),B()("#settings-menu-title").text("CONTROLS"),B()("#done").css("display","block")}),B()("body").on("click","#done",function(){B()("#options-video").css("display","none"),B()("#options-controls").css("display","none"),B()("#options-audio").css("display","none"),B()("#options-settings").css("display","block"),B()(".settings-menu").css("width","25%"),B()("#settings-menu-title").text("OPTIONS"),B()("#done").css("display","none")}),B()("body").on("click",".optionQuality",function(){B()("#alert").css("opacity","1"),B()("#alert span").text("You need to reload the page to apply!"),setTimeout(()=>{B()("#alert").css("opacity","0")},5e3)}),B()("#quality-select").on("change",function(){localStorage.setItem("quality-select",B()(this).val()),U.RENDERER.shadowMap.enabled=!1,"potato"==B()(this).val()?(B()("#recursive-select").val(2).change(),B()("#recursive-render-select").val(0).change(),B()("#resolution-select").val(.5).change(),B()("#shadows-resolution-select").val(512).change(),localStorage.setItem("antialising",!1)):"very_low"==B()(this).val()?(B()("#recursive-select").val(2).change(),B()("#recursive-render-select").val(0).change(),B()("#resolution-select").val(.5).change(),B()("#shadows-resolution-select").val(256).change(),localStorage.setItem("antialising",!1)):"low"==B()(this).val()?(B()("#recursive-select").val(2).change(),B()("#recursive-render-select").val(0).change(),B()("#resolution-select").val(.8).change(),B()("#shadows-resolution-select").val(1024).change(),localStorage.setItem("antialising",!1)):"medium"==B()(this).val()?(B()("#recursive-select").val(2).change(),B()("#recursive-render-select").val(0).change(),B()("#resolution-select").val(1).change(),B()("#shadows-resolution-select").val(1024).change(),localStorage.setItem("antialising",!0)):"high"!=B()(this).val()&&"epic"!=B()(this).val()||(U.RENDERER.shadowMap.enabled=!0,B()("#recursive-select").val(2).change(),B()("#recursive-render-select").val(1).change(),B()("#resolution-select").val(1).change(),B()("#shadows-resolution-select").val(2048).change(),localStorage.setItem("antialising",!0),U.RENDERER.shadowMap.autoUpdate=!0),po()}),B()("#recursive-select").on("change",function(){U.PORTAL_RECURSION_LEVELS=B()(this).val(),po()}),B()("#recursive-render-select").on("change",function(){U.PORTAL_RENDER_LEVEL=B()(this).val(),po()}),B()("#resolution-select").on("change",function(){U.PIXEL_RATIO=B()(this).val(),Ao&&(U.RENDERER.setPixelRatio(window.devicePixelRatio*B()(this).val()),po())}),B()("#shadows-resolution-select").on("change",function(){Ao&&(U.SPOTLIGHT.shadow.mapSize.width=B()(this).val(),U.SPOTLIGHT.shadow.mapSize.height=B()(this).val()),U.RENDERER.shadowMap.autoUpdate=!0,U.RENDERER.shadowMap.autoUpdate=!1,po()}),B()("body").on("input","#option-stats",function(){localStorage.setItem("option-stats",this.checked),this.checked?B()("#main-container").css("display","block"):B()("#main-container").css("display","none"),po()}),B()("#vol-val-range").on("input",function(){localStorage.setItem("vol-val-range",B()(this).val()),B()("#vol-val-number").val(B()(this).val()),B()(this).val()}),B()("#fov-val-range").on("input",function(){}),B()("#mouse-val-range").on("input",function(){localStorage.setItem("mouse-val-range",B()(this).val()),B()("#mouse-val-number").val(B()(this).val()),U.MOBILE||(U.POINTER_CONTROLS.pointerSpeed=B()(this).val()),po()}),B()("#reset-control").on("click",function(){B()("#fov-val-range").val(60).trigger("input"),B()("#mouse-val-range").val(.5).trigger("input")}),B()("body").on("input","#opacity-val-range",function(){B()("#opacity-val-number").val(B()(this).val()),B()("#mobile-controls").css("opacity",B()(this).val())}),B()("#arrow-menu").click(function(){"0px"==B()("#side-bar-left").css("left")?(B()("#side-bar-left").css("left","-350px"),B()("#arrow-menu i").addClass("fa-chevron-right"),B()("#arrow-menu i").removeClass("fa-chevron-left")):(B()("#side-bar-left").css("left","0px"),B()("#arrow-menu i").removeClass("fa-chevron-right"),B()("#arrow-menu i").addClass("fa-chevron-left"))}),B()(".item").mouseenter(function(){B()("#info-box").css("opacity",1),B()("#info-title").text(B()(this).data("title")),B()("#info-content").text(B()(this).data("content"))}),B()(".item").mouseleave(function(){B()("#info-box").css("opacity",0)});var Ao=!1;function po(){Ao&&(U.PAUSED=!1,setTimeout(()=>{U.PAUSED=!0},100),localStorage.setItem("saved",!0))}function mo(){0==Math.abs(window.orientation)?B()("#mobile-warning").css("display","flex"):B()("#mobile-warning").css("display","none")}localStorage.getItem("saved")||(B()("#recursive-select").val(U.PORTAL_RECURSION_LEVELS).change(),B()("#resolution-select").val(.5).change(),B()("#shadows-resolution-select").val(512).change()),localStorage.getItem("vol-val-range")&&B()("#vol-val-range").val(localStorage.getItem("vol-val-range")).trigger("input"),Ao=!0,B()("#social-youtube").on("click",function(){window.open("https://www.youtube.com/@Rafa_dante")}),B()("#social-patreon").on("click",function(){window.open("https://patreon.com/portalwebclone?utm_medium=unknown&utm_source=join_link&utm_campaign=creatorshare_creator&utm_content=copyLink")}),B()("#social-twitter").on("click",function(){window.open("https://x.com/RafaTecXR")}),B()("#social-discord").on("click",function(){window.open("https://discord.com/invite/dNj7TPBy2R")}),B()("#option-download").on("click",function(){window.open("https://drive.google.com/drive/folders/1V4JBopiETzoDdxIogca9_7XqLjbSaHTd?usp=sharing","_blank")}),window.addEventListener("orientationchange",e=>{U.MOBILE&&mo()}),mo(),B()("body").on("input","#option-player",function(){localStorage.setItem("option-player",this.checked),this.checked?(window.playerState=!0,U.SCENE_CHILDREN.add(U.PLAYER_MODEL),U.SCENE_FPS.add(U.GUN_CLONE),U.SCENE_FPS.add(U.GUN_CLONE2)):(window.playerState=!1,U.SCENE_CHILDREN.remove(U.PLAYER_MODEL),U.SCENE_CHILDREN.remove(U.PLAYER_MODEL_CLONE),U.SCENE_FPS.remove(U.GUN_CLONE),U.SCENE_FPS.remove(U.GUN_CLONE2)),po()}),"true"==localStorage.getItem("option-player")&&(B()("#option-player").prop("checked",!0),window.playerState=!0);s=window.innerWidth,l=window.innerHeight;let No=`
varying vec2 vUv; 
void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`;var a=`

// most of the code is from https://www.shadertoy.com/view/lsf3RH

uniform float iTime;
uniform int iPortal;
uniform int iOpened;
uniform vec4 resolution;

varying vec2 vUv;

float snoise(vec3 uv, float res)
{
	const vec3 s = vec3(1e0, 1e2, 1e3);
	
	uv *= res;
	
	vec3 uv0 = floor(mod(uv, res))*s;
	vec3 uv1 = floor(mod(uv+vec3(1.), res))*s;
	
	vec3 f = fract(uv); f = f*f*(3.0-2.0*f);

	vec4 v = vec4(uv0.x+uv0.y+uv0.z, uv1.x+uv0.y+uv0.z,
		      	  uv0.x+uv1.y+uv0.z, uv1.x+uv1.y+uv0.z);

	vec4 r = fract(sin(v*1e-1)*1e3);
	float r0 = mix(mix(r.x, r.y, f.x), mix(r.z, r.w, f.x), f.y);
	
	r = fract(sin((v + uv1.z - uv0.z)*1e-1)*1e3);
	float r1 = mix(mix(r.x, r.y, f.x), mix(r.z, r.w, f.x), f.y);
	
	return mix(r0, r1, f.z)*2.-1.;
}


void main( ) 
{
    vec2 p = -0.42 + 0.84 *vUv;
	//vec2 p = -.5 + gl_FragCoord.xy / resolution.xy;
	//p.x *= resolution.x/resolution.y;
	
    //p.x *= 1.5;
    
	float color = 3.0 - (3.*length(2.*p));
    
	vec3 coord = vec3(atan(p.x,p.y)/6.2832+.5, length(p)*.4, .5);
	
    coord = 1.0 - coord;

    //for(int i = 1; i <= 2; i++) {
        float power = pow(2.0, float(1));
        color += (0.4 / power) * snoise(coord + vec3(0.,-iTime*.05, iTime*.01), power*16.);
    //}

    color = 1.0 - color;
    color *= 2.7;
    color *= smoothstep(0.43, 0.4, length(p));

    //
    float pct = distance(vUv,vec2(0.5));
    // set solid background
    float y = smoothstep(0.35,0.525,pct);

    if(iOpened == 1){
        if(iPortal == 0){
            gl_FragColor = vec4(pow(max(color,0.),3.)*0.15, pow(max(color,0.),2.)*0.4, color, y);

            gl_FragColor = vec4(mix(vec3(1, 0.2, 0),vec3(color, pow(max(color,0.),2.)*0.4, pow(max(color,0.),3.)*0.15),color),y);
        }else{
            gl_FragColor = vec4(mix(vec3(0, 0.2, 1),vec3(pow(max(color,0.),3.)*0.15, pow(max(color,0.),2.)*0.4, color),color),y);
        }
    }else{
        if(iPortal == 0){
            //gl_FragColor  = vec4(color, pow(max(color,0.),2.)*0.4, pow(max(color,0.),3.)*0.15 , y);
            gl_FragColor = vec4(pow(max(color,0.),3.)*0.15, pow(max(color,0.),2.)*0.4, color, y);
        
            gl_FragColor = vec4(mix(vec3(1, 0.2, 0),vec3(color, pow(max(color,0.),2.)*0.4, pow(max(color,0.),3.)*0.15),color),1.0);
        }else{
            gl_FragColor = vec4(mix(vec3(0, 0.2, 1),vec3(pow(max(color,0.),3.)*0.15, pow(max(color,0.),2.)*0.4, color),color),1.0);
        }
    }

}
`,n=(U.UNIFORMS_PORTAL_GUN_ENERGY={iTime:{type:"f",value:1},iAlpha:{type:"f",value:0},iColor:{type:"v3",value:new b.Pq0(1,.25,0)},resolution:{type:"v2",value:new b.I9Y(10,1)},iChannel0:{type:"t",value:(new b.Tap).load("./assets/textures/shaders/energy2.png")}},new b.Gu$(15,32,16)),o=(new b.V9B({color:16776960}),U.MATERIAL_GUN=new b.BKk({uniforms:U.UNIFORMS_PORTAL_GUN_ENERGY,vertexShader:`
varying vec2 vUv; 
void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`,fragmentShader:`
//
uniform float iTime;
uniform float iAlpha;
uniform sampler2D iChannel0;
uniform sampler2D iChannel1;
uniform vec2 iResolution;
uniform vec3 iColor;

float height(in vec2 uv){
    float speed = 6.0;

    float topright=		sin(iTime*(speed+1.0)	-sin(length(uv-vec2(1.0,1.0)))*53.0);
    float topleft=		sin(iTime*(speed+1.0)	-sin(length(uv-vec2(0.0,1.0)))*37.0);
    float bottomright=	sin(iTime*(speed)    	-sin(length(uv-vec2(1.0,0.0)))*61.0);
    float bottomleft=	sin(iTime*(speed+2.0)	-sin(length(uv-vec2(0.0,0.0)))*47.0);

    float horizontalWaves=sin(iTime*(speed+2.0)-sin(uv.y)*47.0);
    
    
    float temp = horizontalWaves +bottomleft*0.4 +bottomright*0.2 +topleft*0.6 +topright*0.3;
    
    float b=smoothstep(-2.5,5.0,temp);
    return b*3.0;
}

varying vec2 vUv;

void main()
{
	//vec2 uv=gl_FragCoord.xy/iResolution.xy;

    vec2 uv= 0.0 + 1.0 *vUv;
    
    float waveHeight=0.4+height(uv);
    
    //vec3 color=vec3(waveHeight*0.3,waveHeight*0.5,waveHeight);
    vec3 color=vec3(waveHeight * iColor.x,waveHeight*iColor.y,waveHeight * iColor.z);
    
    gl_FragColor = vec4( color, iAlpha );
}
`,side:2,transparent:!0,opacity:0}),new b.eaF(n,U.MATERIAL_GUN),U.UNIFORMS_LIGHT_BRIDGE={time:{value:0}},new b.Q1f(0,.75,1)),i=("epic"==localStorage.getItem("quality-select")&&(o=new b.Q1f(0,1.5,2)),U.MATERIAL_LIGHT_BRIDGERS=new b.V9B({color:o,side:b.$EB,transparent:!0,blending:b.EZo,onBeforeCompile:e=>{e.uniforms.time=U.UNIFORMS_LIGHT_BRIDGE.time,e.fragmentShader=`
          uniform float time;
          ${e.fragmentShader}
        `.replace("#include <color_fragment>",`#include <color_fragment>
          float t = time;
          float mainWave = sin((vUv.x - t * 0.2) * 1.5 * PI2) * 0.5 + 0.5;
          mainWave = mainWave * 0.25 + 0.25;
          mainWave *= (sin(t * PI2 * 0.1) * 0.5 + 0.5) * 0.25 + 0.75;
          float sideLines = smoothstep(0.45, 0.5, abs(vUv.x - 0.5));
          float contactLines = smoothstep(0.45, 0.5, abs(vUv.y - 0.5));
          float scanLineSin = abs(vUv.x - (sin(t * 2.7) * 0.5 + 0.5));
          float scanLine = smoothstep(0.01, 0., scanLineSin);
          float fadeOut = pow(vUv.y, 2.7);
          
          
          float a = 0.;
          a = max(a, mainWave);
          a = max(a, sideLines);
          a = max(a, contactLines);
          //a = max(a, scanLine);
          
          diffuseColor.a = a;

            #include <tonemapping_fragment>
            #include <colorspace_fragment>
          
          `)}}),U.MATERIAL_LIGHT_BRIDGERS.defines={USE_UV:""},new b.Pq0(.02,.5,.95)),r=new b.Pq0(.95,.45,.02),t=(localStorage.getItem("quality-select"),U.UNIFORMS_TRACTOR_BEAM={iTime:{type:"f",value:1},iAlpha:{type:"f",value:1},iColor:{type:"v3",value:i}},U.UNIFORMS_TRACTOR_BEAM_ORANGE={iTime:{type:"f",value:1},iAlpha:{type:"f",value:1},iColor:{type:"v3",value:r}},`
attribute float height;  // Custom attribute for height

varying vec2 vUv; 
varying float vHeight;

void main()
{
    vHeight = height;  // Pass height to fragment shader
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`),n=(U.MATERIAL_TRACTOR_BEAM=new b.BKk({uniforms:U.UNIFORMS_TRACTOR_BEAM,vertexShader:t,fragmentShader:`
uniform float iTime;
uniform float iAlpha;
uniform vec2 iResolution;
uniform vec3 iColor;
varying vec2 vUv;
varying float vHeight;  // Received from vertex shader

float height(in vec2 uv) {
    float speed = 6.0;

    // Calculate normalized horizontal position
    float horizontalPos = uv.x + uv.y * vHeight;

    // Adjust frequency to spread waves evenly and control width
    float horizontalWaves = sin(iTime * (speed + 2.0) + horizontalPos * 18.85);

    float b = smoothstep(0.0, 4.0, horizontalWaves);
    return b * 3.0;
}

void main() {
    vec2 uv= -vUv;

    float waveHeight = height(uv);
    
    // Set transparency based on wave height
    float alpha = waveHeight; // Invert waveHeight to make black parts transparent
    
    vec3 color = vec3(waveHeight * iColor.x, waveHeight * iColor.y, waveHeight * iColor.z);

    // Glow effect: render the object with a halo around it
    float glowStrength = 0.2;
    float glowSize = 0.2;

    // Calculate distance from center (for circular glow)
    float dist = length(vUv - 0.5);

    // Apply glow based on distance from center
    float glow = glowStrength * smoothstep(glowSize, 0.0, dist);

    // Add glow to color
    color += vec3(glow);
    
    gl_FragColor = vec4(color, iAlpha * alpha);

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`,side:2,transparent:!0}),U.MATERIAL_TRACTOR_BEAM_REVERSE=new b.BKk({uniforms:U.UNIFORMS_TRACTOR_BEAM_ORANGE,vertexShader:t,fragmentShader:`
//
uniform float iTime;
uniform float iAlpha;
uniform vec2 iResolution;
uniform vec3 iColor;
varying vec2 vUv;
varying float vHeight;  // Received from vertex shader

float height(in vec2 uv) {
    float speed = 6.0;

    // Calculate normalized horizontal position
    float horizontalPos = uv.x + uv.y * vHeight;

    // Adjust frequency to spread waves evenly and control width
    float horizontalWaves = sin(iTime * (speed + 2.0) + horizontalPos * 18.85);

    float b = smoothstep(0.0, 4.0, horizontalWaves);
    return b * 3.0;
}

void main() {
    vec2 uv= vUv;

    float waveHeight = height(uv);
    
    // Set transparency based on wave height
    float alpha = waveHeight; // Invert waveHeight to make black parts transparent
    
    vec3 color = vec3(waveHeight * iColor.x, waveHeight * iColor.y, waveHeight * iColor.z);
    
    gl_FragColor = vec4(color, iAlpha * alpha);

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`,side:2,transparent:!0}),1),o=("epic"==localStorage.getItem("quality-select")&&(n=30),U.UNIFORMS_LASER_FIELD={iTime:{type:"f",value:1},iAlpha:{type:"f",value:1},iColor:{type:"v3",value:new b.Pq0(n,0,0)}},U.MATERIAL_LASER_FIELD=new b.BKk({uniforms:U.UNIFORMS_LASER_FIELD,vertexShader:`

varying vec2 vUv; 

void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`,fragmentShader:`
uniform float iTime;
uniform float iAlpha;
uniform vec2 iResolution;
uniform vec3 iColor;
varying vec2 vUv;

float height(in vec2 uv) {
    float speed = 2.0;

    // Calculate normalized horizontal position
    float horizontalPos = uv.x;

    // Adjust frequency to spread waves evenly and control width
    float horizontalWaves = sin(iTime * (speed + 2.0) + horizontalPos * 75.0);

    float b = smoothstep(0.0, 4.0, horizontalWaves);
    return b * 3.0;
}

void main() {
    vec2 uv= -vUv;

    float waveHeight = height(uv);
    
    // Set transparency based on wave height
    float alpha = waveHeight; // Invert waveHeight to make black parts transparent
    
    vec3 color = vec3(waveHeight * iColor.x, waveHeight * iColor.y, waveHeight * iColor.z);

    // Glow effect: render the object with a halo around it
    float glowStrength = 0.2;
    float glowSize = 0.2;

    // Calculate distance from center (for circular glow)
    float dist = length(vUv - 0.5);

    // Apply glow based on distance from center
    float glow = glowStrength * smoothstep(glowSize, 0.0, dist);

    // Add glow to color
    color += vec3(glow);
    
    gl_FragColor = vec4(color, iAlpha * alpha);

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`,side:2,transparent:!0}),U.UNIFORMS_FIZZLER={iTime:{value:0},iResolution:{type:"v2",value:new b.I9Y(1e3,1e3)}},U.MATERIAL_FIZZLER=new b.BKk({uniforms:U.UNIFORMS_FIZZLER,vertexShader:`
varying vec2 vUv; 
void main()
{
    vUv = uv;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;
}
`,fragmentShader:`
uniform float iTime;
uniform vec2 iResolution;

// Found this on GLSL sandbox. I really liked it, changed a few things and made it tileable.
// :)
// by David Hoskins.
// Original water turbulence effect by joltz0r


// Redefine below to see the tiling...
//#define SHOW_TILING

#define TAU 6.28318530718
#define MAX_ITER 5

varying vec2 vUv;

void main() 
{
	float time = iTime * .5+23.0;
    // uv should be the 0-1 uv of texture...
	//vec2 uv = gl_FragCoord.xy / iResolution.y;
  vec2 uv = -1.0 + 2.0 *vUv;
    
#ifdef SHOW_TILING
	vec2 p = mod(uv*TAU*2.0, TAU)-250.0;
#else
    vec2 p = mod(uv*TAU, TAU)-250.0;
#endif
	vec2 i = vec2(p);
	float c = 1.0;
	float inten = .005;

	for (int n = 0; n < MAX_ITER; n++) 
	{
		float t = time * (1.0 - (3.5 / float(n+1)));
		i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));
		c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));
	}
	c /= float(MAX_ITER);
	c = 1.17-pow(c, 1.4);
	vec3 colour = vec3(pow(abs(c), 8.0));
    colour = clamp(colour + vec3(0.0, 0.35, 0.5), 0.0, 1.0);
    
	gl_FragColor = vec4(colour, 0.15);
}
`,side:2,transparent:!0,opacity:.2,depthWrite:!1}),(new b.Tap).load("./assets/textures/noise.webp")),i=(o.wrapS=o.wrapT=b.GJx,(new b.Tap).load("./assets/textures/matcap.webp")),To=(i.colorSpace=b.er$,U.UNIFORMS_DISSOLVER={u_EffectOrigin:{value:new b.Pq0(3,2,3)},u_Time:{value:0},diffuseMap:{value:i},t_Noise:{value:o}},U.MATERIAL_DISSOLVER=new b.BKk({uniforms:U.UNIFORMS_DISSOLVER,vertexShader:`
    varying vec3 vViewPosition;
    varying vec3 vWorldPosition;
    varying vec2 vUv; // Pass UV coordinates to fragment shader
    
    #include <normal_pars_vertex>
    #include <uv_pars_vertex> // Include UV handling
    
    void main() {
      #include <beginnormal_vertex>
      #include <defaultnormal_vertex>
      #include <normal_vertex>
    
      #include <begin_vertex>
      #include <project_vertex>
    
      // Position of the mesh in world space
      vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;

      // Pass UV coordinates to fragment shader
      vUv = uv;
    
      vViewPosition = -mvPosition.xyz;
    }
    `,fragmentShader:`
    varying vec3 vViewPosition;
    varying vec3 vWorldPosition;
    varying vec2 vUv; // Receive UV coordinates from vertex shader
    
    uniform vec3 u_EffectOrigin;
    uniform sampler2D t_Noise;
    uniform float u_Time;
    uniform sampler2D diffuseMap; // Texture map
    
    #include <normal_pars_fragment>
    
    void main() {
      vec4 diffuseColor = texture2D(diffuseMap, vUv); // Sample texture map
      vec4 glowColor = vec4(0.2667, 0.8745, 0.6, 0.0);
    
      #include <normal_fragment_begin>
    
      vec3 viewDir = normalize(vViewPosition);
        vec3 x = normalize( vec3(viewDir.z, 0.0, - viewDir.x));
        vec3 y = cross(viewDir, x);
        vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
    
      vec4 tNoise = texture2D(t_Noise, uv+vec2(u_Time* -0.2, u_Time*0.1));
      float noise = (tNoise.r + tNoise.g + tNoise.b) / 3.0;
    
      float distancefromEffectOrigin = distance(vWorldPosition, u_EffectOrigin);
      
      float falloff = step(1.0, distancefromEffectOrigin - noise);

      // Apply falloff to dissolve effect
        float dissolveFactor = 1.0 - falloff; // Invert falloff for dissolve effect

        // Combine texture color with custom effect using dissolveFactor
        vec4 finalColor = mix(diffuseColor, glowColor, dissolveFactor);

        // Set fragment color
        gl_FragColor = finalColor;
    }
    `,side:2,transparent:!0,depthWrite:!1}),r=new b.BKk({uniforms:{iTime:{type:"f",value:.1},resolution:{value:new b.I9Y(s,l)},iPortal:{value:1},iOpened:{value:0}},vertexShader:No,fragmentShader:a,side:2,transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10}),(t=new b.tcD(U.PORTAL_WIDTH,50)).computeBoundsTree(),(r=new b.eaF(t,r)).name="portal-0",r.renderOrder=-1,U.PORTAL_SHADER[0]=r,n=new b.BKk({uniforms:{iTime:{type:"f",value:.1},resolution:{value:new b.I9Y(s,l)},iPortal:{value:0},iOpened:{value:0}},vertexShader:No,fragmentShader:a,side:2,transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10}),(t=new b.tcD(U.PORTAL_WIDTH,50)).computeBoundsTree(),(r=new b.eaF(t,n)).renderOrder=-1,r.name="portal-1",U.PORTAL_SHADER[1]=r,new b.zD7),Ro=new b.zD7,Ro=new b.zD7,Oo=0;let Io=1/60,Do=(new b.zD7,e=>{(Oo+=Ro.getDelta())>Io&&(Oo%=Io),Lo()}),Lo=e=>{var t=To.getDelta(),i=(U.UNIFORMS_PORTAL_GUN_ENERGY.iTime.value+=t,U.PORTALS[0]&&(U.PORTALS[0].portalShader.material.uniforms.iTime.value+=t),U.PORTALS[1]&&(U.PORTALS[1].portalShader.material.uniforms.iTime.value+=t),To.getElapsedTime());U.UNIFORMS_LIGHT_BRIDGE.time.value=i,U.UNIFORMS_TRACTOR_BEAM.iTime.value+=t,U.UNIFORMS_TRACTOR_BEAM_ORANGE.iTime.value+=t,U.UNIFORMS_FIZZLER.iTime.value+=t,U.UNIFORMS_LASER_FIELD.iTime.value+=t,U.UNIFORMS_DISSOLVER.u_Time.value=i};var go,So=!1,ho=!1,Co=!1,yo=!1,Mo=.01;let Po=null;window.PLAYER_JUMPING_FROM_BLUE_GEL=!1;var fo,vo=.1;let wo=new b.zD7,bo=0,Bo=0,Uo=0,Go=0;var xo=.1,Yo=!1,Vo=!1,Ho=!1,ko=!1;let Fo=function(e){ko=Ho=Vo=Yo=!1;var t=1100,i=(U.MOBILE&&null==Po&&!U.TELEPORTING_TARGET_QUATERNION&&(t=900,U.MAIN_CAMERA.rotation.y+=(U.TARGET_ROTATION_X-U.MAIN_CAMERA.rotation.y)*vo,go=U.TARGET_ROTATION_Y-U.MAIN_CAMERA.rotation.x,U.MAIN_CAMERA.rotation.x<=1.5&&-1.5<=U.MAIN_CAMERA.rotation.x&&(U.MAIN_CAMERA.rotation.x+=go*vo),1.5<U.MAIN_CAMERA.rotation.x?(u.blocked_top=!0,U.MAIN_CAMERA.rotation.x=1.5):u.blocked_top=!1,U.MAIN_CAMERA.rotation.x<-1.5?(u.blocked_bottom=!0,U.MAIN_CAMERA.rotation.x=-1.5):u.blocked_bottom=!1),new b.Pq0),i=(U.MAIN_CAMERA.getWorldDirection(i),i.projectOnPlane(U.PLAYER.upVectorThree).normalize()),n=i.clone().negate(),o=U.PLAYER.upVectorThree.clone().cross(i).normalize(),a=o.clone().negate();let r=1;U.PLAYER.inJump&&(r=.05),U.PLAYER.inJump?U.PLAYER.linearDamping=.01:U.PLAYER.linearDamping=.999;var s=u.fwdValue+u.bkdValue+u.lftValue+u.rgtValue;let l=1;2==s&&(l=1/Math.sqrt(s));var E,c,s=t*U.PLAYER.mass*r*e*U.SPEED;U.GEL_ORANGE&&U.PLAYER.applyForce(i.clone().multiplyScalar(3*s),U.PLAYER.position),U.STOP_TIME||U.GEL_ORANGE||window.PLAYER_JUMPING_FROM_BLUE_GEL||(null!==Po&&($o(E=navigator.getGamepads()[Po],5,0,1),$o(E,6,0,0),$o(E,7,0,2),1!=E.buttons[3].value||ho?0==E.buttons[3].value&&(u.crouched&&uo(.25),ho=!1,u.crouched=!1,0):(u.crouched=!0,uo(-.25),ho=!0),1!=E.buttons[1].value||So?0==E.buttons[1].value&&(So=!1):(Et(),So=!0),ea(E,12,Co),ea(E,15,yo),U.TELEPORTING_TARGET_QUATERNION||(t=E.axes[2],c=E.axes[3],bo-=2.5*t*e,Bo-=2.5*c*e,Bo=b.cj9.clamp(Bo,-Math.PI/2,Math.PI/2),Uo+=(bo-Uo)*xo,Go+=(Bo-Go)*xo,U.MAIN_CAMERA.rotation.x=Go,U.MAIN_CAMERA.rotation.y=Uo,U.MAIN_CAMERA.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,U.MAIN_CAMERA.rotation.x))),E.axes[1]<-.5&&(Yo=!0,Qo(i,s,l)),.5<E.axes[1]&&(Vo=!0,Qo(n,s,l)),E.axes[0]<-.5&&(Ho=!0,Qo(o,s,l)),.5<E.axes[0])&&(ko=!0,Qo(a,s,l)),U.MOBILE&&null==Po?(0<u.fwdValue&&(Yo=!0,Jo(i,s,u.fwdValue)),0<u.bkdValue&&(Vo=!0,Jo(n,s,u.bkdValue)),0<u.lftValue&&(Ho=!0,Jo(o,s,u.lftValue)),0<u.rgtValue&&(ko=!0,Jo(a,s,u.rgtValue)),u.shouldJump&&(U.PLAYER.inJump=!0,U.PLAYER.applyImpulse(U.PLAYER.upVectorThree.clone().multiplyScalar(200),U.PLAYER.position)),u.shouldJump=!1):(t=new b.Pq0(U.PLAYER.position.x,U.PLAYER.position.y,U.PLAYER.position.z),u.controller.KeyW.pressed&&(Yo=!0,Zo(i,t,s,l,e)),u.controller.KeyS.pressed&&(Vo=!0,Zo(n,t,s,l,e)),u.controller.KeyA.pressed&&(Ho=!0,Zo(o,t,s,l,e)),u.controller.KeyD.pressed&&(ko=!0,Zo(a,t,s,l,e)),u.shouldJump=!1,u.controller.Space.pressed||(qo=!1),null!==Po?0<E.buttons[0].value&&!U.PLAYER.inJump&&(u.shouldJump=!0):u.controller.Space.pressed&&!U.PLAYER.inJump&&(u.shouldJump=!0),!u.shouldJump||U.PLAYER.inJump||qo||Xo||(L.WALK.pause(),qo=!0,U.PLAYER.inJump=!0,U.PLAYER.jumpVelocity?(U.PLAYER.linearDamping=.01,c=-1*U.PLAYER.mass*U.PLAYER.jumpVelocity,i=new w.Vec3(c*U.PLAYER.upVectorThree.x,c*U.PLAYER.upVectorThree.y,c*U.PLAYER.upVectorThree.z),U.PLAYER.applyImpulse(i,U.PLAYER.position),U.PLAYER.jumpVelocity=null):U.PLAYER.applyImpulse(U.PLAYER.upVectorThree.clone().multiplyScalar(200),U.PLAYER.position),Xo=!0,setTimeout(()=>{Xo=!1},100),U.PLAYER.customGravity&&kt()))),ta(e),U.PLAYER_MOVING&&(U.GUN.children[0].position.x+=Math.sin(u.headBobTimer*U.HEAD_BOB_SPEED)*Mo*e)};var zo,jo,qo=!1,Xo=!1;window.gg=!1;let Wo=function(i){var e,t;U.TELEPORTING_TARGET_QUATERNION?(xo=1,U.MAIN_CAMERA.quaternion.slerp(U.TELEPORTING_TARGET_QUATERNION,.15),function(e,t,i){return i=2<arguments.length&&void 0!==i?i:.001,e=Math.abs(e.dot(t)),Math.abs(e-1)<i}(U.MAIN_CAMERA.quaternion,U.TELEPORTING_TARGET_QUATERNION)&&(U.TELEPORTING_TARGET_QUATERNION=null,U.MAIN_CAMERA.rotation.z=0,setTimeout(()=>{xo=.1},50)),U.GUN.position.copy(U.MAIN_CAMERA.position),U.GUN.quaternion.copy(U.MAIN_CAMERA.quaternion),U.PORTAL_GUN_CAMERA.position.copy(U.MAIN_CAMERA.position),U.PORTAL_GUN_CAMERA.quaternion.copy(U.MAIN_CAMERA.quaternion),U.TARGET_ROTATION_X=U.MAIN_CAMERA.rotation.y,U.TARGET_ROTATION_Y=U.MAIN_CAMERA.rotation.x,window.targetRotationOnMouseDownX=U.TARGET_ROTATION_X,window.targetRotationOnMouseDownY=U.TARGET_ROTATION_Y,Bo=U.MAIN_CAMERA.rotation.x,bo=U.MAIN_CAMERA.rotation.y):window.blockCamRotation||(U.GUN.quaternion.slerp(U.MAIN_CAMERA.quaternion,.075),e=U.GUN,t=i,e.position.y+=.0025*Math.sin(.001*t),e.rotation.x+=.00125*Math.sin(.001*t)),window.nnn&&U.PLAYER.EULER?((e=U.PLAYER.EULER).y=U.MAIN_CAMERA.rotation.y,(t=new b.PTz).setFromEuler(e),U.PLAYER.quaternion.copy(t)):U.PLAYER.quaternion.setFromAxisAngle(new w.Vec3(0,1,0),U.MAIN_CAMERA.rotation.y),100<U.MAIN_CAMERA.position.distanceTo(new b.Pq0(0,0,0))&&((n=U.ENTER_DOOR.clone()).translateZ(1),U.PLAYER.position.copy(n.position)),U.PLAYER_MODEL&&(U.PLAYER_MODEL.position.copy(U.PLAYER.position).add(U.PLAYER.upVectorThree.clone().multiplyScalar(-1)),U.PLAYER_MODEL.quaternion.copy(U.PLAYER.quaternion),U.PLAYER_MODEL.quaternion.multiply(new b.PTz(0,50,0)).normalize(),U.PLAYER_MODEL.translateY(.4),U.PLAYER_MODEL_CLONE.position.copy(U.PLAYER.position).add(U.PLAYER.upVectorThree.clone().multiplyScalar(-1)),U.PLAYER_MODEL_CLONE.quaternion.copy(U.PLAYER.quaternion),U.PLAYER_MODEL_CLONE.quaternion.multiply(new b.PTz(0,50,0)).normalize(),U.PLAYER_MODEL_CLONE.translateY(.4),U.PLAYER_MODEL_CLONE.visible=!1,U.PLAYER_MODEL_CLONE.traverse(e=>{var t;e.material&&(t=e.material.clone(),e.material=t,e.material.transparent=!1,e.material.opacity=1,e.material.colorWrite=!0,e.material.depthWrite=!0)}));if(U.PLAYER_MODEL){var n="ANIM_STANDING_IDLE",i="ANIM_STATIONARY_RUNNING",o="ANIM_BACKWARD_RUNNING",a="ANIM_JUMP",r="ANIM_LEFT_STRAFE",s="ANIM_RIGHT_STRAFE";"none"==U.PORTAL_GUN_INITIATE&&(n="ANIM_STANDING_IDLE_NO_GUN",i="ANIM_STATIONARY_RUNNING_NO_GUN",o="ANIM_BACKWARD_RUNNING_NO_GUN",a="ANIM_JUMP_NO_GUN",r="ANIM_LEFT_STRAFE_NO_GUN",s="ANIM_RIGHT_STRAFE_NO_GUN");let e=U.PLAYER_MODEL.animationActions[n],t=U.PLAYER_MODEL_CLONE.animationActions[n];if(U.PLAYER_MODEL.modelReady){U.PLAYER.inJump&&!U.PLAYER.inTractor?(e=U.PLAYER_MODEL.animationActions[a],t=U.PLAYER_MODEL_CLONE.animationActions[a]):Yo&&Ho&&ko&&Vo?(e=U.PLAYER_MODEL.animationActions[n],t=U.PLAYER_MODEL_CLONE.animationActions[n]):Yo&&Vo?(e=U.PLAYER_MODEL.animationActions[n],t=U.PLAYER_MODEL_CLONE.animationActions[n],ko?(e=U.PLAYER_MODEL.animationActions[s],t=U.PLAYER_MODEL_CLONE.animationActions[s]):Ho&&(e=U.PLAYER_MODEL.animationActions[r],t=U.PLAYER_MODEL_CLONE.animationActions[r])):Ho&&ko?(e=U.PLAYER_MODEL.animationActions[n],t=U.PLAYER_MODEL_CLONE.animationActions[n],Yo?(e=U.PLAYER_MODEL.animationActions[i],t=U.PLAYER_MODEL_CLONE.animationActions[i]):Vo&&(e=U.PLAYER_MODEL.animationActions[o],t=U.PLAYER_MODEL_CLONE.animationActions[o])):0<u.fwdValue&&0<u.rgtValue&&u.lftValue&&0<u.bkdValue?(e=U.PLAYER_MODEL.animationActions[n],t=U.PLAYER_MODEL_CLONE.animationActions[n]):0<u.fwdValue&&0<u.bkdValue?(e=U.PLAYER_MODEL.animationActions[n],t=U.PLAYER_MODEL_CLONE.animationActions[n],0<u.rgtValue?(e=U.PLAYER_MODEL.animationActions[s],t=U.PLAYER_MODEL_CLONE.animationActions[s]):u.lftValue&&(e=U.PLAYER_MODEL.animationActions[r],t=U.PLAYER_MODEL_CLONE.animationActions[r])):u.lftValue&&0<u.rgtValue?(e=U.PLAYER_MODEL.animationActions[n],t=U.PLAYER_MODEL_CLONE.animationActions[n],0<u.fwdValue?(e=U.PLAYER_MODEL.animationActions[i],t=U.PLAYER_MODEL_CLONE.animationActions[i]):0<u.bkdValue&&(e=U.PLAYER_MODEL.animationActions[o],t=U.PLAYER_MODEL_CLONE.animationActions[o])):((Yo||0<u.fwdValue)&&(e=U.PLAYER_MODEL.animationActions[i],t=U.PLAYER_MODEL_CLONE.animationActions[i]),(Vo||0<u.bkdValue)&&(e=U.PLAYER_MODEL.animationActions[o],t=U.PLAYER_MODEL_CLONE.animationActions[o]),(ko||0<u.rgtValue)&&(e=U.PLAYER_MODEL.animationActions[s],t=U.PLAYER_MODEL_CLONE.animationActions[s]),(Ho||u.lftValue)&&(e=U.PLAYER_MODEL.animationActions[r],t=U.PLAYER_MODEL_CLONE.animationActions[r]));a=e;if(a!=fo){jo=fo,fo=a;let e=.01;jo&&(e=.8,jo.fadeOut(e)),fo.reset(),fo.fadeIn(e),fo.play()}n=t;if(n!=zo){jo=zo,zo=n;let e=.01;jo&&(e=.8,jo.fadeOut(e)),zo.reset(),zo.fadeIn(e),zo.play()}i=wo.getDelta();U.MIXERS.update(i),U.MIXERS_CLONE.update(i)}}};function Zo(e,t,i,n,o){U.PLAYER.centering=!1,U.BLOCK_PLAYER_MOVE||(!L.WALK.paused||U.PLAYER.inJump||U.PLAYER.lightBridge?U.PLAYER.inJump||!U.PLAYER.lightBridge||L.WALK.paused||L.WALK.pause():(L.WALK.currentTime=0,D(L.WALK)),U.PLAYER_MOVING=!0,0==U.PLAYER.mass?(t.add(e.clone().multiplyScalar(+o)),U.PLAYER.position.copy(t)):(U.STATS_UI.steps+=.01,U.PLAYER.applyForce(e.clone().multiplyScalar(i*n),U.PLAYER.position)))}function Qo(e,t,i){U.BLOCK_PLAYER_MOVE||(U.PLAYER.applyForce(e.clone().multiplyScalar(t*i),U.PLAYER.position),U.PLAYER_MOVING=!0,u.headBobActive=!0)}function Jo(e,t,i){U.BLOCK_PLAYER_MOVE||(U.PLAYER.applyForce(e.clone().multiplyScalar(t*i),U.PLAYER.position),U.PLAYER_MOVING=!0)}var Ko=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];function $o(e,t,i,n){1!=e.buttons[t].value||Ko[t]?0==e.buttons[t].value&&(Ko[t]=!1):(vt(n,null,U.MAIN_CAMERA),Ko[t]=!0)}function ea(e,t,i){1==e.buttons[t].value&&!i||e.buttons[t].value}let ta=function(e){var t;u.headBobActive&&U.PLAYER_MOVING&&(t=Math.PI,t=(1+Math.floor((u.headBobTimer+1e-7)*U.HEAD_BOB_SPEED/t))*t/U.HEAD_BOB_SPEED,u.headBobTimer=Math.min(u.headBobTimer+e,t))};window.addEventListener("gamepadconnected",e=>{e=e.gamepad;Po=e.index}),window.addEventListener("gamepaddisconnected",e=>{Po=null});var ia=e(721);class I extends b.LoY{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};super(),this.type="LightningStrike",this.init(I.copyParameters(e,e)),this.createMesh()}static createRandomGenerator(){let t=2053,i=[];for(let e=0;e<t;e++)i.push(Math.random());let n={currentSeed:0,random:function(){var e=i[n.currentSeed];return n.currentSeed=(n.currentSeed+1)%t,e},getSeed:function(){return n.currentSeed/t},setSeed:function(e){n.currentSeed=Math.floor(e*t)%t}};return n}static copyParameters(){let t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};function e(e){return i===t?e:e.clone()}return t.sourceOffset=void 0!==i.sourceOffset?e(i.sourceOffset):new b.Pq0(0,100,0),t.destOffset=void 0!==i.destOffset?e(i.destOffset):new b.Pq0(0,0,0),t.timeScale=void 0!==i.timeScale?i.timeScale:1,t.roughness=void 0!==i.roughness?i.roughness:.9,t.straightness=void 0!==i.straightness?i.straightness:.7,t.up0=void 0!==i.up0?e(i.up0):new b.Pq0(0,0,1),t.up1=void 0!==i.up1?e(i.up1):new b.Pq0(0,0,1),t.radius0=void 0!==i.radius0?i.radius0:1,t.radius1=void 0!==i.radius1?i.radius1:1,t.radius0Factor=void 0!==i.radius0Factor?i.radius0Factor:.5,t.radius1Factor=void 0!==i.radius1Factor?i.radius1Factor:.2,t.minRadius=void 0!==i.minRadius?i.minRadius:.2,t.isEternal=void 0!==i.isEternal?i.isEternal:void 0===i.birthTime||void 0===i.deathTime,t.birthTime=i.birthTime,t.deathTime=i.deathTime,t.propagationTimeFactor=void 0!==i.propagationTimeFactor?i.propagationTimeFactor:.1,t.vanishingTimeFactor=void 0!==i.vanishingTimeFactor?i.vanishingTimeFactor:.9,t.subrayPeriod=void 0!==i.subrayPeriod?i.subrayPeriod:4,t.subrayDutyCycle=void 0!==i.subrayDutyCycle?i.subrayDutyCycle:.6,t.maxIterations=void 0!==i.maxIterations?i.maxIterations:9,t.isStatic=void 0!==i.isStatic&&i.isStatic,t.ramification=void 0!==i.ramification?i.ramification:5,t.maxSubrayRecursion=void 0!==i.maxSubrayRecursion?i.maxSubrayRecursion:3,t.recursionProbability=void 0!==i.recursionProbability?i.recursionProbability:.6,t.generateUVs=void 0!==i.generateUVs&&i.generateUVs,t.randomGenerator=i.randomGenerator,t.noiseSeed=i.noiseSeed,t.onDecideSubrayCreation=i.onDecideSubrayCreation,t.onSubrayCreation=i.onSubrayCreation,t}update(e){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=e&&e<=this.rayParameters.deathTime?(this.updateMesh(e),e<this.subrays[0].endPropagationTime?this.state=I.RAY_PROPAGATING:e>this.subrays[0].beginVanishingTime?this.state=I.RAY_VANISHING:this.state=I.RAY_STEADY,this.visible=!0):(this.visible=!1,e<this.rayParameters.birthTime?this.state=I.RAY_UNBORN:this.state=I.RAY_EXTINGUISHED))}init(e){this.rayParameters=e,this.maxIterations=void 0!==e.maxIterations?Math.floor(e.maxIterations):9,e.maxIterations=this.maxIterations,this.isStatic=void 0!==e.isStatic&&e.isStatic,e.isStatic=this.isStatic,this.ramification=void 0!==e.ramification?Math.floor(e.ramification):5,e.ramification=this.ramification,this.maxSubrayRecursion=void 0!==e.maxSubrayRecursion?Math.floor(e.maxSubrayRecursion):3,e.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==e.recursionProbability?e.recursionProbability:.6,e.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==e.generateUVs&&e.generateUVs,e.generateUVs=this.generateUVs,void 0!==e.randomGenerator?(this.randomGenerator=e.randomGenerator,this.seedGenerator=e.randomGenerator,void 0!==e.noiseSeed&&this.seedGenerator.setSeed(e.noiseSeed)):(this.randomGenerator=I.createRandomGenerator(),this.seedGenerator=Math),void 0!==e.onDecideSubrayCreation?this.onDecideSubrayCreation=e.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==e.onSubrayCreation&&(this.onSubrayCreation=e.onSubrayCreation)),this.state=I.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),e.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let e=0;e<this.maxSubrays;e++)this.subrays.push(this.createSubray());this.raySegments=[];for(let e=0;e<this.maxRaySegments;e++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new ia.h(this.seedGenerator),this.simplexY=new ia.h(this.seedGenerator),this.simplexZ=new ia.h(this.seedGenerator),this.forwards=new b.Pq0,this.forwardsFill=new b.Pq0,this.side=new b.Pq0,this.down=new b.Pq0,this.middlePos=new b.Pq0,this.middleLinPos=new b.Pq0,this.newPos=new b.Pq0,this.vPos=new b.Pq0,this.cross1=new b.Pq0}createMesh(){var e=1<<this.maxIterations,t=3*(1+e)*this.maxSubrays,e=18*e*this.maxSubrays;this.vertices=new Float32Array(3*t),this.indices=new Uint32Array(e),this.generateUVs&&(this.uvs=new Float32Array(2*t)),this.fillMesh(0),this.setIndex(new b.MW4(this.indices,1)),this.positionAttribute=new b.qtW(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new b.qtW(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=b.Vnu,this.positionAttribute.usage=b.Vnu,this.generateUVs&&(this.uvsAttribute.usage=b.Vnu)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(e){this.fillMesh(e),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(i){let n=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(i,function(e){var t=n.currentSubray;i<t.birthTime||(this.rayParameters.isEternal&&0==n.currentSubray.recursion?(n.createPrism(e),n.onDecideSubrayCreation(e,n)):i<t.endPropagationTime?n.timeFraction>=e.fraction0*t.propagationTimeFactor&&(n.createPrism(e),n.onDecideSubrayCreation(e,n)):((i<t.beginVanishingTime||n.timeFraction<=t.vanishingTimeFactor+e.fraction1*(1-t.vanishingTimeFactor))&&n.createPrism(e),n.onDecideSubrayCreation(e,n)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(e,t){e.pos0.copy(t.sourceOffset),e.pos1.copy(t.destOffset),e.up0.copy(t.up0),e.up1.copy(t.up1),e.radius0=t.radius0,e.radius1=t.radius1,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.timeScale=t.timeScale,e.roughness=t.roughness,e.straightness=t.straightness,e.propagationTimeFactor=t.propagationTimeFactor,e.vanishingTimeFactor=t.vanishingTimeFactor,e.maxIterations=this.maxIterations,e.seed=void 0!==t.noiseSeed?t.noiseSeed:0,e.recursion=0}fractalRay(t,e){this.time=t,this.currentSegmentCallback=e,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let e=0;e<this.numSubrays;e++){var i=this.subrays[e],n=(this.currentSubray=i,this.randomGenerator.setSeed(i.seed),i.endPropagationTime=b.cj9.lerp(i.birthTime,i.deathTime,i.propagationTimeFactor),i.beginVanishingTime=b.cj9.lerp(i.deathTime,i.birthTime,1-i.vanishingTimeFactor),this.randomGenerator.random),n=(i.linPos0.set(n(),n(),n()).multiplyScalar(1e3),i.linPos1.set(n(),n(),n()).multiplyScalar(1e3),this.timeFraction=(t-i.birthTime)/(i.deathTime-i.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0,this.getNewSegment());n.iteration=0,n.pos0.copy(i.pos0),n.pos1.copy(i.pos1),n.linPos0.copy(i.linPos0),n.linPos1.copy(i.linPos1),n.up0.copy(i.up0),n.up1.copy(i.up1),n.radius0=i.radius0,n.radius1=i.radius1,n.fraction0=0,n.fraction1=1,n.positionVariationFactor=1-i.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,i.recursion)/(1<<i.maxIterations),this.fractalRayRecursive(n)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(t){if(t.iteration>=this.currentSubray.maxIterations)this.currentSegmentCallback(t);else{this.forwards.subVectors(t.pos1,t.pos0);let e=this.forwards.length();e<1e-6&&(this.forwards.set(0,0,.01),e=this.forwards.length());var i=.5*(t.radius0+t.radius1),n=.5*(t.fraction0+t.fraction1),o=this.time*this.currentSubray.timeScale*Math.pow(2,t.iteration),a=(this.middlePos.lerpVectors(t.pos0,t.pos1,.5),this.middleLinPos.lerpVectors(t.linPos0,t.linPos1,.5),this.middleLinPos),a=(this.newPos.set(this.simplexX.noise4d(a.x,a.y,a.z,o),this.simplexY.noise4d(a.x,a.y,a.z,o),this.simplexZ.noise4d(a.x,a.y,a.z,o)),this.newPos.multiplyScalar(t.positionVariationFactor*e),this.newPos.add(this.middlePos),this.getNewSegment()),o=(a.pos0.copy(t.pos0),a.pos1.copy(this.newPos),a.linPos0.copy(t.linPos0),a.linPos1.copy(this.middleLinPos),a.up0.copy(t.up0),a.up1.copy(t.up1),a.radius0=t.radius0,a.radius1=i,a.fraction0=t.fraction0,a.fraction1=n,a.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,a.iteration=t.iteration+1,this.getNewSegment());o.pos0.copy(this.newPos),o.pos1.copy(t.pos1),o.linPos0.copy(this.middleLinPos),o.linPos1.copy(t.linPos1),this.cross1.crossVectors(t.up0,this.forwards.normalize()),o.up0.crossVectors(this.forwards,this.cross1).normalize(),o.up1.copy(t.up1),o.radius0=i,o.radius1=t.radius1,o.fraction0=n,o.fraction1=t.fraction1,o.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,o.iteration=t.iteration+1,this.fractalRayRecursive(a),this.fractalRayRecursive(o)}}createPrism(e){this.forwardsFill.subVectors(e.pos1,e.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(e.pos0,e.up0,this.forwardsFill,e.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(e.pos1,e.up0,this.forwardsFill,e.radius1,e.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(e,t,i,n){this.side.crossVectors(t,i).multiplyScalar(n*I.COS30DEG),this.down.copy(t).multiplyScalar(-n*I.SIN30DEG);var i=this.vPos,o=this.vertices;i.copy(e).sub(this.side).add(this.down),o[this.currentCoordinate++]=i.x,o[this.currentCoordinate++]=i.y,o[this.currentCoordinate++]=i.z,i.copy(e).add(this.side).add(this.down),o[this.currentCoordinate++]=i.x,o[this.currentCoordinate++]=i.y,o[this.currentCoordinate++]=i.z,i.copy(t).multiplyScalar(n).add(e),o[this.currentCoordinate++]=i.x,o[this.currentCoordinate++]=i.y,o[this.currentCoordinate++]=i.z,this.currentVertex+=3}createTriangleVerticesWithUVs(e,t,i,n,o){this.side.crossVectors(t,i).multiplyScalar(n*I.COS30DEG),this.down.copy(t).multiplyScalar(-n*I.SIN30DEG);var i=this.vPos,a=this.vertices,r=this.uvs;i.copy(e).sub(this.side).add(this.down),a[this.currentCoordinate++]=i.x,a[this.currentCoordinate++]=i.y,a[this.currentCoordinate++]=i.z,r[this.currentUVCoordinate++]=o,r[this.currentUVCoordinate++]=0,i.copy(e).add(this.side).add(this.down),a[this.currentCoordinate++]=i.x,a[this.currentCoordinate++]=i.y,a[this.currentCoordinate++]=i.z,r[this.currentUVCoordinate++]=o,r[this.currentUVCoordinate++]=.5,i.copy(t).multiplyScalar(n).add(e),a[this.currentCoordinate++]=i.x,a[this.currentCoordinate++]=i.y,a[this.currentCoordinate++]=i.z,r[this.currentUVCoordinate++]=o,r[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(e){var t=this.indices;e=this.currentVertex-6,t[this.currentIndex++]=1+e,t[this.currentIndex++]=2+e,t[this.currentIndex++]=5+e,t[this.currentIndex++]=1+e,t[this.currentIndex++]=5+e,t[this.currentIndex++]=4+e,t[this.currentIndex++]=e,t[this.currentIndex++]=1+e,t[this.currentIndex++]=4+e,t[this.currentIndex++]=e,t[this.currentIndex++]=4+e,t[this.currentIndex++]=3+e,t[this.currentIndex++]=2+e,t[this.currentIndex++]=e,t[this.currentIndex++]=3+e,t[this.currentIndex++]=2+e,t[this.currentIndex++]=3+e,t[this.currentIndex++]=5+e}createDefaultSubrayCreationCallbacks(){let _=this.randomGenerator.random,r=(this.onDecideSubrayCreation=function(e,t){var i,n=t.currentSubray,o=t.rayParameters.subrayPeriod,a=t.rayParameters.subrayDutyCycle,r=t.rayParameters.isEternal&&0==n.recursion?-_()*o:b.cj9.lerp(n.birthTime,n.endPropagationTime,e.fraction0)-_()*o,s=t.time-r,l=Math.floor(s/o),E=_()*(l+1);let c=0;s%o<=a*o&&(c=t.subrayProbability),n.recursion<t.maxSubrayRecursion&&t.numSubrays<t.maxSubrays&&_()<c&&(s=t.addNewSubray(),i=t.randomGenerator.getSeed(),s.seed=E,t.randomGenerator.setSeed(E),s.recursion=n.recursion+1,s.maxIterations=Math.max(1,n.maxIterations-1),s.linPos0.set(_(),_(),_()).multiplyScalar(1e3),s.linPos1.set(_(),_(),_()).multiplyScalar(1e3),s.up0.copy(n.up0),s.up1.copy(n.up1),s.radius0=e.radius0*t.rayParameters.radius0Factor,s.radius1=Math.min(t.rayParameters.minRadius,e.radius1*t.rayParameters.radius1Factor),s.birthTime=r+l*o,s.deathTime=s.birthTime+o*a,t.rayParameters.isEternal||0!=n.recursion||(s.birthTime=Math.max(s.birthTime,n.birthTime),s.deathTime=Math.min(s.deathTime,n.deathTime)),s.timeScale=2*n.timeScale,s.roughness=n.roughness,s.straightness=n.straightness,s.propagationTimeFactor=n.propagationTimeFactor,s.vanishingTimeFactor=n.vanishingTimeFactor,t.onSubrayCreation(e,n,s,t),t.randomGenerator.setSeed(i))},new b.Pq0),s=new b.Pq0,l=new b.Pq0,E=new b.Pq0;this.onSubrayCreation=function(e,t,i,n){n.subrayCylinderPosition(e,t,i,.5,.6,.2)},this.subrayConePosition=function(e,t,i,n,o,a){i.pos0.copy(e.pos0),r.subVectors(t.pos1,t.pos0),s.copy(r).normalize(),r.multiplyScalar(e.fraction0+(1-e.fraction0)*(_()*n));e=r.length(),l.crossVectors(t.up0,s),n=2*Math.PI*_();l.multiplyScalar(Math.cos(n)),E.copy(t.up0).multiplyScalar(Math.sin(n)),i.pos1.copy(l).add(E).multiplyScalar(e*o*(a+_()*(1-a))).add(r).add(t.pos0)},this.subrayCylinderPosition=function(e,t,i,n,o,a){i.pos0.copy(e.pos0),r.subVectors(t.pos1,t.pos0),s.copy(r).normalize(),r.multiplyScalar(e.fraction0+(1-e.fraction0)*((2*_()-1)*n));e=r.length(),l.crossVectors(t.up0,s),n=2*Math.PI*_();l.multiplyScalar(Math.cos(n)),E.copy(t.up0).multiplyScalar(Math.sin(n)),i.pos1.copy(l).add(E).multiplyScalar(e*o*(a+_()*(1-a))).add(r).add(t.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new b.Pq0,pos1:new b.Pq0,linPos0:new b.Pq0,linPos1:new b.Pq0,up0:new b.Pq0,up1:new b.Pq0,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new b.Pq0,pos1:new b.Pq0,linPos0:new b.Pq0,linPos1:new b.Pq0,up0:new b.Pq0,up1:new b.Pq0,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(e){return super.copy(e),this.init(I.copyParameters({},e.rayParameters)),this}clone(){return new this.constructor(I.copyParameters({},this.rayParameters))}}I.prototype.isLightningStrike=!0,I.RAY_INITIALIZED=0,I.RAY_UNBORN=1,I.RAY_PROPAGATING=2,I.RAY_STEADY=3,I.RAY_VANISHING=4,I.RAY_EXTINGUISHED=5,I.COS30DEG=Math.cos(30*Math.PI/180),I.SIN30DEG=Math.sin(30*Math.PI/180);let na={sourceOffset:new b.Pq0,destOffset:new b.Pq0,radius0:.001,radius1:.001,minRadius:25,maxIterations:7,isEternal:!0,timeScale:.7,propagationTimeFactor:.05,vanishingTimeFactor:.95,subrayPeriod:2.5,subrayDutyCycle:.3,maxSubrayRecursion:3,ramification:7,recursionProbability:.6,roughness:.85,straightness:.68},oa={sourceOffset:new b.Pq0,destOffset:new b.Pq0,radius0:.001,radius1:.001,minRadius:25,maxIterations:7,isEternal:!0,timeScale:.7,propagationTimeFactor:.05,vanishingTimeFactor:.95,subrayPeriod:2.5,subrayDutyCycle:.3,maxSubrayRecursion:3,ramification:7,recursionProbability:.6,roughness:.85,straightness:.68},aa={sourceOffset:new b.Pq0,destOffset:new b.Pq0,radius0:.001,radius1:.001,minRadius:25,maxIterations:7,isEternal:!0,timeScale:.7,propagationTimeFactor:.05,vanishingTimeFactor:.95,subrayPeriod:2.5,subrayDutyCycle:.3,maxSubrayRecursion:3,ramification:7,recursionProbability:.6,roughness:.85,straightness:.68},ra,sa,la,Ea,ca,_a;let da=0;var i=e(497),ua=e(445),Aa=0;let pa,ma;let Na=new b.zD7,Ta=new b.zD7,Ra=new b.zD7,Oa=0,Ia=0,Da=performance.now();var La=0;let ga,Sa=new b.PPD;o=document.createElement("div"),o.id="main-container",document.body.appendChild(o),U.STATS=new i.A({trackGPU:!0,trackHz:!0,trackCPT:!0,logsPerSecond:4,graphsPerSecond:30,samplesLog:40,samplesGraph:10,precision:2,horizontal:!0,minimal:!1,mode:0}),o.appendChild(U.STATS.dom),U.STATS.init(U.RENDERER),U.STATS.dom.style.display="none",t=new b.iNn(2,2,2),n=new b.V9B({color:65280});function ha(){U.OBSERVATION_ROOM_IMG.visible=!0,U.ROOM.name="ROOM",U.ITEMS_ADDED.name="ITEMS",U.CUBES.name="CUBES",U.SCENE_CHILDREN.add(U.LINES),U.SCENE_CHILDREN.add(U.ROOM),U.SCENE_CHILDREN.add(U.ITEMS_ADDED),U.ROOM.add(U.CUBES),U.SCENE_CHILDREN.add(U.ITEM_CUBE),U.SCENE.add(U.GUN_GROUP),U.SCENE.add(U.DEBUGGER_GROUP),U.SCENE.add(U.MAIN_CAMERA_GROUP),U.MAIN_CAMERA_GROUP.add(U.MAIN_CAMERA),U.PIVOT=U.MAIN_CAMERA,U.LIGHT_GROUP=new $i,U.LIGHT_GROUP.name="LIGHT_GROUP",pa=new b.BdL(U.RENDERER);var e=new ua.l(U.RENDERER),e=pa.fromScene(e).texture;U.SCENE.environment=e,(U.ENV_MAP=e).dispose(),pa.dispose(),(e=new b.NRn).setFromObject(U.CUBES),e.getCenter(U.CONTROLS.target),U.CONTROLS.target.set(U.CONTROLS.target.x+8,U.CONTROLS.target.y+2,U.CONTROLS.target.z+6),U.MAIN_CAMERA.position.set(-12.2,17.4,26.3),U.CONTROLS.update(),cn("/items/open.glb","door",!1),cn("/items/hd_portal_gun3.glb","gun",!1),cn("/items/cube_dispenser.glb","dispenser",!0,!1,.2,.5,!1,!1,!0,!1,null,null,null,100),U.MATERIAL_FLOOR_NON_PORTAL=new b._4j,Y(U.MATERIAL_FLOOR_NON_PORTAL,"metal/floor.jpg","metal/floor_normal.jpg",null,null,null,null,.7,0,.2,0,null,null),U.MATERIAL_FLOOR_PORTAL=U.MATERIAL_FLOOR_NON_PORTAL.clone(),Y(U.MATERIAL_FLOOR_PORTAL,"portal/floor.jpg","portal/floor_normal.jpg",null,null,null,null,1,0,.2,0,null,null),U.MATERIAL_WALL_PORTAL=new b._4j,Y(U.MATERIAL_WALL_PORTAL,"portal/wall1.jpg","portal/wall1_normal.jpg",null,null,null,null,1,0,.2,0,null,null),U.MATERIAL_WALL_PORTAL2=new b._4j,Y(U.MATERIAL_WALL_PORTAL2,"portal/wall2.jpg","portal/wall2_normal.jpg",null,null,null,null,1,0,.2,0,null,null),U.MATERIAL_WALL_PORTAL3=new b._4j,Y(U.MATERIAL_WALL_PORTAL3,"portal/wall3.jpg","portal/wall3_normal.jpg",null,null,null,null,1,0,.2,0,null,null),U.MATERIAL_WALL_PORTAL4=new b._4j,Y(U.MATERIAL_WALL_PORTAL4,"portal/wall4.jpg","portal/wall4_normal.jpg",null,null,null,null,1,0,.2,0,null,null),U.MATERIAL_WALL_NON_PORTAL=U.MATERIAL_WALL_PORTAL.clone(),Y(U.MATERIAL_WALL_NON_PORTAL,"metal/wall1.jpg","metal/wall1_normal.jpg",null,null,null,null,1,0,.2,0,null,null),U.MATERIAL_WALL_NON_PORTAL2=U.MATERIAL_WALL_PORTAL.clone(),Y(U.MATERIAL_WALL_NON_PORTAL2,"metal/wall2.jpg","metal/wall2_normal.jpg",null,null,null,null,1,0,.2,0,null,null),U.MATERIAL_GRID=new b._4j({side:2}),Y(U.MATERIAL_GRID,"wall/grid/1K_chain_1_basecolor.png","wall/grid/1K_chain_1_normal.png","wall/grid/1K_chain_1_ambientocclusion.png",null,null,"wall/grid/1K_chain_1_opacity.png",.25,1,.5,.5,100,100),U.MATERIAL_GLASS=new b._4j({transparent:!0,opacity:.5,side:2,depthWrite:!1}),Y(U.MATERIAL_GLASS,"wall/glass/Image_8.png","wall/glass/normal.png",null,null,null,null,.1,0,.8,0,null,null),window.addEventListener("resize",Ca),ra=new I(na),Ea=new b.eaF(ra,new b.V9B({color:new b.Q1f(2,2,2)})),sa=new I(oa),ca=new b.eaF(sa,new b.V9B({color:new b.Q1f(2,2,2)})),la=new I(aa),_a=new b.eaF(la,new b.V9B({color:new b.Q1f(2,2,2)})),(U.LIGHTNIN_STRIKE_1=Ea).visible=!1,(U.LIGHTNIN_STRIKE_2=ca).visible=!1,(U.LIGHTNIN_STRIKE_3=_a).visible=!1,U.LIGHTNIN_STRIKE_1.scale.set(1,1,1),U.LIGHTNIN_STRIKE_2.scale.set(1,1,1),U.LIGHTNIN_STRIKE_3.scale.set(1,1,1),Ea.layers.mask=2,ca.layers.mask=2,_a.layers.mask=2,U.RENDERER.setAnimationLoop(ya)}function Ca(){window.canvasWidth=Math.min(window.innerWidth,1920),window.canvasHeight=Math.min(window.innerHeight,1080),U.RENDERER.setSize(window.canvasWidth,window.canvasHeight),U.MAIN_CAMERA.aspect=window.canvasWidth/window.canvasHeight,U.MAIN_CAMERA.updateProjectionMatrix(),va.aspect=window.canvasWidth/window.canvasHeight,va.updateProjectionMatrix(),U.PORTAL_GUN_CAMERA.aspect=window.canvasWidth/window.canvasHeight,U.PORTAL_GUN_CAMERA.updateProjectionMatrix(),U.COMPOSER&&U.COMPOSER.setSize(window.canvasWidth,window.canvasHeight),U.PAUSED&&U.FPS_MODE&&(U.RENDERER.setRenderTarget(ma),U.RENDERER.localClippingEnabled=!1,U.RENDERER.clippingPlanes=[],"epic"==localStorage.getItem("quality-select")&&U.COMPOSER?U.COMPOSER.render():(U.RENDERER.autoClear=!1,U.RENDERER.clear(),U.RENDERER.render(U.SCENE,U.MAIN_CAMERA),document.getElementById("drawcalls").innerHTML="Drawcalls: "+U.RENDERER.info.render.calls,U.RENDERER.clearDepth(),U.RENDERER.render(U.GUN_GROUP,U.PORTAL_GUN_CAMERA)))}function ya(e){if(window.stopMenuLoop){if(U.FPS_MODE){if(!U.PAUSED){U.STATS.update(),U.STATS_UI.time=window.clockTimer.getElapsedTime()+window.curentTimeOffset,U.LEVEL_ENTERED&&0,Ia++;var t,i=performance.now();i>=Da+100&&(La=10*Math.round(100*Ia/(i-Da)),Ia=0,Da=i),i=Na.getDelta(),15<La&&(Fo(i),da+=.01,ra&&sa&&la&&U.FPS_MODE&&(o=U.GUN.getObjectByName("cube_1").position,a=U.GUN.getObjectByName("cube_2").position,t=U.GUN.getObjectByName("cube_3").position,ra.rayParameters.sourceOffset.copy(o),ra.rayParameters.destOffset.copy(U.PORTAL_GUN_FLASH.position),sa.rayParameters.sourceOffset.copy(a),sa.rayParameters.destOffset.copy(U.PORTAL_GUN_FLASH.position),la.rayParameters.sourceOffset.copy(t),la.rayParameters.destOffset.copy(U.PORTAL_GUN_FLASH.position),ra.update(da),sa.update(da),la.update(da))),U.CANNON_WORLD.step(1/60,i,3),Do(),ke(),nt(o=Ta.getDelta()),Wo(e),gt(),re(o);for(var n=0;n<U.TRIGGER_BOXES.length;n++)U.TRIGGER_BOXES[n].item.visible&&(U.TRIGGER_BOXES[n].item.visible=U.TRIGGER_BOXES[n].item.userData.triggerVisibility),U.TRIGGER_BOXES[n].box3.containsPoint(U.PLAYER.position)?U.TRIGGER_BOXES[n].item.userData.active||U.TRIGGER_BOXES[n].item.userData.played&&!U.TRIGGER_BOXES[n].item.userData.multipleTrigger||(U.TRIGGER_BOXES[n].item.userData.active=!0,"trigger_save"!=U.TRIGGER_BOXES[n].instancedName||U.PLAYER.spawnPosition.equals(U.TRIGGER_BOXES[n].item.position)?"trigger_voice"==U.TRIGGER_BOXES[n].instancedName&&F(U.TRIGGER_BOXES[n].item.userData):(L.POSITIVE.play(),U.PLAYER.spawnPosition=U.TRIGGER_BOXES[n].item.position),"trigger_audio"==U.TRIGGER_BOXES[n].instancedName&&(F(U.TRIGGER_BOXES[n].item.userData),U.PLANE_USER_DATA[U.SELECTED_ID[0]].item.userData.soundEffectLoop)&&L.AMBIENT.pause()):U.TRIGGER_BOXES[n].item.userData.active=!1;h.update();var o=e,e=(ga=!1,U.PLAYER&&U.PLAYER_MODEL&&(J(U.PLAYER_MODEL,!1,1),ga=U.PLAYER_MODEL_CLONE.visible),U.RENDERER.shadowMap.autoUpdate),a=(U.RENDERER.shadowMap.autoUpdate=!1,ma=U.RENDERER.getRenderTarget(),U.RENDERER.xr.enabled=!1,U.GUN_CLONE.visible=U.PLAYER_MODEL.visible,new b.Pq0);window.hand.getWorldPosition(a),U.GUN_CLONE.position.copy(a),U.GUN_CLONE.rotation.y=U.MAIN_CAMERA.rotation.y,-20<(a=180*U.MAIN_CAMERA.rotation.x/Math.PI)&&a<30?(window.neck.rotation.y=-U.MAIN_CAMERA.rotation.x,Aa=U.MAIN_CAMERA.rotation.x):window.neck.rotation.y=-Aa,Oa+=Ra.getDelta(),U.RENDERER.autoClearStencil=!1,0<U.PORTAL_RECURSION_LEVELS?(a=o-fa)>=Pa&&(fa=o-a%Pa,wa(0,1),wa(1,0)):U.PORTALS[0]&&U.PORTALS[1]&&1==U.PORTALS[0].portalShader.material.uniforms.iOpened.value&&(U.PORTALS[0].mesh.material.uniforms.texture1.value=null,U.PORTALS[1].mesh.material.uniforms.texture1.value=null,U.PORTALS[0].portalShader.material.uniforms.iOpened.value=0,U.PORTALS[1].portalShader.material.uniforms.iOpened.value=0),U.SCENE_CHILDREN.visible=!0,U.GUN_CLONE.visible=!1,(U.GUN_CLONE2.visible=ga)&&U.GUN_CLONE2&&window.posW&&(U.GUN_CLONE2.position.copy(window.posW),U.GUN_CLONE2.quaternion.copy(U.PLAYER_MODEL_CLONE.quaternion),U.GUN_CLONE2.rotation.y+=Math.PI),U.PLAYER&&U.PLAYER_MODEL&&(J(U.PLAYER_MODEL,!0,0),U.PLAYER_MODEL_CLONE.visible=ga),null===U.PORTALS[0]&&null!==U.PORTALS[1]&&(U.PORTALS[1].mesh.visible=!1),null!==U.PORTALS[0]&&null===U.PORTALS[1]&&(U.PORTALS[0].mesh.visible=!1),null!==U.PORTALS[0]&&null!==U.PORTALS[1]&&(U.PORTALS[0].mesh.visible=!0,U.PORTALS[1].mesh.visible=!0),U.RENDERER.shadowMap.autoUpdate=e;for(var r=0;r<U.CAMERA_OBJ_HORIZONTAL.length;r++)U.CAMERAS[r].fixed&&(U.CAMERA_OBJ_HORIZONTAL[r].lookAt(U.PIVOT.position),U.CAMERA_OBJ_HORIZONTAL[r].rotation.x=0,U.CAMERA_OBJ_HORIZONTAL[r].rotation.y=0);for(r=0;r<U.CAMERA_OBJ_VERTICAL.length;r++)U.CAMERAS[r].fixed&&(U.CAMERA_OBJ_VERTICAL[r].lookAt(U.PIVOT.position),U.CAMERA_OBJ_VERTICAL[r].rotation.z=0,U.CAMERA_OBJ_VERTICAL[r].rotation.y=0);U.RENDERER.setRenderTarget(ma),U.RENDERER.localClippingEnabled=!1,U.RENDERER.clippingPlanes=[],"epic"==localStorage.getItem("quality-select")&&U.COMPOSER?U.COMPOSER.render():(U.RENDERER.autoClear=!1,U.RENDERER.clear(),U.RENDERER.render(U.SCENE,U.MAIN_CAMERA),document.getElementById("drawcalls").innerHTML="Drawcalls: "+U.RENDERER.info.render.calls,U.RENDERER.clearDepth(),U.RENDERER.render(U.GUN_GROUP,U.PORTAL_GUN_CAMERA))}}else U.RENDERER.render(U.SCENE,U.MAIN_CAMERA),h.update(),document.getElementById("drawcalls").innerHTML="Drawcalls: "+U.RENDERER.info.render.calls;var s;U.FPS_MODE&&null!==Po&&(1!=(s=navigator.getGamepads()[Po]).buttons[9].value||s.buttons[9].pressed2?1!=s.buttons[0].value||s.buttons[0].pressed2||"block"==B()("#blocker").css("display")&&(s.buttons[0].pressed2=!0,setTimeout(()=>{s.buttons[0].pressed2=!1},100),(U.FINISHED?B()("#next-map-btn"):B()("#settings-close")).trigger("click")):(s.buttons[9].pressed2=!0,setTimeout(()=>{s.buttons[9].pressed2=!1},100),document.exitPointerLock(),_o()))}}U.ITEM_CUBE=new b.eaF(t,n),U.ITEM_CUBE.visible=!1,U.ITEM_CUBE.name="ITEM_CUBE",document.getElementById("container").appendChild(U.RENDERER.domElement);U.RENDERER.info.autoReset=!0;let Ma=60;"very_low"==localStorage.getItem("quality-select")?Ma=20:"low"==localStorage.getItem("quality-select")?Ma=30:"medium"==localStorage.getItem("quality-select")&&(Ma=40),window.curentTimeOffset=0,window.clockTimer=new b.zD7;let Pa=1e3/Ma,fa=0;let va=U.MAIN_CAMERA.clone();function wa(t,i){if(null!==U.PORTALS[t]&&null!==U.PORTALS[i]){var n,e=new b.PTz,{width:e,height:o}=(U.MAIN_CAMERA.getWorldQuaternion(e),va.position.copy(U.PIVOT.position),va.quaternion.copy(e),U.RENDERER.domElement),a=(U.PORTALS[t].mesh.material.uniforms.ww.value=e,U.PORTALS[t].mesh.material.uniforms.wh.value=o,U.PORTAL_TARGETS[t].setSize(e,o),U.PORTAL_TMP_TARGETS[t].setSize(e,o),U.PORTALS[t].mesh.material.stencilWrite=!0,U.RENDERER.clearStencil(),U.RENDERER.setRenderTarget(null),new Array(U.PORTAL_RECURSION_LEVELS+1));a[0]=Ba(va,U.PORTALS[t],null);for(let e=0;e<U.PORTAL_RECURSION_LEVELS;e++)a[e+1]=Ba(va,U.PORTALS[t],U.PORTALS[i].plane)&&a[e],ba(U.PORTALS[t],va);U.MOBILE?(U.PORTALS[t].mesh.visible=!1,U.PORTALS[i].mesh.visible=!1):(U.PORTALS[t].visible=!1,U.PORTALS[i].visible=!1),U.RENDERER.localClippingEnabled=!0;for(let e=U.PORTAL_RECURSION_LEVELS-1;0<=e;e--)0==e?(U.PLAYER_MODEL_CLONE.visible=!1,U.GUN_CLONE2.visible=!1):(U.PLAYER_MODEL_CLONE.visible=ga,U.GUN_CLONE2.visible=ga),e>U.PORTAL_RENDER_LEVEL?U.SCENE_CHILDREN.visible=!1:U.SCENE_CHILDREN.visible=!0,a[e]?(U.RENDERER.clippingPlanes=[U.PORTALS[i].plane.clone()],U.RENDERER.setRenderTarget(U.PORTAL_TMP_TARGETS[t]),U.RENDERER.clear(),U.RENDERER.render(U.SCENE,va),n=U.PORTAL_TARGETS[t],U.PORTAL_TARGETS[t]=U.PORTAL_TMP_TARGETS[t],U.PORTAL_TMP_TARGETS[t]=n,U.PORTALS[t].mesh.material.uniforms.texture1.value=U.PORTAL_TARGETS[t].texture,ba(U.PORTALS[i],va),U.PORTALS[t].visible=!0):ba(U.PORTALS[i],va);U.MOBILE?(U.PORTALS[t].mesh.visible=!0,U.PORTALS[i].mesh.visible=!0):(U.PORTALS[t].visible=!0,U.PORTALS[i].visible=!0),U.PORTALS[t].mesh.material.stencilWrite=!1}}function ba(e,t){var i=(new b.kn4).makeScale(-1,-1,1),i=e.CDBB.inverse_t.clone().premultiply(i).premultiply(e.output.CDBB.t);t.applyMatrix4(i)}function Ba(e,t,i){return e.updateMatrix(),e.updateMatrixWorld(),Sa.setFromProjectionMatrix((new b.kn4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),Sa.intersectsObject(t.mesh)&&(null===i||0<i.distanceToPoint(t.mesh.position))&&0<t.plane.distanceToPoint(e.position)}}}]);